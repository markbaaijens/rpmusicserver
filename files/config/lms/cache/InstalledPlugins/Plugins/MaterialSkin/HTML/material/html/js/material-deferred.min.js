/*! PhotoSwipe - v4.1.2 - 2017-04-05
* http://photoswipe.com
* Copyright (c) 2017 Dmitry Semenov; */
!function(a,b){"function"==typeof define&&define.amd?define(b):"object"==typeof exports?module.exports=b():a.PhotoSwipe=b()}(this,function(){"use strict";var a=function(a,b,c,d){var e={features:null,bind:function(a,b,c,d){var e=(d?"remove":"add")+"EventListener";b=b.split(" ");for(var f=0;f<b.length;f++)b[f]&&a[e](b[f],c,!1)},isArray:function(a){return a instanceof Array},createEl:function(a,b){var c=document.createElement(b||"div");return a&&(c.className=a),c},getScrollY:function(){var a=window.pageYOffset;return void 0!==a?a:document.documentElement.scrollTop},unbind:function(a,b,c){e.bind(a,b,c,!0)},removeClass:function(a,b){var c=new RegExp("(\\s|^)"+b+"(\\s|$)");a.className=a.className.replace(c," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")},addClass:function(a,b){e.hasClass(a,b)||(a.className+=(a.className?" ":"")+b)},hasClass:function(a,b){return a.className&&new RegExp("(^|\\s)"+b+"(\\s|$)").test(a.className)},getChildByClass:function(a,b){for(var c=a.firstChild;c;){if(e.hasClass(c,b))return c;c=c.nextSibling}},arraySearch:function(a,b,c){for(var d=a.length;d--;)if(a[d][c]===b)return d;return-1},extend:function(a,b,c){for(var d in b)if(b.hasOwnProperty(d)){if(c&&a.hasOwnProperty(d))continue;a[d]=b[d]}},easing:{sine:{out:function(a){return Math.sin(a*(Math.PI/2))},inOut:function(a){return-(Math.cos(Math.PI*a)-1)/2}},cubic:{out:function(a){return--a*a*a+1}}},detectFeatures:function(){if(e.features)return e.features;var a=e.createEl(),b=a.style,c="",d={};if(d.oldIE=document.all&&!document.addEventListener,d.touch="ontouchstart"in document.documentElement||navigator.maxTouchPoints>0,window.requestAnimationFrame&&(d.raf=window.requestAnimationFrame,d.caf=window.cancelAnimationFrame),d.pointerEvent=navigator.pointerEnabled||navigator.msPointerEnabled,!d.pointerEvent){var f=navigator.userAgent;if(/iP(hone|od)/.test(navigator.platform)){var g=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);g&&g.length>0&&(g=parseInt(g[1],10),g>=1&&g<8&&(d.isOldIOSPhone=!0))}var h=f.match(/Android\s([0-9\.]*)/),i=h?h[1]:0;i=parseFloat(i),i>=1&&(i<4.4&&(d.isOldAndroid=!0),d.androidVersion=i),d.isMobileOpera=/opera mini|opera mobi/i.test(f)}for(var j,k,l=["transform","perspective","animationName"],m=["","webkit","Moz","ms","O"],n=0;n<4;n++){c=m[n];for(var o=0;o<3;o++)j=l[o],k=c+(c?j.charAt(0).toUpperCase()+j.slice(1):j),!d[j]&&k in b&&(d[j]=k);c&&!d.raf&&(c=c.toLowerCase(),d.raf=window[c+"RequestAnimationFrame"],d.raf&&(d.caf=window[c+"CancelAnimationFrame"]||window[c+"CancelRequestAnimationFrame"]))}if(!d.raf){var p=0;d.raf=function(a){var b=(new Date).getTime(),c=Math.max(0,16-(b-p)),d=window.setTimeout(function(){a(b+c)},c);return p=b+c,d},d.caf=function(a){clearTimeout(a)}}return d.svg=!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,e.features=d,d}};e.detectFeatures(),e.features.oldIE&&(e.bind=function(a,b,c,d){b=b.split(" ");for(var e,f=(d?"detach":"attach")+"Event",g=function(){c.handleEvent.call(c)},h=0;h<b.length;h++)if(e=b[h])if("object"==typeof c&&c.handleEvent){if(d){if(!c["oldIE"+e])return!1}else c["oldIE"+e]=g;a[f]("on"+e,c["oldIE"+e])}else a[f]("on"+e,c)});var f=this,g=25,h=3,i={allowPanToNext:!0,spacing:.12,bgOpacity:1,mouseUsed:!1,loop:!0,pinchToClose:!0,closeOnScroll:!0,closeOnVerticalDrag:!0,verticalDragRange:.75,hideAnimationDuration:333,showAnimationDuration:333,showHideOpacity:!1,focus:!0,escKey:!0,arrowKeys:!0,mainScrollEndFriction:.35,panEndFriction:.35,isClickableElement:function(a){return"A"===a.tagName},getDoubleTapZoom:function(a,b){return a?1:b.initialZoomLevel<.7?1:1.33},maxSpreadZoom:1.33,modal:!0,scaleMode:"fit"};e.extend(i,d);var j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma=function(){return{x:0,y:0}},na=ma(),oa=ma(),pa=ma(),qa={},ra=0,sa={},ta=ma(),ua=0,va=!0,wa=[],xa={},ya=!1,za=function(a,b){e.extend(f,b.publicMethods),wa.push(a)},Aa=function(a){var b=ac();return a>b-1?a-b:a<0?b+a:a},Ba={},Ca=function(a,b){return Ba[a]||(Ba[a]=[]),Ba[a].push(b)},Da=function(a){var b=Ba[a];if(b){var c=Array.prototype.slice.call(arguments);c.shift();for(var d=0;d<b.length;d++)b[d].apply(f,c)}},Ea=function(){return(new Date).getTime()},Fa=function(a){ja=a,f.bg.style.opacity=a*i.bgOpacity},Ga=function(a,b,c,d,e){(!ya||e&&e!==f.currItem)&&(d/=e?e.fitRatio:f.currItem.fitRatio),a[E]=u+b+"px, "+c+"px"+v+" scale("+d+")"},Ha=function(a){ea&&(a&&(s>f.currItem.fitRatio?ya||(mc(f.currItem,!1,!0),ya=!0):ya&&(mc(f.currItem),ya=!1)),Ga(ea,pa.x,pa.y,s))},Ia=function(a){a.container&&Ga(a.container.style,a.initialPosition.x,a.initialPosition.y,a.initialZoomLevel,a)},Ja=function(a,b){b[E]=u+a+"px, 0px"+v},Ka=function(a,b){if(!i.loop&&b){var c=m+(ta.x*ra-a)/ta.x,d=Math.round(a-tb.x);(c<0&&d>0||c>=ac()-1&&d<0)&&(a=tb.x+d*i.mainScrollEndFriction)}tb.x=a,Ja(a,n)},La=function(a,b){var c=ub[a]-sa[a];return oa[a]+na[a]+c-c*(b/t)},Ma=function(a,b){a.x=b.x,a.y=b.y,b.id&&(a.id=b.id)},Na=function(a){a.x=Math.round(a.x),a.y=Math.round(a.y)},Oa=null,Pa=function(){Oa&&(e.unbind(document,"mousemove",Pa),e.addClass(a,"pswp--has_mouse"),i.mouseUsed=!0,Da("mouseUsed")),Oa=setTimeout(function(){Oa=null},100)},Qa=function(){e.bind(document,"keydown",f),N.transform&&e.bind(f.scrollWrap,"click",f),i.mouseUsed||e.bind(document,"mousemove",Pa),e.bind(window,"resize scroll orientationchange",f),Da("bindEvents")},Ra=function(){e.unbind(window,"resize scroll orientationchange",f),e.unbind(window,"scroll",r.scroll),e.unbind(document,"keydown",f),e.unbind(document,"mousemove",Pa),N.transform&&e.unbind(f.scrollWrap,"click",f),V&&e.unbind(window,p,f),clearTimeout(O),Da("unbindEvents")},Sa=function(a,b){var c=ic(f.currItem,qa,a);return b&&(da=c),c},Ta=function(a){return a||(a=f.currItem),a.initialZoomLevel},Ua=function(a){return a||(a=f.currItem),a.w>0?i.maxSpreadZoom:1},Va=function(a,b,c,d){return d===f.currItem.initialZoomLevel?(c[a]=f.currItem.initialPosition[a],!0):(c[a]=La(a,d),c[a]>b.min[a]?(c[a]=b.min[a],!0):c[a]<b.max[a]&&(c[a]=b.max[a],!0))},Wa=function(){if(E){var b=N.perspective&&!G;return u="translate"+(b?"3d(":"("),void(v=N.perspective?", 0px)":")")}E="left",e.addClass(a,"pswp--ie"),Ja=function(a,b){b.left=a+"px"},Ia=function(a){var b=a.fitRatio>1?1:a.fitRatio,c=a.container.style,d=b*a.w,e=b*a.h;c.width=d+"px",c.height=e+"px",c.left=a.initialPosition.x+"px",c.top=a.initialPosition.y+"px"},Ha=function(){if(ea){var a=ea,b=f.currItem,c=b.fitRatio>1?1:b.fitRatio,d=c*b.w,e=c*b.h;a.width=d+"px",a.height=e+"px",a.left=pa.x+"px",a.top=pa.y+"px"}}},Xa=function(a){var b="";i.escKey&&27===a.keyCode?b="close":i.arrowKeys&&(37===a.keyCode?b="prev":39===a.keyCode&&(b="next")),b&&(a.ctrlKey||a.altKey||a.shiftKey||a.metaKey||(a.preventDefault?a.preventDefault():a.returnValue=!1,f[b]()))},Ya=function(a){a&&(Y||X||fa||T)&&(a.preventDefault(),a.stopPropagation())},Za=function(){f.setScrollOffset(0,e.getScrollY())},$a={},_a=0,ab=function(a){$a[a]&&($a[a].raf&&I($a[a].raf),_a--,delete $a[a])},bb=function(a){$a[a]&&ab(a),$a[a]||(_a++,$a[a]={})},cb=function(){for(var a in $a)$a.hasOwnProperty(a)&&ab(a)},db=function(a,b,c,d,e,f,g){var h,i=Ea();bb(a);var j=function(){if($a[a]){if(h=Ea()-i,h>=d)return ab(a),f(c),void(g&&g());f((c-b)*e(h/d)+b),$a[a].raf=H(j)}};j()},eb={shout:Da,listen:Ca,viewportSize:qa,options:i,isMainScrollAnimating:function(){return fa},getZoomLevel:function(){return s},getCurrentIndex:function(){return m},isDragging:function(){return V},isZooming:function(){return aa},setScrollOffset:function(a,b){sa.x=a,M=sa.y=b,Da("updateScrollOffset",sa)},applyZoomPan:function(a,b,c,d){pa.x=b,pa.y=c,s=a,Ha(d)},init:function(){if(!j&&!k){var c;f.framework=e,f.template=a,f.bg=e.getChildByClass(a,"pswp__bg"),J=a.className,j=!0,N=e.detectFeatures(),H=N.raf,I=N.caf,E=N.transform,L=N.oldIE,f.scrollWrap=e.getChildByClass(a,"pswp__scroll-wrap"),f.container=e.getChildByClass(f.scrollWrap,"pswp__container"),n=f.container.style,f.itemHolders=y=[{el:f.container.children[0],wrap:0,index:-1},{el:f.container.children[1],wrap:0,index:-1},{el:f.container.children[2],wrap:0,index:-1}],y[0].el.style.display=y[2].el.style.display="none",Wa(),r={resize:f.updateSize,orientationchange:function(){clearTimeout(O),O=setTimeout(function(){qa.x!==f.scrollWrap.clientWidth&&f.updateSize()},500)},scroll:Za,keydown:Xa,click:Ya};var d=N.isOldIOSPhone||N.isOldAndroid||N.isMobileOpera;for(N.animationName&&N.transform&&!d||(i.showAnimationDuration=i.hideAnimationDuration=0),c=0;c<wa.length;c++)f["init"+wa[c]]();if(b){var g=f.ui=new b(f,e);g.init()}Da("firstUpdate"),m=m||i.index||0,(isNaN(m)||m<0||m>=ac())&&(m=0),f.currItem=_b(m),(N.isOldIOSPhone||N.isOldAndroid)&&(va=!1),a.setAttribute("aria-hidden","false"),i.modal&&(va?a.style.position="fixed":(a.style.position="absolute",a.style.top=e.getScrollY()+"px")),void 0===M&&(Da("initialLayout"),M=K=e.getScrollY());var l="pswp--open ";for(i.mainClass&&(l+=i.mainClass+" "),i.showHideOpacity&&(l+="pswp--animate_opacity "),l+=G?"pswp--touch":"pswp--notouch",l+=N.animationName?" pswp--css_animation":"",l+=N.svg?" pswp--svg":"",e.addClass(a,l),f.updateSize(),o=-1,ua=null,c=0;c<h;c++)Ja((c+o)*ta.x,y[c].el.style);L||e.bind(f.scrollWrap,q,f),Ca("initialZoomInEnd",function(){f.setContent(y[0],m-1),f.setContent(y[2],m+1),y[0].el.style.display=y[2].el.style.display="block",i.focus&&a.focus(),Qa()}),f.setContent(y[1],m),f.updateCurrItem(),Da("afterInit"),va||(w=setInterval(function(){_a||V||aa||s!==f.currItem.initialZoomLevel||f.updateSize()},1e3)),e.addClass(a,"pswp--visible")}},close:function(){j&&(j=!1,k=!0,Da("close"),Ra(),cc(f.currItem,null,!0,f.destroy))},destroy:function(){Da("destroy"),Xb&&clearTimeout(Xb),a.setAttribute("aria-hidden","true"),a.className=J,w&&clearInterval(w),e.unbind(f.scrollWrap,q,f),e.unbind(window,"scroll",f),zb(),cb(),Ba=null},panTo:function(a,b,c){c||(a>da.min.x?a=da.min.x:a<da.max.x&&(a=da.max.x),b>da.min.y?b=da.min.y:b<da.max.y&&(b=da.max.y)),pa.x=a,pa.y=b,Ha()},handleEvent:function(a){a=a||window.event,r[a.type]&&r[a.type](a)},goTo:function(a){a=Aa(a);var b=a-m;ua=b,m=a,f.currItem=_b(m),ra-=b,Ka(ta.x*ra),cb(),fa=!1,f.updateCurrItem()},next:function(){f.goTo(m+1)},prev:function(){f.goTo(m-1)},updateCurrZoomItem:function(a){if(a&&Da("beforeChange",0),y[1].el.children.length){var b=y[1].el.children[0];ea=e.hasClass(b,"pswp__zoom-wrap")?b.style:null}else ea=null;da=f.currItem.bounds,t=s=f.currItem.initialZoomLevel,pa.x=da.center.x,pa.y=da.center.y,a&&Da("afterChange")},invalidateCurrItems:function(){x=!0;for(var a=0;a<h;a++)y[a].item&&(y[a].item.needsUpdate=!0)},updateCurrItem:function(a){if(0!==ua){var b,c=Math.abs(ua);if(!(a&&c<2)){f.currItem=_b(m),ya=!1,Da("beforeChange",ua),c>=h&&(o+=ua+(ua>0?-h:h),c=h);for(var d=0;d<c;d++)ua>0?(b=y.shift(),y[h-1]=b,o++,Ja((o+2)*ta.x,b.el.style),f.setContent(b,m-c+d+1+1)):(b=y.pop(),y.unshift(b),o--,Ja(o*ta.x,b.el.style),f.setContent(b,m+c-d-1-1));if(ea&&1===Math.abs(ua)){var e=_b(z);e.initialZoomLevel!==s&&(ic(e,qa),mc(e),Ia(e))}ua=0,f.updateCurrZoomItem(),z=m,Da("afterChange")}}},updateSize:function(b){if(!va&&i.modal){var c=e.getScrollY();if(M!==c&&(a.style.top=c+"px",M=c),!b&&xa.x===window.innerWidth&&xa.y===window.innerHeight)return;xa.x=window.innerWidth,xa.y=window.innerHeight,a.style.height=xa.y+"px"}if(qa.x=f.scrollWrap.clientWidth,qa.y=f.scrollWrap.clientHeight,Za(),ta.x=qa.x+Math.round(qa.x*i.spacing),ta.y=qa.y,Ka(ta.x*ra),Da("beforeResize"),void 0!==o){for(var d,g,j,k=0;k<h;k++)d=y[k],Ja((k+o)*ta.x,d.el.style),j=m+k-1,i.loop&&ac()>2&&(j=Aa(j)),g=_b(j),g&&(x||g.needsUpdate||!g.bounds)?(f.cleanSlide(g),f.setContent(d,j),1===k&&(f.currItem=g,f.updateCurrZoomItem(!0)),g.needsUpdate=!1):d.index===-1&&j>=0&&f.setContent(d,j),g&&g.container&&(ic(g,qa),mc(g),Ia(g));x=!1}t=s=f.currItem.initialZoomLevel,da=f.currItem.bounds,da&&(pa.x=da.center.x,pa.y=da.center.y,Ha(!0)),Da("resize")},zoomTo:function(a,b,c,d,f){b&&(t=s,ub.x=Math.abs(b.x)-pa.x,ub.y=Math.abs(b.y)-pa.y,Ma(oa,pa));var g=Sa(a,!1),h={};Va("x",g,h,a),Va("y",g,h,a);var i=s,j={x:pa.x,y:pa.y};Na(h);var k=function(b){1===b?(s=a,pa.x=h.x,pa.y=h.y):(s=(a-i)*b+i,pa.x=(h.x-j.x)*b+j.x,pa.y=(h.y-j.y)*b+j.y),f&&f(b),Ha(1===b)};c?db("customZoomTo",0,1,c,d||e.easing.sine.inOut,k):k(1)}},fb=30,gb=10,hb={},ib={},jb={},kb={},lb={},mb=[],nb={},ob=[],pb={},qb=0,rb=ma(),sb=0,tb=ma(),ub=ma(),vb=ma(),wb=function(a,b){return a.x===b.x&&a.y===b.y},xb=function(a,b){return Math.abs(a.x-b.x)<g&&Math.abs(a.y-b.y)<g},yb=function(a,b){return pb.x=Math.abs(a.x-b.x),pb.y=Math.abs(a.y-b.y),Math.sqrt(pb.x*pb.x+pb.y*pb.y)},zb=function(){Z&&(I(Z),Z=null)},Ab=function(){V&&(Z=H(Ab),Qb())},Bb=function(){return!("fit"===i.scaleMode&&s===f.currItem.initialZoomLevel)},Cb=function(a,b){return!(!a||a===document)&&(!(a.getAttribute("class")&&a.getAttribute("class").indexOf("pswp__scroll-wrap")>-1)&&(b(a)?a:Cb(a.parentNode,b)))},Db={},Eb=function(a,b){return Db.prevent=!Cb(a.target,i.isClickableElement),Da("preventDragEvent",a,b,Db),Db.prevent},Fb=function(a,b){return b.x=a.pageX,b.y=a.pageY,b.id=a.identifier,b},Gb=function(a,b,c){c.x=.5*(a.x+b.x),c.y=.5*(a.y+b.y)},Hb=function(a,b,c){if(a-Q>50){var d=ob.length>2?ob.shift():{};d.x=b,d.y=c,ob.push(d),Q=a}},Ib=function(){var a=pa.y-f.currItem.initialPosition.y;return 1-Math.abs(a/(qa.y/2))},Jb={},Kb={},Lb=[],Mb=function(a){for(;Lb.length>0;)Lb.pop();return F?(la=0,mb.forEach(function(a){0===la?Lb[0]=a:1===la&&(Lb[1]=a),la++})):a.type.indexOf("touch")>-1?a.touches&&a.touches.length>0&&(Lb[0]=Fb(a.touches[0],Jb),a.touches.length>1&&(Lb[1]=Fb(a.touches[1],Kb))):(Jb.x=a.pageX,Jb.y=a.pageY,Jb.id="",Lb[0]=Jb),Lb},Nb=function(a,b){var c,d,e,g,h=0,j=pa[a]+b[a],k=b[a]>0,l=tb.x+b.x,m=tb.x-nb.x;return c=j>da.min[a]||j<da.max[a]?i.panEndFriction:1,j=pa[a]+b[a]*c,!i.allowPanToNext&&s!==f.currItem.initialZoomLevel||(ea?"h"!==ga||"x"!==a||X||(k?(j>da.min[a]&&(c=i.panEndFriction,h=da.min[a]-j,d=da.min[a]-oa[a]),(d<=0||m<0)&&ac()>1?(g=l,m<0&&l>nb.x&&(g=nb.x)):da.min.x!==da.max.x&&(e=j)):(j<da.max[a]&&(c=i.panEndFriction,h=j-da.max[a],d=oa[a]-da.max[a]),(d<=0||m>0)&&ac()>1?(g=l,m>0&&l<nb.x&&(g=nb.x)):da.min.x!==da.max.x&&(e=j))):g=l,"x"!==a)?void(fa||$||s>f.currItem.fitRatio&&(pa[a]+=b[a]*c)):(void 0!==g&&(Ka(g,!0),$=g!==nb.x),da.min.x!==da.max.x&&(void 0!==e?pa.x=e:$||(pa.x+=b.x*c)),void 0!==g)},Ob=function(a){if(!("mousedown"===a.type&&a.button>0)){if($b)return void a.preventDefault();if(!U||"mousedown"!==a.type){if(Eb(a,!0)&&a.preventDefault(),Da("pointerDown"),F){var b=e.arraySearch(mb,a.pointerId,"id");b<0&&(b=mb.length),mb[b]={x:a.pageX,y:a.pageY,id:a.pointerId}}var c=Mb(a),d=c.length;_=null,cb(),V&&1!==d||(V=ha=!0,e.bind(window,p,f),S=ka=ia=T=$=Y=W=X=!1,ga=null,Da("firstTouchStart",c),Ma(oa,pa),na.x=na.y=0,Ma(kb,c[0]),Ma(lb,kb),nb.x=ta.x*ra,ob=[{x:kb.x,y:kb.y}],Q=P=Ea(),Sa(s,!0),zb(),Ab()),!aa&&d>1&&!fa&&!$&&(t=s,X=!1,aa=W=!0,na.y=na.x=0,Ma(oa,pa),Ma(hb,c[0]),Ma(ib,c[1]),Gb(hb,ib,vb),ub.x=Math.abs(vb.x)-pa.x,ub.y=Math.abs(vb.y)-pa.y,ba=ca=yb(hb,ib))}}},Pb=function(a){if(a.preventDefault(),F){var b=e.arraySearch(mb,a.pointerId,"id");if(b>-1){var c=mb[b];c.x=a.pageX,c.y=a.pageY}}if(V){var d=Mb(a);if(ga||Y||aa)_=d;else if(tb.x!==ta.x*ra)ga="h";else{var f=Math.abs(d[0].x-kb.x)-Math.abs(d[0].y-kb.y);Math.abs(f)>=gb&&(ga=f>0?"h":"v",_=d)}}},Qb=function(){if(_){var a=_.length;if(0!==a)if(Ma(hb,_[0]),jb.x=hb.x-kb.x,jb.y=hb.y-kb.y,aa&&a>1){if(kb.x=hb.x,kb.y=hb.y,!jb.x&&!jb.y&&wb(_[1],ib))return;Ma(ib,_[1]),X||(X=!0,Da("zoomGestureStarted"));var b=yb(hb,ib),c=Vb(b);c>f.currItem.initialZoomLevel+f.currItem.initialZoomLevel/15&&(ka=!0);var d=1,e=Ta(),g=Ua();if(c<e)if(i.pinchToClose&&!ka&&t<=f.currItem.initialZoomLevel){var h=e-c,j=1-h/(e/1.2);Fa(j),Da("onPinchClose",j),ia=!0}else d=(e-c)/e,d>1&&(d=1),c=e-d*(e/3);else c>g&&(d=(c-g)/(6*e),d>1&&(d=1),c=g+d*e);d<0&&(d=0),ba=b,Gb(hb,ib,rb),na.x+=rb.x-vb.x,na.y+=rb.y-vb.y,Ma(vb,rb),pa.x=La("x",c),pa.y=La("y",c),S=c>s,s=c,Ha()}else{if(!ga)return;if(ha&&(ha=!1,Math.abs(jb.x)>=gb&&(jb.x-=_[0].x-lb.x),Math.abs(jb.y)>=gb&&(jb.y-=_[0].y-lb.y)),kb.x=hb.x,kb.y=hb.y,0===jb.x&&0===jb.y)return;if("v"===ga&&i.closeOnVerticalDrag&&!Bb()){na.y+=jb.y,pa.y+=jb.y;var k=Ib();return T=!0,Da("onVerticalDrag",k),Fa(k),void Ha()}Hb(Ea(),hb.x,hb.y),Y=!0,da=f.currItem.bounds;var l=Nb("x",jb);l||(Nb("y",jb),Na(pa),Ha())}}},Rb=function(a){if(N.isOldAndroid){if(U&&"mouseup"===a.type)return;a.type.indexOf("touch")>-1&&(clearTimeout(U),U=setTimeout(function(){U=0},600))}Da("pointerUp"),Eb(a,!1)&&a.preventDefault();var b;if(F){var c=e.arraySearch(mb,a.pointerId,"id");if(c>-1)if(b=mb.splice(c,1)[0],navigator.pointerEnabled)b.type=a.pointerType||"mouse";else{var d={4:"mouse",2:"touch",3:"pen"};b.type=d[a.pointerType],b.type||(b.type=a.pointerType||"mouse")}}var g,h=Mb(a),j=h.length;if("mouseup"===a.type&&(j=0),2===j)return _=null,!0;1===j&&Ma(lb,h[0]),0!==j||ga||fa||(b||("mouseup"===a.type?b={x:a.pageX,y:a.pageY,type:"mouse"}:a.changedTouches&&a.changedTouches[0]&&(b={x:a.changedTouches[0].pageX,y:a.changedTouches[0].pageY,type:"touch"})),Da("touchRelease",a,b));var k=-1;if(0===j&&(V=!1,e.unbind(window,p,f),zb(),aa?k=0:sb!==-1&&(k=Ea()-sb)),sb=1===j?Ea():-1,g=k!==-1&&k<150?"zoom":"swipe",aa&&j<2&&(aa=!1,1===j&&(g="zoomPointerUp"),Da("zoomGestureEnded")),_=null,Y||X||fa||T)if(cb(),R||(R=Sb()),R.calculateSwipeSpeed("x"),T){var l=Ib();if(l<i.verticalDragRange)f.close();else{var m=pa.y,n=ja;db("verticalDrag",0,1,300,e.easing.cubic.out,function(a){pa.y=(f.currItem.initialPosition.y-m)*a+m,Fa((1-n)*a+n),Ha()}),Da("onVerticalDrag",1)}}else{if(($||fa)&&0===j){var o=Ub(g,R);if(o)return;g="zoomPointerUp"}if(!fa)return"swipe"!==g?void Wb():void(!$&&s>f.currItem.fitRatio&&Tb(R))}},Sb=function(){var a,b,c={lastFlickOffset:{},lastFlickDist:{},lastFlickSpeed:{},slowDownRatio:{},slowDownRatioReverse:{},speedDecelerationRatio:{},speedDecelerationRatioAbs:{},distanceOffset:{},backAnimDestination:{},backAnimStarted:{},calculateSwipeSpeed:function(d){ob.length>1?(a=Ea()-Q+50,b=ob[ob.length-2][d]):(a=Ea()-P,b=lb[d]),c.lastFlickOffset[d]=kb[d]-b,c.lastFlickDist[d]=Math.abs(c.lastFlickOffset[d]),c.lastFlickDist[d]>20?c.lastFlickSpeed[d]=c.lastFlickOffset[d]/a:c.lastFlickSpeed[d]=0,Math.abs(c.lastFlickSpeed[d])<.1&&(c.lastFlickSpeed[d]=0),c.slowDownRatio[d]=.95,c.slowDownRatioReverse[d]=1-c.slowDownRatio[d],c.speedDecelerationRatio[d]=1},calculateOverBoundsAnimOffset:function(a,b){c.backAnimStarted[a]||(pa[a]>da.min[a]?c.backAnimDestination[a]=da.min[a]:pa[a]<da.max[a]&&(c.backAnimDestination[a]=da.max[a]),void 0!==c.backAnimDestination[a]&&(c.slowDownRatio[a]=.7,c.slowDownRatioReverse[a]=1-c.slowDownRatio[a],c.speedDecelerationRatioAbs[a]<.05&&(c.lastFlickSpeed[a]=0,c.backAnimStarted[a]=!0,db("bounceZoomPan"+a,pa[a],c.backAnimDestination[a],b||300,e.easing.sine.out,function(b){pa[a]=b,Ha()}))))},calculateAnimOffset:function(a){c.backAnimStarted[a]||(c.speedDecelerationRatio[a]=c.speedDecelerationRatio[a]*(c.slowDownRatio[a]+c.slowDownRatioReverse[a]-c.slowDownRatioReverse[a]*c.timeDiff/10),c.speedDecelerationRatioAbs[a]=Math.abs(c.lastFlickSpeed[a]*c.speedDecelerationRatio[a]),c.distanceOffset[a]=c.lastFlickSpeed[a]*c.speedDecelerationRatio[a]*c.timeDiff,pa[a]+=c.distanceOffset[a])},panAnimLoop:function(){if($a.zoomPan&&($a.zoomPan.raf=H(c.panAnimLoop),c.now=Ea(),c.timeDiff=c.now-c.lastNow,c.lastNow=c.now,c.calculateAnimOffset("x"),c.calculateAnimOffset("y"),Ha(),c.calculateOverBoundsAnimOffset("x"),c.calculateOverBoundsAnimOffset("y"),c.speedDecelerationRatioAbs.x<.05&&c.speedDecelerationRatioAbs.y<.05))return pa.x=Math.round(pa.x),pa.y=Math.round(pa.y),Ha(),void ab("zoomPan")}};return c},Tb=function(a){return a.calculateSwipeSpeed("y"),da=f.currItem.bounds,a.backAnimDestination={},a.backAnimStarted={},Math.abs(a.lastFlickSpeed.x)<=.05&&Math.abs(a.lastFlickSpeed.y)<=.05?(a.speedDecelerationRatioAbs.x=a.speedDecelerationRatioAbs.y=0,a.calculateOverBoundsAnimOffset("x"),a.calculateOverBoundsAnimOffset("y"),!0):(bb("zoomPan"),a.lastNow=Ea(),void a.panAnimLoop())},Ub=function(a,b){var c;fa||(qb=m);var d;if("swipe"===a){var g=kb.x-lb.x,h=b.lastFlickDist.x<10;g>fb&&(h||b.lastFlickOffset.x>20)?d=-1:g<-fb&&(h||b.lastFlickOffset.x<-20)&&(d=1)}var j;d&&(m+=d,m<0?(m=i.loop?ac()-1:0,j=!0):m>=ac()&&(m=i.loop?0:ac()-1,j=!0),j&&!i.loop||(ua+=d,ra-=d,c=!0));var k,l=ta.x*ra,n=Math.abs(l-tb.x);return c||l>tb.x==b.lastFlickSpeed.x>0?(k=Math.abs(b.lastFlickSpeed.x)>0?n/Math.abs(b.lastFlickSpeed.x):333,k=Math.min(k,400),k=Math.max(k,250)):k=333,qb===m&&(c=!1),fa=!0,Da("mainScrollAnimStart"),db("mainScroll",tb.x,l,k,e.easing.cubic.out,Ka,function(){cb(),fa=!1,qb=-1,(c||qb!==m)&&f.updateCurrItem(),Da("mainScrollAnimComplete")}),c&&f.updateCurrItem(!0),c},Vb=function(a){return 1/ca*a*t},Wb=function(){var a=s,b=Ta(),c=Ua();s<b?a=b:s>c&&(a=c);var d,g=1,h=ja;return ia&&!S&&!ka&&s<b?(f.close(),!0):(ia&&(d=function(a){Fa((g-h)*a+h)}),f.zoomTo(a,0,200,e.easing.cubic.out,d),!0)};za("Gestures",{publicMethods:{initGestures:function(){var a=function(a,b,c,d,e){A=a+b,B=a+c,C=a+d,D=e?a+e:""};F=N.pointerEvent,F&&N.touch&&(N.touch=!1),F?navigator.pointerEnabled?a("pointer","down","move","up","cancel"):a("MSPointer","Down","Move","Up","Cancel"):N.touch?(a("touch","start","move","end","cancel"),G=!0):a("mouse","down","move","up"),p=B+" "+C+" "+D,q=A,F&&!G&&(G=navigator.maxTouchPoints>1||navigator.msMaxTouchPoints>1),f.likelyTouchDevice=G,r[A]=Ob,r[B]=Pb,r[C]=Rb,D&&(r[D]=r[C]),N.touch&&(q+=" mousedown",p+=" mousemove mouseup",r.mousedown=r[A],r.mousemove=r[B],r.mouseup=r[C]),G||(i.allowPanToNext=!1)}}});var Xb,Yb,Zb,$b,_b,ac,bc,cc=function(b,c,d,g){Xb&&clearTimeout(Xb),$b=!0,Zb=!0;var h;b.initialLayout?(h=b.initialLayout,b.initialLayout=null):h=i.getThumbBoundsFn&&i.getThumbBoundsFn(m);var j=d?i.hideAnimationDuration:i.showAnimationDuration,k=function(){ab("initialZoom"),d?(f.template.removeAttribute("style"),f.bg.removeAttribute("style")):(Fa(1),c&&(c.style.display="block"),e.addClass(a,"pswp--animated-in"),Da("initialZoom"+(d?"OutEnd":"InEnd"))),g&&g(),$b=!1};if(!j||!h||void 0===h.x)return Da("initialZoom"+(d?"Out":"In")),s=b.initialZoomLevel,Ma(pa,b.initialPosition),Ha(),a.style.opacity=d?0:1,Fa(1),void(j?setTimeout(function(){k()},j):k());var n=function(){var c=l,g=!f.currItem.src||f.currItem.loadError||i.showHideOpacity;b.miniImg&&(b.miniImg.style.webkitBackfaceVisibility="hidden"),d||(s=h.w/b.w,pa.x=h.x,pa.y=h.y-K,f[g?"template":"bg"].style.opacity=.001,Ha()),bb("initialZoom"),d&&!c&&e.removeClass(a,"pswp--animated-in"),g&&(d?e[(c?"remove":"add")+"Class"](a,"pswp--animate_opacity"):setTimeout(function(){e.addClass(a,"pswp--animate_opacity")},30)),Xb=setTimeout(function(){if(Da("initialZoom"+(d?"Out":"In")),d){var f=h.w/b.w,i={x:pa.x,y:pa.y},l=s,m=ja,n=function(b){1===b?(s=f,pa.x=h.x,pa.y=h.y-M):(s=(f-l)*b+l,pa.x=(h.x-i.x)*b+i.x,pa.y=(h.y-M-i.y)*b+i.y),Ha(),g?a.style.opacity=1-b:Fa(m-b*m)};c?db("initialZoom",0,1,j,e.easing.cubic.out,n,k):(n(1),Xb=setTimeout(k,j+20))}else s=b.initialZoomLevel,Ma(pa,b.initialPosition),Ha(),Fa(1),g?a.style.opacity=1:Fa(1),Xb=setTimeout(k,j+20)},d?25:90)};n()},dc={},ec=[],fc={index:0,errorMsg:'<div class="pswp__error-msg"><a href="%url%" target="_blank">The image</a> could not be loaded.</div>',forceProgressiveLoading:!1,preload:[1,1],getNumItemsFn:function(){return Yb.length}},gc=function(){return{center:{x:0,y:0},max:{x:0,y:0},min:{x:0,y:0}}},hc=function(a,b,c){var d=a.bounds;d.center.x=Math.round((dc.x-b)/2),d.center.y=Math.round((dc.y-c)/2)+a.vGap.top,d.max.x=b>dc.x?Math.round(dc.x-b):d.center.x,d.max.y=c>dc.y?Math.round(dc.y-c)+a.vGap.top:d.center.y,d.min.x=b>dc.x?0:d.center.x,d.min.y=c>dc.y?a.vGap.top:d.center.y},ic=function(a,b,c){if(a.src&&!a.loadError){var d=!c;if(d&&(a.vGap||(a.vGap={top:0,bottom:0}),Da("parseVerticalMargin",a)),dc.x=b.x,dc.y=b.y-a.vGap.top-a.vGap.bottom,d){var e=dc.x/a.w,f=dc.y/a.h;a.fitRatio=e<f?e:f;var g=i.scaleMode;"orig"===g?c=1:"fit"===g&&(c=a.fitRatio),c>1&&(c=1),a.initialZoomLevel=c,a.bounds||(a.bounds=gc())}if(!c)return;return hc(a,a.w*c,a.h*c),d&&c===a.initialZoomLevel&&(a.initialPosition=a.bounds.center),a.bounds}return a.w=a.h=0,a.initialZoomLevel=a.fitRatio=1,a.bounds=gc(),a.initialPosition=a.bounds.center,a.bounds},jc=function(a,b,c,d,e,g){b.loadError||d&&(b.imageAppended=!0,mc(b,d,b===f.currItem&&ya),c.appendChild(d),g&&setTimeout(function(){b&&b.loaded&&b.placeholder&&(b.placeholder.style.display="none",b.placeholder=null)},500))},kc=function(a){a.loading=!0,a.loaded=!1;var b=a.img=e.createEl("pswp__img","img"),c=function(){a.loading=!1,a.loaded=!0,a.loadComplete?a.loadComplete(a):a.img=null,b.onload=b.onerror=null,b=null};return b.onload=c,b.onerror=function(){a.loadError=!0,c()},b.src=a.src,b},lc=function(a,b){if(a.src&&a.loadError&&a.container)return b&&(a.container.innerHTML=""),a.container.innerHTML=i.errorMsg.replace("%url%",a.src),!0},mc=function(a,b,c){if(a.src){b||(b=a.container.lastChild);var d=c?a.w:Math.round(a.w*a.fitRatio),e=c?a.h:Math.round(a.h*a.fitRatio);a.placeholder&&!a.loaded&&(a.placeholder.style.width=d+"px",a.placeholder.style.height=e+"px"),b.style.width=d+"px",b.style.height=e+"px"}},nc=function(){if(ec.length){for(var a,b=0;b<ec.length;b++)a=ec[b],a.holder.index===a.index&&jc(a.index,a.item,a.baseDiv,a.img,!1,a.clearPlaceholder);ec=[]}};za("Controller",{publicMethods:{lazyLoadItem:function(a){a=Aa(a);var b=_b(a);b&&(!b.loaded&&!b.loading||x)&&(Da("gettingData",a,b),b.src&&kc(b))},initController:function(){e.extend(i,fc,!0),f.items=Yb=c,_b=f.getItemAt,ac=i.getNumItemsFn,bc=i.loop,ac()<3&&(i.loop=!1),Ca("beforeChange",function(a){var b,c=i.preload,d=null===a||a>=0,e=Math.min(c[0],ac()),g=Math.min(c[1],ac());for(b=1;b<=(d?g:e);b++)f.lazyLoadItem(m+b);for(b=1;b<=(d?e:g);b++)f.lazyLoadItem(m-b)}),Ca("initialLayout",function(){f.currItem.initialLayout=i.getThumbBoundsFn&&i.getThumbBoundsFn(m)}),Ca("mainScrollAnimComplete",nc),Ca("initialZoomInEnd",nc),Ca("destroy",function(){for(var a,b=0;b<Yb.length;b++)a=Yb[b],a.container&&(a.container=null),a.placeholder&&(a.placeholder=null),a.img&&(a.img=null),a.preloader&&(a.preloader=null),a.loadError&&(a.loaded=a.loadError=!1);ec=null})},getItemAt:function(a){return a>=0&&(void 0!==Yb[a]&&Yb[a])},allowProgressiveImg:function(){return i.forceProgressiveLoading||!G||i.mouseUsed||screen.width>1200},setContent:function(a,b){i.loop&&(b=Aa(b));var c=f.getItemAt(a.index);c&&(c.container=null);var d,g=f.getItemAt(b);if(!g)return void(a.el.innerHTML="");Da("gettingData",b,g),a.index=b,a.item=g;var h=g.container=e.createEl("pswp__zoom-wrap");if(!g.src&&g.html&&(g.html.tagName?h.appendChild(g.html):h.innerHTML=g.html),lc(g),ic(g,qa),!g.src||g.loadError||g.loaded)g.src&&!g.loadError&&(d=e.createEl("pswp__img","img"),d.style.opacity=1,d.src=g.src,mc(g,d),jc(b,g,h,d,!0));else{if(g.loadComplete=function(c){if(j){if(a&&a.index===b){if(lc(c,!0))return c.loadComplete=c.img=null,ic(c,qa),Ia(c),void(a.index===m&&f.updateCurrZoomItem());c.imageAppended?!$b&&c.placeholder&&(c.placeholder.style.display="none",c.placeholder=null):N.transform&&(fa||$b)?ec.push({item:c,baseDiv:h,img:c.img,index:b,holder:a,clearPlaceholder:!0}):jc(b,c,h,c.img,fa||$b,!0)}c.loadComplete=null,c.img=null,Da("imageLoadComplete",b,c)}},e.features.transform){var k="pswp__img pswp__img--placeholder";k+=g.msrc?"":" pswp__img--placeholder--blank";var l=e.createEl(k,g.msrc?"img":"");g.msrc&&(l.src=g.msrc),mc(g,l),h.appendChild(l),g.placeholder=l}g.loading||kc(g),f.allowProgressiveImg()&&(!Zb&&N.transform?ec.push({item:g,baseDiv:h,img:g.img,index:b,holder:a}):jc(b,g,h,g.img,!0,!0))}Zb||b!==m?Ia(g):(ea=h.style,cc(g,d||g.img)),a.el.innerHTML="",a.el.appendChild(h)},cleanSlide:function(a){a.img&&(a.img.onload=a.img.onerror=null),a.loaded=a.loading=a.img=a.imageAppended=!1}}});var oc,pc={},qc=function(a,b,c){var d=document.createEvent("CustomEvent"),e={origEvent:a,target:a.target,releasePoint:b,pointerType:c||"touch"};d.initCustomEvent("pswpTap",!0,!0,e),a.target.dispatchEvent(d)};za("Tap",{publicMethods:{initTap:function(){Ca("firstTouchStart",f.onTapStart),Ca("touchRelease",f.onTapRelease),Ca("destroy",function(){pc={},oc=null})},onTapStart:function(a){a.length>1&&(clearTimeout(oc),oc=null)},onTapRelease:function(a,b){if(b&&!Y&&!W&&!_a){var c=b;if(oc&&(clearTimeout(oc),oc=null,xb(c,pc)))return void Da("doubleTap",c);if("mouse"===b.type)return void qc(a,b,"mouse");var d=a.target.tagName.toUpperCase();if("BUTTON"===d||e.hasClass(a.target,"pswp__single-tap"))return void qc(a,b);Ma(pc,c),oc=setTimeout(function(){qc(a,b),oc=null},300)}}}});var rc;za("DesktopZoom",{publicMethods:{initDesktopZoom:function(){L||(G?Ca("mouseUsed",function(){f.setupDesktopZoom()}):f.setupDesktopZoom(!0))},setupDesktopZoom:function(b){rc={};var c="wheel mousewheel DOMMouseScroll";Ca("bindEvents",function(){e.bind(a,c,f.handleMouseWheel)}),Ca("unbindEvents",function(){rc&&e.unbind(a,c,f.handleMouseWheel)}),f.mouseZoomedIn=!1;var d,g=function(){f.mouseZoomedIn&&(e.removeClass(a,"pswp--zoomed-in"),f.mouseZoomedIn=!1),s<1?e.addClass(a,"pswp--zoom-allowed"):e.removeClass(a,"pswp--zoom-allowed"),h()},h=function(){d&&(e.removeClass(a,"pswp--dragging"),d=!1)};Ca("resize",g),Ca("afterChange",g),Ca("pointerDown",function(){f.mouseZoomedIn&&(d=!0,e.addClass(a,"pswp--dragging"))}),Ca("pointerUp",h),b||g()},handleMouseWheel:function(a){if(s<=f.currItem.fitRatio)return i.modal&&(!i.closeOnScroll||_a||V?a.preventDefault():E&&Math.abs(a.deltaY)>2&&(l=!0,f.close())),!0;if(a.stopPropagation(),rc.x=0,"deltaX"in a)1===a.deltaMode?(rc.x=18*a.deltaX,rc.y=18*a.deltaY):(rc.x=a.deltaX,rc.y=a.deltaY);else if("wheelDelta"in a)a.wheelDeltaX&&(rc.x=-.16*a.wheelDeltaX),a.wheelDeltaY?rc.y=-.16*a.wheelDeltaY:rc.y=-.16*a.wheelDelta;else{if(!("detail"in a))return;rc.y=a.detail}Sa(s,!0);var b=pa.x-rc.x,c=pa.y-rc.y;(i.modal||b<=da.min.x&&b>=da.max.x&&c<=da.min.y&&c>=da.max.y)&&a.preventDefault(),f.panTo(b,c)},toggleDesktopZoom:function(b){b=b||{x:qa.x/2+sa.x,y:qa.y/2+sa.y};var c=i.getDoubleTapZoom(!0,f.currItem),d=s===c;f.mouseZoomedIn=!d,f.zoomTo(d?f.currItem.initialZoomLevel:c,b,333),e[(d?"remove":"add")+"Class"](a,"pswp--zoomed-in")}}});var sc,tc,uc,vc,wc,xc,yc,zc,Ac,Bc,Cc,Dc,Ec={history:!0,galleryUID:1},Fc=function(){return Cc.hash.substring(1)},Gc=function(){sc&&clearTimeout(sc),uc&&clearTimeout(uc)},Hc=function(){var a=Fc(),b={};if(a.length<5)return b;var c,d=a.split("&");for(c=0;c<d.length;c++)if(d[c]){var e=d[c].split("=");e.length<2||(b[e[0]]=e[1])}if(i.galleryPIDs){var f=b.pid;for(b.pid=0,c=0;c<Yb.length;c++)if(Yb[c].pid===f){b.pid=c;break}}else b.pid=parseInt(b.pid,10)-1;return b.pid<0&&(b.pid=0),b},Ic=function(){if(uc&&clearTimeout(uc),_a||V)return void(uc=setTimeout(Ic,500));vc?clearTimeout(tc):vc=!0;var a=m+1,b=_b(m);b.hasOwnProperty("pid")&&(a=b.pid);var c=yc+"&gid="+i.galleryUID+"&pid="+a;zc||Cc.hash.indexOf(c)===-1&&(Bc=!0);var d=Cc.href.split("#")[0]+"#"+c;Dc?"#"+c!==window.location.hash&&history[zc?"replaceState":"pushState"]("",document.title,d):zc?Cc.replace(d):Cc.hash=c,zc=!0,tc=setTimeout(function(){vc=!1},60)};za("History",{publicMethods:{initHistory:function(){if(e.extend(i,Ec,!0),i.history){Cc=window.location,Bc=!1,Ac=!1,zc=!1,yc=Fc(),Dc="pushState"in history,yc.indexOf("gid=")>-1&&(yc=yc.split("&gid=")[0],yc=yc.split("?gid=")[0]),Ca("afterChange",f.updateURL),Ca("unbindEvents",function(){e.unbind(window,"hashchange",f.onHashChange)});var a=function(){xc=!0,Ac||(Bc?history.back():yc?Cc.hash=yc:Dc?history.pushState("",document.title,Cc.pathname+Cc.search):Cc.hash=""),Gc()};Ca("unbindEvents",function(){l&&a()}),Ca("destroy",function(){xc||a()}),Ca("firstUpdate",function(){m=Hc().pid});var b=yc.indexOf("pid=");b>-1&&(yc=yc.substring(0,b),"&"===yc.slice(-1)&&(yc=yc.slice(0,-1))),setTimeout(function(){j&&e.bind(window,"hashchange",f.onHashChange)},40)}},onHashChange:function(){return Fc()===yc?(Ac=!0,void f.close()):void(vc||(wc=!0,f.goTo(Hc().pid),wc=!1))},updateURL:function(){Gc(),wc||(zc?sc=setTimeout(Ic,800):Ic())}}}),e.extend(f,eb)};return a});

/*! PhotoSwipe Default UI - 4.1.2 - 2017-04-05
* http://photoswipe.com
* Copyright (c) 2017 Dmitry Semenov; */
!function(a,b){"function"==typeof define&&define.amd?define(b):"object"==typeof exports?module.exports=b():a.PhotoSwipeUI_Default=b()}(this,function(){"use strict";var a=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v=this,w=!1,x=!0,y=!0,z={barsSize:{top:44,bottom:"auto"},closeElClasses:["item","caption","zoom-wrap","ui","top-bar"],timeToIdle:4e3,timeToIdleOutside:1e3,loadingIndicatorDelay:1e3,addCaptionHTMLFn:function(a,b){return a.title?(b.children[0].innerHTML=a.title,!0):(b.children[0].innerHTML="",!1)},closeEl:!0,captionEl:!0,fullscreenEl:!0,zoomEl:!0,shareEl:!0,counterEl:!0,arrowEl:!0,preloaderEl:!0,tapToClose:!1,tapToToggleControls:!0,clickToCloseNonZoomable:!0,shareButtons:[{id:"facebook",label:"Share on Facebook",url:"https://www.facebook.com/sharer/sharer.php?u={{url}}"},{id:"twitter",label:"Tweet",url:"https://twitter.com/intent/tweet?text={{text}}&url={{url}}"},{id:"pinterest",label:"Pin it",url:"http://www.pinterest.com/pin/create/button/?url={{url}}&media={{image_url}}&description={{text}}"},{id:"download",label:"Download image",url:"{{raw_image_url}}",download:!0}],getImageURLForShare:function(){return a.currItem.src||""},getPageURLForShare:function(){return window.location.href},getTextForShare:function(){return a.currItem.title||""},indexIndicatorSep:" / ",fitControlsWidth:1200},A=function(a){if(r)return!0;a=a||window.event,q.timeToIdle&&q.mouseUsed&&!k&&K();for(var c,d,e=a.target||a.srcElement,f=e.getAttribute("class")||"",g=0;g<S.length;g++)c=S[g],c.onTap&&f.indexOf("pswp__"+c.name)>-1&&(c.onTap(),d=!0);if(d){a.stopPropagation&&a.stopPropagation(),r=!0;var h=b.features.isOldAndroid?600:30;s=setTimeout(function(){r=!1},h)}},B=function(){return!a.likelyTouchDevice||q.mouseUsed||screen.width>q.fitControlsWidth},C=function(a,c,d){b[(d?"add":"remove")+"Class"](a,"pswp__"+c)},D=function(){var a=1===q.getNumItemsFn();a!==p&&(C(d,"ui--one-slide",a),p=a)},E=function(){C(i,"share-modal--hidden",y)},F=function(){return y=!y,y?(b.removeClass(i,"pswp__share-modal--fade-in"),setTimeout(function(){y&&E()},300)):(E(),setTimeout(function(){y||b.addClass(i,"pswp__share-modal--fade-in")},30)),y||H(),!1},G=function(b){b=b||window.event;var c=b.target||b.srcElement;return a.shout("shareLinkClick",b,c),!!c.href&&(!!c.hasAttribute("download")||(window.open(c.href,"pswp_share","scrollbars=yes,resizable=yes,toolbar=no,location=yes,width=550,height=420,top=100,left="+(window.screen?Math.round(screen.width/2-275):100)),y||F(),!1))},H=function(){for(var a,b,c,d,e,f="",g=0;g<q.shareButtons.length;g++)a=q.shareButtons[g],c=q.getImageURLForShare(a),d=q.getPageURLForShare(a),e=q.getTextForShare(a),b=a.url.replace("{{url}}",encodeURIComponent(d)).replace("{{image_url}}",encodeURIComponent(c)).replace("{{raw_image_url}}",c).replace("{{text}}",encodeURIComponent(e)),f+='<a href="'+b+'" target="_blank" class="pswp__share--'+a.id+'"'+(a.download?"download":"")+">"+a.label+"</a>",q.parseShareButtonOut&&(f=q.parseShareButtonOut(a,f));i.children[0].innerHTML=f,i.children[0].onclick=G},I=function(a){for(var c=0;c<q.closeElClasses.length;c++)if(b.hasClass(a,"pswp__"+q.closeElClasses[c]))return!0},J=0,K=function(){clearTimeout(u),J=0,k&&v.setIdle(!1)},L=function(a){a=a?a:window.event;var b=a.relatedTarget||a.toElement;b&&"HTML"!==b.nodeName||(clearTimeout(u),u=setTimeout(function(){v.setIdle(!0)},q.timeToIdleOutside))},M=function(){q.fullscreenEl&&!b.features.isOldAndroid&&(c||(c=v.getFullscreenAPI()),c?(b.bind(document,c.eventK,v.updateFullscreen),v.updateFullscreen(),b.addClass(a.template,"pswp--supports-fs")):b.removeClass(a.template,"pswp--supports-fs"))},N=function(){q.preloaderEl&&(O(!0),l("beforeChange",function(){clearTimeout(o),o=setTimeout(function(){a.currItem&&a.currItem.loading?(!a.allowProgressiveImg()||a.currItem.img&&!a.currItem.img.naturalWidth)&&O(!1):O(!0)},q.loadingIndicatorDelay)}),l("imageLoadComplete",function(b,c){a.currItem===c&&O(!0)}))},O=function(a){n!==a&&(C(m,"preloader--active",!a),n=a)},P=function(a){var c=a.vGap;if(B()){var g=q.barsSize;if(q.captionEl&&"auto"===g.bottom)if(f||(f=b.createEl("pswp__caption pswp__caption--fake"),f.appendChild(b.createEl("pswp__caption__center")),d.insertBefore(f,e),b.addClass(d,"pswp__ui--fit")),q.addCaptionHTMLFn(a,f,!0)){var h=f.clientHeight;c.bottom=parseInt(h,10)||44}else c.bottom=g.top;else c.bottom="auto"===g.bottom?0:g.bottom;c.top=g.top}else c.top=c.bottom=0},Q=function(){q.timeToIdle&&l("mouseUsed",function(){b.bind(document,"mousemove",K),b.bind(document,"mouseout",L),t=setInterval(function(){J++,2===J&&v.setIdle(!0)},q.timeToIdle/2)})},R=function(){l("onVerticalDrag",function(a){x&&a<.95?v.hideControls():!x&&a>=.95&&v.showControls()});var a;l("onPinchClose",function(b){x&&b<.9?(v.hideControls(),a=!0):a&&!x&&b>.9&&v.showControls()}),l("zoomGestureEnded",function(){a=!1,a&&!x&&v.showControls()})},S=[{name:"caption",option:"captionEl",onInit:function(a){e=a}},{name:"share-modal",option:"shareEl",onInit:function(a){i=a},onTap:function(){F()}},{name:"button--share",option:"shareEl",onInit:function(a){h=a},onTap:function(){F()}},{name:"button--zoom",option:"zoomEl",onTap:a.toggleDesktopZoom},{name:"counter",option:"counterEl",onInit:function(a){g=a}},{name:"button--close",option:"closeEl",onTap:a.close},{name:"button--arrow--left",option:"arrowEl",onTap:a.prev},{name:"button--arrow--right",option:"arrowEl",onTap:a.next},{name:"button--fs",option:"fullscreenEl",onTap:function(){c.isFullscreen()?c.exit():c.enter()}},{name:"preloader",option:"preloaderEl",onInit:function(a){m=a}}],T=function(){var a,c,e,f=function(d){if(d)for(var f=d.length,g=0;g<f;g++){a=d[g],c=a.className;for(var h=0;h<S.length;h++)e=S[h],c.indexOf("pswp__"+e.name)>-1&&(q[e.option]?(b.removeClass(a,"pswp__element--disabled"),e.onInit&&e.onInit(a)):b.addClass(a,"pswp__element--disabled"))}};f(d.children);var g=b.getChildByClass(d,"pswp__top-bar");g&&f(g.children)};v.init=function(){b.extend(a.options,z,!0),q=a.options,d=b.getChildByClass(a.scrollWrap,"pswp__ui"),l=a.listen,R(),l("beforeChange",v.update),l("doubleTap",function(b){var c=a.currItem.initialZoomLevel;a.getZoomLevel()!==c?a.zoomTo(c,b,333):a.zoomTo(q.getDoubleTapZoom(!1,a.currItem),b,333)}),l("preventDragEvent",function(a,b,c){var d=a.target||a.srcElement;d&&d.getAttribute("class")&&a.type.indexOf("mouse")>-1&&(d.getAttribute("class").indexOf("__caption")>0||/(SMALL|STRONG|EM)/i.test(d.tagName))&&(c.prevent=!1)}),l("bindEvents",function(){b.bind(d,"pswpTap click",A),b.bind(a.scrollWrap,"pswpTap",v.onGlobalTap),a.likelyTouchDevice||b.bind(a.scrollWrap,"mouseover",v.onMouseOver)}),l("unbindEvents",function(){y||F(),t&&clearInterval(t),b.unbind(document,"mouseout",L),b.unbind(document,"mousemove",K),b.unbind(d,"pswpTap click",A),b.unbind(a.scrollWrap,"pswpTap",v.onGlobalTap),b.unbind(a.scrollWrap,"mouseover",v.onMouseOver),c&&(b.unbind(document,c.eventK,v.updateFullscreen),c.isFullscreen()&&(q.hideAnimationDuration=0,c.exit()),c=null)}),l("destroy",function(){q.captionEl&&(f&&d.removeChild(f),b.removeClass(e,"pswp__caption--empty")),i&&(i.children[0].onclick=null),b.removeClass(d,"pswp__ui--over-close"),b.addClass(d,"pswp__ui--hidden"),v.setIdle(!1)}),q.showAnimationDuration||b.removeClass(d,"pswp__ui--hidden"),l("initialZoomIn",function(){q.showAnimationDuration&&b.removeClass(d,"pswp__ui--hidden")}),l("initialZoomOut",function(){b.addClass(d,"pswp__ui--hidden")}),l("parseVerticalMargin",P),T(),q.shareEl&&h&&i&&(y=!0),D(),Q(),M(),N()},v.setIdle=function(a){k=a,C(d,"ui--idle",a)},v.update=function(){x&&a.currItem?(v.updateIndexIndicator(),q.captionEl&&(q.addCaptionHTMLFn(a.currItem,e),C(e,"caption--empty",!a.currItem.title)),w=!0):w=!1,y||F(),D()},v.updateFullscreen=function(d){d&&setTimeout(function(){a.setScrollOffset(0,b.getScrollY())},50),b[(c.isFullscreen()?"add":"remove")+"Class"](a.template,"pswp--fs")},v.updateIndexIndicator=function(){q.counterEl&&(g.innerHTML=a.getCurrentIndex()+1+q.indexIndicatorSep+q.getNumItemsFn())},v.onGlobalTap=function(c){c=c||window.event;var d=c.target||c.srcElement;if(!r)if(c.detail&&"mouse"===c.detail.pointerType){if(I(d))return void a.close();b.hasClass(d,"pswp__img")&&(1===a.getZoomLevel()&&a.getZoomLevel()<=a.currItem.fitRatio?q.clickToCloseNonZoomable&&a.close():a.toggleDesktopZoom(c.detail.releasePoint))}else if(q.tapToToggleControls&&(x?v.hideControls():v.showControls()),q.tapToClose&&(b.hasClass(d,"pswp__img")||I(d)))return void a.close()},v.onMouseOver=function(a){a=a||window.event;var b=a.target||a.srcElement;C(d,"ui--over-close",I(b))},v.hideControls=function(){b.addClass(d,"pswp__ui--hidden"),x=!1},v.showControls=function(){x=!0,w||v.update(),b.removeClass(d,"pswp__ui--hidden")},v.supportsFullscreen=function(){var a=document;return!!(a.exitFullscreen||a.mozCancelFullScreen||a.webkitExitFullscreen||a.msExitFullscreen)},v.getFullscreenAPI=function(){var b,c=document.documentElement,d="fullscreenchange";return c.requestFullscreen?b={enterK:"requestFullscreen",exitK:"exitFullscreen",elementK:"fullscreenElement",eventK:d}:c.mozRequestFullScreen?b={enterK:"mozRequestFullScreen",exitK:"mozCancelFullScreen",elementK:"mozFullScreenElement",eventK:"moz"+d}:c.webkitRequestFullscreen?b={enterK:"webkitRequestFullscreen",exitK:"webkitExitFullscreen",elementK:"webkitFullscreenElement",eventK:"webkit"+d}:c.msRequestFullscreen&&(b={enterK:"msRequestFullscreen",exitK:"msExitFullscreen",elementK:"msFullscreenElement",eventK:"MSFullscreenChange"}),b&&(b.enter=function(){return j=q.closeOnScroll,q.closeOnScroll=!1,"webkitRequestFullscreen"!==this.enterK?a.template[this.enterK]():void a.template[this.enterK](Element.ALLOW_KEYBOARD_INPUT)},b.exit=function(){return q.closeOnScroll=j,document[this.exitK]()},b.isFullscreen=function(){return document[this.elementK]}),b}};return a});
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var f=a[d];f in c||(c[f]={});c=c[f]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function c(a){return a instanceof f?a:new f(function(b,c){b(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};b.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var d=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){d(a,
0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];a[b]=null;try{c()}catch(l){this.asyncThrow_(l)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var f=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(m){b.reject(m)}};f.prototype.createResolveAndReject_=
function(){function a(a){return function(d){c||(c=!0,a.call(b,d))}}var b=this,c=!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};f.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof f)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};f.prototype.resolveToNonPromiseObj_=function(a){var b=
void 0;try{b=a.then}catch(m){this.reject_(m);return}"function"==typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)};f.prototype.reject_=function(a){this.settle_(2,a)};f.prototype.fulfill_=function(a){this.settle_(1,a)};f.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};f.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=
0;a<this.onSettledCallbacks_.length;++a)h.asyncExecute(this.onSettledCallbacks_[a]);this.onSettledCallbacks_=null}};var h=new b;f.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};f.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(l){c.reject(l)}};f.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{d(a(b))}catch(z){g(z)}}:
b}var d,g,e=new f(function(a,b){d=a;g=b});this.callWhenSettled_(c(a,d),c(b,g));return e};f.prototype.catch=function(a){return this.then(void 0,a)};f.prototype.callWhenSettled_=function(a,b){function c(){switch(d.state_){case 1:a(d.result_);break;case 2:b(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?h.asyncExecute(c):this.onSettledCallbacks_.push(c)};f.resolve=c;f.reject=function(a){return new f(function(b,c){c(a)})};f.race=function(a){return new f(function(b,
d){for(var f=$jscomp.makeIterator(a),g=f.next();!g.done;g=f.next())c(g.value).callWhenSettled_(b,d)})};f.all=function(a){var b=$jscomp.makeIterator(a),d=b.next();return d.done?c([]):new f(function(a,f){function e(b){return function(c){g[b]=c;h--;0==h&&a(g)}}var g=[],h=0;do g.push(void 0),h++,c(d.value).callWhenSettled_(e(g.length-1),f),d=b.next();while(!d.done)})};return f},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};
$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};
$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};$jscomp.generator.Context.prototype.yieldAll=function(a,b){a=$jscomp.makeIterator(a);var c=a.next();$jscomp.generator.ensureIteratorResultIsObject_(c);if(c.done)this.yieldResult=c.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(c.value,b)};
$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(a){return{value:a,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,c){try{var d=a.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(d);if(!d.done)return this.context_.stop_(),d;var f=d.value}catch(h){return this.context_.yieldAllIterator_=null,this.context_.throw_(h),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,f);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this.throw=function(b){return a.throw_(b)};this.return=function(b){return a.return_(b)};$jscomp.initSymbolIterator();this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,b){b=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b));$jscomp.setPrototypeOf&&$jscomp.setPrototypeOf(b,a.prototype);return b};
$jscomp.asyncExecutePromiseGenerator=function(a){function b(b){return a.next(b)}function c(b){return a.throw(b)}return new Promise(function(d,f){function h(a){a.done?d(a.value):Promise.resolve(a.value).then(b,c).then(h,f)}h(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};
$jscomp.checkEs6ConformanceViaProxy=function(){try{var a={},b=Object.create(new $jscomp.global.Proxy(a,{get:function(c,d,f){return c==a&&"q"==d&&f==b}}));return!0===b.q}catch(c){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
$jscomp.polyfill("WeakMap",function(a){function b(){if(!a||!Object.seal)return!1;try{var b=Object.seal({}),c=Object.seal({}),d=new a([[b,2],[c,3]]);if(2!=d.get(b)||3!=d.get(c))return!1;d.delete(b);d.set(c,4);return!d.has(b)&&4==d.get(c)}catch(e){return!1}}function c(){}function d(a){if(!$jscomp.owns(a,h)){var b=new c;$jscomp.defineProperty(a,h,{value:b})}}function f(a){var b=Object[a];b&&(Object[a]=function(a){if(a instanceof c)return a;d(a);return b(a)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&
$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var h="$jscomp_hidden_"+Math.random();f("freeze");f("preventExtensions");f("seal");var g=0,k=function(a){this.id_=(g+=Math.random()+1).toString();if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};k.prototype.set=function(a,b){d(a);if(!$jscomp.owns(a,h))throw Error("WeakMap key fail: "+a);a[h][this.id_]=b;return this};k.prototype.get=function(a){return $jscomp.owns(a,h)?a[h][this.id_]:void 0};k.prototype.has=
function(a){return $jscomp.owns(a,h)&&$jscomp.owns(a[h],this.id_)};k.prototype.delete=function(a){return $jscomp.owns(a,h)&&$jscomp.owns(a[h],this.id_)?delete a[h][this.id_]:!1};return k},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_MAP||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),c=new a($jscomp.makeIterator([[b,"s"]]));if("s"!=c.get(b)||1!=c.size||c.get({x:4})||c.set({x:4},"t")!=c||2!=c.size)return!1;var d=c.entries(),f=d.next();if(f.done||f.value[0]!=b||"s"!=f.value[1])return!1;f=d.next();return f.done||4!=f.value[0].x||"t"!=f.value[1]||!d.next().done?!1:!0}catch(r){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;$jscomp.initSymbolIterator();var c=new WeakMap,d=function(a){this.data_={};this.head_=g();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};d.prototype.set=function(a,b){a=0===a?0:a;var c=f(this,a);c.list||(c.list=this.data_[c.id]=[]);c.entry?c.entry.value=b:(c.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,
value:b},c.list.push(c.entry),this.head_.previous.next=c.entry,this.head_.previous=c.entry,this.size++);return this};d.prototype.delete=function(a){a=f(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};d.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=g();this.size=0};d.prototype.has=function(a){return!!f(this,a).entry};
d.prototype.get=function(a){return(a=f(this,a).entry)&&a.value};d.prototype.entries=function(){return h(this,function(a){return[a.key,a.value]})};d.prototype.keys=function(){return h(this,function(a){return a.key})};d.prototype.values=function(){return h(this,function(a){return a.value})};d.prototype.forEach=function(a,b){for(var c=this.entries(),d;!(d=c.next()).done;)d=d.value,a.call(b,d[1],d[0],this)};d.prototype[Symbol.iterator]=d.prototype.entries;var f=function(a,b){var d=b&&typeof b;"object"==
d||"function"==d?c.has(b)?d=c.get(b):(d=""+ ++k,c.set(b,d)):d="p_"+b;var f=a.data_[d];if(f&&$jscomp.owns(a.data_,d))for(a=0;a<f.length;a++){var g=f[a];if(b!==b&&g.key!==g.key||b===g.key)return{id:d,list:f,index:a,entry:g}}return{id:d,list:f,index:-1,entry:void 0}},h=function(a,b){var c=a.head_;return $jscomp.iteratorPrototype(function(){if(c){for(;c.head!=a.head_;)c=c.previous;for(;c.next!=c.head;)return c=c.next,{done:!1,value:b(c)};c=null}return{done:!0,value:void 0}})},g=function(){var a={};return a.previous=
a.next=a.head=a},k=0;return d},"es6","es3");
$jscomp.polyfill("Set",function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_SET||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),c=new a($jscomp.makeIterator([b]));if(!c.has(b)||1!=c.size||c.add(b)!=c||1!=c.size||c.add({x:4})!=c||2!=c.size)return!1;var h=c.entries(),g=h.next();if(g.done||g.value[0]!=b||g.value[1]!=b)return!1;g=h.next();return g.done||g.value[0]==b||4!=g.value[0].x||g.value[1]!=g.value[0]?!1:h.next().done}catch(k){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;$jscomp.initSymbolIterator();var c=function(a){this.map_=new Map;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)this.add(b.value)}this.size=this.map_.size};c.prototype.add=function(a){a=0===a?0:a;this.map_.set(a,a);this.size=this.map_.size;return this};c.prototype.delete=function(a){a=this.map_.delete(a);this.size=this.map_.size;return a};c.prototype.clear=function(){this.map_.clear();
this.size=0};c.prototype.has=function(a){return this.map_.has(a)};c.prototype.entries=function(){return this.map_.entries()};c.prototype.values=function(){return this.map_.values()};c.prototype.keys=c.prototype.values;c.prototype[Symbol.iterator]=c.prototype.values;c.prototype.forEach=function(a,b){var c=this;this.map_.forEach(function(d){return a.call(b,d,d,c)})};return c},"es6","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,a,"startsWith");a+="";var f=b.length,h=a.length;c=Math.max(0,Math.min(c|0,b.length));for(var g=0;g<h&&c<f;)if(b[c++]!=a[g++])return!1;return g>=h}},"es6","es3");
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var f=c++;return{value:b(f,a[f]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,f=0;f<d;f++){var h=a[f];if(b.call(c,h,f,a))return{i:f,v:h}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");
$jscomp.polyfill("Array.from",function(a){return a?a:function(a,c,d){c=null!=c?c:function(a){return a};var b=[],h="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];if("function"==typeof h){a=h.call(a);for(var g=0;!(h=a.next()).done;)b.push(c.call(d,h.value,g++))}else for(h=a.length,g=0;g<h;g++)b.push(c.call(d,a[g],g));return b}},"es6","es3");
$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,a,"endsWith");a+="";void 0===c&&(c=b.length);c=Math.max(0,Math.min(c|0,b.length));for(var f=a.length;0<f&&0<c;)if(b[--c]!=a[--f])return!1;return 0>=f}},"es6","es3");$jscomp.polyfill("Object.is",function(a){return a?a:function(a,c){return a===c?0!==a||1/a===1/c:a!==a&&c!==c}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,c){var b=this;b instanceof String&&(b=String(b));var f=b.length;c=c||0;for(0>c&&(c=Math.max(c+f,0));c<f;c++){var h=b[c];if(h===a||Object.is(h,a))return!0}return!1}},"es7","es3");$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,c){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,c||0)}},"es6","es3");
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(a){var b=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var d="";a;)if(a&1&&(d+=b),a>>>=1)b+=b;return d}},"es6","es3");var MORE_COMMANDS=new Set(["item_add","item_insert","itemplay"]);function itemText(a){return a.title?a.title:a.name?a.name:a.caption?a.caption:a.credits?a.credits:void 0}
function removeDiactrics(a){return void 0!=a&&1==a.length&&127<a.charCodeAt(0)?a.normalize("NFD").replace(/[\u0300-\u036f]/g,""):a}
function parseBrowseResp(a,b,c,d,f,h){var g={items:[],allSongsItem:void 0,baseActions:[],canUseGrid:!1,jumplist:[],numAudioItems:0,canDrop:!1,itemCustomActions:void 0};try{if(a&&a.result){logJsonMessage("RESP",a);var k=a&&a.params&&1<a.params.length&&a.params[1]&&1<a.params[1].length?a.params[1][0]:void 0;if("musicip"==k&&0<a.params[1].length&&"moods"==a.params[1][1]&&a.result.item_loop){for(var m=0,l=a.result.item_loop,n=l.length;m<n;++m){var e=l[m];e.actions&&e.actions.go&&e.actions.go.params&&
e.actions.go.params.mood&&g.items.push({id:"mood://"+e.actions.go.params.mood,title:e.text,actions:e.actions,stdItem:STD_ITEM_MUSICIP_MOOD,isUrl:!0})}g.subtitle=0==g.items.length?i18n("Empty"):i18np("1 Item","%1 Items",g.items.length)}else if(a.result.item_loop){var r=!1,t=!1,p=!1,z=!1,u=b&&b.isFavFolder?!0:!1,P=b&&b.section==SECTION_PLAYLISTS,V=b&&b.section==SECTION_RADIO,W=V&&b.id==TOP_RADIO_ID,ha=b&&b.section==SECTION_APPS,aa=b&&b.id==TOP_APPS_ID,X=b&&"apps.podcasts"==b.id&&"podcasts"==k&&5==a.params[1].length&&
"items"==a.params[1][1]&&"menu:podcasts"==a.params[1][4],ia="podcasts"==k&&0<getIndex(a.params[1],"search:"),ba="browselibrary"==k&&5<=a.params[1].length&&0<a.params[1].indexOf("mode:bmf"),F="custombrowse"==k,G="musicsimilarity"==k||"musicip"==k&&0<a.params[1].length&&"mix"==a.params[1][1],D="dynamicplaylist"==k,L=!1,M=!1,I=void 0,Q=new Set,N="trackstat"!=k,w=0;g.canUseGrid=N&&(W||ba||a.result.window&&a.result.window.windowStyle&&("icon_list"==a.result.window.windowStyle||"home_menu"==a.result.window.windowStyle))?
!0:!1;g.canDrop=u;a.result.base&&a.result.base.actions&&(g.baseActions=a.result.base.actions,r=void 0!=g.baseActions[ACTIONS[PLAY_ACTION].cmd],t=void 0!=g.baseActions[ACTIONS[ADD_ACTION].cmd],p=void 0!=g.baseActions[ACTIONS[INSERT_ACTION].cmd],z=void 0!=g.baseActions[ACTIONS[MORE_ACTION].cmd],g.baseActions[ACTIONS[PLAY_ACTION].cmd]&&g.baseActions[ACTIONS[PLAY_ACTION].cmd].params&&g.baseActions[ACTIONS[PLAY_ACTION].cmd].params.menu&&(I=g.baseActions[ACTIONS[PLAY_ACTION].cmd].params.menu));m=0;l=a.result.item_loop;
for(n=l.length;m<n;++m)if(e=l[m],e.text&&1!=e.showBigArtwork)if(g.items.length!=a.result.count-1||"playlist"!=e.type||"html/images/albums.png"!=e["icon-id"]||u){var B=!1;void 0!=e.text&&void 0!=e.text.name&&"text"==e.text.type&&(e.text=e.text.name,e.type=e.text.type,e.style=e.goAction=void 0);if("text"==e.type){if(e.style&&MORE_COMMANDS.has(e.style)||10>m&&0<m&&m<n-1&&l[m-1].style&&l[m+1].style&&"item_add"==l[m-1].style&&"itemplay"==l[m+1].style&&e.actions&&e.actions.go&&e.actions.go.params&&e.actions.go.params.cmd&&
"insert"==e.actions.go.params.cmd){a.result.count--;continue}e.title=replaceNewLines(e.text)}else{var C=e.text.split(/\r?\n/);e.title=C[0];1<C.length?e.subtitle=C[1]:e.title=e.text;e.title=e.title.replace(/&#(\d+);/g,function(a,b){return String.fromCharCode(b)});e.title=e.title.replace(/&quot;/g,'"').replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")}e.section=b?b.section:void 0;if(!e.type&&!e.style&&e.actions&&e.actions.go&&e.actions.go.params)for(var q in e.actions.go.params)e.actions.go.params[q]==
TERM_PLACEHOLDER&&(e.type="entry");void 0!=e.type||e.style||!e.actions||!e.actions.go||e.icon||e["icon-id"]||e.image||e.window||e.addAction&&!e.actions.go.nextWindow||(e.type="text");e.text=void 0;e.image=resolveImage(e.icon?e.icon:e["icon-id"],void 0,LMS_IMAGE_SIZE);!e.image&&e.commonParams&&e.commonParams.album_id&&(e.image=resolveImage("music/0/cover"+LMS_IMAGE_SIZE));e.image?L=!0:M=!0;e.menu=[];if("artist"==e.type||"album"==e.type||"year"==e.type||"genre"==e.type||F||"playlist"==e.type||"audio"==
e.type||"itemplay"==e.style||e.goAction&&("playControl"==e.goAction||"play"==e.goAction))if(e.params&&hasPlayableId(e.params)||e.commonParams&&hasPlayableId(e.commonParams)||e.actions&&e.actions.add&&e.actions.add.params&&hasPlayableId(e.actions.add.params)||F)r&&(e.menu.push(PLAY_ACTION),B=!0,g.allowHoverBtns=!0,g.numAudioItems++),p&&(e.menu.push(INSERT_ACTION),B=!0),t&&(e.menu.push(ADD_ACTION),B=!0);var v=!1;if(u)if(e.pos=g.items.length,0<e.menu.length&&(e.menu.push(DIVIDER),v=!0),e.type||(e.isFavFolder=
!0,g.allowHoverBtns=!0),e.menu.push(e.isFavFolder?RENAME_ACTION:EDIT_ACTION),e.menu.push(e.isFavFolder?DELETE_FAV_FOLDER_ACTION:REMOVE_FROM_FAV_ACTION),void 0!=b&&b.id!=TOP_FAVORITES_ID&&e.menu.push(MOVE_FAV_TO_PARENT_ACTION),!e.isFavFolder||e.image&&!e.image.startsWith("/html/images/favorites"+LMS_IMAGE_SIZE))if(e.isFavFolder||void 0==e.presetParams||void 0==e.presetParams.favorites_url)"html/images/favorites.png"==e["icon-id"]?(e.icon="favorite",e.image=void 0):mapIcon(e);else{if(e.presetParams.favorites_url.startsWith("db:album.title")&&
"html/images/albums.png"==e.presetParams.icon?(e.icon="album",e.image=void 0):e.presetParams.favorites_url.startsWith("db:contributor.name")?"html/images/artists.png"!=e.presetParams.icon&&lmsOptions.infoPlugin&&lmsOptions.artistImages||(e.svg="artist",e.image=void 0):e.presetParams.favorites_url.startsWith("db:genre.name")&&"html/images/genres.png"==e.presetParams.icon?(e.icon="label",e.image=void 0):e.presetParams.favorites_url.startsWith("db:year.id")&&"html/images/years.png"==e.presetParams.icon?
(e.icon="date_range",e.image=void 0):e.presetParams.favorites_url.startsWith("file://")&&"html/images/playlists.png"==e.presetParams.icon?(e.icon="list",e.image=void 0):e.presetParams.favorites_url.startsWith("dynamicplaylist://")&&"plugins/DynamicPlayList/html/images/dynamicplaylist.png"==e.presetParams.icon?(e.svg="dice-list",e.image=void 0):"html/images/radio.png"==e.presetParams.icon?(e.svg="radio-station",e.image=void 0):"plugins/RandomPlay/html/images/icon.png"==e.presetParams.icon?(e.svg="dice-multiple",
e.image=void 0):"html/images/favorites.png"==e["icon-id"]?(e.icon="favorite",e.image=void 0):mapIcon(e),e.presetParams.favorites_url.startsWith("http:")||e.presetParams.favorites_url.startsWith("https:"))e.isRadio=!0,!v&&0<e.menu.length&&(e.menu.push(DIVIDER),v=!0),e.menu.push(c.pinned.has(e.presetParams.favorites_url)?UNPIN_ACTION:PIN_ACTION)}else e.icon="folder",e.image=void 0;else e.presetParams?(0<e.menu.length&&(e.menu.push(DIVIDER),v=!0),e.menu.push(ADD_TO_FAV_ACTION)):D&&e.params&&e.params.playlistid&&
B&&(e.presetParams={favorites_url:"dynamicplaylist://"+e.params.playlistid},e.menu.push(ADD_TO_FAV_ACTION));P&&"playlist"==e.type&&(!v&&0<e.menu.length&&(e.menu.push(DIVIDER),v=!0),e.menu.push(RENAME_ACTION),e.menu.push(REMOVE_DUPES_ACTION),e.menu.push(DELETE_ACTION));X?(!v&&0<e.menu.length&&(e.menu.push(DIVIDER),v=!0),void 0==e.type&&(e.menu.push(UNSUB_PODCAST_ACTION),e.section=SECTION_PODCASTS)):ia&&0==e.menu.length&&(e.menu=[ADD_TO_FAV_ACTION,MORE_ACTION],e.section=SECTION_PODCASTS);if(!e.type&&
e.actions&&e.actions.go&&e.actions.go.params)for(var H=0,R=e.actions.go.params.length;H<R;++H)if(TERM_PLACEHOLDER==e.actions.go.params[H]){e.type="search";break}e.type||!e.style||"itemNoAction"!=e.style||e.actions&&(e.actions.go||e.actions.do)||(e.type="text");aa&&e.actions&&e.actions.go&&e.actions.go.params&&e.actions.go.params.menu?("myapps"==e.actions.go.params.menu?e.actions.go.params.item_id&&(e.id=fixId(e.actions.go.params.item_id,"myapps")):e.id="apps."+e.actions.go.params.menu,e.id&&(!v&&
0<e.menu.length&&(e.menu.push(DIVIDER),v=!0),e.menu.push(c.pinned.has(e.id)?UNPIN_ACTION:PIN_ACTION)),mapIcon(e,k)):P&&e.commonParams&&e.commonParams.playlist_id?e.id="playlist_id:"+e.commonParams.playlist_id:V?("search"!=e.type&&(e.id||(e.id=e.params&&e.params.item_id?fixId(e.params.item_id,void 0==I?"radio":I):e.presetParams&&e.presetParams.favorites_url?"radio:"+e.presetParams.favorites_url:e.actions&&e.actions.go&&e.actions.go.params&&e.actions.go.params.item_id?"item_id:"+e.actions.go.params.item_id:
b&&b.id&&TOP_RADIO_ID!=b.id?b.id+"."+e.title:"radio:"+e.title),0<e.menu.length&&(e.icon||e.image)&&"entry"!=e.type&&e.presetParams&&e.presetParams.favorites_url?(!v&&0<e.menu.length&&(e.menu.push(DIVIDER),v=!0),e.isRadio=!0,e.menu.push(c.pinned.has(e.presetParams.favorites_url)?UNPIN_ACTION:PIN_ACTION)):"radios"==a.params[1][0]&&"entry"!=e.type&&e.actions&&e.actions.go&&e.actions.go.params&&e.actions.go.params.menu&&(e.id="radio:"+e.actions.go.params.menu,e.menu.push(c.pinned.has(e.id)?UNPIN_ACTION:
PIN_ACTION))),W&&e["icon-id"]?(e.actions&&e.actions.go&&e.actions.go.params&&"language"==e.actions.go.params.menu&&(e["icon-id"]="/language.png"),mapIcon(e,void 0,{icon:void 0,svg:"radio-station"})):mapIcon(e)):ba?e.icon="playlist"==e.type?e.actions&&e.actions.play&&e.actions.play.params&&e.actions.play.params.folder_id?"folder":"list":isPlaylist(e.title)?"list":"audio"==e.type?"music_note":"crop_portrait":u||(e.params&&e.params.item_id?e.id="item_id:"+e.params.item_id:e.actions&&e.actions.go&&e.actions.go.params&&
e.actions.go.params.item_id&&(e.id="item_id:"+e.actions.go.params.item_id),X||mapIcon(e,k));if(!e.id||u)e.params&&e.params.track_id?e.id=uniqueId("track_id:"+e.params.track_id,g.items.length):b.id.startsWith(TOP_ID_PREFIX)?e.id="item_id:"+g.items.length:e.id=b.id+"."+g.items.length;!e.type&&e.params&&e.params.track&&(e.type="audio");B&&(v||(e.menu.push(DIVIDER),v=!0),G&&e.trackType&&"local"==e.trackType&&(e.saveableTrack=!0,e.menu.push(ADD_TO_PLAYLIST_ACTION)),e.menu.push(SELECT_ACTION));!u&&(e.commonParams&&
(e.commonParams.artist_id||e.commonParams.album_id||e.commonParams.track_id)||z&&0<e.menu.length&&e.params&&e.params.item_id||e.actions&&e.actions.more&&e.actions.more.cmd)&&(!v&&0<e.menu.length&&(e.menu.push(DIVIDER),v=!0),e.menu.push(MORE_ACTION));q=removeDiactrics(e.textkey);void 0==q||0!=g.jumplist.length&&g.jumplist[g.jumplist.length-1].key==q||g.jumplist.push({key:q,index:g.items.length});u?(e.draggable=!0,e.realIndex=g.items.length):isAudioTrack(e)&&(e.draggable=!0);"text"==e.type&&e.title.startsWith("<")&&
(e.type="html");!u&&b&&b.section==SECTION_FAVORITES&&e.commonParams&&e.commonParams.track_id&&(e.id="track_id:"+e.commonParams.track_id,e.stdItem=STD_ITEM_TRACK,e.type=e.presetParams=e.commonParams=e.menu=e.playallParams=e.addallParams=e.goAction=e.style=void 0);void 0!=e.icon&&(e.icon.startsWith("http")||e.icon.startsWith("/"))&&(e.icon=void 0);g.items.push(e);Q.add(e.type)}else a.result.count--,r&&1<n&&(g.allSongsItem=e);else e.url&&"musicartistinfo"==k?(g.items.push({id:"image:"+g.items.length,
title:itemText(e),type:"image",image:resolveImageUrl(e.url,LMS_IMAGE_SIZE),src:resolveImageUrl(e.url),w:0,h:0}),g.canUseGrid=!0,w++):a.result.count--;!u&&b&&b.section==SECTION_FAVORITES&&0<g.items.length&&g.items[0].stdItem==STD_ITEM_TRACK&&(g.baseActions=[]);g.canUseGrid&&Q.has("text")?g.canUseGrid=!1:g.canUseGrid||!N||!L||1!=Q.size||Q.has("text")||Q.has(void 0)||(g.canUseGrid=!0);r&&2<g.numAudioItems&&void 0==g.allSongsItem&&g.baseActions.playControl&&g.baseActions.playControl.params&&g.baseActions.playControl.params.item_id&&
(g.allSongsItem={id:g.baseActions.playControl.params.item_id,params:g.baseActions.playControl.params});if((V||ha&&2==b.id.split(".").length)&&1<g.items.length&&15>=g.items.length){m=void 0;e=n=0;for(var x=g.items.length;e<x&&void 0==g.items[e].image;++e)void 0==m?(m=g.items[e].icon?g.items[e].icon:g.items[e].svg,n++):(g.items[e].icon?g.items[e].icon:g.items[e].svg)==m&&n++;if(n==g.items.length&&void 0!=m){e=0;for(x=g.items.length;e<x;++e)g.items[e].icon=g.items[e].svg=void 0;g.canUseGrid=!1}}else if(M&&
L){var ja=resolveImage("music/0/cover"+LMS_IMAGE_SIZE),ka=resolveImage("html/images/artists"+LMS_IMAGE_SIZE);e=0;for(x=g.items.length;e<x;++e){var A=g.items[e];if(!A.image&&!A.icon&&!A.svg)if("album"==A.type||A.window&&"album"==A.window.titleStyle&&"album"==A.window.menuStyle&&A.actions&&A.actions.go)A.image=ja;else if("artist"==A.type)A.image=ka;else{g.canUseGrid=!1;break}}}1==g.items.length&&"text"==g.items[0].type&&"itemNoAction"==g.items[0].style&&msgIsEmpty(g.items[0].title)&&(g.items=[]);if(aa)g.items.sort(titleSort);
else if(X){m=[];n=[];q=[];e=0;l=g.items;for(x=l.length;e<x;++e)void 0==l[e].type?(l[e].index=n.length,n.push(l[e])):(mapIcon(l[e],"podcasts","rss_feed"),"podcast"==l[e].svg&&(l[e].svg=void 0,l[e].icon="rss_feed"),0<n.length?q.push(l[e]):m.push(l[e]));n.sort(titleSort);g.items=m;g.items=g.items.concat(n);g.items=g.items.concat(q)}else u?g.items.sort(c.sortFavorites?favSort:partialFavSort):W&&g.items.sort(weightSort);0<w&&w==g.items.length?g.subtitle=i18np("1 Image","%1 Images",g.items.length):(a.result.window&&
a.result.window.textarea&&g.items.length<LMS_MAX_NON_SCROLLER_ITEMS&&(C=replaceNewLines(a.result.window.textarea),0<C.length&&(g.items.unshift({title:C,type:C.startsWith("<")||0<C.indexOf("<br/>")?"html":"text",id:b.id+".textarea"}),g.canUseGrid=!1)),G?(g.items.shift(),g.subtitle=0==g.items.length?i18n("Empty"):i18np("1 Track","%1 Tracks",g.items.length)):g.subtitle=0==g.items.length?i18n("Empty"):i18np("1 Item","%1 Items",g.items.length))}else if(a.result.artists_loop){C=w=G=!1;if(a.params&&1<a.params.length)for(e=
3,x=a.params[1].length;e<x;++e)if("string"===typeof a.params[1][e]||a.params[1][e]instanceof String)if(t=a.params[1][e].toLowerCase(),t.startsWith("role_id:")){if("role_id:composer"==t||"role_id:2"==t)G=!0;else if("role_id:conductor"==t||"role_id:3"==t)w=!0;else if("role_id:band"==t||"role_id:4"==t)C=!0;break}g.canUseGrid=lmsOptions.infoPlugin&&lmsOptions.artistImages;g.itemCustomActions=getCustomActions("artist");m=0;l=a.result.artists_loop;for(n=l.length;m<n;++m)e=l[m],q=removeDiactrics(e.textkey),
void 0==q||0!=g.jumplist.length&&g.jumplist[g.jumplist.length-1].key==q||g.jumplist.push({key:q,index:g.items.length}),r={id:"artist_id:"+e.id,title:e.artist,image:lmsOptions.infoPlugin&&lmsOptions.artistImages?"/imageproxy/mai/artist/"+e.id+"/image"+LMS_IMAGE_SIZE:void 0,stdItem:STD_ITEM_ARTIST,type:"group",textkey:q},g.items.push(r);g.subtitle=G?i18np("1 Composer","%1 Composers",g.items.length):w?i18np("1 Conductor","%1 Conductors",g.items.length):C?i18np("1 Band","%1 Bands",g.items.length):i18np("1 Artist",
"%1 Artists",g.items.length);b&&b.id&&b.id.startsWith("search:")&&(g.jumplist=[])}else if(a.result.albums_loop){g.canUseGrid=!0;g.itemCustomActions=getCustomActions("album");G=!1;if(a.params&&1<a.params.length)for(e=3,R=a.params[1].length;e<R;++e)if("string"===typeof a.params[1][e]||a.params[1][e]instanceof String)if(t=a.params[1][e].toLowerCase(),t.startsWith("sort:year")){G=!0;break}m=0;l=a.result.albums_loop;for(n=l.length;m<n;++m)e=l[m],p=e.album,e.year&&0<e.year&&(p+=" ("+e.year+")"),q=G?""+
e.year:removeDiactrics(e.textkey),G&&2<q.length&&(q="'"+q.slice(-2)),void 0==q||0!=g.jumplist.length&&g.jumplist[g.jumplist.length-1].key==q||g.jumplist.push({key:q,index:g.items.length}),w=r=void 0,lmsOptions.showAllArtists&&e.artists?(w=e.artists.split(MULTI_SPLIT_REGEX),r=w.join(", ")):r=e.artist,z={id:"album_id:"+e.id,artist_id:e.artist_id,artist_ids:void 0==e.artist_ids?void 0:e.artist_ids.split(","),artists:w,title:p,subtitle:r,image:e.artwork_url?resolveImageUrl(e.artwork_url,LMS_IMAGE_SIZE):
"/music/"+(e.artwork_track_id?e.artwork_track_id:e.artwork)+"/cover"+LMS_IMAGE_SIZE,stdItem:STD_ITEM_ALBUM,type:"group",origTitle:e.album,textkey:q,emblem:getEmblem(e.extid),draggable:!0},g.items.push(z);g.subtitle=i18np("1 Album","%1 Albums",g.items.length);b&&b.id&&b.id.startsWith("search:")&&(g.jumplist=[])}else if(a.result.titles_loop){F=0;var Y=b&&b.id&&b.id.startsWith("album_id:"),da=b&&b.id&&b.id.startsWith("currentaction:"),J=c&&c.isSearch,K=J||da||b&&b.id&&b.id.startsWith("artist_id:");D=
new Map;var S=da&&f&&getAlbumSort(f,h).startsWith("year");if(4<=a.params[1].length&&"tracks"==a.params[1][0])for(H=0,R=a.params[1].length;H<R&&(!Y||!K);++H)(""+a.params[1][H]).startsWith("album_id:")?Y=!0:(""+a.params[1][H]).startsWith("search:")&&(K=!0);g.itemCustomActions=getCustomActions("album-track");var la=Y&&1<a.result.count?STD_ITEM_ALBUM_TRACK:STD_ITEM_TRACK;m=0;l=a.result.titles_loop;for(n=l.length;m<n;++m){e=l[m];p=e.title;var E=parseFloat(e.duration||0),T=void 0==e.tracknum?0:parseInt(e.tracknum);
0<T&&(p=(9<T?T:"0"+T)+SEPARATOR+p,J&&void 0!=e.disc&&(p=e.disc+"."+p));e.trackartist&&(K||e.albumartist&&e.trackartist!==e.albumartist||!e.albumartist&&"1"==e.compilation)?p+=SEPARATOR+e.trackartist:e.artist&&(K||e.albumartist&&e.artist!==e.albumartist||!e.albumartist&&"1"==e.compilation)&&(p+=SEPARATOR+e.artist);K&&e.album&&(p+=SEPARATOR+e.album,e.year&&0<e.year&&(p+=" ("+e.year+")"));if(void 0!=e.disc&&!J)if(D.has(e.disc)){var Z=D.get(e.disc);Z.total++;Z.duration+=E}else D.set(e.disc,{pos:g.items.length,
total:1,duration:E});F+=0<E?E:0;var y=0<E?formatSeconds(E):void 0,O=lmsOptions.techInfo?formatTechInfo(e):void 0;O&&(y=y?y+(SEPARATOR+O):O);g.items.push({id:"track_id:"+e.id,title:p,subtitle:void 0!=e.rating?ratingString(y,e.rating):y,stdItem:la,type:"track",rating:e.rating,image:K?"/music/"+(""==e.coverid||void 0==e.coverid?"0":e.coverid)+"/cover"+LMS_IMAGE_SIZE:void 0,filter:FILTER_PREFIX+e.disc,emblem:K?getEmblem(e.extid):void 0,tracknum:S&&void 0!=e.tracknum?T:void 0,disc:S&&e.disc?parseInt(e.disc):
void 0,year:S&&e.year?parseInt(e.year):void 0,album:S||J?e.album:void 0,artist:J?e.artist:void 0,album_id:J?e.album_id:void 0,artist_id:J?e.artist_id:void 0,url:e.url,draggable:!0,duration:e.duration})}S&&g.items.sort(yearAlbumTrackSort);if(1<D.size)for(l=0,L=$jscomp.makeIterator(D.keys()),M=L.next();!M.done;M=L.next())I=M.value,N=D.get(I),g.items.splice(N.pos+l,0,{title:i18n("Disc %1",I)+SEPARATOR+i18np("1 Track","%1 Tracks",N.total)+" ("+formatSeconds(N.duration)+")",id:FILTER_PREFIX+I,header:!0,
menu:[PLAY_ALL_ACTION,INSERT_ALL_ACTION,ADD_ALL_ACTION]}),l++;g.subtitle=i18np("1 Track","%1 Tracks",g.items.length-(1<D.size?D.size:0));b&&b.id&&b.id.startsWith("search:")||(g.subtitle+=" ("+formatSeconds(F)+")")}else if(a.result.genres_loop){m=0;l=a.result.genres_loop;for(n=l.length;m<n;++m)e=l[m],q=removeDiactrics(e.textkey),void 0==q||0!=g.jumplist.length&&g.jumplist[g.jumplist.length-1].key==q||g.jumplist.push({key:q,index:g.items.length}),g.items.push({id:"genre_id:"+e.id,title:e.genre,stdItem:STD_ITEM_GENRE,
type:"group",textkey:q});g.itemCustomActions=getCustomActions("genre");g.subtitle=i18np("1 Genre","%1 Genres",g.items.length)}else if(a.result.playlists_loop){b=!1;m=0;l=a.result.playlists_loop;for(n=l.length;m<n;++m)e=l[m],q=removeDiactrics(e.textkey),B=1==parseInt(e.remote)||void 0!=e.extid,v=getEmblem(e.extid),void 0!=v&&(b=!0),void 0==q||0!=g.jumplist.length&&g.jumplist[g.jumplist.length-1].key==q||g.jumplist.push({key:q,index:g.items.length}),g.items.push({id:"playlist_id:"+e.id,title:e.playlist,
icon:void 0==v?"list":void 0,svg:void 0==v?void 0:v.name,stdItem:B?STD_ITEM_REMOTE_PLAYLIST:STD_ITEM_PLAYLIST,type:"group",section:SECTION_PLAYLISTS,url:e.url,remotePlaylist:B});if(!b)for(e=0,x=g.items.length;e<x;++e)g.items[e].icon=g.items[e].svg=void 0;g.itemCustomActions=getCustomActions("playlist");g.subtitle=i18np("1 Playlist","%1 Playlists",g.items.length)}else if(a.result.playlisttracks_loop){m=F=0;l=a.result.playlisttracks_loop;for(n=l.length;m<n;++m)e=l[m],p=e.title,e.artist&&(p+=SEPARATOR+
e.artist),p||(p=i18n("Unknown")),E=parseFloat(e.duration||0),F+=E,y=0<E?formatSeconds(E):void 0,(O=lmsOptions.techInfo?formatTechInfo(e):void 0)&&(y=y?y+(SEPARATOR+O):O),e.album&&(y=y?y+(SEPARATOR+e.album):e.album),B=void 0!=b&&b.remotePlaylist,g.items.push({id:uniqueId("track_id:"+e.id,g.items.length),title:p,subtitle:y,image:e.artwork_url?resolveImageUrl(e.artwork_url,LMS_IMAGE_SIZE):"/music/"+(""==e.coverid||void 0==e.coverid?"0":e.coverid)+"/cover"+LMS_IMAGE_SIZE,stdItem:B?STD_ITEM_REMOTE_PLAYLIST_TRACK:
STD_ITEM_PLAYLIST_TRACK,type:"track",draggable:!0,duration:e.duration});g.itemCustomActions=getCustomActions("playlist-track");g.subtitle=i18np("1 Track","%1 Tracks",g.items.length);g.canDrop=!B;0<F&&(g.subtitle+=" ("+formatSeconds(F)+")")}else if(a.result.years_loop){m=0;l=a.result.years_loop;for(n=l.length;m<n;++m)e=l[m],q=e.textkey,void 0==q||0!=g.jumplist.length&&g.jumplist[g.jumplist.length-1].key==q||g.jumplist.push({key:q,index:g.items.length}),g.items.push({id:"year:"+e.year,title:e.year,
stdItem:STD_ITEM_YEAR,type:"group",textkey:q});g.itemCustomActions=getCustomActions("year");g.subtitle=i18np("1 Year","%1 Years",g.items.length)}else if(0===a.result.count&&a.result.networkerror)g.items.push({title:i18n("Failed to retrieve listing. (%1)",a.result.networkerror),type:"text"});else if(a.result.data&&a.result.data.constructor===Array&&a.result.title){m=0;l=a.result.data;for(n=l.length;m<n;++m)e=l[m],e.image&&(e.title=itemText(e),e.id="image:"+g.items.length,e.type="image",e.src=resolveImageUrl(e.image),
e.image=resolveImageUrl(e.image,LMS_IMAGE_SIZE),e.w=0,e.h=0,g.items.push(e));0<g.items.length&&(g.title=a.result.title,g.subtitle=i18np("1 Image","%1 Images",g.items.length),g.canUseGrid=g.forceGrid=!0)}else if(a.result.biography)g.items.push({title:replaceNewLines(a.result.biography),type:"html",id:b.id+".0"});else if(a.result.albumreview)g.items.push({title:replaceNewLines(a.result.albumreview),type:"html",id:b.id+".0"});else if(a.result.loop_loop){m=w=0;l=a.result.loop_loop;for(n=l.length;m<n;++m){e=
l[m];var ea=mapIcon(e);e.title=itemText(e);e.image=ea?void 0:resolveImage(e.icon,e.image,LMS_IMAGE_SIZE);"text"===e.type||"textarea"===e.type?(75>e.title.length&&e.image&&w++,e.type="text"):"search"===e.type?(e.command=[e.cmd?e.cmd:b.command[0],"items"],e.params=["want_url:1","item_id:"+e.id,"search:"+TERM_PLACEHOLDER],e.image=ea?void 0:resolveImage(e.icon,e.image,LMS_IMAGE_SIZE),e.icon="search",e.type="xmlsearch",e.id=b.url+e.cmd+e.id):0<e.hasitems?(e.command=b.command,e.params=["item_id:"+e.id,
"want_url:1"],e.type="group",e.actions=1===e.isaudio?[PLAY_ACTION,INSERT_ACTION,ADD_ACTION]:void 0,e.id="item_id:"+e.id):1===e.isaudio&&(e.type="track",e.actions=[PLAY_ACTION,INSERT_ACTION,ADD_ACTION],e.id="item_id:"+e.id);g.items.push(e)}if(0<w&&w==g.items.length)for(g.subtitle=i18np("1 Image","%1 Images",g.items.length),g.canUseGrid=g.forceGrid=!0,m=0,l=g.items,n=l.length;m<n;++m)g.items[m].type="image",g.items[m].src=resolveImageUrl(e.image),g.items[m].w=0,g.items[m].h=0}else if(a.result.extras_loop){m=
0;l=a.result.extras_loop;for(n=l.length;m<n;++m)e=l[m],e.type="extra",mapIcon(e,"lms-extras",{icon:"extension",svg:void 0}),e.id="extras:"+e.id,e.menu=[c.pinned.has(e.id)?UNPIN_ACTION:PIN_ACTION],g.items.push(e);g.items.sort(titleSort);g.subtitle=0==g.items.length?i18n("Empty"):i18np("1 Item","%1 Items",g.items.length);g.canUseGrid=!0}a.result.count>LMS_BATCH_SIZE&&(g.subtitle=i18n("Only showing %1 items",LMS_BATCH_SIZE));if(d&&lmsLastScan&&canUseCache&&(g.iscache=!0,idbKeyval.set(d,g),a.params&&
1<a.params.length&&0<a.params[1].length&&"albums"==a.params[1][0])){var U=d.split("-"+SORT_KEY);if(2==U.length&&(U=U[1].split("-"),1<U.length)){var fa=U[0];a=["album","artistalbum","artflow","yearalbum","yearartistalbum"];e=0;for(x=a.length;e<x;++e)if(a[e]!=fa){var ma=d.replace(SORT_KEY+fa,SORT_KEY+a[e]);idbKeyval.del(ma)}}}0==g.items.length&&(g.canUseGrid=!1)}else a&&a.iscache&&(g=a)}catch(ca){g.items.push({title:i18n("ERROR: List processing failed")+"\n"+ca,type:"text",id:"error"}),logError(ca)}return g}
;/*
 i81n*/
function browseMatches(a,b){if(b.startsWith(a))return!0;var c=b.indexOf(" ");return 0<c&&b.substring(c+1).startsWith(a)?!0:!1}
function browseHandleKey(a,b){if(!b.ctrlKey&&!b.altKey&&!b.metaKey&&void 0!=a.jumplist&&1<a.jumplist.length&&1>a.$store.state.openDialogs.length&&1>a.$store.state.visibleMenus.size&&(a.$store.state.desktopLayout||"browse"==a.$store.state.page))if(b=b.key.toUpperCase(),"#"==b)a.lastKeyPress=void 0,a.jumpTo(a.jumplist[0].index);else{var c=(new Date).getTime();if(void 0==a.lastKeyPress||1E3<c-a.lastKeyPress.time){a.lastKeyPress=void 0;for(var d=0,f=a.jumplist,h=f.length;d<h;++d)if(f[d].key==b){a.jumpTo(f[d].index);
a.lastKeyPress={key:b,text:""+b,time:c,invalid:!1};break}}else if(!a.lastKeyPress.invalid){d=0;f=a.jumplist;for(h=f.length;d<h;++d)if(f[d].key==a.lastKeyPress.key){a.lastKeyPress.time=c;a.lastKeyPress.text+=b;b=f[d].index;c=a.items;for(d=c.length;b<d&&c[b].textkey==a.lastKeyPress.key;++b)if(f=c[b].title.toUpperCase(),browseMatches(a.lastKeyPress.text,f)||browseMatches(a.lastKeyPress.text,f.replaceAll(".","").replaceAll("(","").replaceAll(")","").replaceAll("/","").replaceAll("-","").replaceAll(",",
""))){a.jumpTo(b);return}break}a.lastKeyPress.invalid=!0}}}
function browseAddHistory(a){var b={};b.items=a.items;b.allSongsItem=a.allSongsItem;b.jumplist=a.jumplist;b.baseActions=a.baseActions;b.current=a.current;b.currentLibId=a.currentLibId;b.pinnedItemLibName=a.pinnedItemLibName;b.currentBaseActions=a.currentBaseActions;b.currentActions=a.currentActions;b.headerTitle=a.headerTitle;b.headerSubTitle=a.headerSubTitle;b.tbarActions=a.tbarActions;b.settingsMenuActions=a.settingsMenuActions;b.pos=a.scrollElement.scrollTop;b.grid=a.grid;b.hoverBtns=a.hoverBtns;
b.command=a.command;b.showRatingButton=a.showRatingButton;b.subtitleClickable=a.subtitleClickable;b.prevPage=a.prevPage;b.allSearchResults=a.allSearchResults;b.inGenre=a.inGenre;b.searchActive=a.searchActive;b.canDrop=a.canDrop;b.itemCustomActions=a.itemCustomActions;a.prevPage=void 0;a.history.push(b)}
function browseActions(a,b,c,d){var f=[];if(void 0==c.artist||c.artist!=i18n("Various Artists")&&"various artists"!=c.artist.toLowerCase()){if(lmsOptions.infoPlugin){if(void 0!=c.artist_id||void 0!=c.artist)f.push({title:i18n("Artist biography"),icon:"menu_book",do:{command:void 0!=c.artist_id?["musicartistinfo","biography","html:1","artist_id:"+c.artist_id]:["musicartistinfo","biography","html:1","artist:"+c.artist],params:[]},weight:0}),f.push({title:i18n("Pictures"),icon:"insert_photo",do:{command:void 0!=
c.artist_id?["musicartistinfo","artistphotos","html:1","artist_id:"+c.artist_id]:["musicartistinfo","artistphotos","html:1","artist:"+c.artist],params:[]},weight:0});void 0==c.album_id&&(void 0==c.album||void 0==c.artist_id&&void 0==c.artist)||f.push({title:i18n("Album review"),icon:"local_library",do:{command:void 0!=c.album_id?["musicartistinfo","albumreview","html:1","album_id:"+c.album_id]:void 0!=c.artist_id?["musicartistinfo","albumreview","html:1","album:"+c.album,"artist_id:"+c.artist_id]:
["musicartistinfo","albumreview","html:1","album:"+c.album,"artist:"+c.artist],params:[]},weight:0});void 0!=c.path&&0<c.path.length&&f.push({localfiles:!0,title:i18n("Local files"),icon:"insert_drive_file",do:{command:["musicartistinfo","localfiles","folder:"+c.path],params:[]},weight:2})}lmsOptions.youTubePlugin&&void 0!=c.artist&&f.push({title:"YouTube",svg:"youtube",do:{command:["youtube","items"],params:["want_url:1","item_id:3","search:"+c.artist,"menu:youtube"]},weight:10});if(void 0!=c.artist_id&&
void 0==c.album_id&&void 0!=c.count&&1<c.count){var h=["sort:albumtrack","tags:cdrilstyE","artist_id:"+c.artist_id];void 0!=c.role_id&&h.push(c.role_id);void 0!=c.genre_id&&h.push(c.genre_id);f.push({title:i18n("All songs"),icon:"music_note",do:{command:["tracks"],params:h},weight:3})}}if(void 0!=b&&void 0!=b.stdItem&&void 0!=STD_ITEMS[b.stdItem].actionMenu){c=300;h=0;for(var g=STD_ITEMS[b.stdItem].actionMenu,k=g.length;h<k;++h)if(CUSTOM_ACTIONS==g[h]){if(void 0!=a.itemCustomActions)for(var m=0,l=
a.itemCustomActions.length;m<l;++m)c++,a.itemCustomActions[m].weight=c,a.itemCustomActions[m].custom=!0,f.push(a.itemCustomActions[m])}else(ADD_RANDOM_ALBUM_ACTION!=g[h]||1<d)&&(DOWNLOAD_ACTION!=g[h]||lmsOptions.allowDownload&&void 0==b.emblem)&&(c++,f.push({action:g[h],weight:c}))}return f}
function browseHandleNextWindow(a,b,c,d,f){var h=b.nextWindow?b.nextWindow:b.actions&&b.actions.go&&b.actions.go.nextWindow?b.actions.go.nextWindow:void 0;return h?(h=h.toLowerCase(),b=d.items&&1==d.items.length&&"text"==d.items[0].type&&d.items[0].title&&!msgIsEmpty(d.items[0].title)?d.items[0].title:b.title,bus.$emit("showMessage",b),"refresh"==h||f&&"parent"==h?a.refreshList():0<a.history.length&&("parent"==h||"nowplaying"==h||f&&"grandparent"==h)?("parent"!=h||"trackinfo"!=c.command[0]||"items"!=
c.command[1]||!d.items||0<d.items.length)&&a.goBack(!0):"grandparent"==h&&1<a.history.length&&(a.history.pop(),a.goBack(!0)),"nowplaying"==h&&(a.$store.state.desktopLayout||a.$store.commit("setPage","now-playing"),a.goBack(!0)),!0):!1}
function browseHandleListResponse(a,b,c,d,f){if(d&&d.items)if(0==d.items.length&&1<c.command.length&&"podcasts"==c.command[0]&&("addshow"==c.command[1]||"delshow"==c.command[1]))bus.$emit("showMessage",b.title),a.history[a.history.length-2].needsRefresh=!0,a.fetchingItem=void 0,a.goBack();else{(SEARCH_ID!=b.id&&ADV_SEARCH_ID!=b.id||void 0==a.current||SEARCH_ID!=a.current.id&&ADV_SEARCH_ID!=a.current.id)&&a.addHistory();d.canUseGrid=d.canUseGrid&&(a.$store.state.showArtwork||d.forceGrid);a.canDrop=
d.canDrop;a.searchActive=b.id.startsWith(SEARCH_ID);a.command=c;a.currentBaseActions=a.baseActions;a.headerTitle=b.title?"search"!=b.type&&"entry"!=b.type||void 0==a.enteredTerm?b.title:b.title+SEPARATOR+a.enteredTerm:"?";a.current=b;a.currentLibId=c.libraryId;a.pinnedItemLibName=b.libname?b.libname:a.pinnedItemLibName;a.items=d.items;a.allSongsItem=d.allSongsItem;a.jumplist=d.jumplist;a.filteredJumplist=[];a.baseActions=d.baseActions;a.tbarActions=[];a.settingsMenuActions=[];a.isTop=!1;a.subtitleClickable=
!IS_MOBILE&&0<a.items.length&&void 0!=a.items[0].id&&void 0!=a.items[0].artist_id&&a.items[0].id.startsWith("album_id:");a.grid={allowed:d.canUseGrid,use:d.canUseGrid&&(d.forceGrid||isSetToUseGrid(a.current&&a.current.id.startsWith(TOP_ID_PREFIX)&&a.current.id!=TOP_FAVORITES_ID?GRID_OTHER:c)),numColumns:0,ih:GRID_MIN_HEIGHT,rows:[],few:!1,haveSubtitle:!0};a.jumplistActive=0;a.prevPage=f;a.hoverBtns=!IS_MOBILE&&0<a.items.length&&(void 0!=a.items[0].stdItem&&a.items[0].stdItem!=STD_ITEM_GENRE&&a.items[0].stdItem!=
STD_ITEM_YEAR||1<a.items.length&&a.items[0].header&&void 0!=a.items[1].stdItem&&a.items[1].stdItem!=STD_ITEM_GENRE&&a.items[1].stdItem!=STD_ITEM_YEAR||d.allowHoverBtns);a.currentActions={show:!1,items:[]};f=a.current.id.startsWith("artist_id:");if(a.current.id.startsWith("artist_id:")&&"albums"==a.command.command[0]||a.current.id.startsWith("album_id:")&&"tracks"==a.command.command[0]){var h=new Map;h[a.current.id.split(":")[0]]=a.current.id.split(":")[1];if(f){h.artist=a.current.title;h.count=d.items.length;
var g=getField(a.command,"role_id:");0<=g&&(h.role_id=a.command.params[g]);g=getField(a.command,"genre_id:");0<=g&&(h.genre_id=a.command.params[g])}else if(h.album=a.current.title,0<a.items.length&&(g=a.items[0].header?1<a.items.length?a.items[1].url:void 0:a.items[0].url,void 0!=g&&/^file:\/\//.test(g)))try{h.path=decodeURIComponent(g.substring(0,g.lastIndexOf("/"))+"/").substring(7),/^\/[a-zA-Z]:\/.+/.test(h.path)&&(h.path=h.path.substring(1))}catch(n){logError(n)}a.currentActions.items=browseActions(a,
0<d.items.length?b:void 0,h,d.items.length);if(f){g=0;for(var k=a.onlineServices,m=k.length;g<m;++g){var l=getEmblem(k[g]+":");a.currentActions.items.push({title:"wimp"==k[g]?"Tidal":capitalize(k[g]),weight:10,svg:l?l.name:void 0,id:k[g],isService:!0})}}else void 0!=a.$store.state.ratingsPlugin&&1<a.items.length&&a.currentActions.items.push({albumRating:!0,title:i18n("Set rating for all tracks"),icon:"stars",weight:99});a.currentActions.items.sort(function(a,b){return a.weight!=b.weight?a.weight<
b.weight?-1:1:titleSort(a,b)});if(f&&0==a.items.length)for(a.items.push({id:"intro",title:i18n("No albums have been favorited for this artist. Please use the entries below to look for albums on your online services."),type:"text"}),g=0,k=a.currentActions.items,m=k.length;g<m;++g)k[g].isService&&a.items.push({id:k[g].id?k[g].id:"ca"+g,title:k[g].title,do:k[g].do,svg:k[g].svg,icon:k[g].icon,currentAction:!0});a.currentActions.show=0<a.items.length&&0<a.currentActions.items.length;void 0!=h.path&&0<
h.path.length&&lmsCommand("",["musicartistinfo","localfiles","folder:"+h.path]).then(function(b){b=b.data;if(!b||!b.result||!b.result.item_loop){b=0;for(var c=a.currentActions.items,d=c.length;b<d;++b)if(c[b].localfiles){c.splice(b,1);break}}}).catch(function(a){})}a.itemCustomActions=d.itemCustomActions;if(b.id.startsWith(SEARCH_ID))0<a.items.length&&a.items[0].id.startsWith("track_id:")?a.tbarActions=[SEARCH_LIB_ACTION,PLAY_ALL_ACTION,ADD_ALL_ACTION]:a.tbarActions=[SEARCH_LIB_ACTION];else if(SECTION_FAVORITES==
a.current.section&&a.current.isFavFolder)a.tbarActions=[ADD_FAV_FOLDER_ACTION,ADD_FAV_ACTION];else if(SECTION_PLAYLISTS==a.current.section&&a.current.id.startsWith("playlist_id:"))a.tbarActions=[PLAY_ACTION,ADD_ACTION],a.currentActions={show:!0,items:browseActions(a,0<d.items.length?b:void 0,{},d.items.length)};else if(a.allSongsItem)a.tbarActions=[PLAY_ALL_ACTION,ADD_ALL_ACTION];else if("albums"==c.command[0]&&c.params.find(function(a){return"sort:random"==a}))a.tbarActions=[RELOAD_ACTION];else if(0<
a.items.length&&(!a.current||!a.current.isPodcast||addAndPlayAllActions(c))){if(a.current&&a.current.menu)for(g=0,m=a.current.menu.length;g<m;++g)if(a.current.menu[g]==ADD_ACTION||a.current.menu[g]==PLAY_ACTION){a.tbarActions=[PLAY_ACTION,ADD_ACTION];break}0==a.tbarActions.length&&a.current&&(a.current.actions&&a.current.actions.play||a.current.stdItem)&&(a.tbarActions=[PLAY_ACTION,ADD_ACTION]);!(0==a.tbarActions.length&&2<d.numAudioItems&&200>=d.numAudioItems&&0<a.command.command.length&&ALLOW_ADD_ALL.has(a.command.command[0]))||
b.id&&b.id.startsWith(TOP_ID_PREFIX)||(a.tbarActions=[PLAY_ALL_ACTION,ADD_ALL_ACTION])}d.canUseGrid&&!d.forceGrid&&a.settingsMenuActions.unshift(a.grid.use?USE_LIST_ACTION:USE_GRID_ACTION);if(0<a.command.command.length&&"albums"==a.command.command[0]&&0<a.items.length){h=!0;g=0;for(m=a.command.params.length;g<m;++g)if(a.command.params[g].startsWith(SORT_KEY))h=a.command.params[g].split(":")[1],h="new"!=h&&"random"!=h;else if(a.command.params[g].startsWith("search:")){h=!1;break}h&&a.settingsMenuActions.unshift(ALBUM_SORTS_ACTION)}bus.$emit("settingsMenuActions",
a.settingsMenuActions,"browse");a.headerSubTitle=d.subtitle?d.subtitle:1==a.items.length&&("text"==a.items[0].type||"html"==a.items[0].type)||f&&0==a.items.length?void 0:0==a.items.length?i18n("Empty"):i18np("1 Item","%1 Items",a.items.length);a.$nextTick(function(){a.setBgndCover();a.filterJumplist();a.layoutGrid(!0);setScrollTop(a,0)});0==a.items.length&&browseHandleNextWindow(a,b,c,d,!1)}}
function browseHandleTextClickResponse(a,b,c,d,f){d=parseBrowseResp(d,b,a.options);browseHandleNextWindow(a,b,c,d,f)||(3<c.command.length&&"playlist"==c.command[1]&&"play"==c.command[2]?(bus.$emit("showMessage",b.title),a.goBack(!0)):d.items&&(0<d.items.length||1<c.command.length&&"favorites"==c.command[0]&&"items"==c.command[1])?a.handleListResponse(b,c,d):c&&c.command&&"globalsearch"==c.command[0]&&bus.$emit("showMessage",i18n("No results found")))}
function browseClick(a,b,c,d){if(void 0==a.fetchingItem&&"html"!=b.type)if(a.menu.show)a.menu.show=!1;else if(!(0<a.$store.state.visibleMenus.size))if("search"==b.type||"entry"==b.type)(a.grid.use||a.useRecyclerForLists)&&promptForText(b.title,"","").then(function(c){c.ok&&c.value&&0<c.value.length&&("search"==b.type?a.search(void 0,b,c.value):a.entry(void 0,b,c.value))});else if(b.header)b.allSearchResults&&0<b.allSearchResults.length?(a.addHistory(),a.items=b.allSearchResults,a.headerSubTitle=b.subtitle,
a.current=b,a.searchActive=!1,b.menu&&0<b.menu.length&&b.menu[0]==PLAY_ALL_ACTION&&(a.tbarActions=[PLAY_ALL_ACTION,ADD_ALL_ACTION]),setScrollTop(a,0)):0<a.selection.size?a.select(b,c,d):a.$store.state.showMenuAudio&&a.itemMenu(b,c,d);else if(0<a.selection.size)a.select(b,c,d);else if(b.isPinned&&void 0!=b.url&&"extra"!=b.type)a.itemMenu(b,c,d);else if(b.currentAction)a.currentAction(b,c);else if("image"==b.type)a.showImage(c);else if(isAudioTrack(b))a.$store.state.showMenuAudio&&a.itemMenu(b,c,d);
else if(!isTextItem(b)||b.id.startsWith(TOP_ID_PREFIX)||b.id.startsWith(MUSIC_ID_PREFIX))if("extra"==b.type)a.$store.state.player?bus.$emit("dlg.open","iframe",b.url+"player="+a.$store.state.player.id,b.title+SEPARATOR+a.$store.state.player.name,void 0,1):bus.$emit("showError",void 0,i18n("No Player"));else if(TOP_MYMUSIC_ID==b.id)a.addHistory(),a.items=a.myMusic,a.myMusicMenu(),a.headerTitle=b.title,a.headerSubTitle=i18n("Browse music library"),a.current=b,setScrollTop(a,0),a.isTop=!1,a.tbarActions=
[VLIB_ACTION,SEARCH_LIB_ACTION],a.grid={allowed:!0,use:isSetToUseGrid(GRID_OTHER),numColumns:0,ih:GRID_MIN_HEIGHT,rows:[],few:!1,haveSubtitle:!0},a.settingsMenuActions=[a.grid.use?USE_LIST_ACTION:USE_GRID_ACTION],a.layoutGrid(!0),bus.$emit("settingsMenuActions",a.settingsMenuActions,"browse");else if(RANDOM_MIX_ID==b.id)bus.$emit("dlg.open","rndmix");else if(STD_ITEM_GENRE==b.stdItem&&a.current&&(a.current.id==GENRES_ID||getField(b,"year")))browseAddCategories(a,b,!0,getField(b,"year"));else if(b.actions&&
b.actions.go&&b.actions.go.params&&b.actions.go.params.genre_id&&"artists"==b.actions.go.params.mode&&0<b.title.indexOf(": "))browseAddCategories(a,{id:"genre_id:"+b.actions.go.params.genre_id,title:b.title.split(": ")[1]},!0);else if(STD_ITEM_YEAR==b.stdItem&&a.current&&a.current.id==YEARS_ID)browseAddCategories(a,b,!1);else if(b.actions&&b.actions.go&&b.actions.go.params&&b.actions.go.params.year&&"albums"==b.actions.go.params.mode&&0<b.title.indexOf(": "))browseAddCategories(a,{id:"year:"+b.actions.go.params.year,
title:b.title.split(": ")[1]},!1);else if(b.weblink)IS_IOS?window.open(b.weblink):bus.$emit("dlg.open","iframe",b.weblink,b.title,void 0,1);else{var f=a.buildCommand(b);if(2<f.command.length&&"playlist"==f.command[1])!b.menu||1>b.menu.length?lmsCommand(a.playerId(),f.params?f.command.concat(f.params):f.command).then(function(a){bus.$emit("showMessage",b.title)}):a.$store.state.showMenuAudio&&a.itemMenu(b,c,d);else{if(b.mapgenre){var h=getField(f,"genre:");if(0<=h){lmsCommand("",["material-skin","map",
f.params[h]]).then(function(c){c=c.data;c.result.genre_id&&(f.params[h]="genre_id:"+c.result.genre_id,a.fetchItems(f,b))});return}}a.fetchItems(f,b)}}else a.canClickText(b)&&a.doTextClick(b)}
function browseAddCategories(a,b,c){a.addHistory();a.items=[];a.items.push({title:lmsOptions.separateArtists?i18n("All Artists"):i18n("Artists"),command:["artists"],params:[b.id,ARTIST_TAGS,"include_online_only_artists:1"],svg:"artist",type:"group",id:uniqueId(b.id,a.items.length)});lmsOptions.separateArtists&&a.items.push({title:i18n("Album Artists"),command:["artists"],params:[b.id,ARTIST_TAGS,"role_id:ALBUMARTIST","include_online_only_artists:1"],svg:"albumartist",type:"group",id:uniqueId(b.id,
a.items.length)});a.items.push({title:i18n("Albums"),command:["albums"],params:[b.id,ALBUM_TAGS_PLACEHOLDER,SORT_KEY+ALBUM_SORT_PLACEHOLDER],menu:[],icon:"album",type:"group",id:uniqueId(b.id,a.items.length)});a.items.push({title:i18n("Random Albums"),command:["albums"],params:[b.id,ALBUM_TAGS_PLACEHOLDER,"sort:random"],menu:[],svg:"dice-album",type:"group",id:uniqueId(b.id,a.items.length)});c||a.items.push({title:i18n("Genres"),command:["genres"],params:[b.id],cancache:!0,svg:"guitar-acoustic",type:"group",
id:uniqueId(b.id,a.items.length)});a.inGenre=c?b.title:"years";(c?useComposer(b.title):lmsOptions.showComposer)&&a.items.push({title:i18n("Composers"),command:["artists"],params:["role_id:COMPOSER",b.id,ARTIST_TAGS],cancache:!0,svg:"composer",type:"group",id:uniqueId(b.id,a.items.length)});(c?useConductor(b.title):lmsOptions.showConductor)&&a.items.push({title:i18n("Conductors"),command:["artists"],params:["role_id:CONDUCTOR",b.id,ARTIST_TAGS],cancache:!0,svg:"conductor",type:"group",id:uniqueId(b.id,
a.items.length)});(c?useBand(b.title):lmsOptions.showBand)&&a.items.push({title:i18n("Bands"),command:["artists"],params:["role_id:BAND",b.id,ARTIST_TAGS],cancache:!0,svg:"trumpet",type:"group",id:uniqueId(b.id,a.items.length)});a.headerTitle=b.title;a.headerSubTitle=i18n("Select category");setScrollTop(a,0);a.isTop=!1;a.jumplist=a.filteredJumplist=[];a.grid={allowed:!0,use:isSetToUseGrid(GRID_OTHER),numColumns:0,ih:GRID_MIN_HEIGHT,rows:[],few:!1,haveSubtitle:!0};a.settingsMenuActions=[a.grid.use?
USE_LIST_ACTION:USE_GRID_ACTION];a.layoutGrid(!0);bus.$emit("settingsMenuActions",a.settingsMenuActions,"browse");a.currentActions={items:[],show:!1};c=getCustomActions(c?"genre":"year",!1);if(void 0!=c){for(var d=0,f=c.length;d<f;++d)c[d].custom=!0,a.currentActions.items.push(c[d]);a.currentActions.show=0<a.currentActions.items.length;a.currentActions.show&&(a.current={id:b.id,title:b.title})}}
function browseItemAction(a,b,c,d,f){if(b==SEARCH_LIB_ACTION)1>a.$store.state.visibleMenus.size&&(setLocalStorageVal("search",""),a.searchActive=!0);else if(b===MORE_ACTION)c.isPodcast?bus.$emit("dlg.open","iteminfo",c):a.fetchItems(a.buildCommand(c,ACTIONS[b].cmd),c);else if(b===MORE_LIB_ACTION)a.itemMoreMenu(c);else if(b===PIN_ACTION)RANDOM_MIX_ID!=c.id&&void 0!=a.current&&a.current.id==TOP_MYMUSIC_ID&&a.libraryName&&c.params?confirm(i18n("Store current library with pinned item?")+addNote(i18n("If you store the library when pinning then this library will always be used, regardless of changing the library in 'My Music'. If you elect not to store the library, then changing the library under 'My Music' will effect the items displayed within this pinned item.")),
i18n("With"),void 0,i18n("Without")).then(function(b){if(1==b){b=a.currentLibId?a.currentLibId:a.$store.state.library?a.$store.state.library:LMS_DEFAULT_LIBRARY;var d=JSON.parse(JSON.stringify(c));d.id=b+"::"+c.id;d.title=c.title+SEPARATOR+a.libraryName;d.title=c.title;d.libname=a.libraryName;d.params.push("library_id:"+b);a.pin(d,!0)}else 2==b&&a.pin(c,!0)}):a.pin(c,!0);else if(b===UNPIN_ACTION)a.pin(c,!1);else if(a.playerId())if(b===RENAME_ACTION)promptForText(i18n("Rename"),c.title,c.title,i18n("Rename")).then(function(b){if(b.ok&&
b.value&&0<b.value.length&&b.value!=c.title)if(c.isPinned)c.title=b.value,a.saveTopList();else{var d=SECTION_PLAYLISTS==c.section?["playlists","rename",c.id,"newname:"+b.value]:["favorites","rename",c.id,"title:"+b.value];lmsCommand(a.playerId(),d).then(function(b){logJsonMessage("RESP",b.data);a.refreshList()}).catch(function(b){logAndShowError(b,i18n("Rename failed"),d);a.refreshList()})}});else if(b==ADD_FAV_ACTION)bus.$emit("dlg.open","favorite","add",{id:(a.current.id.startsWith("item_id:")?
a.current.id+".":"item_id:")+a.items.length});else if(b==EDIT_ACTION)bus.$emit("dlg.open","favorite","edit",c);else if(b==ADD_FAV_FOLDER_ACTION)promptForText(ACTIONS[ADD_FAV_FOLDER_ACTION].title,void 0,void 0,i18n("Create")).then(function(b){b.ok&&b.value&&0<b.value.length&&lmsCommand(a.playerId(),["favorites","addlevel","title:"+b.value,(a.current.id.startsWith("item_id:")?a.current.id+".":"item_id:")+a.items.length]).then(function(b){logJsonMessage("RESP",b.data);a.refreshList()}).catch(function(a){logAndShowError(a,
i18n("Failed"),l)})});else if(b===DELETE_ACTION)confirm(i18n("Delete '%1'?",c.title),i18n("Delete")).then(function(b){if(b&&c.id.startsWith("playlist_id:")){a.clearSelection();var d=["playlists","delete",c.id];lmsCommand(a.playerId(),d).then(function(b){logJsonMessage("RESP",b.data);a.refreshList()}).catch(function(a){logAndShowError(a,i18n("Failed to delete playlist!"),d)})}});else if(b==REMOVE_ACTION)confirm(i18n("Remove '%1'?",c.title),i18n("Remove")).then(function(b){b&&(a.clearSelection(),lmsCommand(a.playerId(),
["playlists","edit","cmd:delete",a.current.id,"index:"+d]).then(function(b){logJsonMessage("RESP",b.data);a.refreshList()}).catch(function(a){logAndShowError(a,i18n("Failed to remove '%1'!",c.title),l)}))});else if(b==ADD_TO_FAV_ACTION){updateItemFavorites(c);var h=c.favUrl?c.favUrl:c.url,g=c.favIcon,k=SECTION_PODCASTS==c.section?"link":"audio",m=c.origTitle?c.origTitle:c.title;c.presetParams&&c.presetParams.favorites_url&&(h=c.presetParams.favorites_url,g=c.presetParams.icon,SECTION_PODCASTS!=c.section&&
(k=c.presetParams.favorites_type),c.presetParams.favorites_title&&(m=c.presetParams.favorites_title));var l=["favorites","exists",h];lmsCommand(a.playerId(),l).then(function(b){b=b.data;logJsonMessage("RESP",b);if(b&&b.result&&1==b.result.exists)bus.$emit("showMessage",i18n("Already in favorites"));else{l=["favorites","add","url:"+h,"title:"+m];k&&l.push("type:"+k);"group"==c.type&&l.push("hasitems:1");g&&l.push("icon:"+g);if(c.presetParams){b=new Set("url title type icon favorites_url favorites_type favorites_title".split(" "));
for(var d in c.presetParams)b.has(d)||l.push(d+":"+c.presetParams[d])}lmsCommand(a.playerId(),l).then(function(a){logJsonMessage("RESP",a.data);bus.$emit("showMessage",i18n("Added to favorites"));bus.$emit("refreshFavorites")}).catch(function(a){logAndShowError(a,i18n("Failed to add to favorites!"),l)})}}).catch(function(a){bus.$emit("showMessage",i18n("Failed to add to favorites!"));logError(a,l)})}else if(b===REMOVE_FROM_FAV_ACTION||b==DELETE_FAV_FOLDER_ACTION){var n=SECTION_FAVORITES==a.current.section?
c.id:"url:"+(c.presetParams&&c.presetParams.favorites_url?c.presetParams.favorites_url:c.favUrl);void 0!=n&&confirm(b===REMOVE_FROM_FAV_ACTION?i18n("Remove '%1' from favorites?",c.title):i18n("Delete '%1'?",c.title)+addNote(i18n("This will remove the folder, and any favorites contained within.")),b===REMOVE_FROM_FAV_ACTION?i18n("Remove"):i18n("Delete")).then(function(b){if(b){a.clearSelection();var c=n.startsWith("url:")?["material-skin","delete-favorite",n]:["favorites","delete",n];lmsCommand(a.playerId(),
c).then(function(b){logJsonMessage("RESP",b.data);bus.$emit("refreshFavorites");SECTION_FAVORITES==a.current.section&&a.refreshList()}).catch(function(a){logAndShowError(a,i18n("Failed to remove favorite!"),c)})}})}else if(b===MOVE_FAV_TO_PARENT_ACTION)a.clearSelection(),f=c.id.replace("item_id:","").split("."),f.pop(),f.pop(),0<f.length?(f=f.join("."),f+=".0"):f="0",l=["favorites","move",c.id.replace("item_id:","from_id:"),"to_id:"+f],lmsCommand(a.playerId(),l).then(function(b){logJsonMessage("RESP",
b.data);a.goBack(!0)}).catch(function(a){logAndShowError(a,i18n("Failed to move favorite!"),l)});else if(b===ADD_RANDOM_ALBUM_ACTION){var e=[];buildStdItemCommand(c,a.command).params.forEach(function(a){a.startsWith("sort:")||e.push(a)});e=browseReplaceCommandTerms(a,{command:[],params:e}).params;e.push(SORT_KEY+"random");lmsList(a.playerId(),["albums"],e,0,1).then(function(b){b=parseBrowseResp(b.data,a.current,a.options);if(1===b.items.length&&b.items[0].id){var c=b.items[0],d=["playlistcontrol",
"cmd:add",c.id];b=lmsOptions.noGenreFilter?-1:getField({params:e},"genre_id:");0<=b&&d.push(e[b]);lmsCommand(a.playerId(),d).then(function(a){bus.$emit("refreshStatus");bus.$emit("showMessage",i18n("Appended '%1' to the play queue",c.title))}).catch(function(a){bus.$emit("showError",a);logError(a,d)})}else bus.$emit("showError",void 0,i18n("Failed to find an album!"))}).catch(function(a){logAndShowError(a,void 0,["albums"],e,0,1)})}else if(SELECT_ACTION===b){if(!a.selection.has(d)&&(0==a.selection.size&&
bus.$emit("browseSelection",!0),a.selection.add(d),a.selectionDuration+=itemDuration(a.items[d]),c.selected=!0,forceItemUpdate(a,c),f&&f.shiftKey&&void 0!=a.lastSelect&&d!=a.lastSelect)){f=a.lastSelect<d?a.lastSelect:d;for(var r=a.lastSelect<d?d:a.lastSelect,t=a.items.length;f<=r&&f<t;++f)a.itemAction(SELECT_ACTION,a.items[f],f)}a.lastSelect=d}else if(UNSELECT_ACTION===b)a.lastSelect=void 0,a.selection.has(d)&&(a.selection.delete(d),a.selectionDuration-=itemDuration(a.items[d]),c.selected=!1,forceItemUpdate(a,
c),0==a.selection.size&&bus.$emit("browseSelection",!1));else if(MOVE_HERE_ACTION==b)0<a.selection.size&&!a.selection.has(d)&&(bus.$emit("movePlaylistItems",a.current.id,Array.from(a.selection).sort(function(a,b){return a<b?-1:1}),d),a.clearSelection());else if(RATING_ACTION==b)bus.$emit("dlg.open","rating",[c.id],c.rating);else if(PLAY_ALBUM_ACTION==b){if(c.filter)for(f=0,t=a.items.length;f<d;++f)a.items[f].header&&d--;l=browseBuildFullCommand(a,a.current,PLAY_ACTION);l.command.push("play_index:"+
d);lmsCommand(a.playerId(),l.command).then(function(b){logJsonMessage("RESP",b.data);bus.$emit("refreshStatus");a.$store.state.desktopLayout||a.$store.commit("setPage","now-playing")}).catch(function(a){logAndShowError(a,void 0,l.command)})}else if(UNSUB_PODCAST_ACTION==b)confirm(i18n("Unubscribe from '%1'?",c.title),i18n("Unsubscribe")).then(function(b){b&&lmsCommand("",["material-skin","delete-podcast","pos:"+c.index,"name:"+c.title]).then(function(b){a.refreshList()}).catch(function(b){logAndShowError(b,
i18n("Failed to unsubscribe podcast!"),l);a.refreshList()})});else if(ADD_ALL_ACTION==b||INSERT_ALL_ACTION==b||PLAY_ALL_ACTION==b)if(a.current&&c.id==a.current.id)a.allSongsItem?a.itemAction(ADD_ALL_ACTION==b?ADD_ACTION:INSERT_ALL_ACTION==b?INSERT_ACTION:PLAY_ACTION,a.allSongsItem):(a.doList(a.items,b),bus.$emit("showMessage",i18n("Adding tracks...")));else{r=[];var p=c.id.startsWith(FILTER_PREFIX),z=p?c.id:SEARCH_ID==c.id&&a.items[0].id.startsWith("track")?"track_id":"album_id",u=c.allSearchResults&&
0<c.allSearchResults.length?c.allSearchResults:a.items;f=0;for(t=u.length;f<t;++f)if(p?u[f].filter==z:u[f].id.startsWith(z))INSERT_ALL_ACTION==b?r.unshift(u[f]):r.push(u[f]);else if(0<r.length)break;a.doList(r,b);bus.$emit("showMessage",p||c.id.endsWith("tracks")?i18n("Adding tracks..."):i18n("Adding albums..."))}else if(b==GOTO_ARTIST_ACTION)a.fetchItems(a.replaceCommandTerms({command:["albums"],params:["artist_id:"+c.artist_id,ARTIST_ALBUM_TAGS,SORT_KEY+ARTIST_ALBUM_SORT_PLACEHOLDER]}),{cancache:!1,
id:"artist_id:"+c.artist_id,title:c.id.startsWith("album_id:")?c.subtitle:c.artist,stdItem:STD_ITEM_ARTIST});else if(b==GOTO_ALBUM_ACTION)a.fetchItems({command:["tracks"],params:["album_id:"+c.album_id,TRACK_TAGS,SORT_KEY+"tracknum"]},{cancache:!1,id:"album_id:"+c.album_id,title:c.album,stdItem:STD_ITEM_ALBUM});else if(ADD_TO_PLAYLIST_ACTION==b)bus.$emit("dlg.open","addtoplaylist",[c],[browseBuildCommand(a,c)]);else if(REMOVE_DUPES_ACTION==b)confirm(i18n("Remove duplicate tracks?")+addNote(i18n("This will remove tracks with the same artist and title.")),
i18n("Remove")).then(function(b){b&&(a.items[0].id.startsWith("playlist_id:")?lmsList("",["playlists","tracks"],[c.id,PLAYLIST_TRACK_TAGS]).then(function(b){b=parseBrowseResp(b.data,c,a.options,void 0);0<b.items.length?removeDuplicates(c.id,b.items):bus.$emit("showMessage",i18n("Playlist has no tracks"))}):removeDuplicates(c.id,a.items))});else if(BR_COPY_ACTION==b)bus.$emit("queueGetSelectedUrls",d,c.id);else if(DOWNLOAD_ACTION==b){f=a.current.id.startsWith("artist_id:")?a.current.title:void 0;void 0==
f&&(t=c.id.startsWith("album_id:")?c:a.current.id.startsWith("album_id:")?a.current:void 0,void 0!=t&&(void 0!=t.artists?f=t.artists[0]:void 0!=t.subtitle&&(f=t.subtitle)));if(void 0==f)for(t=a.history,r=t.length-1;0<r&&void 0==f;--r)p=t[r].current,void 0!=p&&(p.id.startsWith("artist_id:")?f=p.title:p.id.startsWith("album_id:")&&(void 0!=p.artists?f=p.artists[0]:void 0!=p.subtitle&&(f=p.subtitle)));download(c,c.id.startsWith("album_id:")?a.buildCommand(c):void 0,f)}else l=browseBuildFullCommand(a,
c,b),0===l.command.length?bus.$emit("showError",void 0,i18n("Don't know how to handle this!")):lmsCommand(a.playerId(),l.command).then(function(d){logJsonMessage("RESP",d.data);bus.$emit("refreshStatus");a.clearSelection();a.$store.state.desktopLayout||(b===PLAY_ACTION?a.$store.commit("setPage","now-playing"):b===ADD_ACTION?bus.$emit("showMessage",i18n("Appended '%1' to the play queue",void 0==c.title?a.headerTitle:c.title)):b===INSERT_ACTION&&bus.$emit("showMessage",i18n("Inserted '%1' into the play queue",
void 0==c.title?a.headerTitle:c.title)))}).catch(function(a){logAndShowError(a,void 0,l.command)});else bus.$emit("showError",void 0,i18n("No Player"))}
function browseItemMenu(a,b,c,d){if(a.menu.show&&a.menu.item&&b.id==a.menu.item.id)a.menu.show=!1;else if(b.menu)if(1==b.menu.length&&MORE_ACTION==b.menu[0]&&SECTION_PODCASTS!=b.section)if(b.moremenu)showMenu(a,{show:!0,item:b,x:d.clientX,y:d.clientY,index:c});else{var f=browseBuildFullCommand(a,b,b.menu[0]);lmsList(a.playerId(),f.command,f.params,0,100,!1).then(function(g){g=parseBrowseResp(g.data,b,a.options,void 0);0<g.items.length?(b.moremenu=g.items,showMenu(a,{show:!0,item:b,x:d.clientX,y:d.clientY,
index:c})):logAndShowError(void 0,i18n("No entries found"),f.command)})}else showMenu(a,{show:!0,item:b,itemMenu:b.menu,x:d.clientX,y:d.clientY,index:c});else if(void 0!=b.stdItem){var h=STD_ITEMS[b.stdItem];showMenu(a,{show:!0,item:b,itemMenu:h.searchMenu&&(a.current.libsearch||a.current.allSearchResults)?h.searchMenu:h.menu,x:d.clientX,y:d.clientY,index:c})}else TOP_MYMUSIC_ID==b.id&&a.showLibMenu(d,c)}
function browseHeaderAction(a,b,c){if(!(0<a.$store.state.visibleMenus.size&&(a.$store.state.desktopLayout||0>a.settingsMenuActions.indexOf(b))))if(USE_LIST_ACTION==b)a.changeLayout(!1);else if(USE_GRID_ACTION==b)a.changeLayout(!0);else if(ALBUM_SORTS_ACTION==b){b="";for(var d=0,f=a.command.params.length;d<f;++d)if(a.command.params[d].startsWith(SORT_KEY)){b=a.command.params[d].split(":")[1];break}var h=[];d=0;for(f=B_ALBUM_SORTS.length;d<f;++d)h.push({key:B_ALBUM_SORTS[d].key,label:B_ALBUM_SORTS[d].label,
selected:b==B_ALBUM_SORTS[d].key});showMenu(a,{show:!0,x:c?c.clientX:window.innerWidth,y:c?c.clientY:0,albumSorts:h,inMainMenu:!c})}else VLIB_ACTION==b?a.showLibMenu(c):void 0==a.current.allid||ADD_ACTION!=b&&PLAY_ACTION!=b?ADD_TO_PLAYLIST_ACTION==b?bus.$emit("dlg.open","addtoplaylist",a.items):RELOAD_ACTION==b?a.refreshList(!0):ADV_SEARCH_ACTION==b?bus.$emit("dlg.open","advancedsearch",!1):SAVE_VLIB_ACTION==b?promptForText(ACTIONS[SAVE_VLIB_ACTION].title,void 0,void 0,i18n("Save")).then(function(b){if(b.ok&&
b.value&&0<b.value.length){var c=JSON.parse(JSON.stringify(a.command.command));c.push("savelib:"+b.value);lmsCommand("",c).then(function(a){bus.$emit("showMessage",i18n("Saved virtual library."))}).catch(function(a){bus.$emit("showError",void 0,i18n("Failed to save virtual library!"));logError(a)})}}):a.itemAction(b,a.current):a.itemAction(b,{swapid:a.current.allid,id:a.items[0].id,title:a.current.title,goAction:a.items[0].goAction,params:a.items[0].params,section:a.items[0].section})}
function browseGoHome(a){a.searchActive=!1;if(0!=a.history.length){void 0!=a.fetchingItem&&(a.nextReqId(),a.fetchingItem=void 0);a.selection=new Set;var b=0<a.history.length?a.history[0].pos:0;a.items=a.top;a.jumplist=[];a.filteredJumplist=[];a.history=[];a.current=null;a.currentLibId=null;a.pinnedItemLibName=void 0;a.headerTitle=null;a.headerSubTitle=null;a.baseActions=[];a.currentBaseActions=[];a.currentActions={show:!1,items:[]};a.tbarActions=[];a.isTop=!0;a.grid={allowed:!0,use:isSetToUseGrid(GRID_OTHER),
numColumns:0,ih:GRID_MIN_HEIGHT,rows:[],few:!1,haveSubtitle:!0};a.settingsMenuActions=[a.grid.use?USE_LIST_ACTION:USE_GRID_ACTION];a.hoverBtns=!IS_MOBILE;a.command=void 0;a.showRatingButton=!1;a.subtitleClickable=!1;a.inGenre=void 0;a.canDrop=!0;a.$nextTick(function(){a.setBgndCover();a.filterJumplist();a.layoutGrid(!0);setScrollTop(a,0<b.pos?b.pos:0)});bus.$emit("settingsMenuActions",a.settingsMenuActions,"browse")}}
function browseGoBack(a,b){if(void 0!=a.fetchingItem)a.nextReqId(),a.fetchingItem=void 0;else{var c=a.searchActive;if(a.searchActive&&(a.searchActive=!1,1>a.items.length||void 0==a.items[0].allSearchResults&&SEARCH_OTHER_ID!=a.items[0].id))return;if(a.prevPage&&!a.$store.state.desktopLayout){var d=""+a.prevPage;a.$nextTick(function(){a.$nextTick(function(){a.$store.commit("setPage",NP_INFO==d||NP_EXPANDED==d?"now-playing":d)})})}if(2>a.history.length)a.goHome();else{a.selection=new Set;var f=a.history.pop();
a.items=f.items;a.allSongsItem=f.allSongsItem;a.jumplist=f.jumplist;a.filteredJumplist=[];a.grid=f.grid;a.hoverBtns=f.hoverBtns;a.baseActions=f.baseActions;a.current=f.current;a.currentBaseActions=f.currentBaseActions;a.currentActions=f.currentActions;a.currentLibId=f.currentLibId;a.pinnedItemLibName=f.pinnedItemLibName;a.headerTitle=f.headerTitle;a.headerSubTitle=f.headerSubTitle;a.tbarActions=f.tbarActions;a.settingsMenuActions=f.settingsMenuActions;a.command=f.command;a.showRatingButton=f.showRatingButton;
a.subtitleClickable=f.subtitleClickable;a.prevPage=f.prevPage;a.allSearchResults=f.allSearchResults;a.inGenre=f.inGenre;a.searchActive=f.searchActive&&!c;a.canDrop=f.canDrop;a.itemCustomActions=f.itemCustomActions;b||f.needsRefresh?a.refreshList():a.$nextTick(function(){a.setBgndCover();a.filterJumplist();a.layoutGrid(!0);setScrollTop(a,0<f.pos?f.pos:0)});bus.$emit("settingsMenuActions",a.settingsMenuActions,"browse")}}}
function browseBuildCommand(a,b,c,d){var f={command:[],params:[]};if(void 0===b||null===b)return console.error("Null item passed to buildCommand????"),f;void 0==c&&(f=buildStdItemCommand(b,a.command));if(1>f.command.length){void 0==c&&(c="go");var h=a.current==b?a.currentBaseActions:a.baseActions;if(c=b.actions&&b.actions[c]?b.actions[c]:"go"==c&&b.actions&&b.actions["do"]?b.actions["do"]:h?h[c]?h[c]:"go"==c&&h["do"]?h["do"]:void 0:void 0){f.command=[];c.cmd&&c.cmd.forEach(function(a){f.command.push(a)});
f.params=[];var g=new Set;[c.params,b.commonParams].forEach(function(a){if(a)for(var b in a)if(void 0!=a[b]&&null!=a[b]&&0<(""+a[b]).length){var c=b+":"+a[b];f.params.push(c);g.add(c)}});if(c.itemsParams&&b[c.itemsParams])for(var k in b[c.itemsParams])"touchToPlaySingle"!=k&&"touchToPlay"!=k&&(h=b[c.itemsParams][k],void 0!=h&&null!=h&&0<(""+h).length&&(h=k+":"+b[c.itemsParams][k],g.has(h)||f.params.push(h)))}if(2==f.command.length&&"browselibrary"==f.command[0]&&"items"==f.command[1]){h=[];var m=
[],l=!0,n=void 0,e=!1,r=!1,t=!1,p=!1,z=!1;k=0;var u=f.params;for(c=u.length;k<c;++k)if(u[k].startsWith("mode:")){n=u[k].split(":")[1];if(n.startsWith("myMusicArtists"))n="artists";else if(n.startsWith("myMusicAlbums")||"randomalbums"==n)n="albums";else if("vaalbums"==n)n="albums";else if("years"==n)h.push("hasAlbums:1");else if("artists"!=n&&"albums"!=n&&"genres"!=n&&"tracks"!=n&&"playlists"!=n){l=!1;break}m.push(n)}else if(!u[k].startsWith("menu:"))if(u[k].startsWith("tags:"))0>u[k].split(":")[1].indexOf("s")&&
(k+="s"),h.push(u[k]),r=!0;else if(h.push(u[k]),u[k].startsWith(SORT_KEY))e=!0;else if(u[k].startsWith("artist_id:"))t=!0;else if(u[k].startsWith("library_id:"))p=!0;else if(u[k].startsWith("role_id:")){var P=u[k].split(":")[1].toLowerCase();"albumartist"!=P&&"5"!=P&&(z=!0)}l&&1==m.length&&n&&("tracks"==n?(r||h.push(TRACK_TAGS),e||h.push(SORT_KEY+"tracknum")):"albums"==n?(r||h.push(t?ARTIST_ALBUM_TAGS_PLACEHOLDER:ALBUM_TAGS_PLACEHOLDER),e||h.push(SORT_KEY+(t?ARTIST_ALBUM_SORT_PLACEHOLDER:ALBUM_SORT_PLACEHOLDER))):
"playlists"==n?r||h.push(PLAYLIST_TAGS_PLACEHOLDER):r||("artists"==n||"vaalbums"==n?(h.push(ARTIST_TAGS_PLACEHOLDER),p||z||h.push("include_online_only_artists:1")):"years"!=n&&"genres"!=n||h.push("tags:s")),f={command:m,params:h})}else if(a.command&&a.command.params&&"artistinfo"==f.command[0]||"albuminfo"==f.command[0]){m=h=!1;k=0;for(c=f.params.length;k<c;++k)f.params[k].startsWith("artist_id:")?h=!0:f.params[k].startsWith("album_id:")&&(m=!0);if(!h||!m)for(k=0,c=a.command.params.length;k<c;++k)(!h&&
a.command.params[k].startsWith("artist_id:")||!m&&a.command.params[k].startsWith("album_id:"))&&f.params.push(a.command.params[k])}}if(void 0==d||d)f=a.replaceCommandTerms(f,b);return f}
function browseMyMusicMenu(a){0<a.myMusic.length&&!a.myMusic[0].needsUpdating||(a.fetchingItem={id:TOP_ID_PREFIX},lmsCommand("",["material-skin","browsemodes"]).then(function(b){var c=b.data;if(c&&c.result){logJsonMessage("RESP",c);a.myMusic=[];var d=new Set;if(c&&c.result&&c.result.modes_loop){b=0;c=c.result.modes_loop;for(var f=c.length;b<f;++b){var h=c[b];d.add(h.id);if(!a.$store.state.disabledBrowseModes.has(h.id)){var g=a.buildCommand({id:h.id,actions:{go:{cmd:["browselibrary","items"],params:h.params}}},
"go",!1);g={title:h.text,command:g.command,params:g.params,weight:h.weight?parseFloat(h.weight):100,id:MUSIC_ID_PREFIX+h.id,type:"group",icon:"music_note"};var k=!1;h.id.startsWith("myMusicArtistsAudiobooks")?(g.icon="edit",g.cancache=!0):h.id.startsWith("myMusicArtists")?(mapArtistIcon(g.params,g),g.cancache=!0):h.id.startsWith("myMusicAlbumsVariousArtists")?(g.icon=void 0,g.svg="album-multi",g.cancache=!0):h.id.startsWith("myMusicAlbumsAudiobooks")?(g.icon="local_library",g.cancache=!0):h.id.startsWith("myMusicAlbums")?
(g.icon="album",g.cancache=!0):h.id.startsWith("myMusicGenres")?(g.svg="guitar-acoustic",g.icon=void 0,g.cancache=!0,g.id=GENRES_ID):"myMusicPlaylists"==h.id?(g.icon="list",g.section=SECTION_PLAYLISTS):h.id.startsWith("myMusicYears")?(g.icon="date_range",g.cancache=!0,g.id=YEARS_ID):"myMusicNewMusic"==h.id?(g.icon="new_releases",g.section=SECTION_NEWMUSIC):h.id.startsWith("myMusicMusicFolder")?g.icon="folder":h.id.startsWith("myMusicFileSystem")?g.icon="computer":"myMusicRandomAlbums"==h.id?(g.svg=
"dice-album",g.icon=void 0):h.id.startsWith("myMusicTopTracks")?(g.icon="arrow_upward",g.limit=200):h.id.startsWith("myMusicFlopTracks")?(g.icon="arrow_downward",g.limit=200):h.icon?h.icon.endsWith("/albums.png")?g.icon="album":h.icon.endsWith("/artists.png")?(g.svg="artist",g.icon=void 0):h.icon.endsWith("/genres.png")?(g.svg="guitar-acoustic",g.icon=void 0):k=!0:k=!0;k&&mapIcon(h)&&(g.svg=h.svg,g.icon=h.icon);g.params.push("menu:1");0<=getField(g,"genre_id:")&&(g.mapgenre=!0);a.myMusic.push(g)}}}a.playerId()?
lmsList(a.playerId(),["menu","items"],["direct:1"]).then(function(b){var c=b.data;if(c&&c.result&&c.result.item_loop){logJsonMessage("RESP",c);b=0;c=c.result.item_loop;for(var f=c.length;b<f;++b){var e=c[b];if("myMusic"==e.node&&e.id)if("randomplay"==e.id)a.myMusic.push({title:i18n("Random Mix"),svg:"dice-multiple",id:RANDOM_MIX_ID,type:"app",weight:e.weight?parseFloat(e.weight):100});else if(!e.id.startsWith("myMusicSearch")&&!e.id.startsWith("opmlselect")&&!d.has(e.id)){var g=a.buildCommand(e,"go",
!1),h={title:e.text,command:g.command,params:g.params,weight:e.weight?parseFloat(e.weight):100,id:MUSIC_ID_PREFIX+e.id,type:"group",icon:"music_note"};"dynamicplaylist"==e.id?(h.svg="dice-list",h.icon=void 0):e.id.startsWith("trackstat")?h.icon="bar_chart":e.id.startsWith("artist")?(h.svg="artist",h.icon=void 0):e.id.startsWith("playlists")?(h.icon="list",h.section=SECTION_PLAYLISTS):"moods"==e.id?(h.svg="magic-wand",h.icon=void 0):"custombrowse"==e.id||e.menuIcon&&e.menuIcon.endsWith("/custombrowse.png")?
(1==g.params.length&&g.params[0].startsWith("hierarchy:new")&&(h.limit=lmsOptions.newMusicLimit),e.id.startsWith("artist")?(h.svg="artist",h.icon=void 0):e.id.startsWith("genre")?(h.svg="guitar-acoustic",h.icon=void 0):h.icon=e.id.startsWith("new")?"new_releases":e.id.startsWith("album")?"album":e.id.startsWith("artist")?"group":e.id.startsWith("decade")||e.id.startsWith("year")?"date_range":e.id.startsWith("playlist")?"list":e.id.startsWith("ratedmysql")?"star":"music_note"):e.icon&&(e.icon.endsWith("/albums.png")?
h.icon="album":e.icon.endsWith("/artists.png")?(h.svg="artist",h.icon=void 0):e.icon.endsWith("/genres.png")&&(h.svg="guitar-acoustic",h.icon=void 0));0<=getField(h,"genre_id:")&&(h.mapgenre=!0);a.myMusic.push(h)}}a.processMyMusicMenu()}a.fetchingItem=void 0}).catch(function(b){a.fetchingItem=void 0;logAndShowError(b)}):(a.processMyMusicMenu(),a.myMusic[0].needsUpdating=!0,a.fetchingItem=void 0)}}).catch(function(b){a.fetchingItem=void 0;logAndShowError(b)}))}
function browseAddPinned(a,b){for(var c=b.length,d=c-1;0<=d;--d)void 0==b[d].command&&void 0==b[d].params&&void 0!=b[d].item&&(c=a.buildCommand(b[d].item),b[d].params=c.params,b[d].command=c.command,b[d].image=b[d].item.image,b[d].icon=b[d].item.icon,b[d].item=void 0),b[d].menu=void 0==b[d].url?[RENAME_ACTION,UNPIN_ACTION]:[PLAY_ACTION,INSERT_ACTION,ADD_ACTION,DIVIDER,RENAME_ACTION,UNPIN_ACTION],a.options.pinned.add(b[d].id),a.top.unshift(b[d]);1>a.history.length&&(a.items=a.top);d=0;for(c=a.myMusic.length;d<
c;++d)a.myMusic[d].menu=[a.options.pinned.has(a.myMusic[d].id)?UNPIN_ACTION:PIN_ACTION];a.saveTopList();removeLocalStorage("pinned")}
function browsePin(a,b,c,d){for(var f=-1,h=-1,g=0,k=a.top.length;g<k;++g)if(a.top[g].id==(b.isRadio?b.presetParams.favorites_url:b.id)){f=g;break}else a.top[g].id.startsWith(TOP_ID_PREFIX)||(h=g);if(c&&-1==f){if(b.mapgenre&&!d){var m=getField(b,"genre_id:");if(0<=m){lmsCommand("",["material-skin","map",b.params[m]]).then(function(d){d=d.data;d.result.genre&&(b.params[m]="genre:"+d.result.genre,browsePin(a,b,c,!0))});return}}b.isRadio?a.top.splice(h+1,0,{id:b.presetParams.favorites_url,title:b.title,
image:b.image,icon:b.icon,svg:b.svg,isPinned:!0,url:b.presetParams.favorites_url,menu:[PLAY_ACTION,INSERT_ACTION,ADD_ACTION,DIVIDER,RENAME_ACTION,UNPIN_ACTION],weight:void 0==b.weight?1E4:b.weight}):"extra"==b.type?a.top.splice(h+1,0,{id:b.id,title:b.title,icon:b.icon,svg:b.svg,url:b.url,isPinned:!0,type:b.type,menu:[RENAME_ACTION,UNPIN_ACTION],weight:1E4}):(d=a.buildCommand(b,void 0,!1),a.top.splice(h+1,0,{id:b.id,title:b.title,libname:b.libname,image:b.image,icon:b.icon,svg:b.svg,mapgenre:b.mapgenre,
command:d.command,params:d.params,isPinned:!0,menu:[RENAME_ACTION,UNPIN_ACTION],weight:void 0==b.weight?1E4:b.weight,section:b.section,cancache:b.cancache}));a.options.pinned.add(b.id);a.updateItemPinnedState(b);a.saveTopList();bus.$emit("showMessage",i18n("Pinned '%1' to home screen.",b.title))}else c||-1==f||confirm(i18n("Un-pin '%1'?",b.title),i18n("Un-pin")).then(function(c){c&&(a.top.splice(f,1),a.options.pinned.delete(b.id),a.updateItemPinnedState(b),a.saveTopList())})}
function browseUpdateItemPinnedState(a,b){if(b.menu){for(var c=0,d=b.menu.length;c<d;++c)if(b.menu[c]==PIN_ACTION||b.menu[c]==UNPIN_ACTION){b.menu[c]=b.menu[c]==PIN_ACTION?UNPIN_ACTION:PIN_ACTION;break}if(b.id.startsWith(TOP_ID_PREFIX))for(c=0,d=a.myMusic.length;c<d;++c)a.myMusic[c].menu=[a.options.pinned.has(a.myMusic[c].id)?UNPIN_ACTION:PIN_ACTION]}}
function browseReplaceCommandTerms(a,b,c){if(shouldAddLibraryId(b)){for(var d=!1,f=0,h=b.params.length;f<h;++f)if(b.params[f].startsWith("library_id:")){var g=b.params[f].split(":")[1];if(void 0!=g&&""!=""+g){d=!0;b.libraryId=g;break}}!d&&(f=a.currentLibId?a.currentLibId:a.$store.state.library?a.$store.state.library:LMS_DEFAULT_LIBRARY)&&(b.params.push("library_id:"+f),b.libraryId=f)}if(0<b.params.length)for(d=getAlbumSort(b,a.inGenre),f=0,h=b.params.length;f<h;++f)c&&c.swapid&&b.params[f]==c.id?
b.params[f]=c.swapid:(b.params[f]=b.params[f].replace(SORT_KEY+ALBUM_SORT_PLACEHOLDER,SORT_KEY+d).replace(SORT_KEY+ARTIST_ALBUM_SORT_PLACEHOLDER,SORT_KEY+d).replace(TERM_PLACEHOLDER,a.enteredTerm).replace(ARTIST_ALBUM_TAGS_PLACEHOLDER,ARTIST_ALBUM_TAGS).replace(ALBUM_TAGS_PLACEHOLDER,lmsOptions.showAllArtists?ALBUM_TAGS_ALL_ARTISTS:ALBUM_TAGS).replace(ARTIST_TAGS_PLACEHOLDER,ARTIST_TAGS).replace(PLAYLIST_TAGS_PLACEHOLDER,PLAYLIST_TAGS),b.params[f].startsWith("tags:")&&(b.params[f]+=(a.$store.state.showRating&&
"tracks"==b.command[0]?"R":"")+(!lmsOptions.serviceEmblems||"tracks"!=b.command[0]&&"albums"!=b.command[0]?"":"E")));return b}
function browseBuildFullCommand(a,b,c){var d=browseBuildCommand(a,b,ACTIONS[c].cmd);if(1>d.command.length){if(b.url&&(!b.id||!b.id.startsWith("playlist_id:")&&!b.id.startsWith("track_id")))d.command=["playlist",INSERT_ACTION==c?"insert":ACTIONS[c].cmd,b.url,b.title];else if(b.app&&b.id)d.command=[b.app,"playlist",INSERT_ACTION==c?"insert":ACTIONS[c].cmd,b.id];else if(b.isFolderItem||b.isUrl)d.command=["playlist",INSERT_ACTION==c?"insert":ACTIONS[c].cmd,b.id];else if(b.id){d.command=["playlistcontrol",
"cmd:"+(c==PLAY_ACTION?"load":INSERT_ACTION==c?"insert":ACTIONS[c].cmd)];if(b.id.startsWith("album_id:")||b.id.startsWith("artist_id:")){c=0;for(var f=void 0!=b.stdItem?buildStdItemCommand(b,b.id==a.current.id?0<a.history.length?a.history[a.history.length-1].command:void 0:a.command).params:b.params,h=f.length;c<h;++c)if(!lmsOptions.noRoleFilter&&f[c].startsWith("role_id:")||!lmsOptions.noGenreFilter&&f[c].startsWith("genre_id:")||f[c].startsWith("artist_id:"))b.id.startsWith("artist_id:")&&f[c].startsWith("artist_id:")||
d.command.push(f[c]),f[c].startsWith("artist_id:")&&!b.id.startsWith("album_id:")&&d.params.push(SORT_KEY+ARTIST_ALBUM_SORT_PLACEHOLDER)}else b.id.startsWith("genre_id:")&&d.params.push(SORT_KEY+ALBUM_SORT_PLACEHOLDER);d.command.push(originalId(b.id))}d=browseReplaceCommandTerms(a,d)}if(0===d.command.length)return d;0<d.params.length&&d.params.forEach(function(a){d.command.push(a)});return d}
function browseDoList(a,b,c){c=ADD_ALL_ACTION==c?ADD_ACTION:PLAY_ALL_ACTION==c?PLAY_ACTION:c;if(b[0].id.startsWith("track_id:")){for(var d="",f=0,h=b.length;f<h;++f)d=1>d.length?d+originalId(b[f].id):d+(","+originalId(b[f].id).split(":")[1]);var g=browseBuildFullCommand(a,{id:d},c);0===g.command.length?bus.$emit("showError",void 0,i18n("Don't know how to handle this!")):(g.command.includes(d)||g.command.push(d),PLAY_ACTION==c?lmsCommand(a.playerId(),["playlist","clear"]).then(function(b){lmsCommand(a.playerId(),
g.command).then(function(b){b=b.data;bus.$emit("refreshStatus");logJsonMessage("RESP",b);a.$store.state.desktopLayout||a.$store.commit("setPage","now-playing")}).catch(function(a){logError(a,g.command)})}):lmsCommand(a.playerId(),g.command).then(function(a){logJsonMessage("RESP",a.data)}).catch(function(a){logError(a,g.command)}))}else{d=[];f=0;for(h=b.length;f<h;++f)(b[f].stdItem||b[f].menu&&0<b[f].menu.length&&b[f].menu[0]==PLAY_ACTION)&&d.push({act:PLAY_ACTION==c?0==d.length?PLAY_ACTION:ADD_ACTION:
c,item:b[f]});a.doCommands(d,PLAY_ACTION==c,!1,0,"refreshStatus")}}
function browseDoCommands(a,b,c,d,f,h){if(0<b.length)if(void 0==f?f=0:(f++,10<b.length&&void 0!=h&&(2==f||25==f||50==f||0===f%100)&&bus.$emit(h)),d||PLAY_ACTION!=b[0].act){var g=b.shift();if(void 0!=g.act){var k=void 0==g.act?g:browseBuildFullCommand(a,g.item,g.act);if(0===k.command.length){bus.$emit("showError",void 0,i18n("Don't know how to handle this!"));return}g=k.command}lmsCommand(a.playerId(),g).then(function(g){logJsonMessage("RESP",g.data);c&&0==b.length&&!a.$store.state.desktopLayout&&
a.$store.commit("setPage","now-playing");browseDoCommands(a,b,c,d,f,h)}).catch(function(a){logError(a,k.command)})}else lmsCommand(a.playerId(),["playlist","clear"]).then(function(d){browseDoCommands(a,b,c,!0,f,h)});else bus.$emit(h)}
function browseInsertQueueAlbums(a,b,c,d,f){if(0==b.length){for(var h=[],g=f.length-1;0<=g;--g,++d)h.push(["playlistcontrol","cmd:add","track_id:"+f[g]]),h.push(["playlist","move",d,c]);browseDoCommands(a,h,!1,!1,0,"refreshStatus")}else{var k=b.pop();h=["tracks",0,1E3];g=0;k=browseBuildCommand(a,a.items[k]).params;for(var m=k.length;g<m;++g)k[g].startsWith("tags:")||h.push(k[g]);lmsCommand("",h).then(function(g){var h=g.data;if(h&&h.result&&h.result.titles_loop){g=0;h=h.result.titles_loop;for(var e=
h.length;g<e;++g)f.push(h[g].id)}browseInsertQueueAlbums(a,b,c,d,f)}).catch(function(a){logError(a)})}}
function browseInsertQueue(a,b,c,d){var f=[],h=[];if(1<a.selection.size||-1==b&&0<a.selection.size)h=Array.from(a.selection).sort(function(a,b){return a<b?1:-1});else{if(-1==b)return;h=[b]}if(a.items[h[0]].id.startsWith("album_id:"))browseInsertQueueAlbums(a,h,c,d,[]);else{if(a.items[h[0]].id.startsWith("track_id:")){b=0;for(var g=h.length;b<g;++b,++d)f.push(["playlistcontrol","cmd:add",originalId(a.items[h[b]].id)]),f.push(["playlist","move",d,c])}else for(b=0,g=h.length;b<g;++b,++d){var k=browseBuildFullCommand(a,
a.items[h[b]],ADD_ACTION);0<k.command.length&&(f.push(k.command),f.push(["playlist","move",d,c]))}browseDoCommands(a,f,!1,!1,0,"refreshStatus")}a.clearSelection()}function browsePlayerChanged(a){a.current&&a.current.id==TOP_APPS_ID?a.refreshList(!0):1<a.history.length&&a.history[1].current.id==TOP_APPS_ID&&(a.history[1].needsRefresh=!0)}
function browseAddToPlaylist(a,b,c,d,f){for(var h=[],g=0,k=b.length;g<k;++g)h.push(["playlists","edit",c,"cmd:add","url:"+b[g]]),void 0!=d&&void 0!=f&&(h.push(["playlists","edit","cmd:move",c,"index:"+f,"toindex:"+d]),f++,d++);browseDoCommands(a,h,!1,!1,0,void 0!=d&&void 0!=f?"refreshPlaylist":void 0)}var DEFERRED_LOADED=!0;var NP_MAX_ALBUMS=50,NP_MAX_TRACKS=50,NP_SIMILAR_URL="http://ws.audioscrobbler.com/2.0/?api_key=5a854b839b10f8d46e630e8287c2299b&method=artist.getSimilar&autocorrect=1&format=json&limit=25&&artist=";
function nowplayingOnPlayerStatus(a,b){var c=!1,d=!1;b.isplaying!=a.playerStatus.isplaying&&(a.playerStatus.isplaying=b.isplaying,c=!0);b.current.canseek!=a.playerStatus.current.canseek&&(a.playerStatus.current.canseek=b.current.canseek);b.current.duration!=a.playerStatus.current.duration&&(a.playerStatus.current.duration=b.current.duration);b.current.url!=a.playerStatus.current.url&&(a.playerStatus.current.url=b.current.url);if(b.current.time!=a.playerStatus.current.time||c)a.playerStatus.current.time=
b.current.time,a.playerStatus.current.updated=new Date,a.playerStatus.current.origTime=b.current.time;a.setPosition();b.current.id!=a.playerStatus.current.id&&(a.playerStatus.current.id=b.current.id);b.current.title!=a.playerStatus.current.title&&(a.playerStatus.current.title=b.current.title,d=!0);b.current.tracknum!=a.playerStatus.current.tracknum&&(a.playerStatus.current.tracknum=b.current.tracknum,d=!0);var f=1<b.current.disccount?b.current.disc:0;if(f!=a.playerStatus.current.disc||b.current.disccount!=
a.playerStatus.current.disccount)a.playerStatus.current.disc=f,a.playerStatus.current.disccount=b.current.disccount,d=!0;b.will_sleep_in!=a.playerStatus.sleepTimer&&(a.playerStatus.sleepTimer=b.will_sleep_in);b.dvc!=a.playerStatus.dvc&&(a.playerStatus.dvc=b.dvc);f=b.current.trackartist?b.current.trackartist:b.current.artist;var h=b.current.trackartists?b.current.trackartists:b.current.artists,g=b.current.trackartist_id?b.current.trackartist_id:b.current.artist_id,k=b.current.trackartist_ids?b.current.trackartist_ids:
b.current.artist_ids;if(a.playerStatus.current.artist!=f||a.playerStatus.current.artists!=h||a.playerStatus.current.artist_id!=g||a.playerStatus.current.artist_ids!=k)a.playerStatus.current.artist=f,a.playerStatus.current.artists=h,a.playerStatus.current.artist_id=g,a.playerStatus.current.artist_ids=k,d=!0;f=b.current.albumartist?b.current.albumartist:b.current.band;h=b.current.albumartist_ids?b.current.albumartist_ids:b.current.band_ids;g=b.current.albumartists?b.current.albumartists:b.current.bands;
if(f!=a.playerStatus.current.albumartist||g!=a.playerStatus.current.albumartists||h!=a.playerStatus.current.albumartist_ids)a.playerStatus.current.albumartist=f,a.playerStatus.current.albumartists=g,a.playerStatus.current.albumartist_ids=h,d=!0;if(b.current.album!=a.playerStatus.current.albumName||b.current.year!=a.playerStatus.current.year||b.current.album_id!=a.playerStatus.current.album_id||b.current.remote_title!=a.playerStatus.current.remote_title)a.playerStatus.current.albumName=b.current.album,
a.playerStatus.current.album_id=b.current.album_id,a.playerStatus.current.year=b.current.year,a.playerStatus.current.remote_title=b.current.remote_title,a.playerStatus.current.album=b.current.year&&0<b.current.year?a.playerStatus.current.albumName+" ("+b.current.year+")":a.playerStatus.current.albumName,a.playerStatus.current.albumLine=buildAlbumLine(b.current,"now-playing"),d=!0;f=void 0==b.current.rating?0:Math.ceil(b.current.rating/10)/2;if(b.current.rating!=a.rating.setting||a.rating.value!=f)a.rating.setting=
b.current.rating,a.rating.value=f,d=!0;f=buildArtistLine(b.current,"now-playing");k=b.current.composer&&lmsOptions.showComposer&&useComposer(b.current.genre);g=b.current.conductor&&lmsOptions.showConductor&&useConductor(b.current.genre);h=b.current.band&&lmsOptions.showBand&&useBand(b.current.genre);b.current.composer!=a.playerStatus.current.composer&&(a.playerStatus.current.composer=b.current.composer);b.current.composers!=a.playerStatus.current.composers&&(a.playerStatus.current.composers=b.current.composers);
b.current.conductor!=a.playerStatus.current.conductor&&(a.playerStatus.current.conductor=b.current.conductor);b.current.conductors!=a.playerStatus.current.conductors&&(a.playerStatus.current.conductors=b.current.conductors);b.current.band!=a.playerStatus.current.band&&(a.playerStatus.current.band=b.current.band);b.current.bands!=a.playerStatus.current.bands&&(a.playerStatus.current.bands=b.current.bands);k=k?b.current.composer_id?b.current.composer_id:b.current.composer_ids?b.current.composer_ids[0]:
void 0:void 0;k!=a.playerStatus.current.composer_id&&(a.playerStatus.current.composer_id=k);g=g?b.current.conductor_id?b.current.conductor_id:b.current.conductor_ids?b.current.conductor_ids[0]:void 0:void 0;g!=a.playerStatus.current.conductor_id&&(a.playerStatus.current.conductor_id=g);h=h?b.current.band_id?b.current.band_id:b.current.band_ids?b.current.band_ids[0]:void 0:void 0;h!=a.playerStatus.current.band_id&&(a.playerStatus.current.band_id=h);b.current.genre!=a.playerStatus.current.genre&&(a.playerStatus.current.genre=
b.current.genre);f!=a.playerStatus.current.artistAndComposer&&(a.playerStatus.current.artistAndComposer=f);b.playlist.shuffle!=a.playerStatus.playlist.shuffle&&(a.playerStatus.playlist.shuffle=b.playlist.shuffle);b.playlist.repeat!=a.playerStatus.playlist.repeat&&(a.playerStatus.playlist.repeat=b.playlist.repeat);b.playlist.current!=a.playerStatus.playlist.current&&(a.playerStatus.playlist.current=b.playlist.current);b.playlist.count!=a.playerStatus.playlist.count&&(a.playerStatus.playlist.count=
b.playlist.count);f=formatTechInfo(b.current);f!=a.playerStatus.current.technicalInfo&&(a.playerStatus.current.technicalInfo=f);d&&a.info.sync&&(a.setInfoTrack(),a.showInfo());c?a.playerStatus.isplaying?a.startPositionInterval():a.stopPositionInterval():a.playerStatus.isplaying&&d&&a.startPositionInterval();a.volume=0>b.volume?-1*b.volume:b.volume;c=(b=b.current.buttons)?b.shuffle:void 0;d=b?b.repeat:void 0;c&&c.command?a.shuffAltBtn={show:!0,command:c.command,tooltip:c.tooltip,image:c.icon,icon:"thumbsDown"==
c.jiveStyle?"thumb_down":"thumbsUp"==c.jiveStyle?"thumb_up":"love"==c.jiveStyle?"favorite":void 0}:a.shuffAltBtn.show&&(a.shuffAltBtn.show=!1);d&&d.command?a.repAltBtn={show:!0,command:d.command,tooltip:d.tooltip,image:d.icon,icon:"thumbsDown"==d.jiveStyle?"thumb_down":"thumbsUp"==d.jiveStyle?"thumb_up":"love"==d.jiveStyle?"favorite":void 0}:a.repAltBtn.show&&(a.repAltBtn.show=!1);a.disableBtns=0==a.playerStatus.playlist.count;a.disablePrev=b&&void 0!=b.rew&&0==parseInt(b.rew)||a.disableBtns;a.disableNext=
b&&void 0!=b.fwd&&0==parseInt(b.fwd)||a.disableBtns}
function nowplayingShowMenu(a,b){b.preventDefault();a.clearClickTimeout();if(a.info.show||a.coverUrl&&a.coverUrl!=LMS_BLANK_COVER&&(void 0==a.touch||!a.touch.moving)&&window.innerHeight>=LMS_MIN_NP_LARGE_INFO_HEIGHT){a.touch=void 0;var c=a.menu.show=!1;a.$store.state.desktopLayout&&a.info.show&&(c=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--bottom-toolbar-height").replace("px","")),c=b.clientY>window.innerHeight-c);if(a.info.show&&!c)a.menu.icons=!1,a.menu.items=[{title:i18n("Standard font size"),
act:NP_FONT_ACT,val:10},{title:i18n("Medium font size"),act:NP_FONT_ACT,val:15},{title:i18n("Large font size"),act:NP_FONT_ACT,val:20}];else if(a.menu.icons=!0,a.menu.items=[{title:i18n("Show image"),icon:"photo",act:NP_PIC_ACT},{title:i18n("Show track information"),svg:"more",act:NP_INFO_ACT}],(c=a.playerStatus.current.artist_ids?a.playerStatus.current.artist_ids[0]:a.playerStatus.current.artist_id)&&a.playerStatus.current.artist&&"?"!=a.playerStatus.current.artist?a.menu.items.push({title:ACTIONS[GOTO_ARTIST_ACTION].title,
act:NP_BROWSE_CMD,cmd:{command:["albums"],params:["artist_id:"+c,ARTIST_ALBUM_TAGS,SORT_KEY+ARTIST_ALBUM_SORT_PLACEHOLDER],title:a.playerStatus.current.artist},svg:ACTIONS[GOTO_ARTIST_ACTION].svg}):(c=a.playerStatus.current.albumartist_ids?a.playerStatus.current.albumartist_ids[0]:a.playerStatus.current.albumartist_id)&&a.playerStatus.current.albumartist&&"?"!=a.playerStatus.current.albumartist&&a.menu.items.push({title:ACTIONS[GOTO_ARTIST_ACTION].title,act:NP_BROWSE_CMD,cmd:{command:["albums"],params:["artist_id:"+
c,ARTIST_ALBUM_TAGS,SORT_KEY+ARTIST_ALBUM_SORT_PLACEHOLDER,"role_id:ALBUMARTIST"],title:a.playerStatus.current.albumartist},svg:ACTIONS[GOTO_ARTIST_ACTION].svg}),a.playerStatus.current.composer&&a.playerStatus.current.composer_id&&useComposer(a.playerStatus.current.genre)&&a.menu.items.push({title:i18n("Go to composer"),act:NP_BROWSE_CMD,cmd:{command:["albums"],params:["artist_id:"+a.playerStatus.current.composer_id,ARTIST_ALBUM_TAGS,SORT_KEY+ARTIST_ALBUM_SORT_PLACEHOLDER,"role_id:COMPOSER"],title:a.playerStatus.current.composer},
svg:"composer"}),a.playerStatus.current.conductor&&a.playerStatus.current.conductor_id&&useConductor(a.playerStatus.current.genre)&&a.menu.items.push({title:i18n("Go to conductor"),act:NP_BROWSE_CMD,cmd:{command:["albums"],params:["artist_id:"+a.playerStatus.current.conductor_id,ARTIST_ALBUM_TAGS,SORT_KEY+ARTIST_ALBUM_SORT_PLACEHOLDER,"role_id:CONDUCTOR"],title:a.playerStatus.current.conductor},svg:"conductor"}),a.playerStatus.current.band&&a.playerStatus.current.band_id&&useBand(a.playerStatus.current.genre)&&
a.menu.items.push({title:i18n("Go to band"),act:NP_BROWSE_CMD,cmd:{command:["albums"],params:["artist_id:"+a.playerStatus.current.band_id,ARTIST_ALBUM_TAGS,SORT_KEY+ARTIST_ALBUM_SORT_PLACEHOLDER,"role_id:BAND"],title:a.playerStatus.current.band},svg:"trumpet"}),a.playerStatus.current.album_id&&a.playerStatus.current.album&&a.menu.items.push({title:ACTIONS[GOTO_ALBUM_ACTION].title,act:NP_BROWSE_CMD,cmd:{command:["tracks"],params:["album_id:"+a.playerStatus.current.album_id,TRACK_TAGS,SORT_KEY+"tracknum"],
title:a.playerStatus.current.album},icon:ACTIONS[GOTO_ALBUM_ACTION].icon}),c=isInFavorites(a.playerStatus.current)?REMOVE_FROM_FAV_ACTION:ADD_TO_FAV_ACTION,void 0!=a.playerStatus.current.favUrl&&void 0!=a.playerStatus.current.favIcon&&a.menu.items.push({title:ACTIONS[c].title,act:NP_ITEM_ACT+c,svg:ACTIONS[c].svg}),void 0!=a.playerStatus.current.title&&a.menu.items.push({title:i18n("Copy details"),act:NP_COPY_DETAILS_CMD,icon:"content_copy"}),a.customActions&&0<a.customActions.length){c=0;for(var d=
a.customActions,f=d.length;c<f;++c)a.menu.items.push({title:d[c].title,act:NP_CUSTOM+c,icon:d[c].icon,svg:d[c].svg})}a.menu.x=b.clientX;a.menu.y=b.clientY;a.$nextTick(function(){a.menu.show=!0})}}
function nowplayingMenuAction(a,b){if(NP_FONT_ACT==b.act)a.adjustFont(b.val);else if(NP_PIC_ACT==b.act)a.showPic();else if(NP_INFO_ACT==b.act)a.trackInfo();else if(NP_BROWSE_CMD==b.act)bus.$emit("browse",b.cmd.command,b.cmd.params,b.cmd.title,"now-playing"),a.close();else if(NP_COPY_DETAILS_CMD==b.act)void 0!=a.playerStatus.current.title&&void 0!=a.playerStatus.current.artist&&void 0!=a.playerStatus.current.album?copyTextToClipboard(i18n("Playing %1 by %2 from %3",a.playerStatus.current.title,a.playerStatus.current.artist,
a.playerStatus.current.album)):void 0!=a.playerStatus.current.title&&void 0!=a.playerStatus.current.artist?copyTextToClipboard(i18n("Playing %1 by %2",a.playerStatus.current.title,a.playerStatus.current.artist)):copyTextToClipboard(i18n("Playing %1",a.playerStatus.current.title));else if(FOLLOW_LINK_ACTION==b.act)openWindow(b.link);else if(SEARCH_TEXT_ACTION==b.act)bus.$emit("browse-search",b.text,NP_INFO),a.close();else if(b.act>=NP_ITEM_ACT){var c=b.act-NP_ITEM_ACT;if(ADD_TO_FAV_ACTION==c||REMOVE_FROM_FAV_ACTION==
c){var d=ADD_TO_FAV_ACTION==c,f=a.playerStatus.current;lmsCommand(a.$store.state.player.id,["favorites","exists",f.favUrl]).then(function(b){b=b.data;logJsonMessage("RESP",b);b&&b.result&&b.result.exists==(d?0:1)&&(d?lmsCommand(a.$store.state.player.id,["favorites","add","url:"+f.favUrl,"title:"+f.title,"icon:"+f.favIcon]).then(function(a){logJsonMessage("RESP",a.data);bus.$emit("refreshFavorites")}).catch(function(a){}):confirm(i18n("Remove '%1' from favorites?",f.title),i18n("Remove")).then(function(b){lmsCommand(a.$store.state.player.id,
["material-skin","delete-favorite","url:"+f.favUrl]).then(function(a){logJsonMessage("RESP",a.data);bus.$emit("refreshFavorites")}).catch(function(a){})}))})}else if(void 0!=a.menu.tab&&void 0!=a.menu.index&&void 0!=a.info.tabs[a.menu.tab].sections[0].items&&0<=a.info.tabs[a.menu.tab].sections[0].items.length&&a.menu.index<a.info.tabs[a.menu.tab].sections[0].items.length){var h=a.info.tabs[a.menu.tab].sections[0].items[a.menu.index];if(MORE_LIB_ACTION==c)bus.$emit("browse",["tracks"],[h.id,TRACK_TAGS,
SORT_KEY+"tracknum"],unescape(h.title),NP_INFO),a.close();else if(MORE_ACTION==c)bus.$emit("trackInfo",h,void 0,NP_INFO),a.close();else{var g=["playlistcontrol","cmd:"+(c==PLAY_ACTION?"load":INSERT_ACTION==c?"insert":ACTIONS[c].cmd),h.id];lmsCommand(a.$store.state.player.id,g).then(function(a){logJsonMessage("RESP",a.data);bus.$emit("refreshStatus");c===ADD_ACTION?bus.$emit("showMessage",i18n("Appended '%1' to the play queue",h.title)):c===INSERT_ACTION&&bus.$emit("showMessage",i18n("Inserted '%1' into the play queue",
h.title))}).catch(function(a){logAndShowError(a,void 0,g)})}}}else a.customActions&&b.act>=NP_CUSTOM&&(b=b.act-NP_CUSTOM,0<=b&&b<a.customActions.length&&performCustomAction(a,a.customActions[b],a.$store.state.player,a.playerStatus.current))}
function nowplayingArtistEntry(a,b,c,d){if(void 0!=a[b+"s"]&&void 0!=a[b+"_ids"]&&a[b+"s"].length==a[b+"_ids"].length){for(var f="",h=0,g=a[b+"s"].length;h<g;++h)d.has(a[b+"s"][h])||(d.add(a[b+"s"][h]),1<f.length&&(f+=", "),f+='<obj class="link-item" onclick="nowplayingBrowse(\''+c+"', "+a[b+"_ids"][h]+", '"+escape(a[b+"s"][h])+"')\">"+a[b+"s"][h]+"</obj>");return f}return void 0==a[b]||d.has(a[b])?"":(d.add(a[b]),void 0!=a[b+"_id"]?'<obj class="link-item" onclick="nowplayingBrowse(\''+c+"', "+a[b+
"_id"]+", '"+escape(a[b])+"')\">"+a[b]+"</obj>":a[b])}
function nowplayingFetchTrackInfo(a){if(a.info.tabs[TRACK_TAB].artist!=a.infoTrack.artist||a.info.tabs[TRACK_TAB].songtitle!=a.infoTrack.title||a.info.tabs[TRACK_TAB].track_id!=a.infoTrack.track_id||a.info.tabs[TRACK_TAB].artist_id!=a.infoTrack.artist_id){a.info.tabs[TRACK_TAB].text=i18n("Fetching...");a.info.tabs[TRACK_TAB].track_id=a.infoTrack.track_id;a.info.tabs[TRACK_TAB].artist=a.infoTrack.artist;a.info.tabs[TRACK_TAB].artist_id=a.infoTrack.artist_id;a.info.tabs[TRACK_TAB].songtitle=a.infoTrack.title;
a.info.tabs[TRACK_TAB].reqId++;65535<a.info.tabs[TRACK_TAB].reqId&&(a.info.tabs[TRACK_TAB].reqId=0);var b=["musicartistinfo","lyrics","html:1"];void 0==a.infoTrack.track_id||(""+a.infoTrack.track_id).startsWith("-")?(void 0!=a.infoTrack.title&&b.push("title:"+a.infoTrack.title),void 0!=a.infoTrack.artist&&b.push("artist:"+a.infoTrack.artist)):b.push("track_id:"+a.infoTrack.track_id);3==b.length?a.info.tabs[TRACK_TAB].text=a.infoTrack.empty?"":i18n("Insufficient metadata to fetch information."):lmsCommand("",
b,a.info.tabs[TRACK_TAB].reqId).then(function(b){b=b.data;logJsonMessage("RESP",b);b&&b.result&&a.isCurrent(b,TRACK_TAB)&&(a.info.tabs[TRACK_TAB].text=b.result.lyrics?replaceNewLines(b.result.lyrics):a.infoTrack.title)}).catch(function(b){a.info.tabs[TRACK_TAB].text=i18n("Failed to retrieve information.")})}else void 0==a.infoTrack.artist&&void 0==a.infoTrack.title&&void 0==a.infoTrack.track_id&&void 0==a.infoTrack.artist_id&&(a.info.tabs[TRACK_TAB].text=a.infoTrack.empty?"":i18n("Insufficient metadata to fetch information."));
b="";var c=a.playerStatus.current,d=c.composer&&lmsOptions.showComposer&&useComposer(c.genre),f=c.conductor&&lmsOptions.showConductor&&useConductor(c.genre),h=c.band&&lmsOptions.showBand&&useBand(c.genre),g=new Set;if(void 0!=c.artist){var k=nowplayingArtistEntry(c,"artist","ARTIST",g);1<k.length&&(b+="<tr><td>"+i18n("Artist")+"&nbsp;</td><td>"+k+"</td></tr>")}void 0!=c.albumartist&&(k=nowplayingArtistEntry(c,"albumartist","ALBUMARTIST",g),1<k.length&&(b+="<tr><td>"+i18n("Album artist")+"&nbsp;</td><td>"+
k+"</td></tr>"));d&&(d=nowplayingArtistEntry(c,"composer","COMPOSER",g),1<d.length&&(b+="<tr><td>"+i18n("Composer")+"&nbsp;</td><td>"+d+"</td></tr>"));f&&(f=nowplayingArtistEntry(c,"conductor","CONDUCTOR",g),1<f.length&&(b+="<tr><td>"+i18n("Conductor")+"&nbsp;</td><td>"+f+"</td></tr>"));h&&(h=nowplayingArtistEntry(c,"band","BAND",g),1<h.length&&(b+="<tr><td>"+i18n("Band")+"&nbsp;</td><td>"+h+"</td></tr>"));void 0!=c.year&&0<c.year&&(b+="<tr><td>"+i18n("Year")+'&nbsp;</td><td><obj class="link-item" onclick="nowplayingBrowse(\'year\', '+
c.year+')">'+c.year+"</obj></td></tr>");void 0!=c.genre&&(b+="<tr><td>"+i18n("Genre")+'&nbsp;</td><td><obj class="link-item" onclick="nowplayingBrowse(\'genre\', '+c.genre_id+",'"+escape(c.genre)+"')\">"+c.genre+"</obj></td></tr>");a.$store.state.techInfo&&void 0!=c.technicalInfo&&(b+="<tr><td>"+i18n("Technical")+"&nbsp;</td><td>"+c.technicalInfo+"</td></tr>");c=getTrackSource(c);void 0!=c&&(b+="<tr><td>"+i18n("Source")+"&nbsp;</td><td>"+c+"</td></tr>");a.info.tabs[TRACK_TAB].sections[0].html=0<b.length?
'<table class="np-html-sect">'+b+"</table>":void 0}
function nowPlayingGetArtistAlbums(a,b){lmsList("",["albums"],["artist_id:"+b,ALBUM_TAGS,"sort:yearalbum"],0,NP_MAX_ALBUMS,!1,a.info.tabs[ARTIST_TAB].reqId).then(function(b){b=b.data;logJsonMessage("RESP",b);b&&b.result&&a.isCurrent(b,ARTIST_TAB)&&(a.info.tabs[ARTIST_TAB].sections[0].items=parseBrowseResp(b).items,a.info.tabs[ARTIST_TAB].sections[0].title=i18np("1 Album","%1 Albums",b.result.count),b.result.count>NP_MAX_ALBUMS&&(a.info.tabs[ARTIST_TAB].sections[0].more=i18n("+ %1 more",b.result.count-
NP_MAX_ALBUMS)))})}
function nowplayingFetchArtistInfo(a){if(a.info.tabs[ARTIST_TAB].artist!=a.infoTrack.artist||a.info.tabs[ARTIST_TAB].artist_id!=a.infoTrack.artist_id||void 0!=a.info.tabs[ARTIST_TAB].artist_ids&&void 0!=a.infoTrack.artist_ids&&a.info.tabs[ARTIST_TAB].artist_ids.length!=a.infoTrack.artist_ids.length){a.info.tabs[ARTIST_TAB].sections[0].items=[];a.info.tabs[ARTIST_TAB].sections[0].more=void 0;a.info.tabs[ARTIST_TAB].sections[1].html=void 0;a.info.tabs[ARTIST_TAB].text=i18n("Fetching...");a.info.tabs[ARTIST_TAB].image=
void 0;a.info.tabs[ARTIST_TAB].isMsg=!0;a.info.tabs[ARTIST_TAB].artist=a.infoTrack.artist;a.info.tabs[ARTIST_TAB].artist_id=a.infoTrack.artist_id;a.info.tabs[ARTIST_TAB].artist_ids=a.infoTrack.artist_ids;a.info.tabs[ARTIST_TAB].albumartist=a.infoTrack.albumartist;a.info.tabs[ARTIST_TAB].albumartist_ids=a.infoTrack.albumartist_ids;a.info.tabs[ARTIST_TAB].reqId++;65535<a.info.tabs[ARTIST_TAB].reqId&&(a.info.tabs[ARTIST_TAB].reqId=0);var b=a.infoTrack.artist_ids;if(void 0!=b&&1<b.length){a.info.tabs[ARTIST_TAB].first=
!0;a.info.tabs[ARTIST_TAB].found=!1;a.info.tabs[ARTIST_TAB].count=b.length;for(var c=0,d=b.length;c<d;++c)lmsCommand("",["musicartistinfo","biography","artist_id:"+b[c].trim(),"html:1"],a.info.tabs[ARTIST_TAB].reqId).then(function(b){b=b.data;logJsonMessage("RESP",b);b&&a.isCurrent(b,ARTIST_TAB)&&(b.result&&b.result.biography&&b.result.artist&&(a.info.tabs[ARTIST_TAB].found=!0,a.info.tabs[ARTIST_TAB].first?(a.info.tabs[ARTIST_TAB].text="",a.info.tabs[ARTIST_TAB].first=!1):a.info.tabs[ARTIST_TAB].text+=
"<br/><br/>",a.info.tabs[ARTIST_TAB].text+="<b>"+b.result.artist+"</b><br/>"+replaceNewLines(b.result.biography)),a.info.tabs[ARTIST_TAB].count--,0!=a.info.tabs[ARTIST_TAB].count||a.info.tabs[ARTIST_TAB].found?a.info.tabs[ARTIST_TAB].isMsg=!1:(a.info.tabs[ARTIST_TAB].text=a.infoTrack.artist,a.info.tabs[ARTIST_TAB].image="/imageproxy/mai/artist/"+a.infoTrack.artist_ids[0]+"/image"+LMS_CURRENT_IMAGE_SIZE))})}else b=["musicartistinfo","biography","html:1"],void 0!=a.infoTrack.artist_id?b.push("artist_id:"+
a.infoTrack.artist_id):b.push("artist:"+a.infoTrack.artist),3==b.length?a.info.tabs[ARTIST_TAB].text=a.infoTrack.empty?"":i18n("Insufficient metadata to fetch information."):lmsCommand("",b,a.info.tabs[ARTIST_TAB].reqId).then(function(b){b=b.data;logJsonMessage("RESP",b);b&&b.result&&a.isCurrent(b,ARTIST_TAB)&&(b.result.biography||b.result.error)&&(void 0==b.result.biography&&a.info.tabs[ARTIST_TAB].albumartist&&a.info.tabs[ARTIST_TAB].artist!=a.info.tabs[ARTIST_TAB].albumartist&&0<=a.info.tabs[ARTIST_TAB].artist.indexOf(a.info.tabs[ARTIST_TAB].albumartist)?
(b=["musicartistinfo","biography","html:1"],void 0!=a.infoTrack.albumartist_ids?b.push("artist_id:"+a.infoTrack.albumartist_ids[0]):void 0!=a.infoTrack.albumartist&&b.push("artist:"+a.infoTrack.albumartist),3==b.length?(a.info.tabs[ARTIST_TAB].text=a.infoTrack.artist,a.info.tabs[ARTIST_TAB].isMsg=!0):lmsCommand("",b,a.info.tabs[ARTIST_TAB].reqId).then(function(b){b=b.data;logJsonMessage("RESP",b);b&&b.result&&a.isCurrent(b,ARTIST_TAB)&&(a.info.tabs[ARTIST_TAB].text=b.result.biography?replaceNewLines(b.result.biography):
a.infoTrack.artist,a.info.tabs[ARTIST_TAB].image=void 0==a.infoTrack.albumartist_ids?void 0:"/imageproxy/mai/artist/"+a.infoTrack.albumartist_ids[0]+"/image"+LMS_CURRENT_IMAGE_SIZE,a.info.tabs[ARTIST_TAB].isMsg=void 0==b.result.biography)}).catch(function(b){a.info.tabs[ARTIST_TAB].text=i18n("Failed to retrieve information.")})):(a.info.tabs[ARTIST_TAB].text=b.result.biography?replaceNewLines(b.result.biography):a.infoTrack.artist,a.info.tabs[ARTIST_TAB].image=void 0==a.infoTrack.artist_ids?void 0:
"/imageproxy/mai/artist/"+a.infoTrack.artist_ids[0]+"/image"+LMS_CURRENT_IMAGE_SIZE,a.info.tabs[ARTIST_TAB].isMsg=void 0==b.result.biography))}).catch(function(b){a.info.tabs[ARTIST_TAB].text=i18n("Failed to retrieve information.")});void 0!=a.infoTrack.artist_id&&0<=a.infoTrack.artist_id?nowPlayingGetArtistAlbums(a,a.infoTrack.artist_id):(a.info.tabs[ARTIST_TAB].albumartist||a.info.tabs[ARTIST_TAB].artist)&&lmsCommand("",["material-skin","map","artist:"+(a.info.tabs[ARTIST_TAB].albumartist?a.info.tabs[ARTIST_TAB].albumartist:
a.info.tabs[ARTIST_TAB].artist)],a.info.tabs[ARTIST_TAB].reqId).then(function(b){(b=b.data)&&b.result&&b.result.artist_id&&a.isCurrent(b,ARTIST_TAB)&&(logJsonMessage("RESP",b),nowPlayingGetArtistAlbums(a,b.result.artist_id))});(a.info.tabs[ARTIST_TAB].albumartist||a.info.tabs[ARTIST_TAB].artist)&&lmsCommand("",["material-skin","geturl","url:"+NP_SIMILAR_URL+encodeURIComponent(a.info.tabs[ARTIST_TAB].artist?a.info.tabs[ARTIST_TAB].artist:a.info.tabs[ARTIST_TAB].albumartist),"format:json"],a.info.tabs[ARTIST_TAB].reqId).then(function(b){if((b=
b.data)&&b.result&&b.result.content){logJsonMessage("RESP",b);var c=b.result.content;if(c.similarartists&&c.similarartists.artist&&0<c.similarartists.artist.length){b=0;c=c.similarartists.artist;for(var d=c.length;b<d;++b)a.info.tabs[ARTIST_TAB].sections[1].html=void 0==a.info.tabs[ARTIST_TAB].sections[1].html?'<p class="np-html-sect">':a.info.tabs[ARTIST_TAB].sections[1].html+", ",a.info.tabs[ARTIST_TAB].sections[1].html+='<obj class="link-item" onclick="nowplayingSearch(\''+escape(c[b].name)+"')\">"+
c[b].name+"</obj>";a.info.tabs[ARTIST_TAB].sections[1].html+="</p>"}}})}else void 0==a.infoTrack.artist&&void 0==a.infoTrack.artist_id&&void 0==a.infoTrack.artist_ids&&(a.info.tabs[ARTIST_TAB].isMsg=!0,a.info.tabs[ARTIST_TAB].text=a.infoTrack.empty?"":i18n("Insufficient metadata to fetch information."),a.info.tabs[ARTIST_TAB].sections[0].items=[])}
function nowplayingFetchAlbumInfo(a){if(a.info.tabs[ALBUM_TAB].albumartist!=a.infoTrack.albumartist||a.info.tabs[ALBUM_TAB].artist_id!=a.infoTrack.artist_id||a.info.tabs[ALBUM_TAB].album!=a.infoTrack.album||a.info.tabs[ALBUM_TAB].album_id!=a.infoTrack.album_id){a.info.tabs[ALBUM_TAB].sections[0].items=[];a.info.tabs[ALBUM_TAB].sections[0].more=void 0;a.info.tabs[ALBUM_TAB].text=i18n("Fetching...");a.info.tabs[ALBUM_TAB].image=void 0;a.info.tabs[ALBUM_TAB].isMsg=!0;a.info.tabs[ALBUM_TAB].albumartist=
a.infoTrack.albumartist;a.info.tabs[ALBUM_TAB].artist_id=a.infoTrack.artist_id;a.info.tabs[ALBUM_TAB].album=a.infoTrack.album;a.info.tabs[ALBUM_TAB].album_id=a.infoTrack.album_id;a.info.tabs[ALBUM_TAB].reqId++;65535<a.info.tabs[ALBUM_TAB].reqId&&(a.info.tabs[ALBUM_TAB].reqId=0);var b=["musicartistinfo","albumreview","html:1"];void 0!=a.infoTrack.album_id?b.push("album_id:"+a.infoTrack.album_id):(void 0!=a.infoTrack.album&&b.push("album:"+a.infoTrack.album),void 0!=a.infoTrack.artist_id&&b.push("artist_id:"+
a.infoTrack.artist_id),void 0!=a.infoTrack.albumartist?b.push("artist:"+a.infoTrack.albumartist):void 0!=a.infoTrack.artist&&b.push("artist:"+a.infoTrack.artist));3==b.length?(a.info.tabs[ALBUM_TAB].text=a.infoTrack.empty?"":i18n("Insufficient metadata to fetch information."),a.info.tabs[ALBUM_TAB].image=a.infoTrack.empty?void 0:a.coverUrl):lmsCommand("",b,a.info.tabs[ALBUM_TAB].reqId).then(function(b){b=b.data;logJsonMessage("RESP",b);b&&b.result&&a.isCurrent(b,ALBUM_TAB)&&(a.info.tabs[ALBUM_TAB].text=
b.result.albumreview?replaceNewLines(b.result.albumreview):a.infoTrack.album,a.info.tabs[ALBUM_TAB].image=b.result.albumreview?void 0:a.coverUrl,a.info.tabs[ALBUM_TAB].isMsg=void 0==b.result.albumreview)}).catch(function(b){a.info.tabs[ALBUM_TAB].text=i18n("Failed to retrieve information.")});void 0!=a.infoTrack.album_id&&0<=a.infoTrack.album_id&&lmsList("",["tracks"],["album_id:"+a.infoTrack.album_id,TRACK_TAGS,"sort:tracknum"],0,1E3,!1,a.info.tabs[ALBUM_TAB].reqId).then(function(b){b=b.data;logJsonMessage("RESP",
b);if(b&&b.result&&a.isCurrent(b,ALBUM_TAB)){var c=parseBrowseResp(b);a.info.tabs[ALBUM_TAB].sections[0].items=c.items.slice(0,NP_MAX_TRACKS);a.info.tabs[ALBUM_TAB].sections[0].title=c.subtitle;c=a.info.tabs[ALBUM_TAB].sections[0].items.length;a.info.tabs[ALBUM_TAB].sections[0].items[c-1].header&&(a.info.tabs[ALBUM_TAB].sections[0].items.pop(),c--);b.result.count>c&&(a.info.tabs[ALBUM_TAB].sections[0].more=i18n("+ %1 more",b.result.count-c))}})}else void 0==a.infoTrack.albumartist&&void 0==a.infoTrack.artist_id&&
void 0==a.infoTrack.album&&void 0==a.infoTrack.album&&(a.info.tabs[ALBUM_TAB].isMsg=!0,a.info.tabs[ALBUM_TAB].text=a.infoTrack.empty?"":i18n("Insufficient metadata to fetch information."),a.info.tabs[ALBUM_TAB].image=a.infoTrack.empty?void 0:a.coverUrl,a.info.tabs[ALBUM_TAB].sections[0].items=[])}
function nowplayingItemClicked(a,b,c,d,f){a.info.tabs[b].sections[c].items[d].header||(a.menu.items=[{title:ACTIONS[PLAY_ACTION].title,icon:ACTIONS[PLAY_ACTION].icon,act:NP_ITEM_ACT+PLAY_ACTION},{title:ACTIONS[INSERT_ACTION].title,svg:ACTIONS[INSERT_ACTION].svg,act:NP_ITEM_ACT+INSERT_ACTION},{title:ACTIONS[ADD_ACTION].title,icon:ACTIONS[ADD_ACTION].icon,act:NP_ITEM_ACT+ADD_ACTION}],ARTIST_TAB==b&&a.menu.items.push({title:i18n("Browse"),svg:"library-music-outline",act:NP_ITEM_ACT+MORE_LIB_ACTION}),
a.menu.items.push({title:ACTIONS[MORE_ACTION].title,svg:ACTIONS[MORE_ACTION].svg,act:NP_ITEM_ACT+MORE_ACTION}),a.menu.icons=!0,a.menu.tab=b,a.menu.section=c,a.menu.index=d,a.menu.x=f.clientX,a.menu.y=f.clientY,a.$nextTick(function(){a.menu.show=!0}))}
function nowplayingMoreClicked(a,b,c){ARTIST_TAB==b&&0==c?(bus.$emit("browse",["albums"],["artist_id:"+a.infoTrack.artist_id,ALBUM_TAGS,"sort:yearalbum"],unescape(a.infoTrack.artist),NP_INFO),a.info.show=!1):ALBUM_TAB==b&&0==c&&(bus.$emit("browse",["tracks"],["album_id:"+a.infoTrack.album_id,TRACK_TAGS,"sort:tracknum"],unescape(a.infoTrack.album),NP_INFO),a.info.show=!1)}
function nowplayingToggleGrid(a,b,c){a.info.tabs[b].sections[c].grid=!a.info.tabs[b].sections[c].grid;setLocalStorageVal("np-tabs-"+b+"-"+c+"-grid",a.info.tabs[b].sections[c].grid)}function nowplayingSearch(a){bus.$emit("browse-search",unescape(a),NP_INFO);bus.$emit("npclose")}
function nowplayingBrowse(a,b,c){var d=void 0,f=void 0;if("year"==a)bus.$emit("browse",a,b,""+b,NP_INFO),bus.$emit("npclose");else if("genre"==a){var h=unescape(c);isNaN(b)?lmsCommand("",["material-skin","map","genre:"+h]).then(function(b){(b=b.data)&&b.result&&b.result.genre_id?(logJsonMessage("RESP",b),bus.$emit("browse",a,b.result.genre_id,h,NP_INFO),bus.$emit("npclose")):bus.$emit("showError",void 0,i18n("Unknown genre"))}).catch(function(a){bus.$emit("showError",void 0,i18n("Unknown genre"))}):
(bus.$emit("browse",a,b,h,NP_INFO),bus.$emit("npclose"))}else d=["albums"],f=["artist_id:"+b,ARTIST_ALBUM_TAGS,SORT_KEY+ARTIST_ALBUM_SORT_PLACEHOLDER],"ARTIST"!=a&&f.push("role_id:"+a),bus.$emit("browse",d,f,unescape(c),NP_INFO),bus.$emit("npclose")};var lmsPromptDialog=Vue.component("lms-prompt-dialog",{template:'<v-dialog v-model="show" v-if="show" persistent :max-width="maxWidth"><v-card><v-card-title v-if="undefined!=title">{{title}}</v-card-title><v-card-text><v-text-field v-if="type==\'text\'" single-line :label="hint" v-model="text" @keyup.enter="close(true);" ref="entry"></v-text-field><div v-else v-html="text" class="clickable" ref="prompt-dlg-text"></div></v-card-text><v-card-actions><v-spacer></v-spacer><v-btn v-if="type!=\'alert\'" flat @click.native="close(undefined==otherButton ? false : 0)">{{negativeButton}}</v-btn><v-btn flat @click.native="close(undefined==otherButton ? true : 1)">{{positiveButton}}</v-btn><v-btn v-if="undefined!=otherButton" flat @click.native="close(2)">{{otherButton}}</v-btn></v-card-actions></v-card></v-dialog>',
data:function(){return{show:!1,title:void 0,text:void 0,hint:void 0,positiveButton:void 0,negativeButton:void 0,otherButton:void 0,type:"confirm"}},mounted:function(){bus.$on("prompt.open",function(a,b,c,d,f,h,g){this.text=c?c:"";"alert"==a&&"-"==this.text?this.show=!1:(this.maxWidth=50<=this.text.length||"confirm"!=a?500:300,this.type=a,this.title=b,this.hint=d,this.positiveButton=void 0==f?"alert"==a?i18n("Close"):i18n("OK"):f,this.negativeButton=void 0==h?i18n("Cancel"):h,this.otherButton=g,this.show=
!0,"text"==a&&focusEntry(this))}.bind(this));bus.$on("esc",function(){"prompt"==this.$store.state.activeDialog&&this.close(!1)}.bind(this));bus.$on("notificationLinkActivated",function(){"prompt"==this.$store.state.activeDialog&&this.close(!1)}.bind(this))},methods:{close:function(a){this.show=!1;bus.$emit("prompt.resp",a,this.text)}},watch:{show:function(a){this.$store.commit("dialogOpen",{name:"prompt",shown:a})}}});
function confirm(a,b,c,d){return new Promise(function(f){bus.$emit("dlg.open","prompt","confirm",void 0,a,void 0,b,c,d);bus.$once("prompt.resp",function(a){f(a)})})}function promptForText(a,b,c,d,f){return new Promise(function(h){bus.$emit("dlg.open","prompt","text",a,c,b,d,f);bus.$once("prompt.resp",function(a,b,c){h({ok:a,value:b.trim()})})})}
function showAlert(a,b){return new Promise(function(c){bus.$emit("dlg.open","prompt","alert",void 0,a,void 0,b);bus.$once("prompt.resp",function(a){c(a)})})};var STD_ITEM_GENRE=0,STD_ITEM_ARTIST=1,STD_ITEM_ALBUM=2,STD_ITEM_PLAYLIST=3,STD_ITEM_REMOTE_PLAYLIST=4,STD_ITEM_YEAR=5,STD_ITEM_TRACK=6,STD_ITEM_ALBUM_TRACK=7,STD_ITEM_PLAYLIST_TRACK=8,STD_ITEM_REMOTE_PLAYLIST_TRACK=9,STD_ITEM_MUSICIP_MOOD=10,STD_ITEMS=[{command:["artists"],params:[ARTIST_TAGS,"include_online_only_artists:1"],menu:[PLAY_ACTION,INSERT_ACTION,ADD_ACTION,ADD_RANDOM_ALBUM_ACTION,DIVIDER,ADD_TO_FAV_ACTION,SELECT_ACTION,CUSTOM_ACTIONS,MORE_LIB_ACTION]},{command:["albums"],params:[ARTIST_ALBUM_TAGS,
SORT_KEY+ARTIST_ALBUM_SORT_PLACEHOLDER],menu:[PLAY_ACTION,INSERT_ACTION,ADD_ACTION,ADD_RANDOM_ALBUM_ACTION,DIVIDER,ADD_TO_FAV_ACTION,SELECT_ACTION,CUSTOM_ACTIONS,MORE_LIB_ACTION],actionMenu:[DIVIDER,INSERT_ACTION,ADD_RANDOM_ALBUM_ACTION,DIVIDER,ADD_TO_FAV_ACTION,CUSTOM_ACTIONS,MORE_LIB_ACTION]},{command:["tracks"],params:[TRACK_TAGS,SORT_KEY+"tracknum"],menu:[PLAY_ACTION,INSERT_ACTION,ADD_ACTION,DIVIDER,ADD_TO_FAV_ACTION,ADD_TO_PLAYLIST_ACTION,DOWNLOAD_ACTION,SELECT_ACTION,CUSTOM_ACTIONS,MORE_LIB_ACTION],
actionMenu:[DIVIDER,INSERT_ACTION,DIVIDER,ADD_TO_FAV_ACTION,ADD_TO_PLAYLIST_ACTION,DOWNLOAD_ACTION,CUSTOM_ACTIONS,MORE_LIB_ACTION],searchMenu:[PLAY_ACTION,INSERT_ACTION,ADD_ACTION,DIVIDER,GOTO_ARTIST_ACTION,ADD_TO_FAV_ACTION,ADD_TO_PLAYLIST_ACTION,DOWNLOAD_ACTION,SELECT_ACTION,CUSTOM_ACTIONS,MORE_LIB_ACTION]},{command:["playlists","tracks"],params:["tags:acdltK"],menu:[PLAY_ACTION,INSERT_ACTION,ADD_ACTION,DIVIDER,ADD_TO_FAV_ACTION,RENAME_ACTION,REMOVE_DUPES_ACTION,DELETE_ACTION,DOWNLOAD_ACTION,SELECT_ACTION,
BR_COPY_ACTION,MORE_LIB_ACTION],actionMenu:[INSERT_ACTION,DIVIDER,ADD_TO_FAV_ACTION,REMOVE_DUPES_ACTION,DOWNLOAD_ACTION,MORE_LIB_ACTION]},{command:["playlists","tracks"],params:[PLAYLIST_TRACK_TAGS],menu:[PLAY_ACTION,INSERT_ACTION,ADD_ACTION,DIVIDER,ADD_TO_FAV_ACTION,SELECT_ACTION]},{command:["albums"],params:[ALBUM_TAGS_PLACEHOLDER,SORT_KEY+ALBUM_SORT_PLACEHOLDER],menu:[PLAY_ACTION,INSERT_ACTION,ADD_ACTION,ADD_RANDOM_ALBUM_ACTION,DIVIDER,ADD_TO_FAV_ACTION,SELECT_ACTION,CUSTOM_ACTIONS,MORE_LIB_ACTION]},
{menu:[PLAY_ACTION,INSERT_ACTION,ADD_ACTION,DIVIDER,ADD_TO_PLAYLIST_ACTION,DOWNLOAD_ACTION,RATING_ACTION,SELECT_ACTION,CUSTOM_ACTIONS,MORE_LIB_ACTION],searchMenu:[PLAY_ACTION,INSERT_ACTION,ADD_ACTION,DIVIDER,GOTO_ARTIST_ACTION,GOTO_ALBUM_ACTION,ADD_TO_PLAYLIST_ACTION,DOWNLOAD_ACTION,RATING_ACTION,SELECT_ACTION,CUSTOM_ACTIONS,MORE_LIB_ACTION]},{menu:[PLAY_ACTION,PLAY_ALBUM_ACTION,INSERT_ACTION,ADD_ACTION,DIVIDER,ADD_TO_PLAYLIST_ACTION,DOWNLOAD_ACTION,RATING_ACTION,SELECT_ACTION,CUSTOM_ACTIONS,MORE_LIB_ACTION]},
{menu:[PLAY_ACTION,INSERT_ACTION,ADD_ACTION,DIVIDER,REMOVE_ACTION,DOWNLOAD_ACTION,SELECT_ACTION,BR_COPY_ACTION,MOVE_HERE_ACTION,CUSTOM_ACTIONS]},{menu:[PLAY_ACTION,INSERT_ACTION,ADD_ACTION,DIVIDER,SELECT_ACTION]},{menu:[PLAY_ACTION,INSERT_ACTION,ADD_ACTION,DIVIDER,ADD_TO_FAV_ACTION]}];
function buildStdItemCommand(a,b){var c={command:[],params:[]};if(void 0==a)return c;if(void 0==a.stdItem){if(a.command&&0<a.command.length)for(var d=0,f=a.command,h=f.length;d<h;++d)c.command.push(f[d]);if(a.params&&0<a.params.length)for(d=0,f=a.params,h=f.length;d<h;++d)c.params.push(f[d])}else{if(void 0==STD_ITEMS[a.stdItem].command)return c;d=0;f=STD_ITEMS[a.stdItem].command;for(h=f.length;d<h;++d)c.command.push(f[d]);d=0;f=STD_ITEMS[a.stdItem].params;for(h=f.length;d<h;++d)c.params.push(f[d]);
if(lmsOptions.techInfo&&(STD_ITEM_ALBUM==a.stdItem||STD_ITEM_PLAYLIST==a.stdItem||STD_ITEM_REMOTE_PLAYLIST==a.stdItem))for(d=0,f=c.params,h=f.length;d<h;++d)if(c.params[d].startsWith("tags:")){c.params[d]+="lorT";break}c.params.push(a.id)}if(void 0!=b)if(a.id.startsWith("artist_id:"))for(d=0,h=b.params.length;d<h;++d){if("string"===typeof b.params[d]||b.params[d]instanceof String)a=b.params[d].toLowerCase(),(a.startsWith("role_id:")||!lmsOptions.noGenreFilter&&a.startsWith("genre_id:")||a.startsWith("year:"))&&
c.params.push(b.params[d])}else if(a.id.startsWith("album_id:"))for(d=0,h=b.params.length;d<h;++d){if("string"===typeof b.params[d]||b.params[d]instanceof String)a=b.params[d].toLowerCase(),(!lmsOptions.noRoleFilter&&a.startsWith("role_id:")||!lmsOptions.noGenreFilter&&a.startsWith("genre_id:")||a.startsWith("artist_id:"))&&c.params.push(b.params[d])}else if(a.id.startsWith("genre_id:"))for(d=0,h=b.params.length;d<h;++d)if("string"===typeof b.params[d]||b.params[d]instanceof String)a=b.params[d].toLowerCase(),
(a.startsWith("role_id:")||a.startsWith("year:"))&&c.params.push(b.params[d]);return c};Vue.component("lms-sync-dialog",{template:'<v-dialog v-model="show" v-if="show" persistent width="600" class="lms-dialog"><v-card v-if="player"><v-card-text><v-container grid-list-md><v-layout wrap><v-flex xs12>{{i18n("Select which players you would like to synchronise with \'%1\':", player.name)}}</v-flex><v-flex xs12><v-select chips deletable-chips multiple :items="players" :label="i18n(\'Synchronise players\')" v-model="chosenPlayers" item-text="label" item-value="id"><v-list-tile slot="prepend-item" @click="togglePlayers()" v-if="players.length>1"><v-list-tile-action><v-icon>{{selectAllIcon}}</v-icon></v-list-tile-action><v-list-tile-title>{{i18n(\'Select All\')}}</v-list-tile-title></v-list-tile><v-divider slot="prepend-item"></v-divider></v-select></v-flex></v-layout></v-container></v-card-text><v-card-actions><v-spacer></v-spacer><v-btn flat @click.native="close()">{{i18n(\'Cancel\')}}</v-btn><v-btn flat @click.native="sync()">{{i18n(\'Sync\')}}</v-btn></v-card-actions></v-card></v-dialog>',
props:[],data:function(){return{show:!1,player:void 0,players:[],chosenPlayers:[]}},computed:{selectAllIcon:function(){return this.chosenPlayers.length==this.players.length?"check_box":0<this.chosenPlayers.length?"indeterminate_check_box":"check_box_outline_blank"}},mounted:function(){bus.$on("sync.open",function(a){var b=this;a.isgroup||(this.player=a,lmsCommand(this.player.id,["sync","?"]).then(function(a){if((a=a.data)&&a.result&&void 0!=a.result._sync){a=a.result._sync.split(",");b.origSync=0<
a.length&&"-"!=a[0]?new Set(a):new Set;b.players=[];b.chosenPlayers=[];var c=0;b.$store.state.players.forEach(function(a){a.id===b.player.id||a.isgroup||(a={id:a.id,label:a.name},b.players.push(a),c++,b.origSync.has(a.id)&&b.chosenPlayers.push(a.id))});0<c&&(b.show=!0)}}))}.bind(this));bus.$on("noPlayers",function(){this.show=!1}.bind(this));bus.$on("esc",function(){"sync"==this.$store.state.activeDialog&&(this.show=!1)}.bind(this))},methods:{close:function(){this.show=!1},sync:function(){var a=this,
b=new Set;this.chosenPlayers.forEach(function(a){b.add(a)});var c=[];this.origSync.forEach(function(a){b.has(a)||c.push({player:a,command:["sync","-"]})});b.forEach(function(b){a.origSync.has(b)||c.push({player:a.player.id,command:["sync",b]})});0==c.length?this.show=!1:this.doCommands(c)},doCommands:function(a){var b=this;if(this.show)if(0==a.length)this.show=!1,bus.$emit("refreshStatus"),bus.$emit("syncChanged");else{var c=a.shift();logJsonMessage("SYNC",c);lmsCommand(c.player,c.command).then(function(c){b.doCommands(a)})}},
togglePlayers:function(){var a=this;this.chosenPlayers.length==this.players.length?this.chosenPlayers=[]:(this.chosenPlayers=[],this.players.forEach(function(b){a.chosenPlayers.push(b.id)}))},i18n:function(a,b){return this.show?i18n(a,b):a}},watch:{show:function(a){this.$store.commit("dialogOpen",{name:"sync",shown:a})}}});Vue.component("lms-groupplayers-dialog",{template:'<v-dialog v-model="show" v-if="show" persistent scrollable width="600" class="lms-dialog"><v-card><v-card-title>{{player ? i18n("Edit group player") : i18n("Create group player")}}</v-card-title><v-card-text><v-list two-line><v-list-tile><v-list-tile-content><v-text-field clearable :label="i18n(\'Name\')" v-model="name" class="lms-search" ref="entry"></v-text-field></v-list-tile-content></v-list-tile><v-list-tile><v-select chips deletable-chips multiple :items="players" :label="i18n(\'Group members\')" v-model="chosenPlayers" item-text="label" item-value="id"><v-list-tile slot="prepend-item" @click="togglePlayers()" v-if="players.length>1"><v-list-tile-action><v-icon>{{selectAllIcon}}</v-icon></v-list-tile-action><v-list-tile-title>{{i18n(\'Select All\')}}</v-list-tile-title></v-list-tile><v-divider slot="prepend-item"></v-divider></v-select></v-list-tile><v-list-tile><v-list-tile-content @click="options.powerMaster = !options.powerMaster" class="switch-label"><v-list-tile-title>{{i18n(\'Power on/off all\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n("Use group player\'s power settings to control power of all members.")}}</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action><v-switch v-model="options.powerMaster"></v-switch></v-list-tile-action></v-list-tile><v-divider></v-divider><v-list-tile><v-list-tile-content @click="options.powerPlay = !options.powerPlay" class="switch-label"><v-list-tile-title>{{i18n(\'Power on all upon play\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n(\'Power on all group members when playing to group.\')}}</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action><v-switch v-model="options.powerPlay"></v-switch></v-list-tile-action></v-list-tile><v-list-tile><v-list-tile-content @click="options.greedy = !options.greedy" class="switch-label"><v-list-tile-title>{{i18n(\'Always synchronize all members\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n(\'Always force members synchronization.\')}}</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action><v-switch v-model="options.greedy"></v-switch></v-list-tile-action></v-list-tile></v-list></v-card-text><v-card-actions><v-spacer></v-spacer><v-btn flat @click.native="close()">{{i18n(\'Cancel\')}}</v-btn><v-btn flat v-if="player" @click.native="update()">{{i18n(\'Update\')}}</v-btn><v-btn flat v-else @click.native="create()">{{i18n(\'Create\')}}</v-btn></v-card-actions></v-card></v-dialog>',
props:[],data:function(){return{show:!1,player:void 0,name:void 0,options:{powerMaster:!0,powerPlay:!0,greedy:!1},players:[],chosenPlayers:[]}},computed:{selectAllIcon:function(){return this.chosenPlayers.length==this.players.length?"check_box":0<this.chosenPlayers.length?"indeterminate_check_box":"check_box_outline_blank"}},mounted:function(){bus.$on("group.open",function(a,b){var c=this;"edit"==a?(this.setDefaults(),this.player=b,this.prevName=this.name=b.name,this.unknownIds=[],lmsCommand(this.player.id,
["playergroup",0,255]).then(function(a){(a=a.data)&&a.result&&(c.options.powerMaster=1==parseInt(a.result.powerMaster),c.options.powerPlay=1==parseInt(a.result.powerPlay),c.options.greedy=1==parseInt(a.result.greedy),a.result.players_loop&&a.result.players_loop.forEach(function(a){c.playerIds.has(a.id)?c.chosenPlayers.push(a.id):c.unknownIds.push(a.id)}),c.show=!0,focusEntry(c))})):"create"==a&&(this.setDefaults(),this.show=!0,focusEntry(this))}.bind(this));bus.$on("noPlayers",function(){this.show=
!1}.bind(this));bus.$on("esc",function(){"group"==this.$store.state.activeDialog&&(this.show=!1)}.bind(this))},methods:{setDefaults:function(){var a=this;this.player=this.prevName=this.name=void 0;this.chosenPlayers=[];this.options={powerMaster:!0,powerPlay:!0};this.players=[];this.playerIds=new Set;this.$store.state.players.forEach(function(b){b.isgroup||(a.players.push({id:b.id,label:b.name}),a.playerIds.add(b.id))})},close:function(){this.show=!1},update:function(){var a=this,b=void 0==this.name?
"":this.name.trim();if(!(1>b.length)){var c=[];this.chosenPlayers.forEach(function(a){c.push(a)});this.unknownIds.forEach(function(a){c.push(a)});var d=["playergroups","update","id:"+this.player.id,"members:"+(0<c.length?c.join(","):"-"),"powerMaster:"+(this.options.powerMaster?1:0),"powerPlay:"+(this.options.powerPlay?1:0),"greedy:"+(this.options.greedy?1:0)];this.prevName!=b?lmsCommand(this.player.id,["name",b]).then(function(b){lmsCommand("",d).then(function(b){bus.$emit("refreshServerStatus");
lmsCommand(a.player.id,["material-skin-group","set-modes"]);a.show=!1})}):lmsCommand("",d).then(function(b){lmsCommand(a.player.id,["material-skin-group","set-modes"]);a.show=!1})}},create:function(){var a=this,b=void 0==this.name?"":this.name.trim();1>b.length||lmsCommand("",["playergroups","add","name:"+b,"members:"+this.chosenPlayers.join(","),"powerMaster:"+(this.options.powerMaster?1:0),"powerPlay:"+(this.options.powerPlay?1:0),"greedy:"+(this.options.greedy?1:0)]).then(function(b){b=b.data;
bus.$emit("refreshServerStatus",1E3);b&&b.result&&b.result.id&&lmsCommand(b.result.id,["material-skin-group","set-modes"]);a.show=!1})},togglePlayers:function(){var a=this;this.chosenPlayers.length==this.players.length?this.chosenPlayers=[]:(this.chosenPlayers=[],this.players.forEach(function(b){a.chosenPlayers.push(b.id)}))},i18n:function(a,b){return this.show?i18n(a,b):a}},watch:{show:function(a){this.$store.commit("dialogOpen",{name:"group",shown:a})}}});Vue.component("lms-ui-settings",{template:'<div><v-dialog v-model="show" v-if="show" scrollable fullscreen><v-card><v-card-title class="settings-title"><v-toolbar app-data class="dialog-toolbar"><v-btn flat icon v-longpress:stop="close" :title="i18n(\'Go back\')"><v-icon>arrow_back</v-icon></v-btn><v-toolbar-title>{{width>=450 ? TB_UI_SETTINGS.title+serverName : TB_UI_SETTINGS.title}}</v-toolbar-title><v-spacer></v-spacer><v-menu bottom left v-model="showMenu"><v-btn icon slot="activator"><v-icon>more_vert</v-icon></v-btn><v-list><v-list-tile @click="saveAsDefault"><v-list-tile-avatar v-if="displayMenuIcons"><v-icon>save_alt</v-icon></v-list-tile-avatar><v-list-tile-content><v-list-tile-title>{{i18n(\'Save as default\')}}</v-list-tile-title></v-list-tile-content></v-list-tile><v-list-tile @click="revertToDefault"><v-list-tile-avatar v-if="displayMenuIcons"><v-icon>settings_backup_restore</v-icon></v-list-tile-avatar><v-list-tile-content><v-list-tile-title>{{i18n(\'Revert to default\')}}</v-list-tile-title></v-list-tile-content></v-list-tile></v-list></v-menu></v-toolbar></v-card-title><v-card-text><v-list two-line subheader class="settings-list"><v-header class="dialog-section-header">{{i18n(\'General\')}}</v-header><v-list-tile><v-select :items="themes" :label="i18n(\'Theme\')" v-model="theme" item-text="label" item-value="key"></v-select></v-list-tile><v-divider></v-divider><v-list-tile><v-list-tile-content><v-list-tile-title>{{i18n(\'Color\')}}</v-list-tile-title><div class="color-grid"><div v-for="(item, index) in colorList.colors" @click="color=item.key" :style="{\'background-color\':item.color}" class="color-circle" v-bind:class="{\'selected-color-circle\':item.key==color}"></div><div v-for="(item, index) in userColors" @click="color=item.key" :style="{\'background-color\':item.color}" class="color-circle" v-bind:class="{\'selected-color-circle\':item.key==color}"></div></div></v-list-tile-content></v-list-tile><v-divider></v-divider><v-list-tile><v-list-tile-content @click="colorToolbars = !colorToolbars" class="switch-label"><v-list-tile-title>{{i18n(\'Color toolbars\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n(\'Use chosen color for toolbars.\')}}</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action><v-switch v-model="colorToolbars"></v-switch></v-list-tile-action></v-list-tile><v-divider></v-divider><v-list-tile v-if="allowLayoutAdjust"><v-select :items="layoutItems" :label="i18n(\'Application layout\')" v-model="layout" item-text="label" item-value="key"></v-select></v-list-tile><v-divider v-if="allowLayoutAdjust"></v-divider><v-list-tile><v-select :items="fontSizes" :label="i18n(\'Font size\')" v-model="fontSize" item-text="label" item-value="key"></v-select></v-list-tile><v-divider></v-divider><v-list-tile><v-list-tile-content @click="stopButton = !stopButton" class="switch-label"><v-list-tile-title>{{i18n(\'Stop button\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n(\'Show a stop button next to the play/pause button.\')}}</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action><v-switch v-model="stopButton"></v-switch></v-list-tile-action></v-list-tile><v-divider></v-divider><v-list-tile><v-select :items="volumeSteps" :label="i18n(\'Volume step\')" v-model="volumeStep" item-text="label" item-value="value"></v-select></v-list-tile><v-divider></v-divider><v-list-tile v-if="mediaControlsSupported"><v-list-tile-content @click="mediaControls = !mediaControls" class="switch-label"><v-list-tile-title>{{IS_MOBILE ? i18n(\'Lock screen and notifications\') : i18n(\'Media keys and notifications\')}}</v-list-tile-title><v-list-tile-sub-title>{{IS_MOBILE ? i18n(\'Show playback controls on lock screen and in notification area.\') : i18n(\'Allow control via media keys.\')}} <v-btn flat icon style="margin-top:4px;height:18px;width:18px; opacity:var(--sub-opacity)" @click.stop="mediaControlsInfo"><v-icon small>help_outline</v-icon></v-btn</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action><v-switch v-model="mediaControls"></v-switch></v-list-tile-action></v-list-tile><v-divider v-if="mediaControlsSupported"></v-divider><v-list-tile v-if="!IS_MOBILE"><v-list-tile-content @click="keyboardControl = !keyboardControl" class="switch-label"><v-list-tile-title>{{i18n(\'Keyboard shortcuts\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n("Enable keyboard shortcuts")}} <v-btn flat icon style="margin-top:4px;height:18px;width:18px; opacity:var(--sub-opacity)" @click.stop="keyboardInfo"><v-icon small>help_outline</v-icon></v-btn</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action><v-switch v-model="keyboardControl"></v-switch></v-list-tile-action></v-list-tile><v-divider v-if="!IS_MOBILE"></v-divider><v-list-tile><v-list-tile-content @click="menuIcons = !menuIcons" class="switch-label"><v-list-tile-title>{{i18n(\'Menu icons\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n(\'Show icons next to popup menu entries.\')}}</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action><v-switch v-model="menuIcons"></v-switch></v-list-tile-action></v-list-tile><v-divider></v-divider><v-list-tile><v-list-tile-content @click="screensaver = !screensaver" class="switch-label"><v-list-tile-title>{{i18n(\'Screensaver\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n(\'When no song is playing on current player, darken screen (and show date & time) after 60 seconds.\')}}</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action><v-switch v-model="screensaver"></v-switch></v-list-tile-action></v-list-tile><v-divider></v-divider><v-list-tile v-if="showLaunchPlayer"><v-list-tile-content @click="showPlayerMenuEntry = !showPlayerMenuEntry" class="switch-label"><v-list-tile-title>{{i18n("Add menu option to start player")}}</v-list-tile-title><v-list-tile-sub-title>{{i18n(\'Add option to main menu to launch player.\')}} {{i18n("(Currently only \'SB Player\' is supported.)")}}</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action><v-switch v-model="showPlayerMenuEntry"></v-switch></v-list-tile-action></v-list-tile><v-divider v-if="showLaunchPlayer"></v-divider><v-list-tile><v-list-tile-content @click="techInfo = !techInfo" class="switch-label"><v-list-tile-title>{{i18n(\'Display technical info\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n(\'Show file type, bitrate, etc.\')}}</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action><v-switch v-model="techInfo"></v-switch></v-list-tile-action></v-list-tile><v-divider></v-divider><v-list-tile><v-list-tile-content @click="showArtwork = !showArtwork" class="switch-label"><v-list-tile-title>{{i18n(\'Show artwork\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n("Display covers, artist images, station logos, etc.")}}</v-list-tile-title></v-list-tile-content><v-list-tile-action><v-switch v-model="showArtwork"></v-switch></v-list-tile-action></v-list-tile><v-divider></v-divider><v-list-tile><v-list-tile-content @click="showRating = !showRating" class="switch-label"><v-list-tile-title>{{i18n(\'Show rating\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n(\'Display rating stars.\')}}{{undefined==ratingsPlugin  ? (" "+i18n("NOTE: Changing ratings requires an additional plugin.")) : ""}}</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action><v-switch v-model="showRating"></v-switch></v-list-tile-action></v-list-tile><v-divider></v-divider><v-list-tile><v-list-tile-content @click="showMenuAudio = !showMenuAudio" class="switch-label"><v-list-tile-title>{{i18n(\'Always show menu\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n(\'Show context menu when clicking anywhere on an audio item.\')}}</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action><v-switch v-model="showMenuAudio"></v-switch></v-list-tile-action></v-list-tile><v-divider></v-divider><v-list-tile v-if="hasPassword"><v-text-field clearable :label="i18n(\'Settings password\')" v-model="password" class="lms-search"></v-text-field></v-list-tile><v-divider v-if="hasPassword"></v-divider><v-list-tile><v-list-tile-content @click="powerButton = !powerButton" class="switch-label"><v-list-tile-title>{{i18n(\'Show power button\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n("Replace player\'s icon in toolbar with a power button.")}}</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action><v-switch v-model="powerButton"></v-switch></v-list-tile-action></v-list-tile><v-divider></v-divider><v-list-tile><v-list-tile-content @click="homeButton = !homeButton" class="switch-label"><v-list-tile-title>{{i18n(\'Show home button\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n(\'When navigating into lists, show a home button to quickly navigate to the main (home) screen. Otherwise navigating home can be achieved via a long-press on the back button.\')}}</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action><v-switch v-model="homeButton"></v-switch></v-list-tile-action></v-list-tile><div class="dialog-padding"></div><v-header class="dialog-section-header">{{i18n(\'Browse\')}}</v-header><v-list-tile><v-list-tile-content @click="letterOverlay = !letterOverlay" class="switch-label"><v-list-tile-title>{{i18n(\'Draw letter overlay\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n(\'Draw large letter when scrolling certain lists (e.g. local artists, albums, etc.)\')}}</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action><v-switch v-model="letterOverlay"></v-switch></v-list-tile-action></v-list-tile><v-divider></v-divider><v-list-tile><v-list-tile-content @click="sortFavorites = !sortFavorites" class="switch-label"><v-list-tile-title>{{i18n(\'Sort favorites list\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n(\'Alphabetically sort favorites, rather than server supplied order.\')}} {{i18n(\'NOTE: Folders are always sorted, this setting only affects playable items.\')}}</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action><v-switch v-model="sortFavorites"></v-switch></v-list-tile-action></v-list-tile><v-divider></v-divider><v-list-tile><v-list-tile-content @click="browseBackdrop = !browseBackdrop" class="switch-label"><v-list-tile-title>{{i18n(\'Draw background\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n(\'Use artist, or album, images as background.\')}}</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action><v-switch v-model="browseBackdrop"></v-switch></v-list-tile-action></v-list-tile><v-divider></v-divider><v-list-tile><v-list-tile-content @click="largeCovers = !largeCovers" class="switch-label"><v-list-tile-title>{{i18n(\'Large covers\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n("When possible, allow the grid view to show larger covers.")}}</v-list-tile-title></v-list-tile-content><v-list-tile-action><v-switch v-model="largeCovers"></v-switch></v-list-tile-action></v-list-tile><v-divider></v-divider><v-list-tile><v-list-tile-content @click="sortHome = !sortHome" class="switch-label"><v-list-tile-title>{{i18n(\'Sort home screen\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n(\'Automatically sort items on the home screen.\')}}</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action><v-switch v-model="sortHome"></v-switch></v-list-tile-action></v-list-tile><v-divider></v-divider><v-list-tile><v-list-tile-content class="switch-label"><v-list-tile-title>{{i18n(\'Home screen items\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n(\'Check the standard items which you wish to appear on the home screen.\')}}</v-list-tile-sub-title><v-list-tile-content/></v-list-tile><template v-for="(item, index) in showItems"><div style="display:flex"><v-checkbox v-model="item.show" :label="item.name" class="settings-list-checkbox"></v-checkbox><v-btn v-if="item.id==TOP_MYMUSIC_ID" @click.stop="showBrowseModesDialog" flat icon class="settings-list-checkbox-action"><v-icon>settings</v-icon></v-btn></div></template><div class="dialog-padding"></div><div class="dialog-padding"></div><v-header class="dialog-section-header">{{i18n(\'Now Playing\')}}</v-header><v-list-tile><v-list-tile-content @click="nowPlayingTrackNum = !nowPlayingTrackNum" class="switch-label"><v-list-tile-title>{{i18n(\'Show track number\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n("Show track\'s album number next to title.")}}</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action><v-switch v-model="nowPlayingTrackNum"></v-switch></v-list-tile-action></v-list-tile><v-divider></v-divider><v-list-tile><v-list-tile-content @click="swipeVolume = !swipeVolume" class="switch-label"><v-list-tile-title>{{i18n(\'Swipe to change volume\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n("Swipe up and down to change current volume.")}}</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action><v-switch v-model="swipeVolume"></v-switch></v-list-tile-action></v-list-tile><v-divider></v-divider><v-list-tile><v-select :items="skipSecondsOptions" :label="i18n(\'Previous/next long-press skip\')" v-model="skipSeconds" item-text="label" item-value="value"></v-select></v-list-tile><v-divider></v-divider><v-list-tile><v-list-tile-content @click="nowPlayingClock = !nowPlayingClock" class="switch-label"><v-list-tile-title>{{i18n(\'Show current date and time\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n("Show current date and time in main toolbar if there is sufficient space.")}}</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action><v-switch v-model="nowPlayingClock"></v-switch></v-list-tile-action></v-list-tile><v-divider></v-divider><v-list-tile><v-list-tile-content @click="nowPlayingBackdrop = !nowPlayingBackdrop" class="switch-label"><v-list-tile-title>{{i18n(\'Draw background\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n(\'Use cover of current track as background.\')}}</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action><v-switch v-model="nowPlayingBackdrop"></v-switch></v-list-tile-action></v-list-tile><div class="dialog-padding"></div><v-header class="dialog-section-header">{{i18n(\'Queue\')}}</v-header><v-list-tile><v-list-tile-content @click="autoScrollQueue = !autoScrollQueue" class="switch-label"><v-list-tile-title>{{i18n(\'Auto-scroll to current track\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n(\'Scroll play queue when current track changes.\')}}</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action><v-switch v-model="autoScrollQueue"></v-switch></v-list-tile-action></v-list-tile><v-divider></v-divider><v-list-tile><v-list-tile-content @click="queueShowTrackNum = !queueShowTrackNum" class="switch-label"><v-list-tile-title>{{i18n(\'Show track number\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n("Show track\'s album number next to title.")}}</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action><v-switch v-model="queueShowTrackNum"></v-switch></v-list-tile-action></v-list-tile><v-divider></v-divider><v-list-tile><v-list-tile-content @click="queueThreeLines = !queueThreeLines" class="switch-label"><v-list-tile-title>{{i18n(\'Three lines\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n("Use three lines (title, artist, album) to show track details.")}}</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action><v-switch v-model="queueThreeLines"></v-switch></v-list-tile-action></v-list-tile><v-divider></v-divider><v-list-tile><v-list-tile-content @click="queueBackdrop = !queueBackdrop" class="switch-label"><v-list-tile-title>{{i18n(\'Draw background\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n(\'Use cover of current track as background.\')}}</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action><v-switch v-model="queueBackdrop"></v-switch></v-list-tile-action></v-list-tile><div class="dialog-padding" v-if="infoPlugin"></div><v-header v-if="infoPlugin">{{i18n(\'Song Information\')}}</v-header><v-list-tile v-if="infoPlugin"><v-list-tile-content @click="infoBackdrop = !infoBackdrop" class="switch-label"><v-list-tile-title>{{i18n(\'Draw background\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n(\'Use cover of current track as background.\')}}</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action><v-switch v-model="infoBackdrop"></v-switch></v-list-tile-action></v-list-tile><div class="dialog-padding"></div></v-list></v-card-text></v-card></v-dialog><v-dialog v-model="browseModesDialog.show" :width="browseModesDialog.wide ? 750 : 500" persistent style="overflow:hidden" v-if="browseModesDialog.show"><v-card><v-card-title>{{i18n("Browse modes")}}</v-card-title><table class="browse-modes-table dialog-main-list"><template v-for="(item, i) in browseModesDialog.modes"><tr v-if="!browseModesDialog.wide || i<browseModesDialog.halfLen"><td><v-checkbox v-model="browseModesDialog.modes[i].enabled" :label="browseModesDialog.modes[i].text" error-count="0" hide-details  class="player-settings-list-checkbox"></v-checkbox></td><td v-if="browseModesDialog.wide && i+(browseModesDialog.halfLen)<browseModesDialog.modes.length"><v-checkbox v-model="browseModesDialog.modes[i+(browseModesDialog.halfLen)].enabled" :label="browseModesDialog.modes[i+(browseModesDialog.halfLen)].text" error-count="0" hide-details  class="player-settings-list-checkbox"></v-checkbox></td></tr></template></table><div class="dialog-padding"></div><v-card-actions><v-spacer></v-spacer><v-btn flat @click="browseModesDialog.show = false">{{i18n(\'Close\')}}</v-btn></v-card-actions></v-card></v-dialog></div>',
data:function(){return{show:!1,showMenu:!1,theme:"dark",themes:[],color:"blue",colorList:{},userColors:[],colorToolbars:!1,fontSize:"r",fontSizes:[],letterOverlay:!1,showMenuAudio:!0,sortFavorites:!0,autoScrollQueue:!0,stopButton:!1,browseBackdrop:!0,queueBackdrop:!0,nowPlayingBackdrop:!0,infoBackdrop:!0,techInfo:!1,queueShowTrackNum:!1,nowPlayingTrackNum:!1,nowPlayingClock:!1,swipeVolume:!1,keyboardControl:!0,queueThreeLines:!0,showArtwork:!1,layout:null,layoutItems:[],volumeSteps:[{value:1,label:"1%"},
{value:2,label:"2%"},{value:5,label:"5%"},{value:10,label:"10%"}],volumeStep:5,skipSecondsOptions:[],skipSeconds:30,showPlayerMenuEntry:!1,menuIcons:!0,allowLayoutAdjust:0>window.location.href.indexOf("?layout=")&&0>window.location.href.indexOf("&layout="),sortHome:IS_IPHONE,showItems:[],hasPassword:!1,password:void 0,browseModesDialog:{show:!1,wide:!1,modes:[],halfLen:0},screensaver:!1,showLaunchPlayer:IS_ANDROID&&!queryParams.hide.has("launchPlayer"),serverName:"",showRating:!1,homeButton:!1,powerButton:!1,
largeCovers:!1,width:500,mediaControls:!1,mediaControlsSupported:!queryParams.hide.has("mediaControls")&&"mediaSession"in navigator}},computed:{infoPlugin:function(){return this.$store.state.infoPlugin},darkUi:function(){return this.$store.state.darkUi},displayMenuIcons:function(){return this.$store.state.menuIcons},ratingsPlugin:function(){return this.$store.state.ratingsPlugin},unlockAll:function(){return this.$store.state.unlockAll},player:function(){return this.$store.state.player},usingColoredToolbars:function(){return this.$store.state.theme.endsWith("-colored")}},
mounted:function(){this.width=25*Math.floor(window.innerWidth/25);setTimeout(function(){this.width=25*Math.floor(window.innerWidth/25)}.bind(this),1E3);bus.$on("windowWidthChanged",function(){this.width=25*Math.floor(window.innerWidth/25)}.bind(this));bus.$on("uisettings.open",function(a){var b=this;this.showMenu=!1;this.readStore();this.password=getLocalStorageVal("password","");this.allowLayoutAdjust&&(this.layoutOrig=this.layout=getLocalStorageVal("layout","auto"));this.hasPassword=!1;lmsCommand("",
["material-skin","pass-isset"]).then(function(a){1==parseInt(a.data.result.set)&&(b.hasPassword=!0)}).catch(function(a){});queryParams.nativeUiChanges&&(this.currentSettings=JSON.stringify(this.settings(!0,!0)));lmsCommand("",["material-skin","browsemodes"]).then(function(a){a=a.data;b.browseModesDialog.modes=[];if(a&&a.result&&a.result.modes_loop){b.browseModesDialog.modes=a.result.modes_loop;a=0;for(var c=b.browseModesDialog.modes,f=c.length;a<f;++a)c[a].enabled=!b.$store.state.disabledBrowseModes.has(c[a].id);
b.browseModesDialog.modes.sort(function(a,b){return a.weight!=b.weight?a.weight<b.weight?-1:1:0});b.browseModesDialog.halfLen=Math.ceil(b.browseModesDialog.modes.length/2)}}).catch(function(a){});lmsCommand("",["material-skin","server"]).then(function(a){(a=a.data)&&a.result&&(b.serverName=void 0==a.result.libraryname?"":SEPARATOR+a.result.libraryname)}).catch(function(a){});getMiscJson(this.colorList,"colors",this);a="other";IS_IOS?a="ios":IS_ANDROID?a="android":-1!=navigator.platform.indexOf("Linux")?
a="linux":-1!=navigator.platform.indexOf("Win")?a="windows":-1!=navigator.platform.indexOf("Mac")&&(a="mac");lmsCommand("",["material-skin","themes","platform:"+a]).then(function(a){a=a.data;for(var c=0,f=b.themes.length;c<f;++c)if(b.themes[c].other){b.themes.splice(c,f-c);break}if(a&&a.result&&a.result.themes){c=0;var h=a.result.themes;for(f=h.length;c<f;++c){var g=h[c].label.replace(/-/g," ");h[c].key.startsWith("user:")||(g=g.replace("Dark",i18n("Dark")));b.themes.push({label:g,key:h[c].key,other:!0})}}b.userColors=
[];a&&a.result&&a.result.colors&&(b.userColors=a.result.colors)}).catch(function(a){});this.show=!0}.bind(this));bus.$on("esc",function(){this.showMenu?this.showMenu=!1:"browsemodes"==this.$store.state.activeDialog?this.browseModesDialog.show=!1:"uisettings"==this.$store.state.activeDialog&&(this.show=!1)}.bind(this));bus.$on("hideMenu",function(a){"uisettings"==a&&(this.showMenu=!1)}.bind(this));bus.$on("langChanged",function(){this.initItems()}.bind(this));this.initItems()},methods:{readStore:function(){var a=
this.$store.state.theme?this.$store.state.theme.split("-"):["dark"],b=1<a.length&&("colored"==a[a.length-1]||"standard"==a[a.length-1])?a.pop():"standard";this.theme=a.join("-");this.colorToolbars="colored"==b;this.color=this.$store.state.color;this.fontSize=this.$store.state.fontSize;this.autoScrollQueue=this.$store.state.autoScrollQueue;this.stopButton=this.$store.state.stopButton;this.browseBackdrop=this.$store.state.browseBackdrop;this.queueBackdrop=this.$store.state.queueBackdrop;this.nowPlayingBackdrop=
this.$store.state.nowPlayingBackdrop;this.infoBackdrop=this.$store.state.infoBackdrop;this.techInfo=this.$store.state.techInfo;this.queueShowTrackNum=this.$store.state.queueShowTrackNum;this.nowPlayingTrackNum=this.$store.state.nowPlayingTrackNum;this.nowPlayingClock=this.$store.state.nowPlayingClock;this.swipeVolume=this.$store.state.swipeVolume;this.keyboardControl=this.$store.state.keyboardControl;this.queueThreeLines=this.$store.state.queueThreeLines;this.showArtwork=this.$store.state.showArtwork;
this.letterOverlay=this.$store.state.letterOverlay;this.sortFavorites=this.$store.state.sortFavorites;this.sortHome=this.$store.state.sortHome;this.showMenuAudio=this.$store.state.showMenuAudio;this.skipSeconds=this.$store.state.skipSeconds;this.volumeStep=lmsOptions.volumeStep;this.showPlayerMenuEntry=this.$store.state.showPlayerMenuEntry;this.menuIcons=this.$store.state.menuIcons;this.showRating=this.$store.state.showRating;this.hidden=this.$store.state.hidden;this.screensaver=this.$store.state.screensaver;
this.homeButton=this.$store.state.homeButton;this.powerButton=this.$store.state.powerButton;this.largeCovers=this.$store.state.largeCovers;this.mediaControls=this.$store.state.mediaControls;a=new Set(JSON.parse(getLocalStorageVal("disabledItems",JSON.stringify([TOP_CDPLAYER_ID,TOP_REMOTE_ID]))));this.showItems=[{id:TOP_MYMUSIC_ID,name:i18n("My Music"),show:!this.hidden.has(TOP_MYMUSIC_ID)},{id:TOP_RADIO_ID,name:i18n("Radio"),show:!this.hidden.has(TOP_RADIO_ID)},{id:TOP_FAVORITES_ID,name:i18n("Favorites"),
show:!this.hidden.has(TOP_FAVORITES_ID)},{id:TOP_APPS_ID,name:i18n("Apps"),show:!this.hidden.has(TOP_APPS_ID)},{id:TOP_EXTRAS_ID,name:i18n("Extras"),show:!this.hidden.has(TOP_EXTRAS_ID)}];a.has(TOP_CDPLAYER_ID)||this.showItems.push({id:TOP_CDPLAYER_ID,name:i18n("CD Player"),show:!this.hidden.has(TOP_CDPLAYER_ID)});a.has(TOP_REMOTE_ID)||this.showItems.push({id:TOP_REMOTE_ID,name:i18n("Remote Libraries"),show:!this.hidden.has(TOP_REMOTE_ID)})},initItems:function(){this.themes=[{key:"light",label:i18n("Light")},
{key:"dark",label:i18n("Dark")},{key:"darker",label:i18n("Darker")},{key:"black",label:i18n("Black")}];this.layoutItems=[{key:"auto",label:i18n("Automatic")},{key:"desktop",label:i18n("Use desktop layout")},{key:"mobile",label:i18n("Use mobile layout")}];this.skipSecondsOptions=[{value:5,label:i18n("%1 seconds",5)},{value:10,label:i18n("%1 seconds",10)},{value:15,label:i18n("%1 seconds",15)},{value:30,label:i18n("%1 seconds",30)}];this.fontSizes=[{key:"l",label:i18n("Large")},{key:"r",label:i18n("Regular")},
{key:"s",label:i18n("Small")}]},close:function(){this.showMenu=this.show=!1;this.$store.commit("setUiSettings",this.settings(!1,!1));this.allowLayoutAdjust&&this.layout!=this.layoutOrig&&(setLocalStorageVal("layout",this.layout),bus.$emit("changeLayout","desktop"==this.layout?!0:"mobile"==this.layout?!1:void 0));this.password!=getLocalStorageVal("password","-")&&this.$store.commit("setPassword",this.password);if(queryParams.nativeUiChanges){var a=JSON.stringify(this.settings(!0,!0));if(a!=this.currentSettings)try{NativeReceiver.updateUiSettings(a)}catch(b){}this.currentSettings=
void 0}},settings:function(a,b){a={theme:this.theme+(this.colorToolbars?"-colored":""),color:this.color,fontSize:this.fontSize,autoScrollQueue:this.autoScrollQueue,letterOverlay:this.letterOverlay,sortFavorites:this.sortFavorites,sortHome:this.sortHome,showMenuAudio:this.showMenuAudio,stopButton:this.stopButton,browseBackdrop:this.browseBackdrop,queueBackdrop:this.queueBackdrop,nowPlayingBackdrop:this.nowPlayingBackdrop,infoBackdrop:this.infoBackdrop,techInfo:this.techInfo,queueShowTrackNum:this.queueShowTrackNum,
nowPlayingTrackNum:this.nowPlayingTrackNum,nowPlayingClock:this.nowPlayingClock,swipeVolume:this.swipeVolume,keyboardControl:this.keyboardControl,showArtwork:this.showArtwork,queueThreeLines:this.queueThreeLines,volumeStep:this.volumeStep,showPlayerMenuEntry:this.showPlayerMenuEntry,menuIcons:this.menuIcons,hidden:a?Array.from(this.hiddenItems()):this.hiddenItems(),skipSeconds:this.skipSeconds,disabledBrowseModes:a?Array.from(this.disabledBrowseModes()):this.disabledBrowseModes(),screensaver:this.screensaver,
homeButton:this.homeButton,powerButton:this.powerButton,largeCovers:this.largeCovers,showRating:this.showRating,mediaControls:this.mediaControls};if(b)for(var c in window.localStorage)if(c.startsWith(LS_PREFIX+ALBUM_SORT_KEY)||c.startsWith(LS_PREFIX+ARTIST_ALBUM_SORT_KEY))void 0==a.sorts&&(a.sorts={}),a.sorts[c.substring(LS_PREFIX.length)]=window.localStorage.getItem(c);return a},saveAsDefault:function(){var a=this;confirm(i18n("Save the current settings as default for new users?")+(this.allowLayoutAdjust?
addNote(i18n("NOTE:'Application layout' is not saved, as this is a per-device setting.")):""),i18n("Set Defaults")).then(function(b){b&&(b=a.settings(!0,!0),lmsCommand("",["pref",LMS_MATERIAL_UI_DEFAULT_PREF,JSON.stringify(b)]),lmsCommand("",["pref",LMS_MATERIAL_DEFAULT_ITEMS_PREF,getLocalStorageVal("topItems","[]")]))})},revertToDefault:function(){var a=this;confirm(i18n("Revert to default settings?"),i18n("Revert")).then(function(b){b&&lmsCommand("",["pref",LMS_MATERIAL_UI_DEFAULT_PREF,"?"]).then(function(b){if((b=
b.data)&&b.result&&b.result._p2)try{var c=JSON.parse(b.result._p2);try{c.hidden=void 0==c.hidden?void 0:new Set(c.hidden)}catch(g){c.hidden=void 0}try{c.disabledBrowseModes=void 0==c.disabledBrowseModes?void 0:new Set(c.disabledBrowseModes)}catch(g){c.disabledBrowseModes=void 0}a.$store.commit("setUiSettings",c);a.readStore();c=0;for(var f=a.browseModesDialog.modes,h=f.length;c<h;++c)f[c].enabled=!a.$store.state.disabledBrowseModes.has(f[c].id)}catch(g){}})})},hiddenItems:function(){for(var a=new Set(Array.from(this.hidden)),
b=0,c=this.showItems.length;b<c;++b)this.showItems[b].show&&a.has(this.showItems[b].id)?a.delete(this.showItems[b].id):this.showItems[b].show||a.has(this.showItems[b].id)||a.add(this.showItems[b].id);return a},disabledBrowseModes:function(){for(var a=new Set,b=0,c=this.browseModesDialog.modes.length;b<c;++b)this.browseModesDialog.modes[b].enabled||a.add(this.browseModesDialog.modes[b].id);return a},keyboardInfo:function(){var a=[i18n("Alt+%1","\u25b2")+SEPARATOR+i18n("Increase volume"),i18n("Alt+%1",
"\u25bc")+SEPARATOR+i18n("Decrease volume"),i18n("Alt+%1","\u25c0")+SEPARATOR+i18n("Previous track"),i18n("Alt+%1","\u25b6")+SEPARATOR+i18n("Next track"),i18n("Spacebar")+SEPARATOR+i18n("Play/pause"),i18n("Home")+SEPARATOR+i18n("Go to homescreen"),shortcutStr("\u25c0")+SEPARATOR+i18n("Go back"),shortcutStr(ACTIONS[SEARCH_LIB_ACTION].key)+SEPARATOR+ACTIONS[SEARCH_LIB_ACTION].title,shortcutStr(ACTIONS[PLAY_ACTION].skey,!0)+SEPARATOR+ACTIONS[PLAY_ACTION].title,shortcutStr(ACTIONS[ADD_ACTION].skey,!0)+
SEPARATOR+ACTIONS[ADD_ACTION].title,shortcutStr(LMS_ADD_ITEM_ACTION_KEYBOARD,!0)+SEPARATOR+i18n("Add favorite or podcast"),shortcutStr(ACTIONS[ADD_FAV_FOLDER_ACTION].skey,!0)+SEPARATOR+ACTIONS[ADD_FAV_FOLDER_ACTION].title,shortcutStr(LMS_TRACK_INFO_KEYBOARD)+SEPARATOR+i18n("Show current track information")];this.$store.state.desktopLayout&&a.push(shortcutStr(LMS_EXPAND_NP_KEYBOARD,!0)+SEPARATOR+i18n("Expand now playing"));a.push(shortcutStr(LMS_SAVE_QUEUE_KEYBOARD)+SEPARATOR+i18n("Save queue"));a.push(shortcutStr(LMS_CLEAR_QUEUE_KEYBOARD)+
SEPARATOR+i18n("Clear queue"));a.push(shortcutStr(ACTIONS[PQ_MOVE_QUEUE_ACTION].key)+SEPARATOR+ACTIONS[PQ_MOVE_QUEUE_ACTION].title);a.push(shortcutStr(ACTIONS[PQ_ADD_URL_ACTION].key)+SEPARATOR+ACTIONS[PQ_ADD_URL_ACTION].title);a.push(shortcutStr(ACTIONS[PQ_SCROLL_ACTION].key)+SEPARATOR+ACTIONS[PQ_SCROLL_ACTION].title);this.$store.state.desktopLayout&&a.push(shortcutStr(LMS_TOGGLE_QUEUE_KEYBOARD,!0)+SEPARATOR+i18n("Toggle queue"));a.push(shortcutStr(LMS_UI_SETTINGS_KEYBOARD)+SEPARATOR+TB_UI_SETTINGS.title);
a.push(shortcutStr(LMS_PLAYER_SETTINGS_KEYBOARD)+SEPARATOR+TB_PLAYER_SETTINGS.title);this.$store.state.unlockAll&&a.push(shortcutStr(LMS_SERVER_SETTINGS_KEYBOARD)+SEPARATOR+TB_SERVER_SETTINGS.title);a.push(shortcutStr(LMS_INFORMATION_KEYBOARD)+SEPARATOR+TB_INFO.title);a.push(shortcutStr(LMS_MANAGEPLAYERS_KEYBOARD)+SEPARATOR+TB_MANAGE_PLAYERS.title);a.push(i18n("Alt+(N)")+SEPARATOR+i18n("Switch to Nth player"));this.$store.state.desktopLayout||(a.push("F1"+SEPARATOR+i18n("Browse")),a.push("F2"+SEPARATOR+
i18n("Playing")),a.push("F3"+SEPARATOR+i18n("Queue")));void 0!=this.$store.state.ratingsPlugin&&this.$store.state.showRating&&a.push(shortcutStr("(N)",!0)+SEPARATOR+i18n("Set rating (0..5)"));bus.$emit("dlg.open","iteminfo",{list:a})},mediaControlsInfo:function(){showAlert(i18n("To support this feature, this app needs to fool your browser into thinking its is playing audio. This is accomplished by playing a silent audio file in a loop. Most browsers block auto-playing of audio so this cannot start until you have interacted with the app (e.g. clicked somewhere). Alternatively you can configure your browser to allow auto-play of audio for the URL you use to access this app (%1).",
window.location.hostname+":"+window.location.port))},i18n:function(a){return this.show?i18n(a):a},showBrowseModesDialog:function(){this.browseModesDialog.wide=700<=window.innerWidth;this.browseModesDialog.show=!0}},watch:{show:function(a){this.$store.commit("dialogOpen",{name:"uisettings",shown:a})},"browseModesDialog.show":function(a){this.$store.commit("dialogOpen",{name:"browsemodes",shown:a})},showMenu:function(a){this.$store.commit("menuVisible",{name:"uisettings",shown:a})}},filters:{svgIcon:function(a,
b,c){return"/material/svg/"+a+"?c="+(b||c?LMS_DARK_SVG:LMS_LIGHT_SVG)+"&r="+LMS_MATERIAL_REVISION}}});var DAYS_OF_WEEK="Sun Mon Tues Weds Thurs Fri Sat".split(" ");
Vue.component("lms-player-settings",{template:'<div><v-dialog v-model="show" v-if="show" scrollable fullscreen><v-card><v-card-title class="settings-title"><v-toolbar app-data class="dialog-toolbar"><v-btn flat icon v-longpress:stop="close" :title="i18n(\'Go back\')"><v-icon>arrow_back</v-icon></v-btn><v-btn v-if="showHome && homeButton" flat icon @click="goHome" :title="i18n(\'Go home\')"><v-icon>home</v-icon></v-btn><v-toolbar-title>{{TB_PLAYER_SETTINGS.title+SEPARATOR+playerName}}</v-toolbar-title><v-spacer></v-spacer><v-menu bottom left v-model="showMenu" v-if="(customActions && customActions.length>0) || unlockAll"><v-btn icon slot="activator"><v-icon>more_vert</v-icon></v-btn><v-list><template v-for="(action, index) in customActions"><v-list-tile @click="doCustomAction(action, {id:playerId, name:playerName})"><v-list-tile-avatar v-if="menuIcons"><v-icon v-if="action.icon">{{action.icon}}</v-icon><img v-else-if="action.svg" class="svg-img" :src="action.svg | svgIcon(darkUi)"></img></v-list-tile-avatar><v-list-tile-content><v-list-tile-title>{{action.title}}</v-list-tile-title></v-list-tile-content></v-list-tile></template><v-divider v-if="customActions && customActions.length>0 && unlockAll"></v-divider><v-list-tile v-if="unlockAll" @click="showExtraSettings"><v-list-tile-avatar v-if="menuIcons"><img class="svg-img" :src="\'configure\'| svgIcon(darkUi)"></img></v-list-tile-avatar><v-list-tile-content><v-list-tile-title>{{i18n(\'Extra settings\')}}</v-list-tile-title></v-list-tile-content></v-list-tile><v-list-tile v-if="unlockAll && playerLink" @click="showConfig"><v-list-tile-avatar v-if="menuIcons"><v-icon>build</v-icon></v-list-tile-avatar><v-list-tile-content><v-list-tile-title>{{i18n(\'Configuration\')}}</v-list-tile-title></v-list-tile-content></v-list-tile></v-list></v-menu></v-toolbar></v-card-title><v-card-text><v-list two-line subheader class="settings-list"><v-header class="dialog-section-header" v-if="unlockAll">{{i18n(\'General\')}}</v-header><v-list-tile v-if="unlockAll"><v-list-tile-content><v-text-field clearable :label="i18n(\'Name\')" v-model="playerName" class="lms-search"></v-text-field></v-list-tile-content><v-list-tile-action><v-btn icon flat @click="setIcon" style="margin-top:-18px"><v-icon v-if="playerIcon.icon">{{playerIcon.icon}}</v-icon><img v-else class="svg-img" :src="playerIcon.svg | svgIcon(darkUi)"></img></v-btn></v-list-tile-action></v-list-tile><div class="dialog-padding" v-if="unlockAll"></div><v-header class="dialog-section-header">{{i18n(\'Audio\')}}</v-header><v-list-tile><v-select :items="crossfadeItems" :label="i18n(\'On song change\')" v-model="crossfade" item-text="label" item-value="key"></v-select></v-list-tile><v-divider></v-divider><v-list-tile :disabled="0==crossfade" v-bind:class="{\'disabled\':0==crossfade}"><v-list-tile-content @click="smartCrossfade = !smartCrossfade" class="switch-label"><v-list-tile-title>{{i18n(\'Smart crossfade\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n("Do not crossfade successive tracks from the same album.")}}</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action><v-switch v-model="smartCrossfade"></v-switch></v-list-tile-action></v-list-tile><v-divider></v-divider><v-list-tile><v-select :items="replaygainItems" :label="i18n(\'Volume gain\')" v-model="replaygain" item-text="label" item-value="key"></v-select></v-list-tile><v-divider v-if="dstmItems && dstmItems.length>1"></v-divider><v-list-tile v-if="dstmItems && dstmItems.length>1"><v-select :items="dstmItems" :label="trans.dstm" v-model="dstm" item-text="label" item-value="key"></v-select></v-list-tile><div class="dialog-padding"></div><v-header class="dialog-section-header">{{i18n(\'Sleep\')}} {{sleepTime | displayTime}}</v-header><v-list-tile class="other-setting"><v-list-tile-content><v-list-tile-title><v-btn flat @click="setSleep"><v-icon class="btn-icon">hotel</v-icon>{{i18n(\'Set sleep timer\')}}</v-btn></v-list-tile-title><v-list-tile-sub-title>{{i18n("Control when player should \'sleep\'.")}}</v-list-tile-sub-title></v-list-tile-content></v-list-tile><div class="dialog-padding" v-if="unlockAll"></div><v-header class="dialog-section-header" v-if="unlockAll" id="alarms">{{i18n(\'Alarms\')}}</v-header><v-list-tile v-if="unlockAll"><v-list-tile-content @click="toggleAllAlarms()" class="switch-label"><v-list-tile-title>{{i18n(\'Enable alarms\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n(\'Enable alarm functionality.\')}}</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action><v-switch v-model="alarms.on" @click.stop="toggleAllAlarms()"></v-switch></v-list-tile-action></v-list-tile><v-divider v-if="showAlarms"></v-divider><div class="settings-sub-pad" v-if="showAlarms"></div><v-subheader class="alarm-sched-header" v-if="showAlarms">{{i18n(\'Scheduled alarms\')}}</v-subheader><template v-for="(item, index) in alarms.scheduled" v-if="showAlarms"><v-list-tile class="alarm-entry"><v-checkbox v-model="item.enabled" :label="item | formatAlarm(twentyFourHour)" @click.stop="toggleAlarm(item)"></v-checkbox><v-btn flat icon @click.stop="editAlarm(item)" class="toolbar-button"><v-icon>edit</v-icon></v-btn><v-btn flat icon @click.stop="deleteAlarm(item)" class="toolbar-button"><v-icon>delete</v-icon></v-btn></v-list-tile><v-divider v-if="(index+1 < alarms.scheduled.length)" class="alarm-divider"></v-divider></template><v-btn flat @click.stop="addAlarm()" class="alarm-add" v-if="showAlarms"><v-icon class="btn-icon">alarm_add</v-icon>{{i18n("Add alarm")}}</v-btn><div class="settings-sub-pad" v-if="showAlarms"></div><v-subheader v-if="showAlarms">{{i18n(\'Alarm settings\')}}</v-subheader><v-list-tile v-if="showAlarms"><v-text-field :label="i18n(\'Volume (%)\')" v-model="alarms.volume" type="number"></v-text-field></v-list-tile><v-divider v-if="showAlarms"></v-divider><v-list-tile v-if="showAlarms"><v-text-field :label="i18n(\'Snooze (minutes)\')" v-model="alarms.snooze" type="number"></v-text-field></v-list-tile><v-divider v-if="showAlarms"></v-divider><v-list-tile v-if="showAlarms"><v-text-field :label="i18n(\'Timeout (minutes)\')" v-model="alarms.timeout" type="number"></v-text-field></v-list-tile><v-divider v-if="showAlarms"></v-divider><v-list-tile v-if="showAlarms"><v-list-tile-content @click="alarms.fade=!alarms.fade" class="switch-label"><v-list-tile-title>{{i18n(\'Fade in\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n(\'Fade in alarms when starting.\')}}</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action><v-switch v-model="alarms.fade" @click.stop="alarms.fade=!alarms.fade"></v-switch></v-list-tile-action></v-list-tile><div v-if="libraries.length>1" class="dialog-padding"></div><v-header v-if="libraries.length>1" class="dialog-section-header">{{i18n(\'Library\')}}</v-header><v-list-tile class="settings-note" v-if="libraries.length>1"><p>{{i18n("Each player may be assigned a \'virtual\' library. If set then this will be used to restrict song selection for \'Random Mix\' (only songs from the chosen library will be used), and other modes. This setting might also affect library browsing with other LMS control points (such as the default web UI).")}}<br/><br/>{{i18n("Please note, the setting here will not affect this control point. To change the library of this control point you need to use the context menu button for \'My Music\', or use the \'Change library\' button when browsing \'My Music\'")}}</p></v-list-tile><v-list-tile v-if="libraries.length>1"><v-select :items="libraries" :label="i18n(\'Library\')" v-model="library" item-text="name" item-value="id"></v-select></v-list-tile><div class="dialog-padding" v-if="unlockAll"></div><v-header v-if="unlockAll">{{i18n(\'Other settings\')}}</v-header><v-list-tile v-if="unlockAll" class="other-setting"><v-list-tile-content><v-list-tile-title><v-btn flat @click="showExtraSettings"><img class="svg-img btn-icon" :src="\'configure\'| svgIcon(darkUi)"></img>{{i18n(\'Extra settings\')}}</v-btn></v-list-tile-title><v-list-tile-sub-title>{{i18n(\'Extra player settings, such as synchronization options, player specific plugin settings, etc.\')}}</v-list-tile-sub-title></v-list-tile-content></v-list-tile><v-list-tile v-if="unlockAll && playerLink" class="other-setting"><v-list-tile-content><v-list-tile-title><v-btn flat @click="showConfig"><v-icon class="btn-icon">build</v-icon>{{i18n(\'Configuration\')}}</v-btn></v-list-tile-title><v-list-tile-sub-title>{{i18n(\'Player specific configuration UI, such as piCorePlayer or SqueezeAMP.\')}}</v-list-tile-sub-title></v-list-tile-content></v-list-tile><div class="dialog-padding"></div></v-list></v-card-text></v-card></v-dialog><v-dialog v-model="alarmDialog.show" width="500" persistent><v-card><v-card-title>{{alarmDialog.id ? i18n("Edit alarm") : i18n("Add alarm")}}</v-card-title><v-list two-line subheader class="settings-list dialog-main-list"><v-list-tile class="settings-compact-row"><v-dialog ref="dialog" :close-on-content-click="false" v-model="alarmDialog.timepicker" :return-value.sync="alarmDialog.time"persistent lazy full-width max-width="290px"><v-text-field slot="activator" v-model="formattedTime" :label="i18n(\'Start time\')" prepend-icon="access_time" readonly></v-text-field><v-time-picker v-if="alarmDialog.timepicker" v-model="alarmDialog.time" full-width :format="twentyFourHour?\'24hr\':\'ampm\'"><v-spacer></v-spacer><v-btn flat @click="alarmDialog.timepicker = false">{{i18n(\'Cancel\')}}</v-btn><v-btn flat @click="$refs.dialog.save(alarmDialog.time)">{{i18n(\'OK\')}}</v-btn></v-time-picker></v-dialog></v-list-tile><div class="dialog-padding"></div><v-subheader>{{i18n(\'Days\')}}</v-subheader><v-list-tile class="settings-compact-row" v-if="wide>0"><v-flex xs6><v-checkbox class="ellipsis" v-model="alarmDialog.dow" :label="i18n(\'Monday\')" value="1"></v-checkbox></v-flex><v-flex xs6><v-checkbox class="ellipsis" v-model="alarmDialog.dow" :label="i18n(\'Tuesday\')" value="2"></v-checkbox></v-flex></v-list-tile><v-list-tile class="settings-compact-row" v-if="wide>0"><v-flex xs6><v-checkbox class="ellipsis" v-model="alarmDialog.dow" :label="i18n(\'Wednesday\')" value="3"></v-checkbox></v-flex><v-flex xs6><v-checkbox class="ellipsis" v-model="alarmDialog.dow" :label="i18n(\'Thursday\')" value="4"></v-checkbox></v-flex></v-list-tile><v-list-tile class="settings-compact-row"><v-checkbox class="ellipsis" v-model="alarmDialog.dow" :label="i18n(\'Friday\')" value="5"></v-checkbox></v-list-tile><v-list-tile class="settings-compact-row" v-if="wide>0"><v-flex xs6><v-checkbox class="ellipsis" v-model="alarmDialog.dow" :label="i18n(\'Saturday\')" value="6"></v-checkbox></v-flex><v-flex xs6><v-checkbox class="ellipsis" v-model="alarmDialog.dow" :label="i18n(\'Sunday\')" value="0"></v-checkbox></v-flex></v-list-tile><v-list-tile class="settings-compact-row" v-if="wide==0"><v-checkbox class="ellipsis" v-model="alarmDialog.dow" :label="i18n(\'Monday\')" value="1"></v-checkbox></v-list-tile><v-list-tile class="settings-compact-row" v-if="wide==0"><v-checkbox class="ellipsis" v-model="alarmDialog.dow" :label="i18n(\'Tuesday\')" value="2"></v-checkbox></v-list-tile><v-list-tile class="settings-compact-row" v-if="wide==0"><v-checkbox class="ellipsis" v-model="alarmDialog.dow" :label="i18n(\'Wednesday\')" value="3"></v-checkbox></v-list-tile><v-list-tile class="settings-compact-row" v-if="wide==0"><v-checkbox class="ellipsis" v-model="alarmDialog.dow" :label="i18n(\'Thursday\')" value="4"></v-checkbox></v-list-tile><v-list-tile class="settings-compact-row" v-if="wide==0"><v-checkbox class="ellipsis" v-model="alarmDialog.dow" :label="i18n(\'Friday\')" value="5"></v-checkbox></v-list-tile><v-list-tile class="settings-compact-row" v-if="wide==0"><v-checkbox class="ellipsis" v-model="alarmDialog.dow" :label="i18n(\'Saturday\')" value="6"></v-checkbox></v-list-tile><v-list-tile class="settings-compact-row" v-if="wide==0"><v-checkbox class="ellipsis" v-model="alarmDialog.dow" :label="i18n(\'Sunday\')" value="0"></v-checkbox></v-list-tile><div class="dialog-padding"></div><v-subheader>{{i18n(\'Options\')}}</v-subheader><v-list-tile><v-select :items="alarmSounds" :label="i18n(\'Sound\')" v-model="alarmDialog.url" item-text="label" item-value="key"></v-select></v-list-tile>\x3c!-- TODO ????<v-list-tile class="settings-compact-row"><v-select :items="alarmShuffeItems" :label="i18n(\'Shuffle\')" v-model="alarmDialog.shuffle" item-text="label" item-value="key"></v-select></v-list-tile>--\x3e<v-list-tile><v-list-tile-content @click="alarmDialog.repeat = !alarmDialog.repeat" class="switch-label"><v-list-tile-title>{{i18n(\'Repeat\')}}</v-list-tile-title><v-list-tile-sub-title>{{i18n(\'Should alarms repeat\')}}</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action><v-switch v-model="alarmDialog.repeat"></v-switch></v-list-tile-action></v-list-tile></v-list><div class="dialog-padding"></div><v-card-actions><v-spacer></v-spacer><v-btn flat @click="alarmDialog.show = false">{{i18n(\'Cancel\')}}</v-btn><v-btn flat @click="saveAlarm()">{{alarmDialog.id ? i18n("Save") : i18n("Create")}}</v-btn></v-card-actions></v-card></v-dialog></div>',props:[],
data:function(){return{show:!1,playerName:void 0,playerIcon:void 0,playerLink:void 0,crossfade:void 0,smartCrossfade:!1,replaygain:void 0,dstm:void 0,crossfadeItems:[],replaygainItems:[],dstmItems:[],alarms:{on:!0,volume:100,snooze:9,timeout:60,fade:!0,scheduled:[]},sleepTime:void 0,alarmShuffeItems:[],alarmSounds:[],alarmDialog:{show:!1,id:void 0,time:void 0,dow:[],repeat:!1,url:void 0,shuffle:void 0},wide:1,playerId:void 0,trans:{dstm:void 0},libraries:[],library:void 0,customActions:void 0,showHome:!1}},
computed:{formattedTime:function(){if(!this.alarmDialog.time)return"";var a=this.alarmDialog.time.split(":");return formatTime(3600*parseInt(a[0])+60*parseInt(a[1]),this.$store.state.twentyFourHour)},unlockAll:function(){return this.$store.state.unlockAll},showAlarms:function(){return this.$store.state.unlockAll&&this.alarms.on},darkUi:function(){return this.$store.state.darkUi},menuIcons:function(){return this.$store.state.menuIcons},twentyFourHour:function(){return this.$store.state.twentyFourHour},
homeButton:function(){return this.$store.state.homeButton}},mounted:function(){bus.$on("langChanged",function(){this.initItems()}.bind(this));this.initItems();bus.$on("playerStatus",function(a){this.show&&this.handlePlayerStatus(a)}.bind(this));bus.$on("otherPlayerStatus",function(a){this.show&&this.playerId==a.id&&this.handlePlayerStatus(a)}.bind(this));bus.$on("playersettings.open",function(a,b,c){if("string"===typeof a||a instanceof String)if("-"==a)a=void 0;else{for(var d=!1,f=0,h=this.$store.state.players.length;f<
h&&!d;++f)if(this.$store.state.players[f].id==a||this.$store.state.players[f].name==a)a=this.$store.state.players[f],d=!0;if(!d){bus.$emit("showError",void 0,i18n("Player not found"));return}}void 0==a&&this.$store.state.player&&!this.show?this.playerSettings(this.$store.state.player,b):void 0==a||this.show?this.$store.state.player||bus.$emit("showError",void 0,i18n("No Player")):this.playerSettings(a,b);this.showHome=c}.bind(this));bus.$on("noPlayers",function(){this.show=this.alarmDialog.show=!1}.bind(this));
this.sleepOpen=!1;bus.$on("dialogOpen",function(a,b){"sleep"==a&&(this.sleepOpen=b)}.bind(this));bus.$on("esc",function(){this.showMenu&&(this.showMenu=!1);"alarm"==this.$store.state.activeDialog?this.alarmDialog.show=!1:"playersettings"==this.$store.state.activeDialog&&this.close()}.bind(this));bus.$on("hideMenu",function(a){"playersettings"==a&&(this.showMenu=!1)}.bind(this));bus.$on("iframeClosed",function(a){a&&this.update(!0)}.bind(this));bus.$on("playerIconSet",function(a,b){a==this.playerId&&
(this.playerIcon=b)}.bind(this))},methods:{handlePlayerStatus:function(a){this.controlSleepTimer(a.will_sleep_in)},playerSettings:function(a,b){var c=this;this.wide=700<=window.innerWidth?2:window.innerWidth>=(this.$store.state.largeFonts?410:370)?1:0;this.cancelSleepTimer();this.dstmItems=[];this.replaygain=this.crossfade="0";this.playerId=a.id;this.playerName=a.name;this.playerIcon=a.icon;this.playerLink=a.link;this.orig={player:{name:a.name,icon:a.icon},dstm:"",alarms:{fade:!1,timeout:0,snooze:0,
on:!1,volume:0},library:"",crossfade:"0",smartCrossfade:!1,replaygain:""};this.customActions=getCustomActions(a.id,this.$store.state.unlockAll);this.$store.state.dstmPlugin&&lmsCommand(this.playerId,["dontstopthemusicsetting"]).then(function(a){var b=a.data;if(b.result&&b.result.item_loop){a=0;b=b.result.item_loop;for(var d=b.length;a<d;++a)b[a].actions&&b[a].actions.do&&b[a].actions.do.cmd&&(c.dstmItems.push({key:b[a].actions.do.cmd[2],label:b[a].text}),1===b[a].radio&&(c.dstm=c.orig.dstm=b[a].actions.do.cmd[2]))}});
this.alarms.on=!0;this.alarms.volume=100;this.alarms.snooze=0;this.alarms.timeout=0;this.alarms.fade=!0;lmsCommand(this.playerId,["playerpref","alarmfadeseconds","?"]).then(function(a){(a=a.data)&&a.result&&void 0!=a.result._p2&&(c.alarms.fade=c.orig.alarms.fade=1==a.result._p2)});lmsCommand(this.playerId,["playerpref","alarmTimeoutSeconds","?"]).then(function(a){(a=a.data)&&a.result&&void 0!=a.result._p2&&(c.alarms.timeout=c.orig.alarms.timeout=Math.floor(parseInt(a.result._p2)/60))});lmsCommand(this.playerId,
["playerpref","alarmSnoozeSeconds","?"]).then(function(a){(a=a.data)&&a.result&&void 0!=a.result._p2&&(c.alarms.snooze=c.orig.alarms.snooze=Math.floor(parseInt(a.result._p2)/60))});lmsCommand(this.playerId,["playerpref","alarmsEnabled","?"]).then(function(a){(a=a.data)&&a.result&&void 0!=a.result._p2&&(c.alarms.on=c.orig.alarms.on=1==a.result._p2)});lmsCommand(this.playerId,["playerpref","alarmDefaultVolume","?"]).then(function(a){(a=a.data)&&a.result&&void 0!=a.result._p2&&(c.alarms.volume=c.orig.alarms.volume=
a.result._p2)});this.alarmSounds=[];this.alarms.scheduled=[];lmsList(this.playerId,["alarm","playlists"],void 0,0).then(function(a){(a=a.data)&&a.result&&a.result.item_loop&&a.result.item_loop.forEach(function(a){a.url?c.alarmSounds.push({key:a.url,label:a.category+": "+a.title}):c.alarmSounds.push({key:"CURRENT_PLAYLIST",label:i18n("Current play queue")})});1>c.alarmSounds.length&&c.alarmSounds.push({key:"CURRENT_PLAYLIST",label:i18n("Current play queue")});c.loadAlarms()});lmsCommand(this.playerId,
["sleep","?"]).then(function(a){(a=a.data)&&a.result&&a.result._sleep&&c.controlSleepTimer(parseInt(a.result._sleep))});lmsList("",["libraries"]).then(function(a){if((a=a.data)&&a.result&&a.result.folder_loop&&0<a.result.folder_loop.length){c.libraries=[];for(var b=0,d=a.result.folder_loop.length;b<d;++b)a.result.folder_loop[b].name=a.result.folder_loop[b].name.replace(SIMPLE_LIB_VIEWS,""),c.libraries.push(a.result.folder_loop[b]);c.libraries.sort(nameSort);c.libraries.unshift({name:i18n("All"),id:LMS_DEFAULT_LIBRARY});
c.library=c.libraries[0].id;lmsCommand(c.playerId,["libraries","getid"]).then(function(a){if((a=a.data)&&a.result)for(var b=0,d=c.libraries.length;b<d;++b)if(c.libraries[b].id==a.result.id){c.library=c.orig.library=c.libraries[b].id;break}})}});this.update(!1);this.show=!0;this.showMenu=!1;void 0!=b&&this.$nextTick(function(){var a=document.getElementById(b);a&&a.scrollIntoView(!0)})},initItems:function(){this.crossfadeItems=[{key:0,label:i18n("No fade")},{key:1,label:i18n("Crossfade")},{key:2,label:i18n("Fade in")},
{key:3,label:i18n("Fade out")},{key:4,label:i18n("Fade in and out")}];this.replaygainItems=[{key:0,label:i18n("None")},{key:1,label:i18n("Track gain")},{key:2,label:i18n("Album gain")},{key:3,label:i18n("Smart gain")}];this.alarmShuffeItems=[{key:0,label:i18n("Don't shuffle")},{key:1,label:i18n("Shuffle by song")},{key:2,label:i18n("Shuffle by album")}];DAYS_OF_WEEK=[i18n("Sun"),i18n("Mon"),i18n("Tues"),i18n("Weds"),i18n("Thurs"),i18n("Fri"),i18n("Sat")];this.trans={dstm:i18n("Don't Stop The Music")}},
update:function(a){var b=this;a&&lmsCommand(this.playerId,["playerpref","playername","?"]).then(function(a){(a=a.data)&&a.result&&void 0!=a.result._p2&&b.playerName!=a.result._p2&&(b.playerName=b.orig.playerName=a.result._p2)});lmsCommand(this.playerId,["playerpref","transitionType","?"]).then(function(a){(a=a.data)&&a.result&&void 0!=a.result._p2&&(b.crossfade=b.orig.crossfade=parseInt(a.result._p2))});lmsCommand(this.playerId,["playerpref","transitionSmart","?"]).then(function(a){(a=a.data)&&a.result&&
void 0!=a.result._p2&&(b.smartCrossfade=b.orig.smartCrossfade=1==parseInt(a.result._p2))});lmsCommand(this.playerId,["playerpref","replayGainMode","?"]).then(function(a){(a=a.data)&&a.result&&void 0!=a.result._p2&&(b.replaygain=b.orig.replaygain=parseInt(a.result._p2))})},goHome:function(){this.close();this.$store.commit("closeAllDialogs",!0)},close:function(a){if(a&&this.showHome)this.goHome();else{this.showMenu=this.show=!1;1<this.dstmItems.length&&this.dstm!=this.orig.dstm&&bus.$emit("dstm",this.playerId,
this.dstm);this.orig.library!=this.library&&lmsCommand(this.playerId,["material-skin-client","set-lib","id:"+this.library]);this.orig.crossfade!=this.crossfade&&lmsCommand(this.playerId,["playerpref","transitionType",this.crossfade]);this.orig.smartCrossfade!=this.smartCrossfade&&lmsCommand(this.playerId,["playerpref","transitionSmart",this.smartCrossfade?1:0]);this.orig.replaygain!=this.replaygain&&lmsCommand(this.playerId,["playerpref","replayGainMode",this.replaygain]);this.orig.alarms.fade!=this.alarms.fade&&
lmsCommand(this.playerId,["playerpref","alarmfadeseconds",this.alarms.fade?1:0]);this.orig.alarms.timeout!=this.alarms.timeout&&lmsCommand(this.playerId,["playerpref","alarmTimeoutSeconds",60*this.alarms.timeout]);this.orig.alarms.snooze!=this.alarms.snooze&&lmsCommand(this.playerId,["playerpref","alarmSnoozeSeconds",60*this.alarms.snooze]);this.orig.alarms.volume!=this.alarms.volume&&lmsCommand(this.playerId,["playerpref","alarmDefaultVolume",this.alarms.volume]);this.orig.player.name!=this.playerName&&
lmsCommand(this.playerId,["name",this.playerName]).then(function(a){bus.$emit("refreshServerStatus")});if(this.orig.player.icon.icon!=this.playerIcon.icon||this.orig.player.icon.svg!=this.playerIcon.svg)lmsCommand(this.playerId,["playerpref","plugin.material-skin:icon",JSON.stringify(this.playerIcon)]),this.$store.commit("setIcon",{id:this.playerId,icon:this.playerIcon}),playerIdIconMap[this.playerId]=this.playerIcon,setLocalStorageVal("playerIdIconMap",JSON.stringify(playerIdIconMap));this.playerId=
this.playerIconUpdate=void 0}},loadAlarms:function(){var a=this;lmsList(this.playerId,["alarms"],["filter:all"],0).then(function(b){b=b.data;a.alarms.scheduled=[];b&&b.result&&b.result.alarms_loop&&b.result.alarms_loop.forEach(function(b){b.enabled=1==b.enabled;b.repeat=1==b.repeat;a.alarms.scheduled.push(b)})})},toggleAllAlarms:function(){this.alarms.on=!this.alarms.on;lmsCommand(this.playerId,["playerpref","alarmsEnabled",this.alarms.on?1:0])},toggleAlarm:function(a){var b=this;lmsCommand(this.playerId,
["alarm","update","enabled:"+(a.enabled?0:1),"id:"+a.id]).then(function(a){b.loadAlarms()})},addAlarm:function(){this.alarmDialog={show:!0,id:void 0,time:"00:00",dow:["1","2","3","4","5"],repeat:!1,url:"CURRENT_PLAYLIST",shuffle:this.alarmShuffeItems[0].key}},editAlarm:function(a){this.alarmDialog={show:!0,id:a.id,time:formatTime(a.time,!0),dow:a.dow.split(","),repeat:a.repeat,url:a.url,enabled:a.enabled}},saveAlarm:function(){var a=this,b=this.alarmDialog.time.split(":");b=3600*parseInt(b[0])+60*
parseInt(b[1]);var c=["alarm"];this.alarmDialog.id?(c.push("update"),c.push("id:"+this.alarmDialog.id),c.push("enabled:"+(this.alarmDialog.enabled?1:0))):(c.push("add"),c.push("enabled:1"));c.push("time:"+b);c.push("dow:"+this.alarmDialog.dow.join(","));c.push("url:"+this.alarmDialog.url);c.push("repeat:"+(this.alarmDialog.repeat?1:0));lmsCommand(this.playerId,c).then(function(b){a.loadAlarms()});this.alarmDialog.show=!1},deleteAlarm:function(a){var b=this;confirm(i18n("Delete alarm?"),i18n("Delete")).then(function(c){c&&
lmsCommand(b.playerId,["alarm","delete","id:"+a.id]).then(function(a){b.loadAlarms()})})},i18n:function(a){return this.show?i18n(a):a},setSleep:function(a){bus.$emit("dlg.open","sleep",{id:this.playerId,name:this.playerName})},setIcon:function(){bus.$emit("dlg.open","icon",{id:this.playerId,name:this.playerName,icon:this.playerIcon})},cancelSleepTimer:function(){this.sleepTime=void 0;void 0!==this.sleepTimer&&(clearInterval(this.sleepTimer),this.sleepTimer=void 0)},controlSleepTimer:function(a){void 0!=
a&&1<a?(a=Math.floor(a),this.timeLeft!=a&&(this.cancelSleepTimer(),this.timeLeft=this.sleepTime=a,this.start=new Date,this.sleepTimer=setInterval(function(){var a=((new Date).getTime()-this.start.getTime())/1E3;this.sleepTime=this.timeLeft-a;0>=this.sleepTime&&(this.sleepTime=void 0,this.cancelSleepTimer())}.bind(this),1E3))):this.cancelSleepTimer()},showExtraSettings:function(){bus.$emit("dlg.open","iframe","/material/settings/player/basic.html?player="+this.playerId,i18n("Extra player settings")+
SEPARATOR+this.playerName,void 0,2)},showConfig:function(){bus.$emit("dlg.open","iframe",this.playerLink,i18n("Configuration")+SEPARATOR+this.playerName,void 0,2)},doCustomAction:function(a,b){performCustomAction(this,a,b)}},filters:{formatAlarm:function(a,b){var c=[],d=!1;a.dow.split(",").sort().forEach(function(a){"0"===a?d=!0:c.push(DAYS_OF_WEEK[a])});d&&c.push(DAYS_OF_WEEK[0]);return formatTime(a.time,b)+" "+c.join(", ")+(a.repeat?" ("+i18n("Repeat")+")":"")},displayTime:function(a){return void 0==
a?"":"("+formatSeconds(Math.floor(a))+")"},svgIcon:function(a,b){return"/material/svg/"+a+"?c="+(b?LMS_DARK_SVG:LMS_LIGHT_SVG)+"&r="+LMS_MATERIAL_REVISION}},watch:{show:function(a){this.$store.commit("dialogOpen",{name:"playersettings",shown:a})},"alarmDialog.show":function(a){this.$store.commit("dialogOpen",{name:"alarm",shown:a})},showMenu:function(a){this.$store.commit("menuVisible",{name:"playersettings",shown:a})}}});Vue.component("lms-volume",{template:'<v-sheet v-model="show" v-if="show" elevation="5" class="vol-sheet"><v-container grid-list-md text-xs-center><v-layout row wrap><v-flex xs12><p class="vol-text">{{playerVolume|displayVolume(dvc)}}</p></v-flex><v-flex xs12><v-layout><v-btn flat icon @wheel="volWheel($event)" v-longpress:repeat="volumeDown" class="vol-btn vol-left"><v-icon>{{muted ? \'volume_off\' : \'volume_down\'}}</v-icon></v-btn><v-slider step="1" :disabled="!dvc" v-model="playerVolume" @wheel.native="volWheel($event)" @click.stop="setVolume" class="vol-slider" @start="volumeSliderStart" @end="volumeSliderEnd"></v-slider><v-btn flat icon @wheel="volWheel($event)" v-longpress:repeat="volumeUp" class="vol-btn vol-right"><v-icon>{{muted ? \'volume_off\' : \'volume_up\'}}</v-icon></v-btn></v-layout></v-flex><v-flex xs12 class="padding hide-for-mini"></v-flex></v-layout></v-container><v-card-actions><v-btn flat v-if="dvc" @click.native="toggleMute()">{{muted ? i18n(\'Unmute\') : i18n(\'Mute\')}}</v-btn><v-spacer></v-spacer><v-btn flat @click.native="show = false">{{i18n(\'Close\')}}</v-btn></v-card-actions></v-sheet>    ',
props:[],data:function(){return{show:!1,playerVolume:0,muted:!1,dvc:!0}},mounted:function(){this.closeTimer=void 0;this.lmsVol=0;bus.$on("playerStatus",function(a){if((this.show||this.showing)&&!this.movingVolumeSlider){this.muted=a.muted;var b=this.lmsVol=a.volume;b!=this.playerVolume&&(this.playerVolume=b);this.dvc=VOL_STD==a.dvc;this.showing&&(this.movingVolumeSlider=this.showing=!1,this.show=!0,this.resetCloseTimer())}}.bind(this));bus.$on("volume.open",function(){this.show?this.close():(this.showing=
!0,bus.$emit("refreshStatus"))}.bind(this));bus.$on("noPlayers",function(){this.close()}.bind(this));bus.$on("esc",function(){"volume"==this.$store.state.activeDialog&&this.close()}.bind(this));bus.$on("dialogOpen",function(a,b){b&&"volume"!=a&&this.close()}.bind(this));bus.$on("menuOpen",function(){this.close()}.bind(this));bus.$on("adjustVolume",function(){this.show&&(this.cancelUpdateTimer(),this.updateTimer=setTimeout(function(){bus.$emit("refreshStatus")}.bind(this),100))}.bind(this))},beforeDestroy:function(){this.cancelCloseTimer()},
methods:{close:function(){this.showing=this.show=!1;this.cancelCloseTimer()},volumeDown:function(){bus.$emit("playerCommand",["mixer","volume","-"+lmsOptions.volumeStep]);this.resetCloseTimer()},volumeUp:function(){bus.$emit("playerCommand",["mixer","volume","+"+lmsOptions.volumeStep]);this.resetCloseTimer()},setVolume:function(){this.show&&(70>=this.lmsVol&&90<=this.playerVolume?this.playerVolume=this.lmsVol:(bus.$emit("playerCommand",["mixer","volume",this.playerVolume]),this.resetCloseTimer()))},
toggleMute:function(){this.show&&(bus.$emit("playerCommand",["mixer","muting",this.muted?0:1]),this.resetCloseTimer())},volWheel:function(a){0>a.deltaY?this.volumeUp():0<a.deltaY&&this.volumeDown()},i18n:function(a){return this.show?i18n(a):a},volumeSliderStart:function(){this.movingVolumeSlider=!0;this.cancelCloseTimer()},volumeSliderEnd:function(){var a=this;this.$store.state.player?lmsCommand(this.$store.state.player.id,["mixer","volume",this.playerVolume]).then(function(b){bus.$emit("updatePlayer",
a.$store.state.player.id);a.movingVolumeSlider=!1}).catch(function(b){bus.$emit("updatePlayer",a.$store.state.player.id);a.movingVolumeSlider=!1}):this.movingVolumeSlider=!1;this.resetCloseTimer();this.cancelSendVolumeTimer()},cancelCloseTimer:function(){void 0!==this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=void 0)},resetCloseTimer:function(){this.cancelCloseTimer();this.closeTimer=setTimeout(function(){this.show=!1}.bind(this),LMS_VOLUME_CLOSE_TIMEOUT)},cancelSendVolumeTimer:function(){void 0!==
this.sendVolumeTimer&&(clearTimeout(this.sendVolumeTimer),this.sendVolumeTimer=void 0)},resetSendVolumeTimer:function(){this.cancelSendVolumeTimer();this.sendVolumeTimer=setTimeout(function(){bus.$emit("playerCommand",["mixer","volume",this.playerVolume])}.bind(this),LMS_VOLUME_DEBOUNCE)},cancelUpdateTimer:function(){void 0!==this.updateTimer&&(clearTimeout(this.updateTimer),this.updateTimer=void 0)}},watch:{playerVolume:function(a){this.show&&0<=a&&(this.movingVolumeSlider||this.resetCloseTimer(),
this.resetSendVolumeTimer())},show:function(a){this.$store.commit("dialogOpen",{name:"volume",shown:a});this.resetCloseTimer();this.cancelSendVolumeTimer();this.cancelUpdateTimer()}},filters:{displayVolume:function(a,b){return b?a+"%":""}}});Vue.component("lms-information-dialog",{template:'<v-dialog v-model="show" v-if="show" scrollable fullscreen><v-card><v-card-title class="settings-title"><v-toolbar app class="dialog-toolbar"><v-btn flat icon v-longpress:stop="close" :title="i18n(\'Go back\')"><v-icon>arrow_back</v-icon></v-btn><v-toolbar-title><div>{{i18n(\'Information\')+serverName}}</div></v-toolbar-title>\x3c!--<v-spacer></v-spacer><v-btn flat icon @click.native="openWindow(\'https://cdn.statically.io/gh/d6jg/material-documentation/master/html/Material%20Skin.html\')" :title="i18n(\'User guide\')"><v-icon>help_outline</b-icon></v-btn>--\x3e</v-toolbar></v-card-title><div class="ios-vcard-text-workaround"><div class="infodetails" id="info-page"><div v-show="updateNotif.msg!=undefined"><p class="about-header">{{updateNotif.title}}</p><div v-html="updateNotif.msg" class="clickable"></div><div class="dialog-padding"></div></div><div v-if="server.length>0"><p class="about-header">{{i18n(\'Server\')}}</p><p v-if="updates.server"><b @click="showUpdateInfo" class="link-item">{{i18n(\'New version available\')}}</b></p><ul><template v-for="(info, index) in server"><li>{{info.label}}: {{info.text}}</li></template></ul><v-btn @click="openServerSettings(serverName, 2)" v-if="unlockAll" flat><img class="btn-icon svg-img" :src="TB_SERVER_SETTINGS.svg | svgIcon(darkUi)"></img>{{TB_SERVER_SETTINGS.title}}</v-btn><div class="dialog-padding"></div></div><p class="about-header">{{i18n(\'Library\')}}</p><ul><template v-for="(item, index) in library"><li>{{item}}</li></template><li v-if="scanning"><v-icon class="pulse">update</v-icon> {{scanInfo}}</li><li v-else>{{scanInfo}}</li></ul><v-menu bottom v-if="!scanning && unlockAll"><v-btn slot="activator" flat><v-icon class="btn-icon">refresh</v-icon>{{i18n(\'Rescan\')}} <v-icon>arrow_drop_down</v-icon></v-btn><v-list><template v-for="(item, index) in rescans"><v-list-tile @click="rescan(item)"><v-list-tile-title>{{item.name}}</v-list-tile-title></v-list-tile></template></v-list></v-menu><div class="dialog-padding" id="info-plugins"></div><p class="about-header">{{i18n(\'Plugins\')}}</p><p v-if="\'idle\'==pluginStatus && updates.details.length>0">{{i18n(\'The following plugins have updates available:\')}}</p><p v-if="\'needs_restart\'==pluginStatus && updates.details.length>0">{{i18n(\'The following plugins have been updated:\')}}</p><ul v-if="\'downloading\'!=pluginStatus && updates.details.length>0"><template v-for="(plug, index) in updates.details"><li><object @click="pluginInfo(plug)" class="link-item">{{plug.title}} {{plug.version}}</object></li></template></ul><v-btn v-if="updates.details.length>0 && \'idle\'==pluginStatus && unlockAll" @click="updatePlugins" flat><img class="svg-img btn-icon" :src="\'update\' | svgIcon(darkUi)">{{i18n(\'Update plugins\')}}</v-btn><p v-if="\'downloading\'==pluginStatus"><v-icon class="pulse">cloud_download</v-icon> {{i18n(\'Downloading plugin updates\')}}</p><v-btn v-if="\'needs_restart\'==pluginStatus && unlockAll" @click="restartServer" flat>{{i18n(\'Restart server\')}}</v-btn><p v-if="\'downloading\'!=pluginStatus && updates.details.length>0" style="padding-top:16px">{{i18n(\'The following plugins are up to date:\')}}</p><ul><template v-for="(plug, index) in plugins.details"><li v-if="\'downloading\'==pluginStatus || !updates.names.has(plug.name)"><object class="link-item" @click="pluginInfo(plug)">{{plug.title}} {{plug.version}}</object></li></template></ul><div class="dialog-padding"></div><p class="about-header">{{i18n(\'Players\')}}</p><div v-for="(item, index) in players"><v-icon v-if="item.icon.icon" style="margin-top:-4px">{{item.icon.icon}}</v-icon><img v-else class="svg-img" style="margin-top:-4px" :src="item.icon.svg | svgIcon(darkUi)"></img> {{item.name}}<ul><template v-for="(info, index) in item.info"><li v-if="info!=\'\'">{{info}}</li></template></ul></li><v-btn @click="openPlayerSettings(item)" flat><img class="btn-icon svg-img" :src="TB_PLAYER_SETTINGS.svg | svgIcon(darkUi)"></img>{{TB_PLAYER_SETTINGS.title}}</v-btn></div><div class="dialog-padding"></div><p class="about-header">{{i18n(\'About\')}}</p><p>{{i18n(\'Material Skin is a HTML5 WebApp for LMS. For support, to report bugs, or ask for new features, please visit one of the following links:\')}}<ul><li><a class="lms-link" href="https://cdn.statically.io/gh/d6jg/material-documentation/master/html/Material%20Skin.html" target="_blank">{{i18n(\'User guide\')}}</a></li><li><a class="lms-link" href="https://forums.slimdevices.com/showthread.php?109624-Announce-Material-Skin" target="_blank">{{i18n(\'LMS support forums\')}}</a></li><li><div class="lms-link cursor" @click="openTechInfo">{{i18n(\'LMS technical information\')}}</div></li><li><a class="lms-link" href="https://github.com/CDrummond/lms-material" target="_blank">{{i18n(\'GitHub development page\')}}</a></li></ul></p><p>{{i18n(\'Material Skin is developed purely for fun, and no donations are required. However, if you wish to make a donation, please use the button below:\')}}</p><v-btn @click="openWindow(\'https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=2X2CTDUH27V9L&source=url\')" flat><img class="svg-img btn-icon" :src="\'paypal\' | svgIcon(darkUi)"></img>{{i18n(\'Donate\')}}</v-btn><div class="dialog-padding"></div><v-divider></v-divider><div class="dialog-padding"></div><p>\u00a9 2018-2021 Craig Drummond</p><div class="dialog-padding"></div></div></div></v-card></v-dialog>',
props:[],data:function(){return{show:!1,server:[],library:[],scanInfo:void 0,players:[],plugins:{names:new Set,details:[]},updates:{names:new Set,details:[],server:!1},pluginStatus:"idle",rescans:[],scanning:!1,serverName:""}},mounted:function(){bus.$on("info.open",function(a){var b=this;lmsCommand("",["material-skin","info"]).then(function(a){(a=a.data)&&a.result&&a.result.info&&(a=JSON.parse(a.result.info))&&a.server&&(b.server=a.server)});lmsCommand("",["material-skin","scantypes"]).then(function(a){(a=
a.data)&&a.result&&a.result.item_loop&&(b.rescans=a.result.item_loop)});lmsCommand("",["material-skin","server"]).then(function(a){(a=a.data)&&a.result&&(b.serverName=void 0==a.result.libraryname?"":SEPARATOR+a.result.libraryname)}).catch(function(a){});this.update();this.timer=setInterval(function(){this.update()}.bind(this),2E3);this.show=!0;var c=this.scrollToPlugins();lmsCommand("",["material-skin","plugins"]).then(function(a){a=a.data;b.plugins.names.clear();b.plugins.details=[];if(a&&a.result&&
a.result.plugins_loop){for(var c=0,d=a.result.plugins_loop.length;c<d;++c)b.plugins.names.add(a.result.plugins_loop[c].name);b.plugins.details=a.result.plugins_loop;b.plugins.details.sort(titleSort)}});this.updates.server=this.$store.state.updatesAvailable.has("server");axios.get(location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")+"/updateinfo.json?x=time"+(new Date).getTime()).then(function(a){a=eval(a.data);b.updates.names.clear();b.updates.details=[];b.updates.server=
a&&a.server;if(a&&a.plugins&&0<a.plugins.length){for(var d=0,h=a.plugins.length;d<h;++d)null!=a.plugins[d]&&(b.updates.names.add(a.plugins[d].name),b.updates.details.push(a.plugins[d]));b.updates.details.sort(titleSort);b.$forceUpdate()}a=new Set;b.updates.server&&a.add("server");0<b.updates.names.size&&a.add("plugins");b.$store.commit("setUpdatesAvailable",a);c||b.scrollToPlugins()}).catch(function(a){b.updates.names.clear();logError(a)})}.bind(this));bus.$on("esc",function(){"info"==this.$store.state.activeDialog&&
(this.show=!1)}.bind(this))},methods:{scrollToPlugins:function(){if(void 0!=this.$store.state.updateNotif.msg)return!1;if(this.$store.state.updatesAvailable.has("plugins")&&!this.$store.state.updatesAvailable.has("server")){var a=document.getElementById("info-plugins");if(a)return setTimeout(function(){a.scrollIntoView({block:"start",behavior:"smooth"})},25),!0}return!1},update:function(){var a=this;this.show&&(lmsCommand("",["material-skin","plugins-status"]).then(function(b){if((b=b.data)&&b.result){var c=
"idle";1==parseInt(b.result.downloading)?c="downloading":1==parseInt(b.result.needs_restart)&&(c="needs_restart");c!=a.pluginStatus&&(a.pluginStatus=c)}}),lmsCommand("",["serverstatus",0,LMS_MAX_PLAYERS]).then(function(b){if((b=b.data)&&b.result){for(var c={},d=0,f=a.players.length;d<f;++d){var h=a.players[d];0<h.sigStrength&&(c[h.id]=h.sigStrength)}a.players=[];if(b.result.players_loop)for(d=0,f=b.result.players_loop.length;d<f;++d){h=b.result.players_loop[d];var g="group"===h.model,k=[i18n("Model: %1",
h.modelname),i18n("Type: %1",h.model),i18n("Firmware: %1",h.firmware),i18n("IP: %1",h.ip.split(":")[0]),i18n("MAC Address: %1",h.playerid),""];void 0!=c[h.playerid]&&(k[5]=i18n("Signal Strength: %1%",c[h.playerid]));a.players.push({name:h.name,id:h.playerid,info:k,isgroup:g,icon:mapPlayerIcon(h)});g||lmsCommand(h.playerid,["signalstrength","?"]).then(function(b){if((b=b.data)&&b.result&&0<b.result._signalstrength)for(var c=0,d=a.players.length;c<d;++c){var e=a.players[c];e.id==b.params[0]&&(e.info[5]=
i18n("Signal Strength: %1%",b.result._signalstrength),e.sigStrength=b.result._signalstrength)}})}a.players.sort(playerSort);c=a.scanning;a.scanning=void 0==b.result.lastscan||1==b.result.scanning||1==b.result.scan;d=void 0;a.scanning&&void 0!=b.result.progressname&&(d=void 0!=b.result.progresstotal?parseInt(b.result.progresstotal):void 0,f=void 0!=b.result.progressdone?parseInt(b.result.progressdone):void 0,d=b.result.progressname+(void 0!=f&&void 0!=d?" ("+f+(d>=f?"/"+d:"")+")":""));a.library=[i18n("Total genres: %1",
b.result["info total genres"]),i18n("Total artists: %1",b.result["info total artists"]),i18n("Total albums: %1",b.result["info total albums"]),i18n("Total songs: %1",b.result["info total songs"]),i18n("Total duration: %1",formatSeconds(b.result["info total duration"],!0))];a.scanInfo=void 0!=d?d:a.scanning?i18n("In progress"):i18n("Last scan: %1",formatDate(b.result.lastscan));a.scanning&&!c&&bus.$emit("refreshServerStatus");b.result.lastscanfailed&&a.library.push("Last scan failure: %1",b.result.lastscanfailed)}}))},
close:function(){this.scanning=this.show=!1;this.pluginStatus="idle";this.timer&&(clearInterval(this.timer),this.timer=void 0)},pluginInfo:function(a){bus.$emit("dlg.open","iteminfo",a)},updatePlugins:function(){var a=this;lmsCommand("",["material-skin","plugins-update","plugins:"+JSON.stringify(this.updates.details)]).then(function(b){(b=b.data)&&b.result&&void 0!=b.result.updating&&0<parseInt(b.result.updating)&&(bus.$emit("showMessage",i18n("Updating plugins.")),a.update())})},restartServer:function(){var a=
this;lmsCommand("",["restartserver"]).then(function(b){a.close();bus.$emit("showMessage",i18n("Server is being restarted."));setTimeout(function(){location.reload()},2500)}).catch(function(b){a.close();bus.$emit("showMessage",i18n("Server is being restarted."))})},i18n:function(a){return this.show?i18n(a):a},openPlayerSettings:function(a){bus.$emit("dlg.open","playersettings",a,void 0,2)},openTechInfo:function(){bus.$emit("dlg.open","iframe","/material/html/docs/index.html",i18n("LMS technical information"),
void 0,2)},rescan:function(a){bus.$emit("showMessage",a.name);lmsCommand("",a.cmd)},showUpdateInfo:function(){bus.$emit("dlg.open","iframe","/material/updateinfo.html",i18n("Update information"),void 0,2)}},beforeDestroy:function(){void 0!==this.timer&&(clearInterval(this.timer),this.timer=void 0)},watch:{show:function(a){this.$store.commit("dialogOpen",{name:"info",shown:a})}},computed:{darkUi:function(){return this.$store.state.darkUi},unlockAll:function(){return this.$store.state.unlockAll},updateNotif:function(){return this.$store.state.updateNotif}},
filters:{svgIcon:function(a,b){return"/material/svg/"+a+"?c="+(b?LMS_DARK_SVG:LMS_LIGHT_SVG)+"&r="+LMS_MATERIAL_REVISION}}});Vue.component("lms-randommix",{template:'<v-dialog v-model="show" v-if="show" persistent scrollable width="600"><v-card><v-card-text><v-select :items="mixes" :label="i18n(\'Mix Type\')" v-model="chosenMix" item-text="label" item-value="key"></v-select><div class="dialog-main-list"><v-select chips deletable-chips multiple :items="genres" :label="i18n(\'Selected Genres\')" v-model="chosenGenres"><v-list-tile slot="prepend-item" @click="toggleGenres()"><v-list-tile-action><v-icon>{{selectAllIcon}}</v-icon></v-list-tile-action><v-list-tile-title>{{i18n(\'Select All\')}}</v-list-tile-title></v-list-tile><v-divider slot="prepend-item"></v-divider><template v-slot:selection="{ item, index }"><v-chip v-if="(index < 5) || chosenGenres.length==6" close @input="chosenGenres.splice(index, 1)"><span>{{ item }}</span></v-chip><span v-if="index == 5 && chosenGenres.length>6" class="subtext">{{i18n("(+%1 others)", chosenGenres.length - 5) }}</span></template></v-select><v-select v-if="libraries.length>1 && showAll" :items="libraries" :label="i18n(\'Library\')" v-model="library" item-text="name" item-value="id"></v-select><v-checkbox v-if="showAll" v-model="continuous" :label="i18n(\'Continuous\')" @click.stop="continuous=!continuous"></v-checkbox><v-text-field v-if="showAll" :label="i18n(\'Historic track count\')" v-model="oldTracks" type="number"></v-text-field><v-text-field v-if="showAll" :label="i18n(\'Upcoming track count\')" v-model="newTracks" type="number"></v-text-field></div></v-card-text><v-card-actions><v-btn v-if="isWide" flat @click.native="showAll=!showAll">{{showAll ? i18n(\'Basic options\') : i18n(\'All options\')}}</v-btn><v-btn v-else flat icon @click.native="showAll=!showAll" :title="showAll ? i18n(\'Basic options\') : i18n(\'All options\')"><v-icon>{{showAll ? \'expand_more\' : \'expand_less\'}}</v-icon></v-btn><v-spacer></v-spacer><v-btn flat @click.native="close()">{{i18n(\'Close\')}}</v-btn><v-btn flat @click.native="stop()" v-if="active">{{i18n(\'Stop\')}}</v-btn><v-btn flat @click.native="start()">{{i18n(\'Start\')}}</v-btn></v-card-actions></v-card></v-dialog>',
props:[],data:function(){return{show:!1,showAll:!1,genres:[],chosenGenres:[],mixes:[],chosenMix:"tracks",active:!1,libraries:[],library:void 0,continuous:!0,oldTracks:10,newTracks:10,isWide:!0}},computed:{selectAllIcon:function(){return this.chosenGenres.length==this.genres.length?"check_box":0<this.chosenGenres.length?"indeterminate_check_box":"check_box_outline_blank"}},mounted:function(){bus.$on("rndmix.open",function(){var a=this;this.showAll=getLocalStorageVal("rndmix.showAll",!1);this.playerId=
this.$store.state.player.id;lmsCommand(this.playerId,["randomplayisactive"]).then(function(b){b=b.data;a.mixes=[{key:"tracks",label:i18n("Song Mix")},{key:"albums",label:i18n("Album Mix")},{key:"contributors",label:i18n("Artist Mix")},{key:"year",label:i18n("Year Mix")}];b&&b.result&&b.result._randomplayisactive?(a.chosenMix=b.result._randomplayisactive,a.active=!0):(a.active=!1,a.choseMix="tracks");lmsList(a.playerId,["randomplaylibrarylist"],void 0,0,500).then(function(b){if((b=b.data)&&b.result&&
b.result.item_loop&&0<b.result.item_loop.length){a.libraries=[];a.library=void 0;for(var c=0,f=b.result.item_loop.length;c<f;++c){var h=b.result.item_loop[c].actions.do.cmd[1];2<(""+h).length&&(a.libraries.push({name:b.result.item_loop[c].text.replace(SIMPLE_LIB_VIEWS,""),id:h}),1==parseInt(b.result.item_loop[c].radio)&&(a.library=h))}a.libraries.sort(nameSort);a.libraries.unshift({name:i18n("All"),id:LMS_DEFAULT_LIBRARY});void 0==a.library&&(a.library=LMS_DEFAULT_LIBRARY)}});lmsList(a.playerId,["genres"],
void 0,0,1E3).then(function(b){var c=b.data;a.chosenGenres=[];a.genres=[];if(c&&c.result&&c.result.genres_loop){b=0;c=c.result.genres_loop;for(var f=c.length;b<f;++b)a.genres.push(c[b].genre)}lmsList(a.playerId,["randomplaygenrelist"],void 0,0,500).then(function(b){(b=b.data)&&b.result&&b.result.item_loop&&(b.result.item_loop.forEach(function(b){1==b.checkbox&&a.chosenGenres.push(b.text)}),a.show=!0)})});lmsCommand("",["pref","plugin.randomplay:continuous","?"]).then(function(b){(b=b.data)&&b.result&&
null!=b.result._p2&&(a.continuous=1==parseInt(b.result._p2))});lmsCommand("",["pref","plugin.randomplay:newtracks","?"]).then(function(b){(b=b.data)&&b.result&&null!=b.result._p2&&(a.newTracks=parseInt(b.result._p2))});lmsCommand("",["pref","plugin.randomplay:oldtracks","?"]).then(function(b){(b=b.data)&&b.result&&null!=b.result._p2&&(a.oldTracks=parseInt(b.result._p2))})})}.bind(this));bus.$on("noPlayers",function(){this.show=!1}.bind(this));bus.$on("esc",function(){"rndmix"==this.$store.state.activeDialog&&
(this.show=!1)}.bind(this));this.isWide=450<=window.innerWidth;bus.$on("windowWidthChanged",function(){this.isWide=450<=window.innerWidth}.bind(this))},methods:{close:function(){this.show=!1;setLocalStorageVal("rndmix.showAll",this.showAll)},start:function(){var a=this;this.close();setLocalStorageVal("rndmix.showAll",this.showAll);lmsCommand("",["pref","plugin.randomplay:continuous",this.continuous?1:0]);lmsCommand("",["pref","plugin.randomplay:newtracks",this.newTracks]);lmsCommand("",["pref","plugin.randomplay:oldtracks",
this.oldTracks]);lmsCommand(this.playerId,["randomplaychooselibrary",this.library]).then(function(b){0==a.chosenGenres.length?lmsCommand(a.playerId,["randomplaygenreselectall","0"]).then(function(b){lmsCommand(a.playerId,["randomplay",a.chosenMix])}):a.chosenGenres.length==a.genres.length?lmsCommand(a.playerId,["randomplaygenreselectall","1"]).then(function(b){lmsCommand(a.playerId,["randomplay",a.chosenMix])}):lmsCommand(a.playerId,["randomplaygenreselectall","0"]).then(function(b){a.addGenre()})})},
stop:function(){this.close();lmsCommand(this.playerId,["randomplay","disable"])},addGenre:function(){var a=this;0==this.chosenGenres.length?lmsCommand(this.playerId,["randomplay",this.chosenMix]):lmsCommand(this.playerId,["randomplaychoosegenre",this.chosenGenres.shift(),"1"]).then(function(b){a.addGenre()})},toggleGenres:function(){this.chosenGenres=this.chosenGenres.length==this.genres.length?[]:this.genres.slice()},i18n:function(a,b){return this.show?i18n(a,b):a}},watch:{show:function(a){this.$store.commit("dialogOpen",
{name:"rndmix",shown:a})}}});Vue.component("lms-rating-dialog",{template:'<v-dialog v-model="show" v-if="show" persistent scrollable width="350"><v-card><v-card-title>{{title}}</v-card-title><v-card-text><v-layout text-xs-center row wrap><v-flex xs12 class="np-text"><v-rating large v-if="maxRating>5" v-model="value" half-increments hover clearable></v-rating><v-rating large v-else v-model="value" hover clearable></v-rating></v-flex></v-layout></v-card-text><v-card-actions><v-spacer></v-spacer><v-btn flat @click.native="cancel()">{{i18n(\'Cancel\')}}</v-btn><v-btn flat @click.native="remove()">{{i18n(\'Remove\')}}</v-btn><v-btn flat @click.native="apply()">{{i18n(\'Apply\')}}</v-btn></v-card-actions></v-card></v-dialog>',
props:[],data:function(){return{show:!1,title:"",value:0,item:void 0}},computed:{maxRating:function(){return this.$store.state.maxRating}},mounted:function(){bus.$on("rating.open",function(a,b){this.$store.state.player.id&&(this.ids=a,this.title=1<a.length?i18n("Set rating for %1 tracks",a.length):i18n("Set rating"),this.value=void 0==b?3:b/20,this.toSet=void 0,this.show=!0)}.bind(this));bus.$on("noPlayers",function(){this.show=!1}.bind(this));bus.$on("esc",function(){"rating"==this.$store.state.activeDialog&&
(this.show=!1)}.bind(this))},methods:{cancel:function(){this.show=!1},apply:function(){var a=this;this.toSet||(this.toSet=[],this.ids.forEach(function(b){a.toSet.push(b.split(":")[1])}),this.setRating())},remove:function(){this.value=0;this.apply()},setRating:function(){var a=this;0==this.toSet.length?(this.toSet=void 0,this.show=!1,bus.$emit("ratingsSet",this.ids,this.value)):lmsCommand(this.$store.state.player.id,[this.$store.state.ratingsPlugin,"setrating",this.toSet[0],this.value]).then(function(b){a.show&&
(a.toSet.shift(),a.setRating())})},i18n:function(a){return this.show?i18n(a):a}},watch:{show:function(a){this.$store.commit("dialogOpen",{name:"rating",shown:a})}}});var PMGR_EDIT_GROUP_ACTION={cmd:"edit",icon:"edit"},PMGR_DELETE_GROUP_ACTION={cmd:"delete",icon:"delete"},PMGR_SYNC_ACTION={cmd:"sync",icon:"link"},PMGR_SETTINGS_ACTION={cmd:"settings",svg:"player-settings"},PMGR_POWER_ON_ACTION={cmd:"on",icon:"power_settings_new",dimmed:!0},PMGR_POWER_OFF_ACTION={cmd:"off",icon:"power_settings_new",active:!0},PMGR_SLEEP_ACTION={cmd:"sleep",icon:"hotel"},PMGR_SET_DEF_PLAYER_ACTION={cmd:"sdp",icon:"check_box_outline_blank"},PMGR_UNSET_DEF_PLAYER_ACTION={cmd:"usdp",
icon:"check_box",active:!0},PMGR_GROUP_MEMBER_ID_MOD=1E3,playerMap={};function getSyncMaster(a){if(void 0==a.syncmaster||1>a.syncmaster.length)return{name:a.name.toLowerCase(),isgroup:a.isgroup};a=playerMap[a.syncmaster];return void 0==a?{name:"",isgroup:!1}:{name:a.name.toLowerCase(),isgroup:a.isgroup}}
function playerSyncSort(a,b){var c=getSyncMaster(a),d=getSyncMaster(b);if(c.isgroup!=d.isgroup)return c.isgroup?1:-1;if(c.name<d.name)return-1;if(c.name>d.name)return 1;if(0<c.name.length){if(a.issyncmaster&&!b.issyncmaster)return-1;if(!a.issyncmaster&&b.issyncmaster)return 1}a=a.name.toLowerCase();b=b.name.toLowerCase();return a<b?-1:a>b?1:0}function playerIdSort(a,b){var c=playerMap[a],d=playerMap[b];a=c?c.name.toLowerCase():a;b=d?d.name.toLowerCase():b;return a<b?-1:a>b?1:0}
Vue.component("lms-manage-players",{template:'<v-dialog v-model="show" v-if="show" scrollable fullscreen><v-card><v-card-title class="settings-title"><v-toolbar app-data class="dialog-toolbar" @drop.native="drop(-1, $event)" @dragover.native="dragOver($event)"><v-btn flat v-if="!draggingSyncedPlayer" icon v-longpress:stop="close" :title="i18n(\'Go back\')"><v-icon>arrow_back</v-icon></v-btn><v-toolbar-title class="ellipsis" style="width:100%; text-align:center" v-if="draggingSyncedPlayer">{{i18n(\'Drop here to remove from group\')}}</v-toolbar-title><v-toolbar-title class="ellipsis" v-else>{{TB_MANAGE_PLAYERS.title}}</v-toolbar-title><v-spacer v-if="!draggingSyncedPlayer"></v-spacer><v-menu v-if="!draggingSyncedPlayer" bottom left v-model="showMenu"><v-btn icon slot="activator"><v-icon>more_vert</v-icon></v-btn><v-list><v-list-tile @click="sleepAll"><v-list-tile-avatar v-if="menuIcons"><v-icon>hotel</v-icon></v-list-tile-avatar><v-list-tile-content><v-list-tile-title>{{i18n(\'Set sleep time for all players\')}}</v-list-tile-title></v-list-tile-content></v-list-tile><v-list-tile @click="createGroup" v-if="manageGroups && unlockAll"><v-list-tile-avatar v-if="menuIcons"><v-icon>add_circle_outline</v-icon></v-list-tile-avatar><v-list-tile-content><v-list-tile-title>{{i18n("Create group player")}}</v-list-tile-title></v-list-tile-content></v-list-tile></v-list></v-menu></v-toolbar></v-card-title><div class="ios-vcard-text-workaround"><v-container grid-list-md class="pmgr-container" id="player-manager-list"><v-layout row wrap><div v-for="(player, index) in players" :key="player.id" style="width:100%" v-bind:class="{\'pmgr-sync\':!isMainPlayer(player), \'active-player\':currentPlayer && currentPlayer.id === player.id}"><v-flex xs12 v-if="0==index && !player.isgroup && manageGroups && firstGroupIndex>=0" class="pmgr-title ellipsis">{{i18n(\'Standard Players\')}}</v-flex><v-flex xs12 v-if="player.isgroup && index==firstGroupIndex" class="pmgr-title ellipsis">{{i18n(\'Group Players\')}}</v-flex><v-flex xs12><v-list class="pmgr-playerlist"><v-list-tile @dragstart.native="dragStart(index, $event)" @dragend.native="dragEnd()" @dragover.native="dragOver($event)" @drop.native="drop(index, $event)" :draggable="!player.isgroup" v-bind:class="{\'highlight-drop\':dropId==(\'pmgr-player-\'+index), \'highlight-drag\':dragIndex==index}" :id="\'tile-pmgr-player-\'+index"><v-list-tile-avatar v-if="player.image && isMainPlayer(player)" :tile="true" v-bind:class="{\'dimmed\': !player.ison}"><img :key="player.image" v-lazy="player.image"></img></v-list-tile-avatar><v-list-tile-content v-if="isMainPlayer(player)"><v-list-tile-title class="ellipsis cursor link-item" @click="setActive(player.id)"><obj :id="\'pmgr-player-\'+index"><v-icon v-if="player.icon.icon" class="pmgr-icon">{{player.icon.icon}}</v-icon><img v-else class="pmgr-icon svg-img" :src="player.icon.svg | svgIcon(darkUi)"></img><font v-bind:class="{\'active-player-title\':currentPlayer && currentPlayer.id === player.id}">{{player.name}}</font></obj><v-icon v-if="player.id==defaultPlayer" class="player-status-icon dimmed">check</v-icon><v-icon v-if="player.will_sleep_in" class="player-status-icon dimmed">hotel</v-icon></v-list-tile-title><v-list-tile-sub-title class="ellipsis" v-bind:class="{\'dimmed\': !player.ison}">{{player.track}}</v-list-tile-sub-title></v-list-tile-content><v-list-tile-content v-else><v-list-tile-title class="ellipsis cursor link-item" @click="setActive(player.id)"><obj :id="\'pmgr-player-\'+index"><v-icon v-if="player.icon.icon" class="pmgr-icon">{{player.icon.icon}}</v-icon><img v-else class="pmgr-icon svg-img" :src="player.icon.svg | svgIcon(darkUi)"></img><font v-bind:class="{\'active-player-title\':currentPlayer && currentPlayer.id === player.id}">{{player.name}}</font></obj><v-icon v-if="player.id==defaultPlayer" class="player-status-icon dimmed">check</v-icon><v-icon v-if="player.will_sleep_in" class="player-status-icon dimmed">hotel</v-icon></v-list-tile-title></v-list-tile-content><v-list-tile-action v-if="player.playIcon && showAllButtons && isMainPlayer(player)" class="pmgr-btn pmgr-btn-control" v-bind:class="{\'disabled\':!player.hasTrack}" @click="prevTrack(player)" :title="player.name + \' - \' + trans.prev"><v-btn icon><v-icon>skip_previous</v-icon></v-btn></v-list-tile-action><v-list-tile-action v-if="player.playIcon && isMainPlayer(player)" class="pmgr-btn pmgr-btn-control" v-bind:class="{\'disabled\':!player.hasTrack}" @click="playPause(player)" :title="player.name + \' - \' + (player.isplaying ? trans.pause : trans.play)"><v-btn icon><v-icon>{{player.playIcon}}</v-icon></v-btn></v-list-tile-action><v-list-tile-action v-if="player.playIcon && showAllButtons && stopButton && isMainPlayer(player)" class="pmgr-btn pmgr-btn-control" @click="stop(player)" v-bind:class="{\'disabled\':!player.hasTrack}" :title="player.name + \' - \' + trans.stop"><v-btn icon><v-icon>stop</v-icon></v-btn></v-list-tile-action><v-list-tile-action v-if="player.playIcon && showAllButtons && isMainPlayer(player)" class="pmgr-btn pmgr-btn-control" @click="nextTrack(player)" v-bind:class="{\'disabled\':!player.hasTrack}" :title="player.name + \' - \' + trans.next"><v-btn icon><v-icon>skip_next</v-icon></v-btn></v-list-tile-action></v-list-tile></v-list></v-flex xs12><v-flex xs12><v-layout v-if="VOL_HIDDEN!=player.dvc"><v-btn flat icon @click="adjustVolume(player, false)" @click.middle="toggleMute(player)" class="pmgr-btn pmgr-vol-dec-btn" :title="player.name + \' - \' + trans.decVol" v-bind:class="{\'dimmed\': !player.ison}"><v-icon>{{player.muted ? \'volume_off\' : \'volume_down\'}}</v-icon></v-btn><v-slider :disabled="VOL_FIXED==player.dvc" @change="volumeChanged(player)" step="1" v-model="player.volume" class="pmgr-vol-slider" v-bind:class="{\'dimmed\': !player.ison}"></v-slider><v-btn flat icon @click="adjustVolume(player, true)" @click.middle="toggleMute(player)" class="pmgr-btn" :title="player.name + \' - \' + trans.incVol" v-bind:class="{\'dimmed\': !player.ison}"><v-icon>{{player.muted ? \'volume_off\' : \'volume_up\'}}</v-icon></v-btn><p v-if="VOL_STD==player.dvc" class="pmgr-vol link-item" v-bind:class="{\'pmgr-vol-small\':!showAllButtons, \'dimmed\': !player.ison || player.muted, \'pulse\':player.ison && player.isplaying && 0==player.volume}" @click.middle="toggleMute(player)" v-longpress="toggleMuteLabel" :id="index+\'-pmgr-label\'">{{player.volume}}%</p><p v-else class="pmgr-vol" v-bind:class="{\'pmgr-vol-small\':!showAllButtons}"></p><v-btn icon @click.stop="playerMenu(player, $event)" class="pmgr-btn" :title="player.name + \' - \' + trans.menu"><v-icon>more_vert</v-icon></v-btn></v-layout><v-layout v-else><v-spacer></v-spacer><v-btn icon @click.stop="playerMenu(player, $event)" class="pmgr-btn" :title="player.name + \' - \' + trans.menu"><v-icon>more_vert</v-icon></v-btn></v-layout></v-flex><v-flex xs12 v-if="player.isgroup && player.members && player.members.length>0 && (!player.syncmaster || player.syncmaster.length<1)"><div class="pmgr-member-list ellipsis"><template v-for="(member, idx) in player.members"><obj @dragstart="dragStart(((index+1)*PMGR_GROUP_MEMBER_ID_MOD)+idx, $event)" @dragend="dragEnd()" :draggable="true" :id="\'pmgr-player-\'+(((index+1)*PMGR_GROUP_MEMBER_ID_MOD)+idx)" class="cursor link-item">{{playerMap[member] ? playerMap[member].name : member}}</obj><obj>{{idx==player.members.length-1 ? "" : ", "}}</obj></template></div></v-flex></div><div v-for="(player, index) in otherPlayers" :key="player.id" style="width:100%"><v-flex xs12 v-if="0==index || player.server!=otherPlayers[index-1].server" v-bind:class="{\'pmgr-other-title\':players.length>0,\'pmgr-title\':0==players.length}" class="ellipsis">{{player.server}}</v-flex><v-flex xs12 style="padding:0px;"><v-list style="padding:0px;"><v-list-tile @click="movePlayer(player)"><v-list-tile-content><v-list-tile-title><v-icon v-if="player.icon.icon">{{player.icon.icon}}</v-icon><img v-else class="svg-img" :src="player.icon.svg | svgIcon(darkUi)"></img>{{player.name}}</v-list-tile-title></v-list-tile-content></v-list-tile><v-divider v-if="index==otherPlayers.length-1 || otherPlayers[index+1].server==player.server" class="pmgr-divider"></v-divider></v-list></v-flex></div></v-layout></v-container></div><div class="dialog-padding"></div></v-card><v-menu offset-y v-model="menu.show" :position-x="menu.x" :position-y="menu.y"><v-list><template v-for="(action, index) in menu.actions"><v-divider v-if="DIVIDER===action"></v-divider><v-list-tile v-else-if="PMGR_SYNC_ACTION!=action || multipleStandardPlayers" @click="playerAction(menu.player, action.cmd)"><v-list-tile-avatar v-if="menuIcons"><v-icon v-if="action.icon" v-bind:class="{\'dimmed\': action.dimmed, \'active-btn\': action.active}">{{action.icon}}</v-icon><img v-else-if="action.svg" class="svg-img" :src="action.svg | svgIcon(darkUi)"></img></v-list-tile-avatar><v-list-tile-title>{{action.title}}</v-list-tile-title></v-list-tile></template><v-divider v-if="menu.customActions && menu.customActions.length>0"></v-divider><template v-if="menu.customActions && menu.customActions.length>0" v-for="(action, index) in menu.customActions"><v-list-tile @click="doCustomAction(action, menu.player)"><v-list-tile-avatar v-if="menuIcons"><v-icon v-if="action.icon">{{action.icon}}</v-icon><img v-else-if="action.svg" class="svg-img" :src="action.svg | svgIcon(darkUi)"></img></v-list-tile-avatar><v-list-tile-content><v-list-tile-title>{{action.title}}</v-list-tile-title></v-list-tile-content></v-list-tile></template></v-list></v-menu></v-dialog>',
props:[],data:function(){return{show:!1,showMenu:!1,showAllButtons:!0,players:[],manageGroups:!1,firstGroupIndex:-1,menu:{show:!1,player:void 0,actions:[],x:0,y:0,customActions:void 0},trans:{play:void 0,pause:void 0,stop:void 0,prev:void 0,next:void 0,decVol:void 0,incVol:void 0,menu:void 0,drop:void 0},draggingSyncedPlayer:!1,dropId:void 0,dragIndex:void 0}},mounted:function(){this.noImage=resolveImageUrl(LMS_BLANK_COVER);bus.$on("manage.open",function(a){var b=this;this.players=[];this.show=!0;
this.openDialogs=0;if(this.$store.state.players){a=0;for(var c=this.$store.state.players,d=c.length;a<d;++a)playerMap[c[a].id]={name:c[a].name,isgroup:c[a].isgroup}}this.manageGroups=getLocalStorageBool("manageGroups",!1);lmsCommand("",["can","playergroups","items","?"]).then(function(a){(a=a.data)&&a.result&&void 0!=a.result._can&&1==a.result._can?lmsCommand("",["playergroups","can-manage"]).then(function(a){a=a.data;b.manageGroups=void 0!=a.result&&1==a.result["can-manage"];setLocalStorageVal("manageGroups",
b.manageGroups)}).catch(function(a){b.manageGroups=!1;setLocalStorageVal("manageGroups",b.manageGroups)}):(b.manageGroups=!1,setLocalStorageVal("manageGroups",b.manageGroups))})}.bind(this));bus.$on("syncChanged",function(){this.updateAll()}.bind(this));this.showAllButtons=400<=window.innerWidth;bus.$on("windowWidthChanged",function(){this.showAllButtons=400<=window.innerWidth}.bind(this));bus.$on("langChanged",function(){this.initItems()}.bind(this));this.initItems();bus.$on("esc",function(){this.showMenu?
this.showMenu=!1:this.menu.show?this.menu.show=!1:"manage"==this.$store.state.activeDialog&&this.close()}.bind(this));bus.$on("hideMenu",function(a){"manage-menu"==a&&(this.showMenu=!1)}.bind(this));bus.$on("playerStatus",function(a){this.updatePlayer(a)}.bind(this));bus.$on("otherPlayerStatus",function(a){this.updatePlayer(a)}.bind(this));bus.$on("noPlayers",function(){this.showMenu=this.show=!1}.bind(this));bus.$on("playersRemoved",function(a){if(this.show){for(var b=0,c=a.length;b<c;++b)for(var d=
0,f=this.players.length;d<f;++d)if(this.players[d].id==a[b]){this.players.splice(d,1);break}1>this.players.length&&(this.show=!1)}}.bind(this));bus.$on("playerIconSet",function(a,b){a==this.playerId&&(this.playerIcon=b);for(var c=0,d=this.players.length;c<d;++c)if(this.players[c].id==a){a=this.players[c];a.icon=b;this.$set(this.players,c,a);break}}.bind(this));bus.$on("adjustVolume",function(){this.show&&(this.cancelUpdateTimer(),this.updateTimer=setTimeout(function(){this.updateAll()}.bind(this),
100))}.bind(this))},methods:{initItems:function(){PMGR_EDIT_GROUP_ACTION.title=i18n("Edit");PMGR_DELETE_GROUP_ACTION.title=i18n("Delete");PMGR_SYNC_ACTION.title=i18n("Synchronise");PMGR_SETTINGS_ACTION.title=i18n("Player settings");PMGR_POWER_ON_ACTION.title=i18n("Switch on");PMGR_POWER_OFF_ACTION.title=i18n("Switch off");PMGR_SLEEP_ACTION.title=i18n("Sleep");PMGR_SET_DEF_PLAYER_ACTION.title=PMGR_UNSET_DEF_PLAYER_ACTION.title=i18n("Default player");this.trans={play:i18n("Play"),pause:i18n("Pause"),
stop:i18n("Stop"),prev:i18n("Previous track"),next:i18n("Next track"),decVol:i18n("Decrease volume"),incVol:i18n("Increase volume"),menu:i18n("Menu")}},playerMenu:function(a,b){this.menu.actions=a.isgroup?this.$store.state.unlockAll?[PMGR_SETTINGS_ACTION,a.ison?PMGR_POWER_OFF_ACTION:PMGR_POWER_ON_ACTION,PMGR_SLEEP_ACTION,DIVIDER,PMGR_EDIT_GROUP_ACTION,PMGR_DELETE_GROUP_ACTION]:[PMGR_SETTINGS_ACTION,a.ison?PMGR_POWER_OFF_ACTION:PMGR_POWER_ON_ACTION,PMGR_SLEEP_ACTION]:[PMGR_SYNC_ACTION,PMGR_SETTINGS_ACTION,
a.ison?PMGR_POWER_OFF_ACTION:PMGR_POWER_ON_ACTION,PMGR_SLEEP_ACTION];this.menu.x=b.clientX;this.menu.y=b.clientY;this.menu.player=a;queryParams.hide.has("defplayer")||(this.menu.actions.push(DIVIDER),this.menu.actions.push(a.id==this.$store.state.defaultPlayer?PMGR_UNSET_DEF_PLAYER_ACTION:PMGR_SET_DEF_PLAYER_ACTION));this.menu.customActions=getCustomActions(a.id,this.$store.state.unlockAll);this.menu.show=!0},createGroup:function(){bus.$emit("dlg.open","group","create")},sleepAll:function(){bus.$emit("dlg.open",
"sleep")},playerAction:function(a,b){PMGR_EDIT_GROUP_ACTION.cmd==b?bus.$emit("dlg.open","group","edit",a):PMGR_DELETE_GROUP_ACTION.cmd==b?this.deleteGroup(a):PMGR_SYNC_ACTION.cmd==b?bus.$emit("dlg.open","sync",a):PMGR_SETTINGS_ACTION.cmd==b?bus.$emit("dlg.open","playersettings",a,void 0,!0):PMGR_POWER_ON_ACTION.cmd==b||PMGR_POWER_OFF_ACTION.cmd==b?this.togglePower(a):PMGR_SLEEP_ACTION.cmd==b?bus.$emit("dlg.open","sleep",a):PMGR_SET_DEF_PLAYER_ACTION.cmd==b?this.$store.commit("setDefaultPlayer",a.id):
PMGR_UNSET_DEF_PLAYER_ACTION.cmd==b&&this.$store.commit("setDefaultPlayer",void 0)},close:function(){this.showMenu=this.show=this.menu.show=!1;this.scrollElement=void 0;this.stopScrolling=!0;this.draggingSyncedPlayer=!1;this.dragIndex=void 0;void 0!=this.groupRefreshTimer&&(clearTimeout(this.groupRefreshTimer),this.groupRefreshTimer=void 0)},i18n:function(a){return this.show?i18n(a):a},adjustVolume:function(a,b){var c=this;!this.show||0<this.$store.state.visibleMenus.size||(a.muted?this.toggleMute(a):
lmsCommand(a.id,["mixer","volume",(b?"+":"-")+lmsOptions.volumeStep]).then(function(b){c.refreshAllMembers(a)}))},setVolume:function(a,b){var c=this;this.show&&lmsCommand(a.id,["mixer","volume",b]).then(function(d){a.volume=b;a.muted=0>b;c.refreshAllMembers(a)})},toggleMute:function(a){var b=this;this.show&&lmsCommand(a.id,["mixer","muting",a.muted?0:1]).then(function(c){b.refreshAllMembers(a);setTimeout(function(){this.refreshAllMembers(a)}.bind(b),500)})},toggleMuteLabel:function(a,b){b=parseInt(b.id.split("-")[0]);
0<=b&&b<=this.players.length&&(b=this.players[b],(a||b.muted)&&this.toggleMute(b))},volumeChanged:function(a){this.setVolume(a,a.volume)},togglePower:function(a){var b=this;this.show&&lmsCommand(a.id,["power",a.ison?"0":"1"]).then(function(c){b.refreshPlayer(a)})},playPause:function(a){var b=this;!this.show||0<this.$store.state.visibleMenus.size||!a.hasTrack||lmsCommand(a.id,a.isplaying?["pause","1"]:["play"]).then(function(c){b.refreshPlayer(a,!0)})},stop:function(a){var b=this;!this.show||0<this.$store.state.visibleMenus.size||
!a.hasTrack||lmsCommand(a.id,["stop"]).then(function(c){b.refreshPlayer(a,!0)})},prevTrack:function(a){var b=this;!this.show||0<this.$store.state.visibleMenus.size||!a.hasTrack||lmsCommand(a.id,["button","jump_rew"]).then(function(c){b.refreshPlayer(a)})},nextTrack:function(a){var b=this;!this.show||0<this.$store.state.visibleMenus.size||!a.hasTrack||lmsCommand(a.id,["playlist","index","+1"]).then(function(c){b.refreshPlayer(a)})},setActive:function(a){a!=this.$store.state.player.id&&0>=this.$store.state.visibleMenus.size&&
this.$store.commit("setPlayer",a)},refreshAllMembers:function(a){this.refreshPlayer(a);if(a.syncslaves)for(var b=0,c=a.syncslaves.length;b<c;++b)a.syncslaves[b].id!=a.id&&bus.$emit("refreshStatus",a.syncslaves[b]);a.syncmaster&&a.syncmaster.id!=a.id&&bus.$emit("refreshStatus",a.syncmaster)},refreshPlayer:function(a,b,c){bus.$emit("refreshStatus",a.id);if(a.isgroup&&a.syncslaves&&b){for(var d=0,f=a.syncslaves.length;d<f;++d)bus.$emit("refreshStatus",a.syncslaves[d]);void 0==c&&(c=0);4>c&&(this.groupRefreshTimer=
setTimeout(function(){this.groupRefreshTimer=void 0;this.refreshPlayer(a,b,c+1)}.bind(this),250))}},deleteGroup:function(a){var b=this;confirm(i18n("Delete '%1'?",a.name),i18n("Delete")).then(function(c){c&&lmsCommand("",["playergroups","delete","id:"+a.id]).then(function(a){setTimeout(function(){bus.$emit("refreshServerStatus");setTimeout(function(){bus.$emit("refreshServerStatus")}.bind(this),100)}.bind(b),250)})})},updateAll:function(){if(this.show)for(var a=0,b=this.players.length;a<b;++a)bus.$emit("refreshStatus",
this.players[a].id)},updatePlayer:function(a){if(this.show){playerMap[a.id]={name:a.name,isgroup:a.isgroup,dvc:a.dvc};a.image=void 0;a.current&&(a.current.artwork_url&&(a.image=resolveImageUrl(a.current.artwork_url)),void 0==a.image&&a.current.coverid&&(a.image=resolveImageUrl("/music/"+a.current.coverid+"/cover.jpg")),void 0==a.image&&(a.image=resolveImageUrl("/music/current/cover.jpg?player="+a.id)));void 0==a.image&&(a.image=this.noImage);a.playIcon=a.isplaying?this.$store.state.stopButton?"pause":
"pause_circle_outline":this.$store.state.stopButton?"play_arrow":"play_circle_outline";a.hasTrack=!0;a.current.title?a.track=a.current.artist?a.current.title+SEPARATOR+a.current.artist:a.current.trackartist?a.current.title+SEPARATOR+a.current.trackartist:a.current.title:a.current.artist?a.track=a.current.artist:a.current.trackartist?a.track=a.current.trackartist:(a.track="...",a.hasTrack=!1);a.isgroup&&a.members&&a.members.sort(playerIdSort);for(var b=!1,c=void 0,d=0,f=this.players.length;d<f;++d)if(this.players[d].id==
a.id){b=!0;c=this.players[d].syncslaves;this.$set(this.players,d,a);break}b||this.players.push(a);this.players.sort(playerSyncSort);this.firstGroupIndex=-1;d=0;for(f=this.players.length;d<f;++d)if(this.players[d].isgroup){this.firstGroupIndex=d;break}if(b&&(c&&a.syncslaves&&a.syncslaves.length!=c.length||!c&&a.syncslaves||c&&!a.syncslaves)){b=new Set;if(c)for(d=0,f=c.length;d<f;++d)bus.$emit("refreshStatus",c[d]),b.add(c[d]);if(a.syncslaves)for(d=0,f=a.syncslaves.length;d<f;++d)b.has(a.syncslaves[d])||
bus.$emit("refreshStatus",a.syncslaves[d])}}},isMainPlayer:function(a){return a.isgroup||a.issyncmaster||!a.syncslaves||1>a.syncslaves.length},movePlayer:function(a){confirm(i18n("Move '%1' from '%2' to this server?",a.name,a.server),i18n("Move")).then(function(b){b&&bus.$emit("movePlayer",a)})},dragStart:function(a,b){b.dataTransfer.dropEffect="move";b.dataTransfer.setData("Text","player:"+a);b.dataTransfer.setDragImage(a<PMGR_GROUP_MEMBER_ID_MOD?document.getElementById("pmgr-player-"+a).parentNode.parentNode.parentNode:
document.getElementById("pmgr-player-"+a),0,0);this.dragIndex=a;this.stopScrolling=!1;this.draggingSyncedPlayer=a>PMGR_GROUP_MEMBER_ID_MOD||this.players[a].issyncmaster||void 0!=this.players[a].syncmaster},dragEnd:function(){this.stopScrolling=!0;this.dragIndex=void 0;this.draggingSyncedPlayer=!1;this.dropId=void 0},dragOver:function(a){this.dropId=void 0;if(void 0!=a.target&&this.dragIndex<PMGR_GROUP_MEMBER_ID_MOD){for(var b=a.target,c=void 0,d=0;5>d&void 0!=b&&void 0==c;++d)b.id&&(b.id.startsWith("pmgr-")?
c=b.id:b.id.startsWith("tile-pmgr-")&&(c=b.id.substring(5))),b=b.parentNode;if(void 0!=c&&(b=parseInt(c.split("-").slice(-1)[0]),0<=b&&b<this.players.length)){b=this.players[b];d=this.players[this.dragIndex];var f=b.syncmaster?b.syncmaster:"A",h=d.syncmaster?d.syncmaster:"B";b.id!=d.id&&b.id!=h&&f!=h&&(this.dropId=c)}}this.stopScrolling=!0;110>a.clientY&&(this.stopScrolling=!1,this.scrollList(-5));a.clientY>window.innerHeight-70&&(this.stopScrolling=!1,this.scrollList(5));a.preventDefault()},scrollList:function(a){if(!this.stopScrolling){void 0==
this.scrollElement&&(this.scrollElement=document.getElementById("player-manager-list"));var b=this.scrollElement.scrollTop+a;setScrollTop(this,b);if(0>=b||b>=this.scrollElement.scrollTopMax)this.stopScrolling=!0;this.stopScrolling||setTimeout(function(){this.scrollList(a)}.bind(this),100)}},drop:function(a,b){var c=this;this.stopScrolling=!0;b.preventDefault();if(void 0!=this.dragIndex&&a!=this.dragIndex&&a<PMGR_GROUP_MEMBER_ID_MOD)if(this.dragIndex>=PMGR_GROUP_MEMBER_ID_MOD)-1==a&&(a=Math.floor(this.dragIndex/
PMGR_GROUP_MEMBER_ID_MOD),b=this.dragIndex-a*PMGR_GROUP_MEMBER_ID_MOD,a--,0<=a&&0<=b&&a<=this.players.length&&this.players[a].isgroup&&this.players[a].members&&b<this.players[a].members.length&&this.updateGroup(this.players[a],this.players[a].members[b],!1));else{var d=this.players[this.dragIndex].id,f=this.players[this.dragIndex].syncmaster;if(-1==a){var h=void 0;a=0;for(b=this.players.length;a<b;++a)if(this.players[a].id==f){h=this.players[a];break}lmsCommand(d,["sync","-"]).then(function(a){bus.$emit("refreshStatus",
d);bus.$emit("refreshStatus",f);c.updateGroup(h,d,!1)})}else if(a=this.players[a],a.isgroup)this.updateGroup(a,d,!0);else{var g=a.syncmaster?a.syncmaster:a.id;g!=f&&lmsCommand(g,["sync",this.players[this.dragIndex].id]).then(function(a){bus.$emit("refreshStatus",d);void 0!=f&&bus.$emit("refreshStatus",f);bus.$emit("refreshStatus",g)})}}this.dragIndex=void 0},doCustomAction:function(a,b){performCustomAction(this,a,b)},updateGroup:function(a,b,c){if(void 0!=a&&a.isgroup){var d=a.members?a.members.indexOf(b):
-1;c&&a.members&&0<=d||lmsCommand("",["playergroups","update","id:"+a.id,"members:"+(c?"+":"-")+b]).then(function(f){lmsCommand(a.id,["material-skin-group","set-modes"]);bus.$emit("refreshServerStatus",1E3);void 0==a.members&&(a.members=[]);c?(a.members.push(b),a.members.sort(playerIdSort)):a.members.splice(d,1)})}},cancelUpdateTimer:function(){void 0!==this.updateTimer&&(clearTimeout(this.updateTimer),this.updateTimer=void 0)}},computed:{currentPlayer:function(){return this.$store.state.player},
defaultPlayer:function(){return this.$store.state.defaultPlayer},otherPlayers:function(){return this.$store.state.otherPlayers},stopButton:function(){return this.$store.state.stopButton},multipleStandardPlayers:function(){return this.$store.state.players?1<this.$store.state.players.length&&!this.$store.state.players[0].isgroup&&!this.$store.state.players[1].isgroup:!1},menuIcons:function(){return this.$store.state.menuIcons},darkUi:function(){return this.$store.state.darkUi},unlockAll:function(){return this.$store.state.unlockAll}},
filters:{svgIcon:function(a,b,c){return"/material/svg/"+a+"?c="+(c?getComputedStyle(document.documentElement).getPropertyValue("--active-color").replace("#",""):b?LMS_DARK_SVG:LMS_LIGHT_SVG)+"&r="+LMS_MATERIAL_REVISION}},watch:{show:function(a){this.$store.commit("dialogOpen",{name:"manage",shown:a});bus.$emit("subscribeAll",a);this.cancelUpdateTimer()},"menu.show":function(a){this.$store.commit("menuVisible",{name:"manage",shown:a})},showMenu:function(a){this.$store.commit("menuVisible",{name:"manage-menu",
shown:a})}}});Vue.component("lms-favorite",{template:'<v-dialog v-model="show" v-if="show" persistent width="600"><v-card><v-card-title>{{isAdd ? i18n("Add favorite") : i18n("Edit favorite")}}</v-card-title><v-form ref="form" v-model="valid" lazy-validation><v-list two-line><v-list-tile><v-list-tile-content><v-text-field clearable :label="i18n(\'Name\')" v-model="name" class="lms-search" ref="entry"></v-text-field></v-list-tile-content></v-list-tile><v-list-tile><v-list-tile-content><v-text-field clearable :label="i18n(\'URL\')" v-model="url" class="lms-search"></v-text-field></v-list-tile-content></v-list-tile></v-list></v-form><v-card-actions><v-spacer></v-spacer><v-btn flat @click.native="cancel()">{{i18n(\'Cancel\')}}</v-btn><v-btn flat @click.native="update()" v-if="!isAdd">{{i18n(\'Update\')}}</v-btn><v-btn flat @click.native="add()" v-if="isAdd">{{i18n(\'Add\')}}</v-btn></v-card-actions></v-card></v-dialog>',
props:[],data:function(){return{valid:!1,show:!1,name:"",url:"",item:void 0,isAdd:!0,pos:1,positions:[1,2,3,4,5,6,7,8,9,10]}},mounted:function(){bus.$on("favorite.open",function(a,b){this.item=b;"edit"==a?(this.playerId=this.$store.state.player?this.$store.state.player.id:"",this.name=b.title,this.url=b.presetParams?b.presetParams.favorites_url:void 0,this.isAdd=!1,this.show=!0,focusEntry(this)):"add"==a&&(this.playerId=this.$store.state.player?this.$store.state.player.id:"",this.url=this.name="",
this.show=this.isAdd=!0,focusEntry(this))}.bind(this));bus.$on("noPlayers",function(){this.show=!1}.bind(this));bus.$on("esc",function(){"favorite"==this.$store.state.activeDialog&&(this.show=!1)}.bind(this))},methods:{cancel:function(){this.show=!1},update:function(){var a=this,b=this.url?this.url.trim():"",c=this.name?this.name.trim():"";if(!(1>b.length||1>c.length)){if(b==(this.item.presetParams?this.item.presetParams.favorites_url:void 0)){if(c==this.item.title)return;lmsCommand(this.playerId,
["favorites","rename",this.item.id,"title:"+c]).then(function(a){bus.$emit("refreshFavorites");bus.$emit("refreshList",SECTION_FAVORITES)})}else lmsCommand(this.playerId,["favorites","delete",this.item.id]).then(function(d){d=["favorites","add","url:"+b,"title:"+c,a.item.id];a.item.presetParams&&(a.item.presetParams.icon&&d.push("icon:"+a.item.presetParams.icon),a.item.presetParams.favorites_type&&d.push("type:"+a.item.presetParams.favorites_type),(a.item.presetParams.favorites_url&&(a.item.presetParams.favorites_url.startsWith("db:contributor")||
a.item.presetParams.favorites_url.startsWith("db:genre")||a.item.presetParams.favorites_url.startsWith("db:album")||a.item.presetParams.favorites_url.startsWith("db:year"))||a.item["icon-id"]&&"html/images/playlists.png"==a.item["icon-id"])&&d.push("hasitems:1"));lmsCommand(a.playerId,d).then(function(a){bus.$emit("refreshFavorites")})});this.show=!1}},add:function(){var a=this,b=this.url?this.url.trim():"",c=this.name?this.name.trim():"";1>b.length||1>c.length||(lmsCommand(this.playerId,["favorites",
"exists",b]).then(function(d){(d=d.data)&&d.result&&1==d.result.exists?bus.$emit("showMessage",i18n("Already in favorites")):lmsCommand(a.playerId,["favorites","add","url:"+b,"title:"+c,a.item.id]).then(function(a){bus.$emit("refreshFavorites")})}),this.show=!1)},i18n:function(a){return this.show?i18n(a):a}},watch:{show:function(a){this.$store.commit("dialogOpen",{name:"favorite",shown:a})}}});Vue.component("lms-sleep-dialog",{template:'<v-dialog v-model="show" v-if="show" persistent width="450" class="lms-dialog"><v-card><v-card-text><v-container grid-list-md style="padding: 4px"><v-layout wrap><v-flex xs12 v-if="undefined==player">{{i18n("Set sleep time for all players")}}</v-flex><v-flex xs12 v-else>{{i18n("Set sleep time for \'%1\'", player.name)}}</v-flex><v-flex xs12><v-list class="sleep-list dialog-main-list"><template v-for="(item, index) in items"><v-list-tile @click="setSleep(item.duration)"><v-list-tile-title>{{item.label}}</v-list-tile-title></v-list-tile><v-divider></v-divider></template></v-list></v-flex></v-layout></v-container></v-card-text><v-card-actions><p v-if="undefined!=sleepTime" style="margin-left:10px" class="dimmed">{{i18n("%1 until sleep", formatSeconds(sleepTime))}}</p><v-spacer></v-spacer><v-btn flat @click.native="cancel()">{{i18n(\'Cancel\')}}</v-btn></v-card-actions></v-card></v-dialog>',
props:[],data:function(){return{show:!1,player:void 0,items:[],sleepTime:void 0}},mounted:function(){bus.$on("sleep.open",function(a){var b=this;this.player=a;this.sleepTime=void 0;this.show=!0;void 0!=this.player&&lmsCommand(this.player.id,["sleep","?"]).then(function(a){(a=a.data)&&a.result&&a.result._sleep&&(b.sleepTime=parseInt(a.result._sleep),b.timeLeft=b.sleepTime,b.start=new Date,b.timer=setInterval(function(){var a=((new Date).getTime()-this.start.getTime())/1E3;this.sleepTime=this.timeLeft-
a;0>=this.sleepTime&&(this.sleepTime=void 0,this.cancelTimer())}.bind(b),1E3))})}.bind(this));bus.$on("langChanged",function(){this.initItems()}.bind(this));this.initItems();bus.$on("noPlayers",function(){this.cancel()}.bind(this));bus.$on("esc",function(){"sleep"==this.$store.state.activeDialog&&this.cancel()}.bind(this))},methods:{initItems:function(){this.items=[{duration:0,label:i18n("Do not sleep")},{duration:900,label:i18n("%1 minutes",15)},{duration:1800,label:i18n("%1 minutes",30)},{duration:2700,
label:i18n("%1 minutes",45)},{duration:3600,label:i18n("%1 minutes",60)},{duration:5400,label:i18n("%1 minutes",90)},{duration:-1,label:i18n("Remaining duration of current track")}]},cancel:function(){this.show=!1;this.cancelTimer()},setSleep:function(a){var b=this;void 0==this.player?this.$store.state.players.forEach(function(b){b.isgroup||lmsCommand(b.id,-1==a?["jiveendoftracksleep"]:["sleep",a]).then(function(a){bus.$emit("updatePlayer",b.id)})}):lmsCommand(this.player.id,-1==a?["jiveendoftracksleep"]:
["sleep",a]).then(function(a){bus.$emit("updatePlayer",b.player.id)});this.show=!1;this.cancelTimer()},i18n:function(a,b){return this.show?i18n(a,b):a},cancelTimer:function(){void 0!==this.timer&&(clearInterval(this.timer),this.timer=void 0)}},beforeDestroy:function(){this.cancelTimer()},watch:{show:function(a){this.$store.commit("dialogOpen",{name:"sleep",shown:a})}}});Vue.component("lms-movequeue-dialog",{template:'<v-dialog v-model="show" v-if="show" persistent width="450" class="lms-dialog"><v-card><v-card-text style="margin-top:-16px"><v-container grid-list-md style="padding: 4px"><v-layout wrap><v-flex xs12><v-list class="sleep-list dialog-main-list"><v-list-tile><v-select :items="options" v-model="option" item-text="label" item-value="key"></v-select></v-list-tile><template v-for="(p, index) in players" v-if="p.id!=src"><v-list-tile @click="moveTo(p)"><v-list-tile-avatar :tile="true" class="lms-avatar"><v-icon v-if="p.icon.icon">{{p.icon.icon}}</v-icon><img v-else class="svg-img" :src="p.icon.svg | svgIcon(darkUi)"></img></v-list-tile-avatar><v-list-tile-title class="sleep-item">{{p.name}}</v-list-tile-title></v-list-tile><v-divider></v-divider></template></v-list></v-flex></v-layout></v-container></v-card-text><v-card-actions><v-spacer></v-spacer><v-btn flat @click.native="cancel()">{{i18n(\'Cancel\')}}</v-btn></v-card-actions></v-card></v-dialog>',
props:[],data:function(){return{show:!1,src:void 0,option:1,options:[]}},computed:{players:function(){return this.$store.state.players},darkUi:function(){return this.$store.state.darkUi}},mounted:function(){bus.$on("movequeue.open",function(a){this.src=a.id;this.option=parseInt(getLocalStorageVal("movequeue",1));this.initItems();this.show=!0}.bind(this));bus.$on("esc",function(){"movequeue"==this.$store.state.activeDialog&&(this.show=!1)}.bind(this))},methods:{cancel:function(){this.show=!1},moveTo:function(a){var b=
this;lmsCommand("",["material-skin","transferqueue","from:"+this.src,"to:"+a.id,"mode:"+(0==this.option?"copy":1==this.option?"move":"swap")]).then(function(c){b.$store.commit("setPlayer",a.id);0==b.option&&bus.$emit("showMessage",i18n("Queue copied to '%1'",a.name))});setLocalStorageVal("movequeue",this.option);this.show=!1},i18n:function(a){return this.show?i18n(a):a},initItems:function(){this.options=[{key:0,label:i18n("Copy the queue to:")},{key:1,label:i18n("Move the queue to:")},{key:2,label:i18n("Swap the queue with:")}]}},
filters:{svgIcon:function(a,b){return"/material/svg/"+a+"?c="+(b?LMS_DARK_SVG:LMS_LIGHT_SVG)+"&r="+LMS_MATERIAL_REVISION}},watch:{show:function(a){this.$store.commit("dialogOpen",{name:"movequeue",shown:a})}}});Vue.component("lms-info-dialog",{template:'<v-dialog v-model="show" v-if="show" persistent scrollable width="600"><v-card><v-card-text><template v-for="(item, index) in details"><v-header v-if="item.title" class="item-info-header">{{item.title}}</v-header><p v-if="item.link" class="item-info-text"><a class="lms-link" :href="item.text" target="_blank">{{item.text}}</a></p><p v-else class="item-info-text">{{item.text}}</p></template></v-card-text><v-card-actions><v-spacer></v-spacer><v-btn flat @click.native="close()">{{i18n(\'Close\')}}</v-btn></v-card-actions></v-card></v-dialog>',
props:[],data:function(){return{show:!1,title:void 0,details:[]}},mounted:function(){bus.$on("iteminfo.open",function(a){this.details=[];a.title&&this.details.push({title:i18n("Title"),text:a.title});a.descr&&this.details.push({title:i18n("Description"),text:a.descr});a.changes&&this.details.push({title:i18n("Changes"),text:a.changes});a.version&&this.details.push({title:i18n("Version"),text:a.version});a.creator&&this.details.push({title:i18n("Creator"),text:a.creator});a.email&&this.details.push({title:i18n("E-Mail"),
text:a.email});if(a.url)this.details.push({title:i18n("URL"),text:a.url});else if(void 0!=a.id&&a.id.startsWith("http"))this.details.push({title:i18n("URL"),text:a.id,link:!0});else if(a.homepage)this.details.push({title:i18n("Homepage"),text:a.homepage,link:!0});else if(a.list)for(var b=0,c=a.list.length;b<c;++b)this.details.push({text:a.list[b]});this.show=!0}.bind(this));bus.$on("esc",function(){"iteminfo"==this.$store.state.activeDialog&&(this.show=!1)}.bind(this))},methods:{close:function(){this.details=
[];this.show=!1},i18n:function(a){return this.show?i18n(a):a}},watch:{show:function(a){this.$store.commit("dialogOpen",{name:"iteminfo",shown:a})}}});function remapClassicSkinIcons(a,b){var c="play add edit favorite favorite_remove delete delete_white first last up down mix mmix next prev queue".split(" ");if(a=a.getElementsByTagName("img"))for(var d=0,f=a.length;d<f;d++){for(var h=!1,g=0,k=c.length;g<k&&!h;++g)a[d].src.endsWith("/html/images/b_"+c[g]+".gif")&&(a[d].src="/material/svg/cs-"+c[g]+"?c="+b,IS_MOBILE&&a[d].classList.add("msk-cs-touch-img"),h=!0);h&&(a[d].width="24",a[d].height="24")}}
function fixClassicSkinRefs(a){if(a=a.getElementsByTagName("a"))for(var b=0,c=a.length;b<c;b++)"browser"==a[b].target&&a[b].href&&a[b].href.startsWith(window.location)&&a[b].removeAttribute("target")}var iframeMenuOpen=!1;function iframeClickHandler(a){iframeMenuOpen&&bus.$emit("hideMenu","iframe")}
function otherClickHandler(a){var b=a.target||a.srcElement,c=void 0;if("A"===b.tagName)c=b.getAttribute("href");else if("SPAN"===b.tagName||"IMG"===b.tagName)c=b.parentElement.getAttribute("href");c&&!c.startsWith("#")&&bus.$emit("iframe-href",c);iframeClickHandler(a)}function clickDirSelect(a){var b=a.srcElement.id.split(".")[1];bus.$emit("dlg.open","file",a.srcElement.ownerDocument.getElementById(b),!0)}
function clickFileSelect(a){var b=a.srcElement.id.split(".")[1];a=a.srcElement.ownerDocument.getElementById(b);b=[];for(var c=0,d=a.classList,f=d.length;c<f;++c)d[c].startsWith("selectFile_")&&b.push(d[c].substring(11));bus.$emit("dlg.open","file",a,!1,b)}
function addFsSelectButton(a,b,c){b&&void 0==a.getElementById("mskdirbtn."+b.id)&&(a=a.createElement("div"),a.id="mskdirbtn."+b.id,a.classList.add("msk-dir-btn"),a.addEventListener("click",c?clickDirSelect:clickFileSelect),b.parentNode.insertBefore(a,b.nextSibling))}function addFsSelectButtons(a){for(var b=["selectFolder","selectFile"],c=0;c<b.length;++c){var d=a.getElementsByClassName(b[c]);if(void 0!=d)for(var f=0,h=d.length;f<h;++f)addFsSelectButton(a,d[f],0==c)}}
function getElementsByClassName(a,b,c){a="*"==b&&a.all?a.all:a.getElementsByTagName(b);b=[];c=new RegExp("(^|\\s)"+c.replace(/\-/g,"\\-")+"(\\s|$)");for(var d=0,f=a.length;d<f;d++)c.test(a[d].className)&&b.push(a[d]);return b}
function addSliders(a){var b=getElementsByClassName(a,"input","sliderInput_.+"),c=!1;if(null!=b)for(var d=0,f=b.length;d<f;d++){var h=b[d].className.split(" ");if(!h.includes("msk-modified"))for(var g=0,k=h.length;g<k;++g)if(h[g].startsWith("sliderInput_")){g=h[g].substring(12).split("_");1<g.length&&(c=parseInt(g[0]),h=parseInt(g[1]),g=2<g.length?parseInt(g[2]):1,k=a.createElement("input"),k.type="range",k.min=c,k.max=h,k.step=g,k.value=b[d].value,k.classList.add("msk-slider"),k.id="mskslider."+
b[d].id,b[d].parentNode.insertBefore(k,b[d]),9999>=h&&b[d].classList.add("msk-slider-input"),k.oninput=function(){var b=this.id.substring(10);a.getElementById(b).value=this.value},b[d].classList.add("msk-modified"),b[d].min=c,b[d].max=h,b[d].onchange=function(){var b=parseInt(this.value),c=parseInt(this.min),d=parseInt(this.max);b>d?this.value=d:b<c&&(this.value=c);a.getElementById("mskslider."+this.id).value=this.value});c=!0;break}}return c}
function hideSection(a){for(a=a.parentElement;void 0!=a;){if(a.className.split(" ").includes("settingSection"))return a.parentNode.removeChild(a),!0;a=a.parentElement}return!1}function hideSections(a){if(1>LMS_SETTINGS_HIDE.length)return!0;for(var b=LMS_SETTINGS_HIDE.split(","),c=!1,d=0,f=b.length;d<f;++d){var h=a.getElementById(b[d].trim());void 0!=h&&hideSection(h)&&(c=!0)}return c}var iframeInfo={content:void 0,action:void 0,actionCheckInterval:void 0,actionChecks:0};
function iframeActionCheck(){iframeInfo.actionChecks++;var a=document.getElementById("embeddedIframe");if(a&&(a=a.contentDocument)){var b=a.getElementById("settingsForm");if(b)if(b.action!=iframeInfo.action)iframeInfo.action=b.action,addFsSelectButtons(a),iframeInfo.addedSliders=addSliders(a),iframeInfo.sectionsHidden=hideSections(a);else if(50>iframeInfo.actionChecks){iframeInfo.addedSliders||(iframeInfo.addedSliders=addSliders(a));iframeInfo.sectionsHidden||(iframeInfo.sectionsHidden=hideSections(a));
return}}clearInterval(iframeInfo.actionCheckInterval);iframeInfo.actionCheckInterval=void 0;iframeInfo.actionChecks=0}function selectChanged(){void 0!=iframeInfo.actionCheckInterval&&clearInterval(iframeInfo.actionCheckInterval);iframeInfo.addedSliders=!1;iframeInfo.sectionsHidden=!1;iframeInfo.actionChecks=0;iframeInfo.actionCheckInterval=setInterval(function(){iframeActionCheck()},100);iframeActionCheck()}
function hideClassicSkinElems(a,b){if(a){var c=document.getElementById("embeddedIframe");if(c){c.contentDocument.bus=bus;c=c.contentDocument;iframeInfo.content=c;if(void 0==c)return;fixClassicSkinRefs(c);remapClassicSkinIcons(c,b);b=void 0;if("player"==a)b=new Set(["ALARM","PLUGIN_DSTM"]);else if("server"==a){var d=c.getElementById("choose_setting");void 0!=d&&(d.addEventListener("change",selectChanged),selectChanged())}c&&(c.addEventListener?c.addEventListener("click","other"==a||"lms"==a?otherClickHandler:
iframeClickHandler):c.attachEvent&&c.attachEvent("onclick","other"==a||"lms"==a?otherClickHandler:iframeClickHandler));if(void 0!=b&&(d=c.getElementById("choose_setting"),void 0!=d))for(var f=d.length-1;0<=f;f--)b.has(d.options[f].value)&&d.remove(f);if("player"==a||"server"==a)if(c.documentElement.style.setProperty("--vh",.01*window.innerHeight+"px"),a=c.getElementById("statusarea"),void 0!=a){b=c.getElementById("rescanWarning");d=c.getElementById("restartWarning");f=void 0!=b?b:void 0!=d?d:void 0!=
c.querySelector('[name="checkForUpdateNow"]')?a:void 0;if(void 0!=f&&(c=f.innerHTML.split("<a"),1<c.length)){var h=void 0!=f.firstElementChild?f.firstElementChild.href:void 0;if(void 0!=h){c=c[0];var g=void 0;if(void 0==c||2>c.trim().length)c=void 0!=f.firstElementChild?f.firstElementChild.innerHTML:void 0;if(void 0!=c&&(f=c.lastIndexOf(". "),10<f&&(c=c.substring(0,f+1)),g=void 0!=b?i18n("Rescan"):void 0!=d?i18n("Restart"):i18n("Download"),void 0!=g)){confirm(c,g).then(function(a){a&&(h.startsWith("https://")||
h.startsWith("http://")&&!h.startsWith("http://"+window.location.hostname+":"+window.location.port+"/")?openWindow(h):bus.$emit("iframe-href",h,!1))});return}}}c=a.innerText;void 0!=c&&(c=c.trim(),a=iframeInfo.content.getElementById("popupWarning"),b=void 0,void 0!=a&&(b=a.innerHTML.replace(/<br\/?>/ig," \n").trim()),0<c.length&&b!=c&&bus.$emit("showMessage",c))}}bus.$emit("iframe-loaded")}}
Vue.component("lms-iframe-dialog",{template:'<div><v-dialog v-model="show" v-if="show" scrollable fullscreen><v-card><v-card-title class="settings-title"><v-toolbar app-data class="dialog-toolbar"><v-btn flat icon v-longpress:stop="goBack" :title="i18n(\'Go back\')"><v-icon>arrow_back</v-icon></v-btn><v-btn v-if="showHome && homeButton" flat icon @click="goHome" :title="i18n(\'Go home\')"><v-icon>home</v-icon></v-btn><v-toolbar-title>{{title}}</v-toolbar-title><v-spacer></v-spacer><v-menu bottom left v-model="showMenu" v-if="actions.length>0 || (customActions && customActions.length>0)"><v-btn icon slot="activator"><v-icon>more_vert</v-icon></v-btn><v-list><template v-for="(item, index) in actions"><v-list-tile @click="doAction(item)"><v-list-tile-avatar v-if="menuIcons"><v-icon v-if="item.icon">{{item.icon}}</v-icon></v-list-tile-avatar><v-list-tile-content><v-list-tile-title>{{item.title}}</v-list-tile-title></v-list-tile-content></v-list-tile></template><v-divider v-if="actions.length>0 && (customActions && customActions.length>0)"></v-divider><template v-if="customActions && customActions.length>0" v-for="(action, index) in customActions"><v-list-tile @click="doCustomAction(action, player)"><v-list-tile-avatar v-if="menuIcons"><v-icon v-if="action.icon">{{action.icon}}</v-icon><img v-else-if="action.svg" class="svg-img" :src="action.svg | svgIcon(darkUi)"></img></v-list-tile-avatar><v-list-tile-content><v-list-tile-title>{{action.title}}</v-list-tile-title></v-list-tile-content></v-list-tile></template></v-list></v-menu></v-toolbar></v-card-title><v-card-text class="embedded-page"><div v-if="!loaded" style="width:100%;padding-top:64px;display:flex;justify-content:center;font-size:18px">{{i18n(\'Loading...\')}}</div><iframe id="embeddedIframe" v-on:load="hideClassicSkinElems(page, textCol)" :src="src" frameborder="0" v-bind:class="{\'iframe-text\':\'other\'==page}"></iframe></v-card-text></v-card></v-dialog><v-snackbar v-model="snackbar.show" :multi-line="true" :timeout="2500" top>{{ snackbar.msg }}</v-snackbar></div>',data:function(){return{show:!1,
showMenu:!1,title:void 0,src:void 0,page:void 0,snackbar:{show:!1,msg:void 0},loaded:!1,actions:[],customActions:[],history:[],showHome:0,textCol:void 0}},mounted:function(){bus.$on("iframe.open",function(a,b,c,d){this.title=b;this.src=a;this.page=0<a.indexOf("player/basic.html")?"player":0<a.indexOf("server/basic.html")?"server":"/material/html/docs/index.html"==a||a.startsWith("plugins/")&&(0<a.indexOf("?player=")||0<a.indexOf("&player="))?"lms":"other";this.show=!0;this.loaded=this.showMenu=!1;
this.actions=void 0==c?[]:c;this.customActions=getCustomActions(this.page+"-dialog",this.$store.state.unlockAll);this.history=[];this.showHome=d;this.textCol=getComputedStyle(document.documentElement).getPropertyValue("--text-color").substring(1)}.bind(this));bus.$on("iframe-loaded",function(){this.loaded=!0}.bind(this));bus.$on("iframe-href",function(a,b){a.startsWith("javascript:")||((void 0==b||b)&&this.history.push(this.src),this.src=a)}.bind(this));bus.$on("noPlayers",function(){this.close()}.bind(this));
bus.$on("esc",function(){this.showMenu?this.showMenu=!1:"iframe"==this.$store.state.activeDialog&&this.close()}.bind(this));bus.$on("hideMenu",function(a){"iframe"==a&&(this.showMenu=!1)}.bind(this));bus.$on("windowHeightChanged",function(){this.show&&void 0!=iframeInfo.content&&iframeInfo.content.documentElement.style.setProperty("--vh",.01*window.innerHeight+"px")}.bind(this))},methods:{goBack:function(a){this.show&&(a&&this.showHome?this.goHome():1>this.history.length?this.close():(this.loaded=
!1,this.src=this.history.pop()))},goHome:function(){this.close();2==this.showHome?this.$store.commit("closeAllDialogs",!0):bus.$emit("browse-home")},close:function(){this.show=0;this.showMenu=!1;this.history=[];iframeInfo.content=void 0;bus.$emit("iframeClosed",this.isPlayer)},i18n:function(a,b){return this.show&&this.transparent?i18n(a,b):a},doAction:function(a){var b=this;confirm(a.text,a.confirm).then(function(c){c&&(lmsCommand("server"==b.page?"":b.$store.state.player.id,a.cmd),b.close())})},
doCustomAction:function(a,b){performCustomAction(this,a,b)}},computed:{menuIcons:function(){return this.$store.state.menuIcons},player:function(){return this.$store.state.player},darkUi:function(){return this.$store.state.darkUi},homeButton:function(){return this.$store.state.homeButton}},filters:{svgIcon:function(a,b){return"/material/svg/"+a+"?c="+(b?LMS_DARK_SVG:LMS_LIGHT_SVG)+"&r="+LMS_MATERIAL_REVISION}},watch:{show:function(a){this.$store.commit("dialogOpen",{name:"iframe",shown:a})},showMenu:function(a){iframeMenuOpen=
a;this.$store.commit("menuVisible",{name:"iframe",shown:a})}}});Vue.component("lms-icon-dialog",{template:'<v-dialog v-model="show" v-if="show" persistent scrollable width="450" class="lms-dialog"><v-card><v-card-text><v-container grid-list-md style="padding: 4px"><v-layout wrap><v-flex xs12><div class="icon-grid"><v-btn flat icon v-for="(item, index) in items.icons" @click="setIcon(item)"><v-icon v-if="item.icon" v-bind:class="{\'active-btn\':player.icon.icon == item.icon}">{{item.icon}}</v-icon><img v-else class="svg-img" :src="item.svg | svgIcon(darkUi, player.icon.svg==item.svg)"></img></v-btn></div></v-flex></v-layout></v-container></v-card-text><v-card-actions><v-spacer></v-spacer><v-btn flat @click.native="cancel()">{{i18n(\'Cancel\')}}</v-btn></v-card-actions></v-card></v-dialog>',
props:[],data:function(){return{show:!1,items:{icons:[]}}},computed:{darkUi:function(){return this.$store.state.darkUi}},mounted:function(){bus.$on("icon.open",function(a){this.player=a;this.show=!0;getMiscJson(this.items,"player-icons-list",this)}.bind(this));bus.$on("noPlayers",function(){this.cancel()}.bind(this));bus.$on("esc",function(){"icon"==this.$store.state.activeDialog&&this.cancel()}.bind(this))},methods:{cancel:function(){this.show=!1},setIcon:function(a){a.icon==this.player.icon.icon&&
a.svg==this.player.icon.svg||bus.$emit("playerIconSet",this.player.id,a);this.cancel()}},filters:{svgIcon:function(a,b,c){return"/material/svg/"+a+"?c="+(c?getComputedStyle(document.documentElement).getPropertyValue("--active-color").replace("#",""):b?LMS_DARK_SVG:LMS_LIGHT_SVG)+"&r="+LMS_MATERIAL_REVISION}},watch:{show:function(a){this.$store.commit("dialogOpen",{name:"icon",shown:a})}}});Vue.component("lms-dstm-dialog",{template:'<v-dialog v-model="show" v-if="show" persistent width="450" class="lms-dialog"><v-card><v-card-text><v-container grid-list-md style="padding: 4px"><v-layout wrap><v-flex xs12>{{i18n("Don\'t Stop The Music")}}</v-flex><v-flex xs12><v-list class="sleep-list dialog-main-list"><template v-for="(item, index) in items"><v-list-tile @click="setDstm(item.key)"><v-list-tile-avatar><v-icon small>{{item.selected ? \'radio_button_checked\' :\'radio_button_unchecked\'}}</v-icon></v-list-tile-avatar><v-list-tile-content>{{item.label}}</v-list-tile-content></v-list-tile><v-divider></v-divider></template></v-list></v-flex></v-layout></v-container></v-card-text><v-card-actions><v-spacer></v-spacer><v-btn flat @click.native="cancel()">{{i18n(\'Cancel\')}}</v-btn></v-card-actions></v-card></v-dialog>',
props:[],data:function(){return{show:!1,items:[]}},mounted:function(){bus.$on("dstm.open",function(){var a=this;this.$store.state.dstmPlugin&&lmsCommand(this.$store.state.player.id,["dontstopthemusicsetting"]).then(function(b){var c=b.data;if(c.result&&c.result.item_loop){a.items=[];b=0;c=c.result.item_loop;for(var d=c.length;b<d;++b)c[b].actions&&c[b].actions.do&&c[b].actions.do.cmd&&a.items.push({key:c[b].actions.do.cmd[2],label:c[b].text,selected:1===c[b].radio});a.show=!0}})}.bind(this));bus.$on("noPlayers",
function(){this.show=!1}.bind(this));bus.$on("esc",function(){"dstm"==this.$store.state.activeDialog&&(this.show=!1)}.bind(this))},methods:{cancel:function(){this.show=!1},setDstm:function(a){bus.$emit("dstm",this.$store.state.player.id,a);this.show=!1},i18n:function(a,b){return this.show?i18n(a,b):a},cancelTimer:function(){void 0!==this.timer&&(clearInterval(this.timer),this.timer=void 0)}},watch:{show:function(a){this.$store.commit("dialogOpen",{name:"dstm",shown:a})}}});Vue.component("lms-savequeue",{template:'<v-dialog v-model="show" v-if="show" persistent width="600"><v-card><v-card-title>{{i18n(\'Save play queue\')}}</v-card-title><v-form class="save-queue-dialog"><v-list two-line><v-list-tile><v-list-tile-content><v-combobox v-model="name" :items="existing" :label="i18n(\'Name\')" class="lms-search" ref="entry" id="savequeue-name"></v-combobox></v-list-tile-content></v-list-tile></v-list></v-form><v-card-actions><v-spacer></v-spacer><v-btn flat @click.native="cancel()">{{i18n(\'Cancel\')}}</v-btn><v-btn flat @click.native="save()">{{i18n(\'Save\')}}</v-btn></v-card-actions></v-card></v-dialog>',
props:[],data:function(){return{show:!1,name:"",existing:[]}},mounted:function(){bus.$on("savequeue.open",function(a){var b=this;this.show=!0;this.name=a;this.currentName=""+a;focusEntry(this);lmsCommand("",["playlists",0,1E4,PLAYLIST_TAGS]).then(function(a){if((a=a.data)&&a.result&&a.result.playlists_loop){a=a.result.playlists_loop;b.existing=[];for(var c=0,f=a.length;c<f;++c)void 0==a[c].extid&&1!=parseInt(a[c].remote)&&b.existing.push(a[c].playlist);b.existing.sort()}})}.bind(this));bus.$on("noPlayers",
function(){this.show=!1}.bind(this));bus.$on("esc",function(){"savequeue"==this.$store.state.activeDialog&&(this.show=!1)}.bind(this))},methods:{cancel:function(){this.show=!1},save:function(){var a=this,b=document.getElementById("savequeue-name"),c=b&&b.value?b.value.trim():"";1>c.length||(this.show=!1,lmsCommand(this.$store.state.player.id,["playlist","save",c]).then(function(b){(b=b.data)&&b.result&&b.result.writeError&&1==parseInt(b.result.writeError)&&bus.$emit("showError",void 0,i18n("Failed to save play queue!"));
bus.$emit("refreshPlaylist",c);a.currentName!=c&&bus.$emit("refreshStatus",a.$store.state.player.id)}).catch(function(a){bus.$emit("showError",a,i18n("Failed to save play queue!"));logError(a)}))},i18n:function(a){return this.show?i18n(a):a}},watch:{show:function(a){this.$store.commit("dialogOpen",{name:"savequeue",shown:a})}}});Vue.component("lms-addtoplaylist-dialog",{template:'<v-dialog v-model="show" v-if="show" persistent width="600"><v-card><v-card-title>{{i18n(\'Add to playlist\')}}</v-card-title><v-form><v-list two-line><v-list-tile><v-list-tile-content><v-combobox v-model="name" :items="existing" :label="i18n(\'Name\')" class="lms-search" ref="entry" id="addtoplaylist-name"></v-combobox></v-list-tile-content></v-list-tile></v-list></v-form><v-card-actions><v-spacer></v-spacer><v-btn flat @click.native="cancel()">{{i18n(\'Cancel\')}}</v-btn><v-btn flat @click.native="save()">{{i18n(\'Add\')}}</v-btn></v-card-actions></v-card></v-dialog>',
props:[],data:function(){return{show:!1,name:"",existing:[]}},mounted:function(){bus.$on("addtoplaylist.open",function(a,b){var c=this;this.show=!0;this.items=a;this.itemCommands=b;focusEntry(this);var d=""+this.name;lmsCommand("",["playlists",0,1E4,PLAYLIST_TAGS]).then(function(a){if((a=a.data)&&a.result&&a.result.playlists_loop){a=a.result.playlists_loop;var b=!1;c.existing=[];for(var f=0,k=a.length;f<k;++f)void 0==a[f].extid&&1!=parseInt(a[f].remote)&&(c.existing.push(a[f].playlist),b||a[f].playlist!=
d||(b=!0));c.existing.sort();b||c.name!=d||(c.name="");1>c.name.length&&0<c.existing.length&&(c.name=c.existing[0])}})}.bind(this));bus.$on("noPlayers",function(){this.show=!1}.bind(this));bus.$on("esc",function(){"addtoplaylist"==this.$store.state.activeDialog&&(this.show=!1)}.bind(this))},methods:{cancel:function(){var a=document.getElementById("addtoplaylist-name");this.name=a&&a.value?a.value.trim():"";this.show=!1},save:function(){var a=document.getElementById("addtoplaylist-name");this.name=
a&&a.value?a.value.trim():"";if(!(1>this.name.length))if(this.show=!1,1==this.items.length&&this.items[0].id.startsWith("album_id:"))this.saveAlbumToPlaylist(this.name,this.items[0].id);else{a=[];for(var b=0,c=this.items.length;b<c;++b)this.items[b].url&&a.push({url:this.items[b].url});0==a.length&&this.items[0].params&&this.items[0].params.track_id?this.convertTrackIds(this.name):this.saveTracksToPlaylist(this.name,a)}},saveAlbumToPlaylist:function(a,b){var c=this;b=["tracks",0,1E3,"tags:u"];for(var d=
0,f=this.itemCommands[0].params,h=f.length;d<h;++d)f[d].startsWith("tags:")||b.push(f[d]);lmsCommand("",b).then(function(b){var d=b.data;b=[];if(d&&d.result&&d.result.titles_loop){var f=0;d=d.result.titles_loop;for(var g=d.length;f<g;++f)d[f].url&&b.push({url:d[f].url})}c.saveTracksToPlaylist(a,b)}).catch(function(a){bus.$emit("showError",a,i18n("Failed to add to playlist!"));logError(a)})},convertTrackIds:function(a){for(var b=this,c=[],d=0,f=this.items.length;d<f;++d)this.items[d].params&&this.items[d].params.track_id&&
c.push(this.items[d].params.track_id);lmsCommand("",["material-skin","urls","tracks:"+c.join(",")]).then(function(c){var d=c.data;c=[];if(d&&d.result&&d.result.urls_loop){var f=0;d=d.result.urls_loop;for(var h=d.length;f<h;++f)d[f].url&&c.push({url:d[f].url})}b.saveTracksToPlaylist(a,c)}).catch(function(a){bus.$emit("showError",a,i18n("Failed to add to playlist!"));logError(a)})},saveTracksToPlaylist:function(a,b){var c=this;0<b.length?lmsCommand("",["playlists","new","name:"+a]).then(function(d){d=
d.data;var f=void 0;d&&d.result&&(d.result.overwritten_playlist_id?f=d.result.overwritten_playlist_id:d.result.playlist_id&&(f=d.result.playlist_id));void 0!=f?c.savePlaylist(a,f,b):bus.$emit("showError",void 0,i18n("Failed to add to playlist!"))}).catch(function(a){bus.$emit("showError",a,i18n("Failed to add to playlist!"));logError(a)}):bus.$emit("showError",err,i18n("Failed to add to playlist!"))},savePlaylist:function(a,b,c){var d=this,f=c.shift();lmsCommand("",["playlists","edit","playlist_id:"+
b,"cmd:add","url:"+f.url]).then(function(f){0<c.length?d.savePlaylist(a,b,c):(bus.$emit("showMessage",i18n("Added to '%1'",a)),bus.$emit("refreshPlaylist",a))}).catch(function(a){bus.$emit("showError",a,i18n("Failed to add to playlist!"));logError(a)})},i18n:function(a){return this.show?i18n(a):a}},watch:{show:function(a){this.$store.commit("dialogOpen",{name:"addtoplaylist",shown:a})}}});lmsPromptDialog=Vue.component("lms-file-dialog",{template:'<v-dialog v-model="show" v-if="show" persistent max-width="600"><v-card><v-card-title>{{isDir ? i18n(\'Select folder\') : i18n(\'Select file\')}}</v-card-title><v-card-text class="file-dialog-select-list"><v-treeview :items="items" :load-children="fetch" open-on-click :open.sync="open"><template v-slot:prepend="{ item }" style="width:22px"><v-icon v-if="item.canselect" @click.stop="selected=item.id">{{selected==item.id ? \'radio_button_checked\' : \'radio_button_unchecked\'}}</v-icon><div @click="select(item)" style="margin-left:8px">{{item.name}}</div></template></v-treeview></v-card-text><v-card-actions><v-spacer></v-spacer><v-btn flat @click.native="close()">{{i18n(\'Cancel\')}}</v-btn><v-btn flat :disabled="undefined==selected" @click.native="useSelected()">{{i18n(\'Use Selected\')}}</v-btn></v-card-actions></v-card></v-dialog>',
data:function(){return{show:!1,isDir:!0,open:[],items:[{name:i18n("Loading..."),id:"<initial>"}],selected:void 0}},mounted:function(){bus.$on("file.open",function(a,b,c){if(void 0!=a&&(this.show=!0,this.elem=a,this.isDir=b,this.types=c,a=a.value,this.fetch(null),void 0!=a&&(console.log("CURRENT",a,this.isDir,c),c=void 0,b=!0,0<=a.indexOf("/")?c=a.split("/"):0<=a.indexOf("\\")&&(c=a.split("\\"),b=!1),void 0!=c&&0<c.length))){for(var d=[],f=0,h=c.length;f<h;++f)""!=c[f]&&d.push(c[f]);0<d.length&&(b&&
d.unshift("/"),this.expand(a,d,b))}}.bind(this));bus.$on("esc",function(){"dirselect"==this.$store.state.activeDialog&&this.close(!1)}.bind(this))},methods:{close:function(){this.open=[];this.items=[];this.elem=void 0;this.show=!1;this.selected=void 0},useSelected:function(){void 0!=this.selected&&(console.log("SELECTED PATH",this.selected),this.elem.value=this.selected,this.close())},parseResp:function(a,b){var c=[];if(void 0!=a.result.fsitems_loop){var d=0;a=a.result.fsitems_loop;for(var f=a.length;d<
f;++d)1==parseInt(a[d].isfolder)?c.push({name:a[d].name,id:a[d].path,children:[],canselect:this.isDir}):c.push({name:a[d].name,id:a[d].path,canselect:!this.isDir})}void 0==b?this.items=c:(b.children=c,this.open.push(b.id));return c},expand:function(a,b,c,d,f){var h=this,g=b.shift(),k=(d?d:"")+(c?"/"==g||"/"==d?"":"/":d?"\\":"")+g;k==a?this.selected=a:(d=["folder:"+k],this.isDir?d.push("filter:foldersonly"):0<this.types.length&&d.push("filter:filetype:("+this.types.join("|")+")"),lmsList("",["readdirectory"],
d,0,500).then(function(d){d=h.parseResp(d.data,f);for(var g=0,m=d.length;g<m;++g)if(d[g].name==b[0]){h.expand(a,b,c,k,d[g]);break}}))},fetch:function(a){var b=this,c;return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){c=[void 0==a?"folder:/":"folder:"+a.id];b.isDir?c.push("filter:foldersonly"):0<b.types.length&&c.push("filter:filetype:("+b.types.join("|")+")");lmsList("",["readdirectory"],c,0,500).then(function(c){b.parseResp(c.data,a)}).catch(function(a){bus.$emit("showError",i18n("Failed to get folder listing"))});
d.jumpToEnd()})},select:function(a){void 0==a.children&&a.canselect&&(this.selected=a.id)}},watch:{show:function(a){this.$store.commit("dialogOpen",{name:"dirselect",shown:a})}}});function grpVolSort(a,b){if(a.isgroup!=b.isgroup)return a.isgroup?-1:1;a=a.name.toLowerCase();b=b.name.toLowerCase();return a<b?-1:a>b?1:0}
Vue.component("lms-groupvolume",{template:'<v-sheet v-model="show" v-if="show" elevation="5" class="vol-sheet group-vol"><v-container grid-list-md text-xs-center id="gv-container"><v-layout row wrap><div v-for="(player, index) in players" style="width:100%" :key="player.id" v-bind:class="{\'active-player\':currentPlayer && currentPlayer.id === player.id}" :id="currentPlayer && currentPlayer.id === player.id ? \'gv-active\' : (\'gv-\'+index)"><v-flex :disabled="VOL_HIDDEN==player.dvc" xs12 style="height:8px"></v-flex><v-flex :disabled="VOL_HIDDEN==player.dvc" xs12 class="vol-label" v-bind:class="{\'pulse\':0==player.volume && player.isplaying, \'link-item\':VOL_STD==player.dvc}" @click.middle="toggleMute(player)" v-longpress="toggleMuteLabel" :id="index+\'-grpvol-label\'">{{player.name}}{{player.volume|displayVolume(player.dvc)}}</v-flex><v-flex :disabled="VOL_HIDDEN==player.dvc" xs12 style="height:16px"></v-flex><v-flex :disabled="VOL_HIDDEN==player.dvc" xs12><v-layout><v-btn flat icon class="vol-btn vol-left" @click="adjustVolume(player, false)"><v-icon>{{player.muted ? \'volume_off\' : \'volume_down\'}}</v-icon></v-btn><v-slider :readonly="VOL_STD!=player.dvc" :disabled="VOL_STD!=player.dvc" @change="volumeChanged(player)" step="1" v-model="player.volume" class="vol-slider" v-bind:class="{\'dimmed\': !player.ison}"></v-slider><v-btn flat icon @click="adjustVolume(player, true)" class="vol-btn vol-right"><v-icon>{{player.muted ? \'volume_off\' : \'volume_up\'}}</v-icon></v-btn></v-layout></v-flex><v-flex xs12 style="height:16px"></v-flex></div></v-layout></v-container><div class="padding"></div><v-card-actions><v-spacer></v-spacer><v-btn flat @click.native="show = false">{{i18n(\'Close\')}}</v-btn></v-card-actions></v-sheet>    ',props:[],
data:function(){return{show:!1,playing:!1,players:[]}},mounted:function(){this.closeTimer=void 0;bus.$on("groupvolume.open",function(a,b){if(this.show)this.close();else{for(var c={},d=0,f=this.$store.state.players.length;d<f;++d)c[this.$store.state.players[d].id]={name:this.$store.state.players[d].name,isgroup:this.$store.state.players[d].isgroup};this.players=[{id:a.syncmaster,master:!0,name:c[a.syncmaster].name,isgroup:c[a.syncmaster].isgroup,volume:void 0,dvc:VOL_STD,muted:!1}];this.$store.state.player.id==
a.syncmaster&&(this.players[0].volume=a.volume);d=0;for(f=a.syncslaves.length;d<f;++d)this.players.push({id:a.syncslaves[d],master:!1,name:c[a.syncslaves[d]].name,isgroup:c[a.syncslaves[d]].isgroup,volume:void 0,dvc:VOL_STD,muted:!1,isplaying:!1}),this.$store.state.player.id==a.syncslaves[d]&&(this.players[this.players.length-1].volume=a.volume);this.players.sort(grpVolSort);this.playerMap={};d=0;for(f=this.players.length;d<f;++d)this.playerMap[this.players[d].id]=d,this.refreshPlayer(this.players[d]);
if(b)var h=0,g=setInterval(function(){var a=document.getElementById("gv-active");void 0!=a?(document.getElementById("gv-container").scrollTop=a.offsetTop,clearInterval(g)):50>h?h++:clearInterval(g)},10);this.show=!0}}.bind(this));bus.$on("noPlayers",function(){this.close()}.bind(this));bus.$on("esc",function(){"groupvolume"==this.$store.state.activeDialog&&this.close()}.bind(this));bus.$on("dialogOpen",function(a,b){b&&"groupvolume"!=a&&this.close()}.bind(this));bus.$on("menuOpen",function(){this.close()}.bind(this));
bus.$on("playerStatus",function(a){this.updatePlayer(a)}.bind(this));bus.$on("otherPlayerStatus",function(a){this.updatePlayer(a)}.bind(this));bus.$on("adjustVolume",function(){this.show&&(this.cancelUpdateTimer(),this.updateTimer=setTimeout(function(){this.refreshAll()}.bind(this),100))}.bind(this))},beforeDestroy:function(){this.cancelCloseTimer()},methods:{close:function(){this.showing=this.show=!1;this.cancelCloseTimer()},i18n:function(a){return this.show?i18n(a):a},refreshPlayer:function(a){bus.$emit("refreshStatus",
a.id)},refreshAll:function(){if(this.show)for(var a=0,b=this.players.length;a<b;++a)this.refreshPlayer(this.players[a])},updatePlayer:function(a){if(this.show){var b=this.playerMap[a.id];void 0!=b&&(this.$store.state.player&&this.$store.state.player.id==a.id&&!a.synced&&(this.show=!1),this.players[b].dvc=a.dvc,this.players[b].muted=a.muted,this.players[b].volume=a.volume,this.players[b].isplaying=a.isplaying)}},adjustVolume:function(a,b){var c=this;!this.show||0<this.$store.state.visibleMenus.size||
VOL_HIDDEN==a.dvc||(this.resetCloseTimer(),a.muted?this.toggleMute(a):lmsCommand(a.id,["mixer","volume",(b?"+":"-")+lmsOptions.volumeStep]).then(function(a){c.refreshAll()}))},volumeChanged:function(a){this.setVolume(a,a.volume)},setVolume:function(a,b){var c=this;this.show&&(VOL_STD!=a.dvc?a.volume=100:(this.resetCloseTimer(),lmsCommand(a.id,["mixer","volume",b]).then(function(d){a.volume=b;a.muted=0>b;c.refreshAll()})))},toggleMute:function(a){var b=this;VOL_STD==a.dvc&&this.show&&(this.resetCloseTimer(),
lmsCommand(a.id,["mixer","muting",a.muted?0:1]).then(function(a){b.refreshAll();setTimeout(function(){this.refreshAll()}.bind(b),500)}))},toggleMuteLabel:function(a,b){b=parseInt(b.id.split("-")[0]);0<=b&&b<=this.players.length&&(b=this.players[b],VOL_STD==b.dvc&&(a||b.muted)&&this.toggleMute(b))},cancelCloseTimer:function(){void 0!==this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=void 0)},resetCloseTimer:function(){this.cancelCloseTimer();this.closeTimer=setTimeout(function(){this.show=
!1}.bind(this),LMS_VOLUME_CLOSE_TIMEOUT)},cancelUpdateTimer:function(){void 0!==this.updateTimer&&(clearTimeout(this.updateTimer),this.updateTimer=void 0)}},watch:{show:function(a){this.$store.commit("dialogOpen",{name:"groupvolume",shown:a});this.resetCloseTimer();this.cancelUpdateTimer();bus.$emit("subscribeAll",a)}},computed:{currentPlayer:function(){return this.$store.state.player}},filters:{displayVolume:function(a,b){return VOL_FIXED!=b?": "+a+"%":""}}});var ADVS_ANY_GENRE=-3,ADVS_IN_GENRE=-1,ADVS_NOT_IN_GENRE=-2,ADVS_ANY_CONTENT_TYPE="*";
Vue.component("lms-advancedsearch-dialog",{template:'<v-dialog v-model="show" v-if="show" persistent scrollable width="900"><v-card><v-card-title>{{i18n("Advanced search")}}</v-card-title><v-card-text><v-layout class="avs-section" wrap :disabled="searching"><v-flex xs12 sm3><div class="avs-title">{{i18n(\'Track\')}}</div></v-flex><v-flex xs12 sm4><v-select :items="textOps" v-model="params.me_titlesearch.op" item-text="label" item-value="key"></v-select></v-flex><v-flex xs12 sm5><v-text-field clearable v-model="params.me_titlesearch.val" class="lms-search" ref="entry"></v-text-field></v-flex></v-layout><v-layout class="avs-section" wrap :disabled="searching"><v-flex xs12 sm3><div class="avs-title">{{i18n(\'Artist\')}}</div></v-flex><v-flex xs12 sm4><v-select :items="textOps" v-model="params.contributor_namesearch.op" item-text="label" item-value="key"></v-select></v-flex><v-flex xs12 sm5><v-text-field clearable v-model="params.contributor_namesearch.val" class="lms-search"></v-text-field></v-flex><v-flex xs12 sm3></v-flex><v-flex xs12 sm9><v-select chips deletable-chips multiple :items="artistTypes" v-model="params.contributor_namesearch.types" item-text="label" item-value="key"></v-select></v-flex></v-layout><v-layout class="avs-section" wrap :disabled="searching"><v-flex xs12 sm3><div class="avs-title">{{i18n(\'Album\')}}</div></v-flex><v-flex xs12 sm4><v-select :items="textOps" v-model="params.album_titlesearch.op" item-text="label" item-value="key"></v-select></v-flex><v-flex xs12 sm5><v-text-field clearable v-model="params.album_titlesearch.val" class="lms-search"></v-text-field></v-flex></v-layout><v-layout class="avs-section" wrap :disabled="searching"><v-flex xs12 sm3><div class="avs-title">{{i18n(\'Genre\')}}</div></v-flex><v-flex xs12 sm4><v-select :items="genres" v-model="params.genre" item-text="label" item-value="key"></v-select></v-flex><v-flex xs12 sm5><v-text-field clearable v-model="params.genre_name" class="lms-search" :disabled="params.genre!=ADVS_IN_GENRE && params.genre!=ADVS_NOT_IN_GENRE"></v-text-field></v-flex></v-layout><v-layout class="avs-section" wrap :disabled="searching"><v-flex xs12 sm3><div class="avs-title">{{i18n(\'Duration\')}}</div></v-flex><v-flex xs12 sm4><v-select :items="fullRangeOps" v-model="params.secs.op" item-text="label" item-value="key"></v-select></v-flex><v-flex xs12 sm5><v-text-field clearable v-model="params.secs.val" class="lms-search" :placeholder="i18n(\'seconds\')"></v-text-field></v-flex></v-layout><v-layout class="avs-section" wrap :disabled="searching"><v-flex xs12 sm3><div class="avs-title">{{i18n(\'Track#\')}}</div></v-flex><v-flex xs12 sm4><v-select :items="rangeOps" v-model="params.tracknum.op" item-text="label" item-value="key"></v-select></v-flex><v-flex xs12 sm5><v-text-field clearable v-model="params.tracknum.val" class="lms-search"></v-text-field></v-flex></v-layout><v-layout class="avs-section" wrap :disabled="searching"><v-flex xs12 sm3><div class="avs-title">{{i18n(\'Year\')}}</div></v-flex><v-flex xs12 sm4><v-select :items="fullRangeOps" v-model="params.year.op" item-text="label" item-value="key"></v-select></v-flex><v-flex xs12 sm5><v-text-field clearable v-model="params.year.val" class="lms-search"></v-text-field></v-flex></v-layout><v-layout class="avs-section" wrap :disabled="searching" v-show="stats && sections.stats.visible"><v-flex xs12 sm3><div class="avs-title">{{i18n(\'Play count\')}}</div></v-flex><v-flex xs12 sm4><v-select :items="fullRangeOps" v-model="params.persistent_playcount.op" item-text="label" item-value="key"></v-select></v-flex><v-flex xs12 sm5><v-text-field clearable v-model="params.persistent_playcount.val" class="lms-search"></v-text-field></v-flex></v-layout><v-layout class="avs-section" wrap :disabled="searching" v-show="stats && sections.stats.visible"><v-flex xs12 sm3><div class="avs-title">{{i18n(\'Rating\')}}</div></v-flex><v-flex xs12 sm4><v-select :items="fullRangeOps" v-model="params.persistent_rating.op" item-text="label" item-value="key"></v-select></v-flex><v-flex xs12 sm5><v-text-field clearable v-model="params.persistent_rating.val" class="lms-search"></v-text-field></v-flex></v-layout><v-layout class="avs-section" wrap :disabled="searching" v-show="sections.tech.visible"><v-flex xs12 sm3><div class="avs-title">{{i18n(\'Bitrate\')}}</div></v-flex><v-flex xs12 sm4><v-select :items="rangeOps" v-model="params.bitrate.op" item-text="label" item-value="key"></v-select></v-flex><v-flex xs12 sm5><v-select :items="bitrates" v-model="params.bitrate.val" item-text="label" item-value="key"></v-select ></v-flex></v-layout><v-layout class="avs-section" wrap :disabled="searching" v-show="sections.tech.visible"><v-flex xs12 sm3><div class="avs-title">{{i18n(\'Sample rate\')}}</div></v-flex><v-flex xs12 sm4><v-select :items="rangeOps" v-model="params.samplerate.op" item-text="label" item-value="key"></v-select></v-flex><v-flex xs12 sm5><v-select :items="sampleRates" v-model="params.samplerate.val" item-text="label" item-value="key"></v-select ></v-flex></v-layout><v-layout class="avs-section" wrap :disabled="searching" v-show="sections.tech.visible"><v-flex xs12 sm3><div class="avs-title">{{i18n(\'Sample size\')}}</div></v-flex><v-flex xs12 sm4><v-select :items="rangeOps" v-model="params.samplesize.op" item-text="label" item-value="key"></v-select></v-flex><v-flex xs12 sm5><v-select :items="sampleSizes" v-model="params.samplesize.val" item-text="label" item-value="key"></v-select ></v-flex></v-layout><v-layout class="avs-section" wrap :disabled="searching" v-show="sections.file.visible"><v-flex xs12 sm3><div class="avs-title">{{i18n(\'Date modified\')}}</div></v-flex><v-flex xs12 sm4><v-select :items="dateOps" v-model="params.timestamp.op" item-text="label" item-value="key"></v-select></v-flex><v-flex xs12 sm5><v-text-field clearable v-model="params.timestamp.val" class="lms-search" placeholder="mm/dd/yyyy"></v-text-field></v-flex></v-layout><v-layout class="avs-section" wrap :disabled="searching" v-show="sections.file.visible"><v-flex xs12 sm3><div class="avs-title">{{i18n(\'File format\')}}</div></v-flex><v-flex xs12 sm9><v-select :items="fileFormats" v-model="params.content_type" item-text="label" item-value="key"></v-select></v-flex></v-layout><v-layout class="avs-section" wrap :disabled="searching" v-show="sections.file.visible"><v-flex xs12 sm3><div class="avs-title">{{i18n(\'Path\')}}</div></v-flex><v-flex xs12 sm4><v-select :items="textOps" v-model="params.url.op" item-text="label" item-value="key"></v-select></v-flex><v-flex xs12 sm5><v-text-field clearable v-model="params.url.val" class="lms-search"></v-text-field></v-flex></v-layout><v-layout class="avs-section" wrap :disabled="searching" v-show="sections.file.visible"><v-flex xs12 sm3><div class="avs-title">{{i18n(\'File size\')}}</div></v-flex><v-flex xs12 sm4><v-select :items="fullRangeOps" v-model="params.filesize.op" item-text="label" item-value="key"></v-select></v-flex><v-flex xs12 sm5><v-text-field clearable v-model="params.filesize.val" class="lms-search" :placeholder="i18n(\'bytes\')"></v-text-field></v-flex></v-layout><v-layout class="avs-section" wrap :disabled="searching"><v-flex xs12 sm3><div class="avs-title">{{i18n(\'Comment\')}}</div></v-flex><v-flex xs12 sm4><v-select :items="textOps" v-model="params.comments_value.op" item-text="label" item-value="key"></v-select></v-flex><v-flex xs12 sm5><v-text-field clearable v-model="params.comments_value.val" class="lms-search"></v-text-field></v-flex></v-layout><v-layout class="avs-section" wrap :disabled="searching"><v-flex xs12 sm3><div class="avs-title">{{i18n(\'Lyrics\')}}</div></v-flex><v-flex xs12 sm4><v-select :items="textOps" v-model="params.lyrics.op" item-text="label" item-value="key"></v-select></v-flex><v-flex xs12 sm5><v-text-field clearable v-model="params.lyrics.val" class="lms-search"></v-text-field></v-flex></v-layout></v-card-text><v-card-actions><div v-if="searching" style="padding-left:8px">{{i18n(\'Searching...\')}}</div><v-menu v-else top v-model="showMenu"><v-btn icon slot="activator"><v-icon>settings</v-icon></v-btn><v-list><template v-for="(sect, index) in sections"><v-list-tile @click="sect.visible=!sect.visible" v-if="stats || !sect.isstats"><v-list-tile-avatar><v-icon>{{sect.visible ? \'check_box\' : \'check_box_outline_blank\'}}</v-icon></v-list-tile-avatar><v-list-tile-content><v-list-tile-title>{{sect.label}}</v-list-tile-title></v-list-tile-content></v-list-tile></template></v-list></v-menu><v-spacer></v-spacer><v-btn flat @click.native="cancel()">{{i18n(\'Cancel\')}}</v-btn><v-btn flat v-if="!searching" @click.native="search()">{{i18n(\'Search\')}}</v-btn</v-card-actions></v-card></v-dialog>',props:[],
data:function(){return{show:!1,showMenu:!1,searching:!1,textOps:[],rangeOps:[],fullRangeOps:[],dateOps:[],contentTypes:[],sampleRates:[],sampleSizes:[],bitrates:[],fileFormats:[],artistTypes:[],genres:[],params:{me_titlesearch:{val:void 0,op:"LIKE"},contributor_namesearch:{val:void 0,op:"LIKE",types:[1,5]},album_titlesearch:{val:void 0,op:"LIKE"},genre:ADVS_ANY_GENRE,genre_name:void 0,secs:{val:void 0,op:">"},tracknum:{val:void 0,op:"="},year:{val:void 0,op:">"},persistent_playcount:{val:void 0,op:">"},
persistent_rating:{val:void 0,op:"="},timestamp:{val:void 0,op:"="},bitrate:{val:0,op:">"},samplerate:{val:0,op:">"},samplesize:{val:0,op:">"},content_type:ADVS_ANY_CONTENT_TYPE,url:{val:void 0,op:"LIKE"},filesize:{val:void 0,op:">"},comments_value:{val:void 0,op:"LIKE"},lyrics:{val:void 0,op:"LIKE"}},sections:{tech:{visible:getLocalStorageBool("advs.tech",!1),label:""},file:{visible:getLocalStorageBool("advs.file",!1),label:""},stats:{visible:getLocalStorageBool("advs.stats",!1),label:"",isstats:!0}},
stats:!0}},mounted:function(){bus.$on("advancedsearch.open",function(a){var b=this;this.textOps=[{key:"LIKE",label:i18n("contains")},{key:"NOT LIKE",label:i18n("doesn't contain")},{key:"STARTS WITH",label:i18n("starts with")},{key:"STARTS NOT WITH",label:i18n("does not start with")}];this.rangeOps=[{key:"=",label:i18n("equals")},{key:"<",label:i18n("less than")},{key:">",label:i18n("greater than")},{key:"!=",label:i18n("not")}];this.fullRangeOps=[{key:"=",label:i18n("equals")},{key:"<",label:i18n("less than")},
{key:">",label:i18n("greater than")},{key:"!=",label:i18n("not equal")},{key:"BETWEEN",label:i18n("in range")},{key:"NOT BETWEEN",label:i18n("not in range")}];this.dateOps=[{key:"=",label:i18n("is")},{key:"<",label:i18n("before")},{key:">",label:i18n("after")},{key:"!=",label:i18n("is not")}];this.sampleRates=[{key:0,label:i18n("any")}];this.sampleSizes=[{key:0,label:i18n("any")}];this.bitrates=[{key:0,label:i18n("any")},{key:32,label:"32 kbps"},{key:48,label:"48 kbps"},{key:64,label:"64 kbps"},{key:96,
label:"96 kbps"},{key:128,label:"128 kbps"},{key:160,label:"160 kbps"},{key:192,label:"192 kbps"},{key:224,label:"224 kbps"},{key:320,label:"320 kbps"}];this.fileFormats=[{key:ADVS_ANY_CONTENT_TYPE,label:i18n("any")}];this.artistTypes=[{key:1,label:i18n("Artist")},{key:5,label:i18n("Album artist")},{key:6,label:i18n("Track artist")},{key:2,label:i18n("Composer")},{key:3,label:i18n("Conductor")},{key:4,label:i18n("Band")}];this.genres=[{key:ADVS_ANY_GENRE,label:i18n("any genre")},{key:ADVS_IN_GENRE,
label:i18n("contains")},{key:ADVS_NOT_IN_GENRE,label:i18n("doesn't contain")}];this.sections.tech.label=i18n("Technical");this.sections.file.label=i18n("File");this.sections.stats.label=i18n("Stats");a&&(this.params.me_titlesearch={val:void 0,op:"LIKE"},this.params.contributor_namesearch={val:void 0,op:"LIKE",types:[1,5]},this.params.album_titlesearch={val:void 0,op:"LIKE"},this.params.genre=ADVS_ANY_GENRE,this.params.genre_name=void 0,this.params.secs={val:void 0,op:">"},this.params.tracknum={val:void 0,
op:"="},this.params.year={val:void 0,op:">"},this.params.persistent_playcount={val:void 0,op:">"},this.params.persistent_rating={val:void 0,op:"="},this.params.timestamp={val:void 0,op:"="},this.params.bitrate={val:0,op:">"},this.params.samplerate={val:0,op:">"},this.params.samplesize={val:0,op:">"},this.params.content_type=ADVS_ANY_CONTENT_TYPE,this.params.url={val:void 0,op:"LIKE"},this.params.filesize={val:void 0,op:">"},this.params.comments_value={val:void 0,op:"LIKE"},this.params.lyrics={val:void 0,
op:"LIKE"});lmsCommand("",["material-skin","adv-search-params"]).then(function(a){if((a=a.data)&&a.result){if(a.result.genres_loop){b.genres=[{key:ADVS_ANY_GENRE,label:i18n("any genre")},{key:ADVS_IN_GENRE,label:i18n("contains")},{key:ADVS_NOT_IN_GENRE,label:i18n("doesn't contain")}];for(var c=0,f=a.result.genres_loop,h=f.length;c<h;++c)b.genres.push({key:f[c].id,label:f[c].name})}if(a.result.filetypes_loop)for(b.fileFormats=[{key:ADVS_ANY_CONTENT_TYPE,label:i18n("any")}],c=0,f=a.result.filetypes_loop,
h=f.length;c<h;++c)b.fileFormats.push({key:f[c].id,label:f[c].name});if(a.result.samplerates_loop)for(b.sampleRates=[{key:0,label:i18n("any")}],c=0,f=a.result.samplerates_loop,h=f.length;c<h;++c)b.sampleRates.push({key:f[c].rate,label:(f[c].rate/1E3).toFixed(1)+" kHz"});if(a.result.samplesizes_loop)for(b.sampleSizes=[{key:0,label:i18n("any")}],c=0,f=a.result.samplesizes_loop,h=f.length;c<h;++c)b.sampleSizes.push({key:f[c].size,label:""+f[c].size});b.stats=1==parseInt(a.result.statistics)}});this.show=
!0;focusEntry(this)}.bind(this));bus.$on("esc",function(){"advancedsearch"==this.$store.state.activeDialog&&this.close()}.bind(this))},methods:{cancel:function(){this.searching?this.searching=!1:this.close()},close:function(){this.searching=this.show=!1;setLocalStorageVal("advs.tech",this.sections.tech.visible);setLocalStorageVal("advs.file",this.sections.file.visible);setLocalStorageVal("advs.stats",this.sections.stats.visible)},search:function(){var a=this;this.searching=!0;for(var b="me_titlesearch contributor_namesearch album_titlesearch secs tracknum year persistent_playcount persistent_rating timestamp url filesize comments_value lyrics".split(" "),
c=["bitrate","samplerate","samplesize"],d=["material-skin","adv-search"],f=0,h=b.length;f<h;++f){var g=void 0==this.params[b[f]].val?"":(""+this.params[b[f]].val).trim();0<g.length&&(d.push(b[f]+":"+g),d.push(b[f]+".op:"+this.params[b[f]].op))}f=0;for(h=c.length;f<h;++f)g=void 0==this.params[c[f]].val?0:parseInt((""+this.params[c[f]].val).trim()),0!=g&&(d.push(c[f]+":"+g),d.push(c[f]+".op:"+this.params[c[f]].op));f=0;b=this.params.contributor_namesearch.types;for(h=b.length;f<h;++f)d.push("contributor_namesearch.active"+
b[f]+":1");this.params.content_type!=ADVS_ANY_CONTENT_TYPE&&d.push("content_type:"+this.params.content_type);this.params.genre==ADVS_IN_GENRE||this.params.genre==ADVS_NOT_IN_GENRE?(g=void 0==this.params.genre_name?"":this.params.genre_name.trim(),0<g.length&&(d.push("genre_name:"+g),d.push("genre:"+this.params.genre))):this.params.genre!=ADVS_ANY_GENRE&&d.push("genre:"+this.params.genre);lmsCommand("",d).then(function(b){var c=b.data;if(a.searching){b=[];var f=0;if(c.result.albums_loop){var g=parseBrowseResp(c,
void 0,{artistImages:setLocalStorageVal("artistImages",!0),isSearch:!0});c.result.albums_loop=void 0;void 0!=g&&(b.push({resp:g,command:{cat:2}}),f+=g.items.length)}c.result.titles_loop&&(c=parseBrowseResp(c,void 0,{artistImages:setLocalStorageVal("artistImages",!0),isSearch:!0}),void 0!=c&&(b.push({resp:c,command:{cat:3}}),f+=c.items.length));c={cancache:!1,title:i18n("Advanced search results"),id:ADV_SEARCH_ID,type:"search",libsearch:!0};bus.$emit("advSearchResults",c,{command:d,params:[]},{items:buildSearchResp(b),
baseActions:[],canUseGrid:!1,jumplist:[],subtitle:i18np("1 Item","%1 Items",f)});a.searching=!1;a.close()}}).catch(function(b){a.searching=!1;logError(b)})},i18n:function(a){return this.show?i18n(a):a}},watch:{show:function(a){this.$store.commit("dialogOpen",{name:"advancedsearch",shown:a})}}});var DOWNLOAD_TAGS="tags:aACeiltuyK",downloadElem=void 0;
function downloadViaBrowser(a){var b=a.shift();if(void 0!=b){var c=(b.artist?b.artist+" - ":"")+(b.album?b.album+" - ":"")+(void 0==b.filename||1>b.filename.length?(b.disc&&0<b.disc?b.disc+".":"")+(b.tracknum?b.tracknum+" ":"")+b.title+(b.ext?"."+b.ext:""):b.filename);downloadElem=document.createElement("a");downloadElem.download=c;downloadElem.href="/material/download/"+b.id;downloadElem.style.display="none";document.body.append(downloadElem);downloadElem.click();setTimeout(function(){downloadElem.remove();
0<a.length&&downloadViaBrowser(a)},100)}}function downloadNative(a){try{NativeReceiver.download(JSON.stringify(a))}catch(b){}}function cancelDownloadNative(a){try{NativeReceiver.cancelDownload(JSON.stringify(a))}catch(b){}}function isCueTrack(a){a=a.split("#");if(2>a.length)return!1;a=a[a.length-1].split("-");return 2!=a.length||isNaN(a[0])&&isNaN(parseFloat(a[0]))||isNaN(a[1])&&isNaN(parseFloat(a[1]))?!1:!0}
function download(a,b,c){var d=a.id.startsWith("playlist_id:")?"playlisttracks_loop":"titles_loop",f=["tracks",0,1E3,DOWNLOAD_TAGS,"sort:tracknum",originalId(a.id)];a.artist_id&&(void 0==b||0<=getField(b,"artist_id"))&&f.push("artist_id:"+a.artist_id);a.id.startsWith("playlist_id:")&&f.unshift("playlists");lmsCommand("",f).then(function(b){var f=b.data;if(f&&f.result&&f.result[d]){var h=[];b=0;f=f.result[d];for(var m=f.length;b<m;++b){var l=f[b];if(/^file:\/\//.test(l.url)){var n=decodeURIComponent(l.url.substring(l.url.lastIndexOf("/")+
1));if(!isCueTrack(n)){var e=l.url.split(".");e=e[e.length-1];splitMultiples(l);var r=void 0==l.tracknum?0:parseInt(l.tracknum),t=void 0!=l.albumartist?l.albumartist:void 0!=c?c:void 0!=l.compilation&&1==parseInt(l.compilation)?lmsOptions.variousArtistsString:l.artist;h.push({id:l.id,title:l.title,filename:n,ext:e,artist:t,album:l.album,tracknum:0<r?9<r?r:"0"+r:void 0,disc:l.disc,album_id:l.album_id})}}}0==h.length?a.id.startsWith("track_id:")?bus.$emit("showError",void 0,i18n("Track is not downloadable.")):
bus.$emit("showError",void 0,i18n("No downloadable tracks.")):1<h.length?confirm(i18n("Download %1 tracks?",h.length),i18n("Download")).then(function(a){1==a&&("native"==queryParams.download?downloadNative(h):downloadViaBrowser(h))}):"native"==queryParams.download?downloadNative(h):downloadViaBrowser(h)}}).catch(function(a){bus.$emit("showError",a,i18n("Failed to add to playlist!"));logError(a)})}
function downloadStatus(a){try{var b=JSON.parse(a);Array.isArray(b)&&bus.$store.commit("setDownloadStatus",b)}catch(c){}}
Vue.component("lms-downloadstatus",{template:'<v-dialog v-model="show" v-if="show" scrollable fullscreen><v-card><v-card-title class="settings-title"><v-toolbar app-data class="dialog-toolbar"><v-btn flat icon v-longpress:stop="close" :title="i18n(\'Go back\')"><v-icon>arrow_back</v-icon></v-btn><v-toolbar-title>{{i18n(\'Downloading\')}}</v-toolbar-title><v-spacer></v-spacer><v-btn icon v-if="undefined!=items && items.length>1" flat @click.native="abortAll()" :title="i18n(\'Abort all\')"><img class="svg-img" :src="\'close-all\' | svgIcon(darkUi, coloredToolbars)"></img></v-btn></v-toolbar></v-card-title><v-card-text style="padding-top:0px"><v-container grid-list-md style="padding:0px"><v-layout wrap><v-flex xs12 v-if="undefined!=items && items.length>0"><v-list class="lms-list" style="padding-top:0px;position:unset;top:unset;height:100%!important;width:100%!important"><div class="dialog-padding"></div><template v-for="(item, index) in items"><v-list-tile class="lms-list-item" v-bind:class="{\'pq-current\': item.downloading}"><v-list-tile-content><v-list-tile-title>{{item.title}}</v-list-tile-title><v-list-tile-sub-title class="ellipsis">{{item.subtitle}}</v-list-tile-sub-title></v-list-tile-content><v-list-tile-action @click.stop="abort(item)"><v-btn icon flat><v-icon>cancel</v-icon></v-btn></v-list-tile-action></v-list-tile></template></v-list></v-flex><v-flex xs12 v-else><div style="padding-top:64px;width:100%;display:flex;justify-content:center;align-items:center;">{{i18n(\'All downloads complete.\')}}</div></v-flex><div class="dialog-padding"></div></v-layout></v-container></v-card-text></v-card></v-dialog>',props:[],
data:function(){return{show:!1,coloredToolbars:!1}},mounted:function(){bus.$on("downloadstatus.open",function(){this.show=!0}.bind(this));bus.$on("esc",function(){"downloadstatus"==this.$store.state.activeDialog&&this.close()}.bind(this));this.coloredToolbars=this.$store.state.theme.endsWith("-colored");bus.$on("themeChanged",function(){this.coloredToolbars=this.$store.state.theme.endsWith("-colored")}.bind(this))},methods:{close:function(){this.show=!1},abort:function(a){1==this.$store.state.downloadStatus.length&&
this.close();cancelDownloadNative([a.id])},abortAll:function(){var a=this;confirm(i18n("Abort all downloads?"),i18n("Abort"),i18n("No")).then(function(b){if(1==b){b=[];for(var c=0,d=a.$store.state.downloadStatus,f=d.length;c<f;++c)b.push(d[c].id);cancelDownloadNative(b);a.close()}})},i18n:function(a,b){return this.show?i18n(a,b):a}},computed:{items:function(){return this.$store.state.downloadStatus},darkUi:function(){return this.$store.state.darkUi}},filters:{svgIcon:function(a,b,c){return"/material/svg/"+
a+"?c="+(b||c?LMS_DARK_SVG:LMS_LIGHT_SVG)+"&r="+LMS_MATERIAL_REVISION}},watch:{show:function(a){this.$store.commit("dialogOpen",{name:"downloadstatus",shown:a})}}});Vue.component("lms-notifications",{template:'<v-dialog v-model="show" v-if="show" scrollable fullscreen><v-card><v-card-title class="settings-title"><v-toolbar app-data class="dialog-toolbar"><v-btn flat icon v-longpress:stop="close" :title="i18n(\'Go back\')"><v-icon>arrow_back</v-icon></v-btn><v-toolbar-title>{{i18n(\'Notifications\')}}</v-toolbar-title></v-toolbar></v-card-title><v-card-text style="padding-top:0px"><v-container grid-list-md style="padding:0px"><v-layout wrap><v-flex xs12 v-if="undefined!=items && items.length>0"><v-list class="lms-list" style="padding-top:0px;position:unset;top:unset;height:100%!important;width:100%!important"><div class="dialog-padding"></div><template v-for="(item, index) in items"><v-list-tile class="lms-list-item" v-bind:class="{\'pq-current\': item.downloading}"><v-list-tile-content><v-list-tile-title>{{item.title}}</v-list-tile-title><v-list-tile-sub-title class="ellipsis clickable" v-html="item.msg"></v-list-tile-sub-title></v-list-tile-content><v-list-tile-action v-if="item.cancelable" @click.stop="cancel(item)"><v-btn icon flat><v-icon>cancel</v-icon></v-btn></v-list-tile-action></v-list-tile></template></v-list></v-flex><v-flex xs12 v-else><div style="padding-top:64px;width:100%;display:flex;justify-content:center;align-items:center;">{{i18n(\'No notifications.\')}}</div></v-flex><div class="dialog-padding"></div></v-layout></v-container></v-card-text></v-card></v-dialog>',
props:[],data:function(){return{show:!1}},mounted:function(){bus.$on("notifications.open",function(){this.show=!0}.bind(this));bus.$on("esc",function(){"notifications"==this.$store.state.activeDialog&&this.close()}.bind(this))},methods:{close:function(){this.show=!1},cancel:function(a){1==this.$store.state.notifications.length&&this.close();lmsCommand("",["material-skin","send-notif","type:notif","msg:-","id:"+a.id])},i18n:function(a,b){return this.show?i18n(a,b):a}},computed:{items:function(){return this.$store.state.notifications}},
watch:{show:function(a){this.$store.commit("dialogOpen",{name:"notifications",shown:a})}}});var lmsGallery=Vue.component("lms-gallery",{template:'<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"><div class="pswp__bg"></div><div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div><div class="pswp__item"></div><div class="pswp__item"></div></div><div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div><button class="pswp__button pswp__button--close"></button><button v-if="!IS_MOBILE" class="pswp__button pswp__button--fs"></button><button v-if="!IS_MOBILE" class="pswp__button pswp__button--zoom"></button><div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div><button class="pswp__button pswp__button--arrow--left"></button><button class="pswp__button pswp__button--arrow--right"></button><div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div>',
mounted:function(){bus.$on("gallery.open",function(a,b){for(var c=this,d=[],f=0,h=a.length;f<h;++f)d.push({src:changeImageSizing(a[f]),w:0,h:0});this.gallery=new PhotoSwipe(document.querySelectorAll(".pswp")[0],PhotoSwipeUI_Default,d,{index:b});this.gallery.listen("gettingData",function(a,b){if(1>b.w||1>b.h)a=new Image,a.onload=function(){b.w=this.width;b.h=this.height;c.gallery.updateSize(!0)},a.src=b.src});this.gallery.init();this.$store.commit("dialogOpen",{name:"gallery",shown:!0});this.gallery.listen("close",
function(){setTimeout(function(){c.$store.commit("dialogOpen",{name:"gallery",shown:!1})},500)})}.bind(this));bus.$on("esc",function(){"gallery"==this.$store.state.activeDialog&&this.gallery.close()}.bind(this))}});

