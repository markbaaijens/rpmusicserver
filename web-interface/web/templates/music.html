{% extends 'base.html' %}

{% block content %}
    <h2>Music</h2>

    <a class="external-link" href="{{ machineInfo.HostUrl }}:9000" target="_blank">Lyrion Music Server</a>&nbsp;&nbsp;

    <h3>Players</h3>
    <p>
    {% if lmsPlayers %}
        {% for lmsPlayer in lmsPlayers %}
            <div>
                {% if lmsPlayer.Type == 'pc' %}
                    <img src="{{ url_for('static',filename='players/pc.svg') }}" class="icon-player">
                {% else %}
                    {% if lmsPlayer.Type == 'pi' %}
                        <img src="{{ url_for('static',filename='players/pi.svg') }}" class="icon-player">
                    {% else %}
                        {% if lmsPlayer.Type == 'sb-boom' %}
                            <img src="{{ url_for('static',filename='players/sb-boom.svg') }}" class="icon-player">
                        {% else %}
                            {% if lmsPlayer.Type == 'sb-radio' %}
                                <img src="{{ url_for('static',filename='players/sb-radio.svg') }}" class="icon-player">
                            {% else %}                        
                                {% if lmsPlayer.Type == 'sb-receiver' %}
                                    <img src="{{ url_for('static',filename='players/sb-receiver.svg') }}" class="icon-player">
                                {% else %}
                                    {% if lmsPlayer.Type == 'sb-touch' %}
                                        <img src="{{ url_for('static',filename='players/sb-touch.svg') }}" class="icon-player">
                                    {% else %}                                    
                                        {% if lmsPlayer.Type == 'sb-classic' %}
                                            <img src="{{ url_for('static',filename='players/sb-classic.svg') }}" class="icon-player">
                                        {% else %}
                                            {% if lmsPlayer.Type == 'sb-transporter' %}
                                                <img src="{{ url_for('static',filename='players/sb-transporter.svg') }}" class="icon-player">
                                            {% else %}
                                                <img src="{{ url_for('static',filename='players/sb-receiver.svg') }}" class="icon-player">
                                            {% endif %}
                                        {% endif %}
                                    {% endif %} 
                                {% endif %} 
                            {% endif %} 
                        {% endif %}
                    {% endif %} 
                {% endif %} 
                {% if lmsPlayer.IsWebServer %}            
                    <a class="external-link" href="http://{{ lmsPlayer.IpAddress }}" target="_blank">
                        <b>{{ lmsPlayer.Name }}</b>
                    </a>
                {% else %}
                    <b>{{ lmsPlayer.Name }}</b>            
                {% endif %}    
                {% if lmsPlayer.Model == 'squeezelite' %}
                    <small>
                        &nbsp;{{ lmsPlayer.Model }}                
                    </small>
                {% endif %}                
            </div>
        {% endfor %} 
    {% else %}
        {% if lmsServerStatus['info total artists'] %}
            <span class="checkmark-n">No players connected</span>
        {% else %}
            <span class="checkmark-n">Music-server is not active</span>
        {% endif %}    
    {% endif %}   

    <h3>Collection</h3>   
    <table>
        <tr>
            <td>Info</td>
            <td>
                {% if lmsServerStatus['info total artists'] %}
                    <b>{{ lmsServerStatus['info total artists'] }}</b> artists |
                    <b>{{ lmsServerStatus['info total albums'] }}</b> albums |
                    <b>{{ lmsServerStatus['info total songs'] }}</b> songs |
                    <b>{{ lmsServerStatus['info total genres'] }}</b> genres
                {% else %}
                    <b>-</b>
                {% endif %}    
            </td>
        </tr>
        <tr>
            <td>Last Export</td>
            <td><b>{{ musicCollectionInfo.LastExport }}</b></td>
        </tr>
        <tr>
            <td>Export Folder</td>
            <td><b>{{ musicCollectionInfo.CollectionFolderFunctional }}</b></td>
        </tr>
    </table> 
    <br>

    {% if lmsServerStatus['info total artists'] %}
        <a href="/ask-export-collection" class="link-button">Export</a>   
    {% else %}
        <a class="link-button disabled">Export</a> 
    {% endif %}  

    <h3>Flac Health
        <a href="https://github.com/markbaaijens/rpmusicserver#flac-health" target="_blank">
            <img src="{{ url_for('static',filename='help.png') }}" class="icon-help">
         </a>        
    </h3>
    <table>
        <tr>
            <td>Last Check</td>
            <td>
                <b>
                    {{ flacHealthInfo.LastCheck }}
                    {% if flacHealthInfo.CheckType != 'none' %}
                        |
                        {% if flacHealthInfo.CheckType == 'new' %}
                            New Folders
                        {% endif %}
                        {% if flacHealthInfo.CheckType == 'all' %}
                            All Folders
                        {% endif %}
                        {% if flacHealthInfo.IsRepairing %}
                            - Repairing
                        {% endif %}                    
                        {% if flacHealthInfo.IsChecking %}
                            - Checking
                        {% endif %}
                    {% endif %}                        
                </b>
            </td>
        </tr>
        <tr>
            <td>Summary</td>
            <td>
                {% if flacHealthInfo.IsChecked %}
                    <b>{{ flacHealthInfo.FolderCount }}</b> folder(s) |

                    {% if flacHealthInfo.ErrorCount == 0 %}
                        <b><span class="checkmark-y">{{ flacHealthInfo.ErrorCount }}</span></b> error(s) |
                    {% else %}
                        <b><span class="checkmark-n">{{ flacHealthInfo.ErrorCount }}</span></b> error(s) |
                    {% endif %}                  

                    {% if flacHealthInfo.WarningCount == 0 %}
                        <b><span class="checkmark-y">{{ flacHealthInfo.WarningCount }}</span></b> warning(s) |
                    {% else %}
                        <b><span class="checkmark-n">{{ flacHealthInfo.WarningCount }}</span></b> warning(s) |
                    {% endif %}                                  

                    {% if flacHealthInfo.TagId3v2Count == 0 %}
                        <b><span class="checkmark-y">{{ flacHealthInfo.TagId3v2Count }}</span></b> id3v2-tag(s) |
                    {% else %}
                        <b><span class="checkmark-n">{{ flacHealthInfo.TagId3v2Count }}</span></b> id3v2-tag(s) |
                    {% endif %}                                                      

                    {% if flacHealthInfo.CorruptFolderCount == 0 %}
                        <b><span class="checkmark-y">{{ flacHealthInfo.CorruptFolderCount }}</span></b> corrupt folder(s)
                    {% else %}
                        <b><span class="checkmark-n">{{ flacHealthInfo.CorruptFolderCount }}</span></b> corrupt folder(s)
                    {% endif %}                                                  
                {% else %}
                    <b>-</b>
                {% endif %}                                                                      
            </td>
        </tr>
    </table> 
    <br>

    <div>
        {% if flacHealthInfo.IsChecking or flacHealthInfo.IsRepairing %}
            <a class="link-button disabled">Check New</a> 
            <a class="link-button disabled">Check All</a>             
        {% else %}                    
            <a href="/ask-flac-health-check-new" class="link-button">Check New</a>
            <a href="/ask-flac-health-check-all" class="link-button">Check All</a>
        {% endif %}

        {% if flacHealthInfo.IsRepairFilePresent %}
            {% if flacHealthInfo.IsRepairing %}        
                <a class="link-button disabled">Repair</a> 
            {% else %}
                <a href="/ask-flac-health-repair" class="link-button">Repair</a>
            {% endif %}         
        {% else %}
            <a class="link-button disabled">Repair</a> 
        {% endif %}         
    </div>

    <div class="indent">
        <p>
        <a href="/logs/flac-health-check/20">Log</a> | <a href="/logs/flac-health-report">Report</a>
    </div>       

{% endblock %}